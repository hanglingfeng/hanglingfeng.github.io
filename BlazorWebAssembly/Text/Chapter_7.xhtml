<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>Chapter_7</title>
  <link href="../Styles/syntax-highlighting.css" rel="stylesheet" type="text/css"/>
  <link href="../Styles/epub.css" rel="stylesheet" type="text/css"/>
</head>

<body id="Chapter_7" lang="en-US" xml:lang="en-US">
  <div id="_idContainer215" class="Basic-Text-Frame">
    <h1 class="chapterNumber">7</h1>
    <h1 id="_idParaDest-218" class="chapterTitle">Building a Shopping Cart Using Application State</h1>
    <p class="normal">Sometimes, we need our applications to maintain their state between different pages. We can accomplish this by<a id="_idIndexMarker539"></a> using <strong class="keyWord">dependency injection</strong> (<strong class="keyWord">DI</strong>). DI is used to access services that are configured in a central location.</p>
    <p class="normal">In this chapter, we will create a shopping cart. As we add and delete items from the shopping cart, the application will maintain a list of the items in the shopping cart. The contents of the shopping cart will be retained when we navigate to another page and then return to the page with the shopping cart. Also, the shopping cart’s total will be displayed on all the pages.</p>
    <blockquote class="packt_quote">
      <p class="quote">Application state,</p>
      <p class="quote">dependency injection</p>
      <p class="quote">a team built on trust!</p>
    </blockquote>
    <p class="normal">In this chapter, we will cover the following topics:</p>
    <ul>
      <li class="bulletList">Introducing the application state</li>
      <li class="bulletList">Understanding DI</li>
      <li class="bulletList">Creating the shopping cart project</li>
    </ul>
    <h1 id="_idParaDest-219" class="heading-1">Technical requirements</h1>
    <p class="normal">To complete this project, you need to have Visual Studio 2022 installed on your PC. For instructions on how to install the free Community Edition of Visual Studio 2022, refer to <em class="chapterRef">Chapter 1</em>, <em class="italic">Introduction to Blazor WebAssembly</em>.</p>
    <p class="normal">The source code for this chapter is available in the following GitHub repository: <a href="https://github.com/PacktPublishing/Blazor-WebAssembly-by-Example-Second-Edition/tree/main/Chapter07"><span class="url">https://github.com/PacktPublishing/Blazor-WebAssembly-by-Example-Second-Edition/tree/main/Chapter07</span></a>.</p>
    <p class="normal">The Code in Action video is available here: <a href="https://packt.link/Ch7"><span class="url">https://packt.link/Ch7</span></a>.</p>
    <h1 id="_idParaDest-220" class="heading-1">Introducing the application state</h1>
    <p class="normal">In a Blazor WebAssembly app, the <a id="_idIndexMarker540"></a>browser’s memory is used to hold the application’s state. This means that when the user navigates between pages, the state is lost unless we preserve it. We will be using the <code class="inlineCode">AppState</code> pattern to preserve the application’s state.</p>
    <p class="normal">In the <code class="inlineCode">AppState</code> pattern, a service is added to a DI container to coordinate the state between related components. The service contains all the states that need to be maintained. Because the service is managed by the DI container, it can outlive individual components and retain the state of the application as the UI changes.</p>
    <p class="normal">The service can be a simple class or a complex class. One service can be used to manage the state of multiple components across the entire application. One benefit of the <code class="inlineCode">AppState</code> pattern is that it leads to a greater separation between presentation logic and business logic.</p>
    <div class="note">
      <p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
      <p class="normal">The application state that is held in the browser’s memory is lost when the user reloads the page.</p>
    </div>
    <p class="normal">For the project in this chapter, we will use a DI service instance to preserve the application’s state.</p>
    <h1 id="_idParaDest-221" class="heading-1">Understanding DI</h1>
    <p class="normal">DI is a <a id="_idIndexMarker541"></a>technique in which an object accesses services that have been configured in a central location. The central location is the DI container. When using DI, each consuming class does not need to create its own instance of the injected class that it has a dependency on. It is provided by the framework and is called a service. In a Blazor WebAssembly application, the services are defined in the <code class="inlineCode">program.cs</code> file.</p>
    <p class="normal">We have already used DI in this book with the following services:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">HttpClient</code></li>
      <li class="bulletList"><code class="inlineCode">IJSRuntime</code></li>
      <li class="bulletList"><code class="inlineCode">NavigationManager</code></li>
    </ul>
    <h2 id="_idParaDest-222" class="heading-2">DI containers</h2>
    <p class="normal">When a Blazor WebAssembly <a id="_idIndexMarker542"></a>application starts, it configures a DI container. The DI container is responsible for building the instances of the service and it lives until the user closes the tab in the browser that is running the web app. In the following example, the <code class="inlineCode">CartService</code> implementation is registered for <code class="inlineCode">ICartService</code>:</p>
    <pre class="programlisting code"><code class="hljs-code">builder.Services.AddSingleton&lt;ICartService, CartService&gt;();
</code></pre>
    <p class="normal">After a service has been added to a DI container, we use the @inject directive to inject the service into any classes that depend on it. The <code class="inlineCode">@inject</code> directive takes two parameters, <code class="inlineCode">Type</code> and <code class="inlineCode">Property</code>:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">Type</code>: This is the type of service.</li>
      <li class="bulletList"><code class="inlineCode">Property</code>: This is the name of the property that is receiving the service.</li>
    </ul>
    <p class="normal">The following example shows how to use the <code class="inlineCode">@inject</code> directive to reference the <code class="inlineCode">CartService</code> that was registered in the preceding code:</p>
    <pre class="programlisting code"><code class="hljs-code">@inject ICartService cartService
</code></pre>
    <p class="normal">Dependencies are injected after the component instance has been created, but before the <code class="inlineCode">OnInitialized</code> or <code class="inlineCode">OnInitializedAsync</code> life cycle events are executed. This means that you cannot use the injected class in the component’s constructor, but you can use it in either the <code class="inlineCode">OnInitialized</code> or <code class="inlineCode">OnInitializedAsync</code> method.</p>
    <p class="normal">The lifetime of each service is designated when it is registered.</p>
    <h2 id="_idParaDest-223" class="heading-2">Service lifetimes</h2>
    <p class="normal">The lifetime of a <a id="_idIndexMarker543"></a>service that is injected using DI can be any of the following values:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Singleton</strong></li>
      <li class="bulletList"><strong class="keyWord">Scoped</strong></li>
      <li class="bulletList"><strong class="keyWord">Transient</strong></li>
    </ul>
    <h3 id="_idParaDest-224" class="heading-3">Singleton</h3>
    <p class="normal">If the service’s lifetime is<a id="_idIndexMarker544"></a> defined as <code class="inlineCode">Singleton</code>, this means that a single instance of the class will be created and that instance will be shared throughout the application. Any components that use the service will receive an instance of the same service. In a Blazor WebAssembly application, this is true for the lifetime of the current application that is running in the current tab of the browser.</p>
    <p class="normal">The following code will create a shared instance of the <code class="inlineCode">ICartService</code> class:</p>
    <pre class="programlisting code"><code class="hljs-code">builder.Services.AddSingleton&lt;ICartService, CartService&gt;();
</code></pre>
    <p class="normal">This is the lifetime of the service that we will use to manage the application’s state in this chapter’s project.</p>
    <h3 id="_idParaDest-225" class="heading-3">Scoped</h3>
    <p class="normal">If the service’s<a id="_idIndexMarker545"></a> lifetime is defined as <code class="inlineCode">Scoped</code>, this means that a new instance of the class will be created for each scope. Since a Blazor WebAssembly application’s concept of the scope coincides with the life cycle of the application, <code class="inlineCode">Scoped</code>-registered services are treated like <code class="inlineCode">Singleton</code> services.</p>
    <p class="normal">The following code will create a shared instance of the <code class="inlineCode">ICartService</code> class:</p>
    <pre class="programlisting code"><code class="hljs-code">builder.Services.AddScoped&lt;ICartService, CartService&gt;();
</code></pre>
    <p class="normal">The instance created by the preceding code is identical to the instance created by using the <code class="inlineCode">AddSingleton</code> method.</p>
    <div class="note">
      <p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
      <p class="normal">In the Blazor WebAssembly project templates provided by Microsoft, they use a <code class="inlineCode">Scoped</code> service to create the <code class="inlineCode">HttpClient</code> instance for data access. This is because Microsoft’s project templates use the <code class="inlineCode">Scoped</code> service lifetime for their services for symmetry with server-side Blazor.</p>
    </div>
    <h3 id="_idParaDest-226" class="heading-3">Transient</h3>
    <p class="normal">If the service lifetime of the <a id="_idIndexMarker546"></a>service is defined as <code class="inlineCode">Transient</code>, this means that a new instance of the class will be created every time an instance of the service is requested. When using <code class="inlineCode">Transient</code> services, the DI container acts as a factory that creates unique instances of the class. Once the instance is created and injected into the dependent component, the container has no further interest in it.</p>
    <p class="normal">The following code will create a transient instance of the <code class="inlineCode">OneUseService</code> class:</p>
    <pre class="programlisting code"><code class="hljs-code">builder.Services.AddTransient&lt;IOneUseService, OneUseService&gt;();
</code></pre>
    <p class="normal">The service’s lifetime is defined in the DI container. A service instance can be either scoped or transient.</p>
    <p class="normal">We can use DI to inject the same service instance into multiple components. DI is used by the <code class="inlineCode">AppState</code> pattern to allow the application to maintain the state between components.</p>
    <p class="normal">Now, let’s get a quick overview of the project that we are going to build in this chapter.</p>
    <h1 id="_idParaDest-227" class="heading-1">Creating the shopping cart project</h1>
    <p class="normal">In this chapter, we will build a<a id="_idIndexMarker547"></a> Blazor WebAssembly app that includes a shopping cart. We will be able to add and remove different products from the shopping cart. The cart’s total will be displayed on each of the pages in the app.</p>
    <p class="normal">The following is a screenshot of the completed application:</p>
    <figure class="mediaobject"><img src="../Images/B18471_07_01.png" alt="Graphical user interface

Description automatically generated"/></figure>
    <p class="packt_figref">Figure 7.1: Shopping cart app</p>
    <p class="normal">The build <a id="_idIndexMarker548"></a>time for this project is approximately 60 minutes.</p>
    <h2 id="_idParaDest-228" class="heading-2">Project overview</h2>
    <p class="normal">The <code class="inlineCode">ShoppingCart</code> project <a id="_idIndexMarker549"></a>will be created by using Microsoft’s <strong class="keyWord">Blazor WebAssembly App Empty</strong> project template to create an empty Blazor WebAssembly project. First, we will add logic to add and remove products from the shopping cart. Then, we will demonstrate that the cart’s state is lost when we navigate between pages. To maintain the cart’s state, we will register a service in the DI container that uses the <code class="inlineCode">AppState</code> pattern. Finally, we will demonstrate that by injecting the new service into the relevant components, the cart’s state is not lost.</p>
    <h2 id="_idParaDest-229" class="heading-2">Creating the shopping cart project</h2>
    <p class="normal">We need to create a<a id="_idIndexMarker550"></a> new Blazor WebAssembly app. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open Visual Studio 2022.</li>
      <li class="numberedList">Click on the <strong class="screenText">Create a new project</strong> button.</li>
      <li class="numberedList">Press <em class="keystroke">Alt</em>+<em class="keystroke">S</em> to enter the search for templates textbox.</li>
      <li class="numberedList">Enter <code class="inlineCode">Blazor</code> and press the <em class="keystroke">Enter</em> key.
    <p class="normal">The following screenshot shows the <strong class="screenText">Blazor WebAssembly App Empty</strong> project template.</p>
    <figure class="mediaobject"><img src="../Images/B18471_07_02.png" alt="Graphical user interface, text, application, chat or text message

Description automatically generated"/></figure>
    <p class="packt_figref">Figure 7.2: Blazor WebAssembly App Empty project template</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Select<a id="_idIndexMarker551"></a> the <strong class="screenText">Blazor WebAssembly App Empty</strong> project template and click on the <strong class="screenText">Next</strong> button.</li>
      <li class="numberedList">Enter <code class="inlineCode">ShoppingCart</code> in the <strong class="screenText">Project name</strong> textbox and click on the <strong class="screenText">Next</strong> button.
    <p class="normal">This is a screenshot of the dialog used to configure our new project:</p>
    <figure class="mediaobject"><img src="../Images/B18471_07_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 7.3: Configure your new project dialog</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">In the preceding example, we placed the <code class="inlineCode">ShoppingCart</code> project into the <code class="inlineCode">E:/Blazor</code> folder. However, the location of this project is not important.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Select <strong class="screenText">.NET 7.0</strong> as the version of the <strong class="screenText">Framework</strong> to use.</li>
      <li class="numberedList">Check the <strong class="screenText">Configure for HTTPS</strong> checkbox.</li>
      <li class="numberedList">Uncheck<a id="_idIndexMarker552"></a> the <strong class="screenText">ASP.NET Core Hosted</strong> checkbox.</li>
      <li class="numberedList">Uncheck the <strong class="screenText">Progressive Web Application</strong> checkbox.
    <p class="normal">This is a screenshot of the dialog used to collect additional information about our new project:</p>
    <figure class="mediaobject"><img src="../Images/B18471_07_04.png" alt="Graphical user interface, text, application, email

Description automatically generated"/></figure>
    <p class="packt_figref">Figure 7.4: Additional information dialog</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Click <a id="_idIndexMarker553"></a>on the <strong class="screenText">Create</strong> button.</li>
    </ol>
    <p class="normal">We have created an empty <code class="inlineCode">ShoppingCart</code> Blazor WebAssembly project. We will use <code class="inlineCode">Bootstrap</code> to style our frontend.</p>
    <h2 id="_idParaDest-230" class="heading-2">Installing Bootstrap</h2>
    <p class="normal">We<a id="_idIndexMarker554"></a> need to install <code class="inlineCode">Bootstrap</code> into our web app. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click on the <code class="inlineCode">wwwroot/css</code> folder and select the <strong class="screenText">Add</strong>,<strong class="screenText"> Client-Side Library</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">bootstrap</code> into the <strong class="screenText">Library</strong> search textbox and press the <em class="keystroke">Enter</em> key.</li>
      <li class="numberedList">Select <strong class="screenText">Choose specific files</strong>.</li>
      <li class="numberedList">Select <code class="inlineCode">css</code> files only, as shown in the following screenshot:
    <figure class="mediaobject"><img src="../Images/B18471_07_05.png" alt="Graphical user interface, text, application, email

Description automatically generated"/></figure>
    <p class="packt_figref">Figure 7.5: Add Client-Side Library dialog</p>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">Although the preceding screenshot has version 5.2.2 of <code class="inlineCode">Bootstrap</code> selected, you can use any version of <code class="inlineCode">Bootstrap</code> to complete this project.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Click <a id="_idIndexMarker555"></a>on the <strong class="screenText">Install</strong> button.
    <div class="note">
      <p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
      <p class="normal">After you install <code class="inlineCode">Bootstrap</code>, a new folder will be added to the <code class="inlineCode">wwwroot/css</code> folder. This new folder contains all the CSS files needed for <code class="inlineCode">Bootstrap</code>. We will only be using the <code class="inlineCode">bootstrap.min.css</code> file in this project.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Open<a id="_idIndexMarker556"></a> the <code class="inlineCode">wwwroot/index.html</code> file.</li>
      <li class="numberedList">Add the following markup to the <code class="inlineCode">head</code> element before the link to the <code class="inlineCode">css/app.css</code> stylesheet:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">link</span><span class="hljs-tag"> </span><span class="hljs-attr">href</span><span class="hljs-tag">=</span><span class="hljs-string">"css/bootstrap/css/bootstrap.min.css"</span><span class="hljs-tag"> </span>
<span class="hljs-tag">        </span><span class="hljs-attr">rel</span><span class="hljs-tag">=</span><span class="hljs-string">"stylesheet"</span><span class="hljs-tag"> /&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">MainLayout.razor</code> file.</li>
      <li class="numberedList">Update the <code class="inlineCode">main</code> element to the following:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">main</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"px-4"</span><span class="hljs-tag">&gt;</span>
    @Body
<span class="hljs-tag">&lt;/</span><span class="hljs-name">main</span><span class="hljs-tag">&gt;</span>
</code></pre>
      
    <p class="normal">The preceding code uses <code class="inlineCode">Bootstrap</code> to add padding around the body of the page.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="10">Open the <code class="inlineCode">Pages/Index.razor</code> file.</li>
      <li class="numberedList">Delete the <code class="inlineCode">h1</code> element.</li>
      <li class="numberedList">Add the following markup:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">PageTitle</span><span class="hljs-tag">&gt;</span>Home<span class="hljs-tag">&lt;/</span><span class="hljs-name">PageTitle</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"bg-light"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">ol</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"breadcrumb"</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">li</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"breadcrumb-item active"</span><span class="hljs-tag">&gt;</span>Home<span class="hljs-tag">&lt;/</span><span class="hljs-name">li</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">ol</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">h1</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"display-3"</span><span class="hljs-tag">&gt;</span>Welcome to Blazing Tasks!<span class="hljs-tag">&lt;/</span><span class="hljs-name">h1</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>
    The store is open for business.
<span class="hljs-tag">&lt;/</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">type</span><span class="hljs-tag">=</span><span class="hljs-string">"button"</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"btn btn-danger mt-2"</span><span class="hljs-tag">&gt;</span>
    Start Shopping
<span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
</code></pre>
      
    <p class="normal">The preceding code includes a breadcrumb that will be styled by using <code class="inlineCode">Bootstrap</code>. A breadcrumb indicates the page’s current location within a navigational hierarchy. The code also includes a button. However, the button does not yet do anything. </p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="13">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start <a id="_idIndexMarker557"></a>the application without debugging.
    <p class="normal">This is a screenshot of the <strong class="screenText">Home</strong> page:</p>
    <figure class="mediaobject"><img src="../Images/B18471_07_06.png" alt="A picture containing text

Description automatically generated"/></figure>
    <p class="packt_figref">Figure 7.6: Home page of the ShoppingCart project</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="14">Click on the <strong class="screenText">Start Shopping</strong> button to verify that nothing happens.</li>
      <li class="numberedList">Close<a id="_idIndexMarker558"></a> the browser.</li>
    </ol>
    <p class="normal">When the user clicks the <strong class="screenText">Start Shopping</strong> button, they should navigate to the <strong class="screenText">Store</strong> page. However, the <strong class="screenText">Store</strong> page does not yet exist.</p>
    <h2 id="_idParaDest-231" class="heading-2">Adding a Store component</h2>
    <p class="normal">We need to <a id="_idIndexMarker559"></a>add a <code class="inlineCode">Store</code> component. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click on the <code class="inlineCode">Pages</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">Razor Component</strong> option from the menu.</li>
      <li class="numberedList">Name the new component <code class="inlineCode">Store</code>.</li>
      <li class="numberedList">Click on the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Delete the <code class="inlineCode">H3</code> element.</li>
      <li class="numberedList">Add the following markup before the code block:
        <pre class="programlisting code"><code class="hljs-code">@page "/store"
<span class="hljs-tag">&lt;</span><span class="hljs-name">PageTitle</span><span class="hljs-tag">&gt;</span>Store<span class="hljs-tag">&lt;/</span><span class="hljs-name">PageTitle</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">ol</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"breadcrumb bg-light"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">li</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"breadcrumb-item"</span><span class="hljs-tag">&gt;&lt;</span><span class="hljs-name">a</span><span class="hljs-tag"> </span><span class="hljs-attr">href</span><span class="hljs-tag">=</span><span class="hljs-string">"#"</span><span class="hljs-tag">&gt;</span>Home<span class="hljs-tag">&lt;/</span><span class="hljs-name">a</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">li</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">li</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"breadcrumb-item active"</span><span class="hljs-tag">&gt;</span>Store<span class="hljs-tag">&lt;/</span><span class="hljs-name">li</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ol</span><span class="hljs-tag">&gt;</span>
</code></pre>
      
    <p class="normal">The preceding code includes a breadcrumb that we can use to navigate to the <strong class="screenText">Home</strong> page.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Open the <code class="inlineCode">Pages/Index.razor</code> file.</li>
      <li class="numberedList">Add the following <code class="inlineCode">@inject</code> directive:
        <pre class="programlisting code"><code class="hljs-code">@inject NavigationManager navigation
</code></pre>
      
    <p class="normal">The <code class="inlineCode">NavigationManager</code> service is provided by the framework to manage URI navigation.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Add the <a id="_idIndexMarker560"></a>following code block:
        <pre class="programlisting code"><code class="hljs-code">@code{
    <span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OpenStore</span><span class="hljs-function">()</span>
    {
        navigation.NavigateTo(<span class="hljs-string">"store"</span>);
    }  
}
</code></pre>
      
    <p class="normal">In the preceding code, when <code class="inlineCode">OpenStore</code> is called, the <code class="inlineCode">NavigationManager</code> will navigate to the <code class="inlineCode">Store</code> page. Since this is a SPA, the page will not need to be reloaded.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">Add the following <code class="inlineCode">@onclick</code> event to the <strong class="screenText">Start Shopping</strong> button:
        <pre class="programlisting code"><code class="hljs-code">@onclick=<span class="hljs-string">"OpenStore"</span>
</code></pre>
      </li>
      <li class="numberedList">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Click on the <strong class="screenText">Start Shopping</strong> button to navigate to the <strong class="screenText">Store</strong> page.</li>
      <li class="numberedList">Click on the <strong class="screenText">Home</strong> breadcrumb to return to the <strong class="screenText">Home</strong> page.</li>
      <li class="numberedList">Close<a id="_idIndexMarker561"></a> the browser.</li>
    </ol>
    <p class="normal">We have added the <strong class="screenText">Store</strong> page. However, it is blank.</p>
    <h2 id="_idParaDest-232" class="heading-2">Adding a Product class</h2>
    <p class="normal">We need to add <a id="_idIndexMarker562"></a>the products that are for sale. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click on the <code class="inlineCode">ShoppingCart</code> project and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder </strong>option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">Models</code>.</li>
      <li class="numberedList">Right-click on the <code class="inlineCode">Models</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">Class</strong> option from the menu.</li>
      <li class="numberedList">Name the new class <code class="inlineCode">Product</code>.</li>
      <li class="numberedList">Click on the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Add the following properties to the <code class="inlineCode">Product</code> class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ProductId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Price { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Image { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</code></pre>
      </li>
      <li class="numberedList">Right-click on the <code class="inlineCode">wwwroot</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder</strong> option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">sample-data</code>.</li>
      <li class="numberedList">Right-click on the <code class="inlineCode">sample-data</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Item</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">json</code> in the <strong class="screenText">Search</strong> box.</li>
      <li class="numberedList">Select <strong class="screenText">JSON File</strong>.</li>
      <li class="numberedList">Name the file <code class="inlineCode">products.json</code>.</li>
      <li class="numberedList">Click on the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Update the file to the following:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"productId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"</span><span class="hljs-attr">productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Charger"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"image"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"charger.jpg"</span>
  <span class="hljs-punctuation">},</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"productId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Ear Buds"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"image"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"earbuds.jpg"</span>
  <span class="hljs-punctuation">},</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"productId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Key Chain"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"</span><span class="hljs-attr">price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"image"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keychain.jpg"</span>
  <span class="hljs-punctuation">},</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"productId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Travel Mug"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"image"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"travelmug.jpg"</span>
  <span class="hljs-punctuation">},</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"productId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"T-Shirt"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"</span><span class="hljs-attr">image"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tshirt.jpg"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
      </li>
    </ol>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">You can copy the <code class="inlineCode">products.json</code> file from the GitHub repository.</p>
    </div>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="15">Right-click on the <code class="inlineCode">wwwroot</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder</strong> option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">images</code>.</li>
      <li class="numberedList">Copy <a id="_idIndexMarker563"></a>the following images from the GitHub repository to the <code class="inlineCode">images</code> folder: <code class="inlineCode">Charger.jpg</code>, <code class="inlineCode">Earbuds.jpg</code>, <code class="inlineCode">KeyChain.jpg</code>, <code class="inlineCode">TravelMug.jpg</code>, and <code class="inlineCode">Tshirt.jpg</code>.</li>
    </ol>
    <p class="normal">We have added a collection of products to our web app. Next, we need to finish the <code class="inlineCode">Store</code> page.</p>
    <h2 id="_idParaDest-233" class="heading-2">Finishing the Store component</h2>
    <p class="normal">We need to add<a id="_idIndexMarker564"></a> a list of the items that are for sale in our store, and we need to add the ability to select the items that we would like to purchase. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">Pages/Store.razor</code> file.</li>
      <li class="numberedList">Add the following directives:
        <pre class="programlisting code"><code class="hljs-code">@using ShoppingCart.Models
@inject HttpClient Http
</code></pre>
      </li>
      <li class="numberedList">Add the following code to the code block:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> IList&lt;Product&gt;? products;
<span class="hljs-keyword">public</span> IList&lt;Product&gt; cart = <span class="hljs-keyword">new</span> List&lt;Product&gt;();
<span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> total;
<span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">override</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> Task </span><span class="hljs-title">OnInitializedAsync</span><span class="hljs-function">()</span>
{
    products = <span class="hljs-keyword">await</span> Http.GetFromJsonAsync&lt;Product[]&gt;
            (<span class="hljs-string">"sample-data/products.json"</span>);
}
</code></pre>
      
    <p class="normal">The preceding code uses <code class="inlineCode">HttpClient</code> to populate the list of products from the <code class="inlineCode">products.json</code> file.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Add the<a id="_idIndexMarker565"></a> following <code class="inlineCode">if</code> statement before the code block:
        <pre class="programlisting code"><code class="hljs-code">@if (products == null)
{
    <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;&lt;</span><span class="hljs-name">em</span><span class="hljs-tag">&gt;</span>Loading...<span class="hljs-tag">&lt;/</span><span class="hljs-name">em</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
}
else
{
    <span class="hljs-tag">&lt;</span><span class="hljs-name">h1</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"display-3"</span><span class="hljs-tag">&gt;</span>Products<span class="hljs-tag">&lt;/</span><span class="hljs-name">h1</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"row"</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">id</span><span class="hljs-tag">=</span><span class="hljs-string">"products"</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"col-xl-4 col-lg-6"</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">id</span><span class="hljs-tag">=</span><span class="hljs-string">"cart"</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"col-xl-3 col-lg-4"</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
}
</code></pre>
      
    <p class="normal">The preceding code displays the <strong class="screenText">Loading...</strong> message until the list of products is loaded. Once the list of products has loaded, it displays the products and the cart.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Add the following markup to the <code class="inlineCode">products</code> element:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">table</span><span class="hljs-tag"> </span><span class="hljs-attr">width</span><span class="hljs-tag">=</span><span class="hljs-string">"100%"</span><span class="hljs-tag">&gt;</span>
    @foreach (Product item in products)
    {
        <span class="hljs-tag">&lt;</span><span class="hljs-name">tr</span><span class="hljs-tag">&gt;</span>
            <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
                <span class="hljs-tag">&lt;</span><span class="hljs-name">img</span><span class="hljs-tag"> </span><span class="hljs-attr">src</span><span class="hljs-tag">=</span><span class="hljs-string">"images/@item.Image"</span><span class="hljs-tag"> /&gt;</span>
            <span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
            <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"align-middle"</span><span class="hljs-tag">&gt;</span>
                @item.ProductName
            <span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
            <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"align-middle"</span><span class="hljs-tag">&gt;</span>
                $@item.Price
            <span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
            <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"align-middle"</span><span class="hljs-tag">&gt;</span>
                <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">type</span><span class="hljs-tag">=</span><span class="hljs-string">"button"</span><span class="hljs-tag"> </span>
<span class="hljs-tag">                        </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"btn btn-danger"</span><span class="hljs-tag">&gt;</span>
                    Add to Cart
                <span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
            <span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;/</span><span class="hljs-name">tr</span><span class="hljs-tag">&gt;</span>
    }
<span class="hljs-tag">&lt;/</span><span class="hljs-name">table</span><span class="hljs-tag">&gt;</span>
</code></pre>
      
    <p class="normal">The preceding markup adds a table that displays all the products that are for sale.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Add the<a id="_idIndexMarker566"></a> following markup to the <code class="inlineCode">cart</code> element:
        <pre class="programlisting code"><code class="hljs-code">@if (cart.Any())
{
    <span class="hljs-tag">&lt;</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>Your Cart<span class="hljs-tag">&lt;/</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">ul</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"list-group"</span><span class="hljs-tag">&gt;</span>
        @foreach (Product item in cart)
        {
            <span class="hljs-tag">&lt;</span><span class="hljs-name">li</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"list-group-item p-2"</span><span class="hljs-tag">&gt;</span>
                <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">type</span><span class="hljs-tag">=</span><span class="hljs-string">"button"</span><span class="hljs-tag"> </span>
<span class="hljs-tag">                        </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"btn btn-sm btn-danger me-2"</span><span class="hljs-tag">&gt;</span>
                    Delete
                <span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
                @item.ProductName - $@item.Price
            <span class="hljs-tag">&lt;/</span><span class="hljs-name">li</span><span class="hljs-tag">&gt;</span>
        }
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">ul</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"p-2"</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">h3</span><span class="hljs-tag">&gt;</span>Total: $@total<span class="hljs-tag">&lt;/</span><span class="hljs-name">h3</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
}
</code></pre>
      
    <p class="normal">The preceding markup displays all the items in our cart.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Add the <code class="inlineCode">AddProduct</code> method to the code block:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">AddProduct</span><span class="hljs-function">(</span><span class="hljs-params">Product product</span><span class="hljs-function">)</span>
{
    cart.Add(product);
    total += product.Price;
}
</code></pre>
      
    <p class="normal">The <a id="_idIndexMarker567"></a>preceding code adds the indicated product to the cart and increments the total by the product’s price.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Add the <code class="inlineCode">DeleteProduct</code> method to the code block:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeleteProduct</span><span class="hljs-function">(</span><span class="hljs-params">Product product</span><span class="hljs-function">)</span>
{
    cart.Remove(product);
    total -= product.Price;
}
</code></pre>
      
    <p class="normal">The preceding code removes the indicated product from the cart and decrements the total by the product’s price.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">Add the following <code class="inlineCode">@onlclick</code> event to the <strong class="screenText">Add to Cart</strong> button:
        <pre class="programlisting code"><code class="hljs-code">@onclick=<span class="hljs-string">"@(() =&gt; AddProduct(item))"</span>
</code></pre>
      </li>
      <li class="numberedList">The preceding code calls the <code class="inlineCode">AddProduct</code> method when the button is clicked. For more information on handling events, refer to <em class="chapterRef">Chapter 8</em>, <em class="italic">Building a Kanban Board Using Events</em>.</li>
      <li class="numberedList">Add the following <code class="inlineCode">@onlclick</code> event to the <strong class="screenText">Delete</strong> button:
        <pre class="programlisting code"><code class="hljs-code">@onclick=<span class="hljs-string">"@(()=&gt;DeleteProduct(item))"</span>
</code></pre>
     
    <p class="normal">The preceding<a id="_idIndexMarker568"></a> code calls the <code class="inlineCode">DeleteProduct</code> method when the button is clicked.</p> </li>
    </ol>
    <p class="normal">We have finished updating the <strong class="screenText">Store</strong> page. Now we need to test it.</p>
    <h2 id="_idParaDest-234" class="heading-2">Demonstrating that the application state has been lost</h2>
    <p class="normal">We<a id="_idIndexMarker569"></a> need to run our web app in order to test the <code class="inlineCode">Store</code> page. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Click on the <strong class="screenText">Start Shopping</strong> button.</li>
      <li class="numberedList">Add a few products to the cart using the <strong class="screenText">Add to Cart</strong> button.</li>
      <li class="numberedList">Delete a product from the cart using the <strong class="screenText">Delete</strong> button.</li>
      <li class="numberedList">Select the <strong class="screenText">Home</strong> option on the navigation menu.</li>
      <li class="numberedList">Return to the <strong class="screenText">Store</strong> page by clicking on the <strong class="screenText">Start Shopping</strong> button.</li>
      <li class="numberedList">Confirm that the cart is now empty.
    <p class="normal">When we navigate between the pages in our web app, the state is lost. </p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Close the browser.</li>
    </ol>
    <p class="normal">We can maintain the state by using DI to enable the <code class="inlineCode">AppState</code> pattern. We will add a <code class="inlineCode">CartService</code> to our project that we will manage using DI.</p>
    <h2 id="_idParaDest-235" class="heading-2">Creating the the ICartService interface</h2>
    <p class="normal">We need to<a id="_idIndexMarker570"></a> create an <code class="inlineCode">ICartService</code> interface. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Return to Visual Studio.</li>
      <li class="numberedList">Right-click on the <code class="inlineCode">ShoppingCart</code> project and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Folder</strong> option from the menu.</li>
      <li class="numberedList">Name the new folder <code class="inlineCode">Services</code>.</li>
      <li class="numberedList">Right-click on the <code class="inlineCode">Services</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">New Item</strong> option from the menu.</li>
      <li class="numberedList">Enter <code class="inlineCode">interface</code> in the <strong class="screenText">Search</strong> box.</li>
      <li class="numberedList">Select <strong class="screenText">Interface</strong>.</li>
      <li class="numberedList">Name the file <code class="inlineCode">ICartService</code>.</li>
      <li class="numberedList">Click on the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Enter the following code:
        <pre class="programlisting code"><code class="hljs-code">        IList&lt;Product&gt; Cart { <span class="hljs-keyword">get</span>; }
        <span class="hljs-built_in">int</span> Total { <span class="hljs-keyword">get</span>; }
        <span class="hljs-keyword">event</span> Action OnChange;
        <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">AddProduct</span><span class="hljs-function">(</span><span class="hljs-params">Product product</span><span class="hljs-function">)</span>;
        <span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeleteProduct</span><span class="hljs-function">(</span><span class="hljs-params">Product product</span><span class="hljs-function">)</span>;
</code></pre>
        <div class="note">
          <p class="normal"><strong class="keyWord">IMPORTANT NOTE</strong></p>
          <p class="normal">Visual Studio will automatically add the following <code class="inlineCode">using</code> statement:</p>
          <p class="normal"><code class="inlineCode">using ShoppingCart.Models;</code></p>
        </div>
      </li>
    </ol>
    <p class="normal">We have <a id="_idIndexMarker571"></a>created the <code class="inlineCode">ICartService</code> interface. Now we need to create a class that inherits from it.</p>
    <h2 id="_idParaDest-236" class="heading-2">Creating the CartService class</h2>
    <p class="normal">We need to <a id="_idIndexMarker572"></a>create the <code class="inlineCode">CartService</code> class. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">Services</code> folder and select the <strong class="screenText">Add</strong>, <strong class="screenText">Class</strong> option from the menu.</li>
      <li class="numberedList">Name the class <code class="inlineCode">CartService</code>.</li>
      <li class="numberedList">Click on the <strong class="screenText">Add</strong> button.</li>
      <li class="numberedList">Update the class to the following:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CartService</span> : <span class="hljs-title">ICartService</span>
{
   <span class="hljs-keyword">private</span> List&lt;Product&gt; cart = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> total;
    <span class="hljs-keyword">public</span> IList&lt;Product&gt; Cart
    {
        <span class="hljs-keyword">get</span> =&gt; cart;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Total
    {
        <span class="hljs-keyword">get</span> =&gt; total;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> Action? OnChange;
}
</code></pre>
      
    <p class="normal">The <code class="inlineCode">CartService</code> class inherits from the <code class="inlineCode">ICartService</code> interface.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Add the <code class="inlineCode">NotifyStateChanged</code> method to the class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">NotifyStateChanged</span><span class="hljs-function">()</span> =&gt; OnChange?.Invoke();
</code></pre>
      
    <p class="normal">In the preceding code, the <code class="inlineCode">OnChange</code> event is invoked when the <code class="inlineCode">NotifyStateChanged</code> method is called.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Add the <code class="inlineCode">AddProduct</code> method to the class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">AddProduct</span><span class="hljs-function">(</span><span class="hljs-params">Product product</span><span class="hljs-function">)</span>
{
    cart.Add(product);
    total += product.Price;
    NotifyStateChanged();
}
</code></pre>
      
    <p class="normal">The preceding code adds the indicated product to the list of products and increments the total. It also calls the <code class="inlineCode">NotifyStateChanged</code> method.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Add<a id="_idIndexMarker573"></a> the <code class="inlineCode">DeleteProduct</code> method to the class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DeleteProduct</span><span class="hljs-function">(</span><span class="hljs-params">Product product</span><span class="hljs-function">)</span>
{
    cart.Remove(product);
    total -= product.Price;
    NotifyStateChanged();
}
</code></pre>
      
    <p class="normal">The preceding code removes the indicated product from the list of products and decrements the total. It also calls the <code class="inlineCode">NotifyStateChanged</code> method.</p></li>
    </ol>
    <p class="normal">We have completed the <code class="inlineCode">CartService</code> class. Now we need to register <code class="inlineCode">CartService</code> in the DI container.</p>
    <h2 id="_idParaDest-237" class="heading-2">Registering CartService in the DI container</h2>
    <p class="normal">We need<a id="_idIndexMarker574"></a> to register <code class="inlineCode">CartService</code> in the DI container before we can inject it into our <code class="inlineCode">Store</code> component. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">Program.cs</code> file. </li>
      <li class="numberedList">Add the following code after the code that registers <code class="inlineCode">HttpClient</code>:
        <pre class="programlisting code"><code class="hljs-code">builder.Services.AddScoped&lt;ICartService, CartService&gt;();
</code></pre>
      </li>
    </ol>
    <p class="normal">We have registered <code class="inlineCode">CartService</code>. Now we need to update the <code class="inlineCode">Store</code> page to use it.</p>
    <h2 id="_idParaDest-238" class="heading-2">Injecting CartService into the Store component</h2>
    <p class="normal">We need<a id="_idIndexMarker575"></a> to inject the <code class="inlineCode">CartService</code> into the <code class="inlineCode">Store</code> component. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">Pages\Store.razor</code> file.</li>
      <li class="numberedList">Add the following directives:
        <pre class="programlisting code"><code class="hljs-code">@using ShoppingCart.Services
@inject ICartService cartService
</code></pre>
      </li>
      <li class="numberedList">Update the <code class="inlineCode">@onclick</code> event of the <strong class="screenText">Add to Cart</strong> button to the following:
        <pre class="programlisting code"><code class="hljs-code">@onclick=<span class="hljs-string">"@(() =&gt; cartService.AddProduct(item))"</span>
</code></pre>
      
    <p class="normal">The preceding markup uses <code class="inlineCode">cartService</code> to add products to the cart.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Update the <code class="inlineCode">cart</code> element to the following:
        <pre class="programlisting code"><code class="hljs-code">@if (cartService.Cart.Any())
{
    <span class="hljs-tag">&lt;</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>Your Cart<span class="hljs-tag">&lt;/</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">ul</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"list-group"</span><span class="hljs-tag">&gt;</span>
        @foreach (Product item in cartService.Cart)
        {
                <span class="hljs-tag">&lt;</span><span class="hljs-name">li</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"list-group-item p-2"</span><span class="hljs-tag">&gt;</span>
                <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"btn btn-sm btn-danger me-2"</span><span class="hljs-tag">&gt;</span>
                    Delete
                <span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
                @item.ProductName - $@item.Price
            <span class="hljs-tag">&lt;/</span><span class="hljs-name">li</span><span class="hljs-tag">&gt;</span>
        }
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">ul</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"p-2"</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">h3</span><span class="hljs-tag">&gt;</span>Total: $@cartService.Total<span class="hljs-tag">&lt;/</span><span class="hljs-name">h3</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
}
</code></pre>
      
    <p class="normal">The preceding code replaces references to the <code class="inlineCode">cart</code> property with references to the <code class="inlineCode">cartService</code>.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Add the following <code class="inlineCode">@onclick</code> event to the <strong class="screenText">Delete</strong> button:
        <pre class="programlisting code"><code class="hljs-code">@onclick=<span class="hljs-string">"@(() =&gt;cartService.DeleteProduct(item))"</span>
</code></pre>
     
    <p class="normal">The preceding markup uses <code class="inlineCode">cartService</code> to delete products from the cart.</p> </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Delete the <code class="inlineCode">cart</code> property, the <code class="inlineCode">total</code> property, the <code class="inlineCode">AddProduct</code> method, and the <code class="inlineCode">DeleteProduct</code> method from the code block.</li>
      <li class="numberedList">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Click on the <strong class="screenText">Start Shopping</strong> button.</li>
      <li class="numberedList">Add a few products to the cart using the <strong class="screenText">Add to Cart</strong> button.</li>
      <li class="numberedList">Delete a product from the cart using the <strong class="screenText">Delete</strong> button.</li>
      <li class="numberedList">Select the <strong class="screenText">Home</strong> option on the navigation menu.</li>
      <li class="numberedList">Return to the <strong class="screenText">Store</strong> page by clicking on the <strong class="screenText">Start Shopping</strong> button.</li>
      <li class="numberedList">Confirm<a id="_idIndexMarker576"></a> that the cart is not empty.</li>
    </ol>
    <p class="normal">We have confirmed that <code class="inlineCode">CartService</code> is working. Now we need to add the cart total to all the pages.</p>
    <h2 id="_idParaDest-239" class="heading-2">Adding the cart total to all the pages</h2>
    <p class="normal">To view <a id="_idIndexMarker577"></a>the cart total on all the pages, we need to add the cart total to a component that is used on all the pages. Since the <code class="inlineCode">MainLayout</code> component is used by all the pages, we will add the cart total to it. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Return to Visual Studio.</li>
      <li class="numberedList">Open the <code class="inlineCode">Shared\MainLayout.razor</code> file.</li>
      <li class="numberedList">Add the following <code class="inlineCode">@using</code> directive:
        <pre class="programlisting code"><code class="hljs-code">@using ShoppingCart.Services
</code></pre>
      </li>
      <li class="numberedList">Add the following <code class="inlineCode">@inject</code> directive:
        <pre class="programlisting code"><code class="hljs-code">@inject ICartService cartService
</code></pre>
      </li>
      <li class="numberedList">Add the following markup above the <code class="inlineCode">main</code> element:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"alert alert-primary"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>Cart Total: $@cartService.Total<span class="hljs-tag">&lt;/</span><span class="hljs-name">h2</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Add a few items to the cart.</li>
      <li class="numberedList">Confirm <a id="_idIndexMarker578"></a>that the <strong class="screenText">Cart Total</strong> field at the top of the page does not update.</li>
    </ol>
    <p class="normal">The cart total at the top of the page is not being updated as we add new items to the cart. We need to deal with this.</p>
    <h2 id="_idParaDest-240" class="heading-2">Using the OnChange method</h2>
    <p class="normal">We need to <a id="_idIndexMarker579"></a>notify the component when it needs to be updated. We do this as follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Return to Visual Studio.</li>
      <li class="numberedList">Open the <code class="inlineCode">Shared\MainLayout.razor</code> file.</li>
      <li class="numberedList">Add the following <code class="inlineCode">@implements</code> directive:
        <pre class="programlisting code"><code class="hljs-code">@implements IDisposable
</code></pre>
      </li>
      <li class="numberedList">Add the following <code class="inlineCode">@code</code> block:
        <pre class="programlisting code"><code class="hljs-code">@code{
    <span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">override</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnInitialized</span><span class="hljs-function">()</span>
    {
        cartService.OnChange += StateHasChanged;
    }
    <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Dispose</span><span class="hljs-function">()</span>
    {
        cartService.OnChange -= StateHasChanged;
    }
}
</code></pre>
      
    <p class="normal">In the preceding code, the component’s <code class="inlineCode">StateHasChanged</code> method is subscribed to the <code class="inlineCode">cartService.OnChange</code> method in the <code class="inlineCode">OnInitialized</code> method and unsubscribed in the <code class="inlineCode">Dispose</code> method.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Press <em class="keystroke">Ctrl</em>+<em class="keystroke">F5</em> to start the application without debugging.</li>
      <li class="numberedList">Add a few products to the cart using the <strong class="screenText">Add to Cart</strong> button.</li>
      <li class="numberedList">Confirm that the <strong class="screenText">Cart Total</strong> field at the top of the page updates.</li>
      <li class="numberedList">Delete a product from the cart using the <strong class="screenText">Delete</strong> button.</li>
      <li class="numberedList">Confirm that the <strong class="screenText">Cart Total</strong> field at the top of the page updates.</li>
      <li class="numberedList">Select the <strong class="screenText">Home</strong> option on the navigation menu.</li>
      <li class="numberedList">Confirm that the <strong class="screenText">Cart Total</strong> field is correctly displayed at the top of the <strong class="screenText">Home</strong> page.
    <p class="normal">We have updated the component to call the <code class="inlineCode">StateHasChanged</code> method whenever <a id="_idIndexMarker580"></a>the <code class="inlineCode">OnChange</code> method of <code class="inlineCode">CartService</code> is invoked.</p></li>
    </ol>
    <div class="packt_tip">
      <p class="normal"><strong class="keyWord">TIP</strong></p>
      <p class="normal">Do not forget to unsubscribe from the event when you dispose of the component.</p>
    </div>
    <p class="normal">You must unsubscribe from the event to prevent the <code class="inlineCode">StateHasChanged</code> method from being invoked every time the <code class="inlineCode">cartService.OnChange</code> event is raised. Otherwise, your application will experience resource leaks.</p>
    <h1 id="_idParaDest-241" class="heading-1">Summary</h1>
    <p class="normal">You should now be able to use DI to apply the <code class="inlineCode">AppState</code> pattern to a Blazor WebAssembly app.</p>
    <p class="normal">In this chapter, we introduced the application state and DI. We explained how to use a DI container and how to inject a service into a component. We also discussed the differences between the singleton, scoped, and transient service lifetimes.</p>
    <p class="normal">After that, we used the <strong class="keyWord">Blazor WebAssembly App Empty</strong> project template to create a new project. We installed <code class="inlineCode">Bootstrap</code> to style the frontend. We added a <code class="inlineCode">Store</code> component to the project and demonstrated that the application state is lost when we navigate between pages. To maintain the application’s state, we registered the <code class="inlineCode">CartService</code> service in the DI container. Finally, we demonstrated that by using the <code class="inlineCode">AppState</code> pattern, we can maintain the shopping cart’s state.</p>
    <p class="normal">We can apply our new skills with DI to maintain the application state for any Blazor WebAssembly app.</p>
    <p class="normal">In the next chapter, we will build a Kanban board using events.</p>
    <h1 id="_idParaDest-242" class="heading-1">Questions</h1>
    <p class="normal">The following questions are provided for your consideration:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Can <code class="inlineCode">localStorage</code> be used to maintain the cart’s state when the page is reloaded?</li>
      <li class="numberedList">Why don’t we need to call the <code class="inlineCode">StateHasChanged</code> method in the <code class="inlineCode">Store</code> component?</li>
      <li class="numberedList">How would you update the cart to allow for the addition of more than one of each type of product at a time?</li>
      <li class="numberedList">When using DI, what is the difference between the various service lifetimes?</li>
    </ol>
    <h1 id="_idParaDest-243" class="heading-1">Further reading</h1>
    <p class="normal">The following resources provide more information concerning the topics covered in this chapter:</p>
    <ul>
      <li class="bulletList">For more information on DI, refer to <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-7.0"><span class="url">https://learn.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-7.0</span></a>.</li>
      <li class="bulletList">For more information on events, refer to <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/events/"><span class="url">https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/events/</span></a>.</li>
    </ul>
  </div>
  <div id="_idContainer217" class="Basic-Text-Frame">
    <h1 id="_idParaDest-244" class="heading-1">Join our community on Discord</h1>
    <p class="normal">Join our community’s Discord space for discussions with the author and other readers:</p>
    <p class="normal"><a href="https://packt.link/BlazorWASM2e"><span class="url">https://packt.link/BlazorWASM2e</span></a></p>
    <p class="normal"><img src="../Images/Discord_QR.png" alt=""/></p>
  </div>
</body>
</html>