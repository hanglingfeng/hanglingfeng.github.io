<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>Chapter_10</title>
<link href="../Styles/syntax-highlighting.css" rel="stylesheet" type="text/css"/>
<link href="../Styles/epub.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body id="Chapter_10" lang="en-US" xml:lang="en-US">
<div class="Basic-Text-Frame" id="_idContainer341">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">10</span></h1>
<h1 class="chapterTitle" id="_idParaDest-379"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Building Serverless Nanoservices Using Azure Functions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, you will be introduced to Azure Functions, which can be configured to only require server-side resources while they execute. </span><span class="koboSpan" id="kobo.3.2" xmlns="http://www.w3.org/1999/xhtml">They execute when they are triggered by an activity like a message sent to a queue or a file uploaded to Azure Storage, or at a regularly scheduled interval.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">This chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">Understanding Azure Functions</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">Building an Azure Functions project</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Responding to timer and resource triggers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">Publishing an Azure Functions project to the cloud</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">Cleaning up Azure Functions resources</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-380"><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Understanding Azure Functions</span></h1>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions</span></strong><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml"> is an event-driven </span><a id="_idIndexMarker1027"/><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">serverless compute platform. </span><span class="koboSpan" id="kobo.13.2" xmlns="http://www.w3.org/1999/xhtml">You can build and debug locally and later deploy to Microsoft Azure cloud. </span><span class="koboSpan" id="kobo.13.3" xmlns="http://www.w3.org/1999/xhtml">Azure Functions can be implemented in many languages, not just C# and .NET. </span><span class="koboSpan" id="kobo.13.4" xmlns="http://www.w3.org/1999/xhtml">It has extensions for Visual Studio 2022 and Visual Studio Code and a command-line tool.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">But first, you might be wondering, “How is it possible to have a service without a server?”</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">Serverless</span></em><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml"> does not literally mean there is no server. </span><span class="koboSpan" id="kobo.16.2" xmlns="http://www.w3.org/1999/xhtml">What serverless means is a service without a </span><em class="italic"><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">permanently running server</span></em><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">, and usually that means not running for most of the time or running with low resources and scaling up dynamically when needed. </span><span class="koboSpan" id="kobo.18.2" xmlns="http://www.w3.org/1999/xhtml">This can save a lot of costs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">For example, organizations often have business functions that only need to run once per hour, once per month, or on an ad hoc basis. </span><span class="koboSpan" id="kobo.19.2" xmlns="http://www.w3.org/1999/xhtml">Perhaps the organization prints checks (cheques in England) to pay its employees at the end of the month. </span><span class="koboSpan" id="kobo.19.3" xmlns="http://www.w3.org/1999/xhtml">Those checks might need the salary amounts converted to words to print on the check. </span><span class="koboSpan" id="kobo.19.4" xmlns="http://www.w3.org/1999/xhtml">A function to convert numbers to words could be implemented as a serverless service. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">For another example, with a content management system, editors might upload new images, and those images might need to be processed in various ways, like generating thumbnails and other optimizations. </span><span class="koboSpan" id="kobo.20.2" xmlns="http://www.w3.org/1999/xhtml">This work can be added to a queue, or an Azure function can be triggered</span><a id="_idIndexMarker1028"/><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml"> when the file is uploaded to Blob Storage.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions can be much more than just a single function. </span><span class="koboSpan" id="kobo.22.2" xmlns="http://www.w3.org/1999/xhtml">They support complex, stateful, workflows and event-driven</span><a id="_idIndexMarker1029"/><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml"> solutions using </span><strong class="keyWord"><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">Durable Functions</span></strong><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">I do not cover Durable Functions in this book, so if you are interested, you can learn more about implementing them using C# and .NET at the following link: </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview?tabs=csharp"><span class="url"><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview?tabs=csharp</span></span></a><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions has a programming model based on triggers and bindings that enable your serverless service to respond to events and connect to other services like data stores.</span></p>
<h2 class="heading-2" id="_idParaDest-381"><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions triggers and bindings</span></h2>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">Triggers</span></strong><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">bindings</span></strong><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml"> are key </span><a id="_idIndexMarker1030"/><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">concepts for Azure Functions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">Triggers are what </span><a id="_idIndexMarker1031"/><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">cause a function to execute. </span><span class="koboSpan" id="kobo.37.2" xmlns="http://www.w3.org/1999/xhtml">Each function must have one, and only one, trigger. </span><span class="koboSpan" id="kobo.37.3" xmlns="http://www.w3.org/1999/xhtml">The most common triggers are shown in the following list:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">HTTP</span></strong><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">: This trigger responds to an</span><a id="_idIndexMarker1032"/><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml"> incoming HTTP request, typically a </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">Azure SQL</span></strong><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">: This trigger responds </span><a id="_idIndexMarker1033"/><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">when a change is detected on a SQL table.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">Cosmos DB</span></strong><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">: This trigger</span><a id="_idIndexMarker1034"/><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml"> uses the Cosmos DB Change Feed to listen for inserts and updates.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">Timer</span></strong><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">: This trigger</span><a id="_idIndexMarker1035"/><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml"> responds to a scheduled time occurring. </span><span class="koboSpan" id="kobo.53.2" xmlns="http://www.w3.org/1999/xhtml">It does not retry if a function fails. </span><span class="koboSpan" id="kobo.53.3" xmlns="http://www.w3.org/1999/xhtml">The function is not called again until the next time on the schedule.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">SignalR</span></strong><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">: This trigger</span><a id="_idIndexMarker1036"/><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml"> responds to messages sent from Azure SignalR Service.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">Queue</span></strong><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">RabbitMQ</span></strong><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">: These triggers</span><a id="_idIndexMarker1037"/><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml"> respond to a message arriving in a queue </span><a id="_idIndexMarker1038"/><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">ready for processing.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">Blob Storage</span></strong><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">: This</span><a id="_idIndexMarker1039"/><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml"> trigger responds</span><a id="_idIndexMarker1040"/><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml"> to a new or</span><a id="_idIndexMarker1041"/><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml"> updated </span><strong class="keyWord"><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">binary large object </span></strong><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">Blob</span></strong><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">).</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">Event Grid</span></strong><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">Event Hub</span></strong><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">: These triggers</span><a id="_idIndexMarker1042"/><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml"> respond when a predefined event occurs.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">Bindings allow functions to have inputs and outputs. </span><span class="koboSpan" id="kobo.77.2" xmlns="http://www.w3.org/1999/xhtml">Each function can have zero, one, or more bindings. </span><span class="koboSpan" id="kobo.77.3" xmlns="http://www.w3.org/1999/xhtml">Some common bindings are shown in the following list:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">Azure SQL</span></strong><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">: Read or write to </span><a id="_idIndexMarker1043"/><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">a table in a SQL Server database.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">Blob Storage</span></strong><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">: Read or </span><a id="_idIndexMarker1044"/><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">write to any file stored as a BLOB.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">Cosmos DB</span></strong><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">: Read or </span><a id="_idIndexMarker1045"/><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">write documents to a cloud-scale data store.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">SignalR</span></strong><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">: Receive or </span><a id="_idIndexMarker1046"/><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">make remote method calls.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">HTTP</span></strong><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">: Make an HTTP</span><a id="_idIndexMarker1047"/><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml"> request and receive the response.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">Queue</span></strong><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">RabbitMQ</span></strong><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">: Write a message to a queue or read a message from a queue.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">SendGrid</span></strong><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">: Send an </span><a id="_idIndexMarker1048"/><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">email message.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">Twilio</span></strong><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">: Send an</span><a id="_idIndexMarker1049"/><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml"> SMS message.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">IoT hub</span></strong><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">: Write to an</span><a id="_idIndexMarker1050"/><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml"> internet-connected device.</span></li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">You can see the full list of supported triggers and bindings at the following link: </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp#supported-bindings"><span class="url"><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp#supported-bindings</span></span></a><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">Triggers and bindings are configured differently for different languages. </span><span class="koboSpan" id="kobo.109.2" xmlns="http://www.w3.org/1999/xhtml">For C# and Java, you decorate methods and parameters with attributes. </span><span class="koboSpan" id="kobo.109.3" xmlns="http://www.w3.org/1999/xhtml">For the other languages, you configure a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">function.json</span></code><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<h2 class="heading-2" id="_idParaDest-382"><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">NCRONTAB expressions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">Timer</span></strong><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml"> trigger</span><a id="_idIndexMarker1051"/><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml"> uses </span><strong class="keyWord"><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">NCRONTAB expressions</span></strong><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml"> to define the frequency of</span><a id="_idIndexMarker1052"/><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml"> the timer. </span><span class="koboSpan" id="kobo.119.2" xmlns="http://www.w3.org/1999/xhtml">The default time zone is </span><strong class="keyWord"><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">Coordinated Universal Time</span></strong><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">UTC</span></strong><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.123.2" xmlns="http://www.w3.org/1999/xhtml">This can be overridden but you really should use UTC for the reasons you learned </span><a id="_idIndexMarker1053"/><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">about in </span><em class="chapterRef"><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 7</span></em><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">Handling Dates, Times, and Internationalization</span></em><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">If you are hosting in an App Service plan, then you can alternatively use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">TimeSpan</span></code><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">, but I recommend learning NCRONTAB expressions for flexibility.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">An NCRONTAB expression consists of five or six parts (if seconds are included):</span></p>
<pre class="programlisting gen"><code class="hljs"><code class="inlineCode"><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">* * * * * *</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">- - - - - -</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">| | | | | |</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">| | | | | +--- day of week (0 - 6) (Sunday=0)</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">| | | | +----- month (1 - 12)</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">| | | +------- day of month (1 - 31)</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">| | +--------- hour (0 - 23)</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">| +----------- min (0 - 59)</span></code>
<code class="inlineCode"><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">+------------- sec (0 - 59)</span></code>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">A star </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">*</span></code><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml"> in the value field above means all legal values, as in parentheses for that column. </span><span class="koboSpan" id="kobo.144.2" xmlns="http://www.w3.org/1999/xhtml">You can specify ranges using a hyphen, and a step value using </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">/</span></code><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.146.2" xmlns="http://www.w3.org/1999/xhtml">Here are some examples of how values can be specified in this format:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">0</span></code><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml"> means at that value. </span><span class="koboSpan" id="kobo.148.2" xmlns="http://www.w3.org/1999/xhtml">For example, for hours, at midnight.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">0,6,12,18</span></code><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml"> means at those listed values. </span><span class="koboSpan" id="kobo.150.2" xmlns="http://www.w3.org/1999/xhtml">For example, for hours, at midnight, 6 a.m., 12 noon, and 6 p.m.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">3-7</span></code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml"> means at that inclusive range of values. </span><span class="koboSpan" id="kobo.152.2" xmlns="http://www.w3.org/1999/xhtml">For example, for hours, at 3 a.m., 4 a.m., 5 a.m., 6 a.m., and 7 a.m.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">4/3</span></code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml"> means a start value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">4</span></code><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml"> and a step value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">3</span></code><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.158.2" xmlns="http://www.w3.org/1999/xhtml">For example, for hours, at 4 a.m., 7 a.m., 10 a.m., 1 p.m., 4 p.m., 7 p.m., and 10 p.m.</span></li>
</ul>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">Table 10.1</span></em><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml"> shows some more examples:</span></p>
<table class="table-container" id="table001-8">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">Expression</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">0 5 * * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml">Once every hour of the day at minute 5 of each hour.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">0 0,10,30,40 * * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">Four times an hour – at minutes 0, 10, 30, and 40 during every hour.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">* * */2 * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">Every 2 hours.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml">0,15 * * * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">At 0 and 15 seconds every minute.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">0/15 * * * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">At 0, 15, 30, and 45 seconds every minute, aka every 15 seconds.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">0-15 * * * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">At 0, 1, 2, 3, and so on up to 15 seconds past each minute, but not 16 to 59 seconds past each minute.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">0 30 9-16 * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">Eight times a day – at hours 9:30 A.M, 10:30 A.M, and so on up to 4:30 P.M.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">0 */5 * * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">12 times an hour – at second 0 of every 5</span><sup class="superscript"><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">th</span></sup><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml"> minute of every hour.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">0 0 */4 * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">6 times a day – at minute 0 of every 4</span><sup class="superscript"><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">th</span></sup><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml"> hour of every day.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">0 30 9 * * *</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">9:30 AM every day.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">0 30 9 * * 1-5</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">9:30 AM every workday.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">0 30 9 * * Mon-Fri</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">9:30 AM every workday.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">0 30 9 * Jan Mon</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">9:30 AM every Monday in January.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">Table 10.1: Examples of NCRONTAB expressions</span></p>
<p class="normal"><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">Now let’s build a simple console app </span><a id="_idIndexMarker1054"/><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">to test your understanding </span><a id="_idIndexMarker1055"/><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">of NCRONTAB expressions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">Use your preferred code editor to add a new console app named </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml">NCrontab.Console</span></code><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml"> to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">Chapter10</span></code><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml"> solution.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">NCrontab.Console</span></code><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml"> project, treat warnings as errors, globally and statically import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">System.Console</span></code><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml"> class, and add a package reference for </span><code class="inlineCode"><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">NCrontab.Signed</span></code><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">"NCrontab.Signed"</span></span><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">"3.3.3"</span></span><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">The NCRONTAB library is only for parsing expressions. </span><span class="koboSpan" id="kobo.214.2" xmlns="http://www.w3.org/1999/xhtml">It is not itself a scheduler. </span><span class="koboSpan" id="kobo.214.3" xmlns="http://www.w3.org/1999/xhtml">You can learn more about it in the GitHub repository at the following link: </span><a href="https://github.com/atifaziz/NCrontab"><span class="url"><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/atifaziz/NCrontab</span></span></a><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml">NCrontab.Console</span></code><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml"> project to restore packages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">, delete the existing statements. </span><span class="koboSpan" id="kobo.222.2" xmlns="http://www.w3.org/1999/xhtml">Add statements to define a date range for the </span><a id="_idIndexMarker1056"/><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">year 2023, output a summary of NCRONTAB syntax, and construct an NCRONTAB schedule, and then use it to output the next 40 occurrences that </span><a id="_idIndexMarker1057"/><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">would occur in 2023, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml"> NCrontab; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">// To use CrontabSchedule and so on.</span></span><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">
DateTime start = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">(year: </span><span class="hljs-number"><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">2023</span></span><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">, month: </span><span class="hljs-number"><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">, day: </span><span class="hljs-number"><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">);
DateTime end = start.AddYears(</span><span class="hljs-number"><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml">$"Start at:   </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">{start:ddd, dd MMM yyyy HH:mm:ss}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">$"End at:     </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">{end:ddd, dd MMM yyyy HH:mm:ss}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine();
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml"> sec = </span><span class="hljs-string"><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">"0,30"</span></span><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml"> min = </span><span class="hljs-string"><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></span><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml"> hour = </span><span class="hljs-string"><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">*"</span></span><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml"> dayOfMonth = </span><span class="hljs-string"><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></span><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml"> month = </span><span class="hljs-string"><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></span><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml"> dayOfWeek = </span><span class="hljs-string"><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></span><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml"> expression = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">.Format(
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">"{0,-3} {1,-3} {2,-3} {3,-3} {4,-3} {5,-3}"</span></span><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">,
  sec, min, hour, dayOfMonth, month, dayOfWeek);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">$"Expression: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">{expression}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">@"            \ / \ / \ / \ / \ / \ /"</span></span><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">$"             -   -   -   -   -   -"</span></span><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">$"             |   |   |   |   |   |"</span></span><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">$"             |   |   |   |   |   +--- day of week (0 - 6) (Sunday=0)"</span></span><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">$"             |   |   |   |   +------- month (1 - 12)"</span></span><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">$"             |   |   |   +----------- day of month (1 - 31)"</span></span><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">$"             |   |   +--------------- hour (0 - 23)"</span></span><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">$"             |   +------------------- min (0 - 59)"</span></span><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">$"             +----------------------- sec (0 - 59)"</span></span><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine();
CrontabSchedule schedule = CrontabSchedule.Parse(expression, 
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml"> CrontabSchedule.ParseOptions { IncludingSeconds = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml"> });
IEnumerable&lt;DateTime&gt; occurrences = schedule.GetNextOccurrences(start, end);
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">// Output the first 40 occurrences.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">foreach</span></span><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml"> (DateTime occurrence </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">in</span></span><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml"> occurrences.Take(</span><span class="hljs-number"><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">40</span></span><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">))
{
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">$"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">{occurrence:ddd, dd MMM yyyy HH:mm:ss}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml">);
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">Note the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">The default </span><a id="_idIndexMarker1058"/><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">potential time span for occurrences is the whole year of 2023.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">The default </span><a id="_idIndexMarker1059"/><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">expression is </span><code class="inlineCode"><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">0,30 * * * * *</span></code><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">, meaning at 0 and 30 seconds of every minute of every hour of every day of every weekday of every month.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">The formatting for the syntax help assumes each component will be three characters wide because </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">-3</span></code><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml"> is used for output formatting. </span><span class="koboSpan" id="kobo.324.2" xmlns="http://www.w3.org/1999/xhtml">You could write a cleverer algorithm to dynamically adjust the arrows to point to variable width components, but I was lazy. </span><span class="koboSpan" id="kobo.324.3" xmlns="http://www.w3.org/1999/xhtml">I will leave that as an exercise for you.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">Our expression includes seconds, so when parsing, we must set that as an additional option.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">After defining the schedule, the schedule calls its </span><code class="inlineCode"><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">GetNextOccurrences</span></code><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml"> method to return a sequence of all the calculated occurrences.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">The loop only outputs the first 40 occurrences. </span><span class="koboSpan" id="kobo.329.2" xmlns="http://www.w3.org/1999/xhtml">That should be enough to understand how most expressions work.</span></li>
</ul></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">Start the console app without debugging, and note the occurrences are every 30 seconds, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">Start at:   Sun, 01 Jan 2023 00:00:00
End at:     Mon, 01 Jan 2024 00:00:00
Expression: 0,30 *   *   *   *   *
            \ / \ / \ / \ / \ / \ /
             -   -   -   -   -   -
             |   |   |   |   |   |
             |   |   |   |   |   +--- day of week (0 - 6) (Sunday=0)
             |   |   |   |   +------- month (1 - 12)
             |   |   |   +----------- day of month (1 - 31)
             |   |   +--------------- hour (0 - 23)
             |   +------------------- min (0 - 59)
             +----------------------- sec (0 - 59)
Sun, 01 Jan 2023 00:00:30
Sun, 01 Jan 2023 00:01:00
Sun, 01 Jan 2023 00:01:30
...
</span><span class="koboSpan" id="kobo.331.2" xmlns="http://www.w3.org/1999/xhtml">Sun, 01 Jan 2023 00:19:30
Sun, 01 Jan 2023 00:20:00
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">Note that although the start time is </span><code class="inlineCode"><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">Sun, 01 Jan 2023 00:00:00</span></code><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">, that value is excluded from the occurrences because it is not a “next” occurrence.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">Close the console app.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml">, modify the </span><a id="_idIndexMarker1060"/><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml">components of the expression to test some of the examples in the table, or make up your own</span><a id="_idIndexMarker1061"/><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml"> examples. </span><span class="koboSpan" id="kobo.340.2" xmlns="http://www.w3.org/1999/xhtml">Try the expression </span><code class="inlineCode"><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml">0 0 */4 * * *</span></code><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">, and note it should have the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml">Start at:   Sun, 01 Jan 2023 00:00:00
End at:     Mon, 01 Jan 2024 00:00:00
Expression: 0   0   */4 *   *   *
            \ / \ / \ / \ / \ / \ /
             -   -   -   -   -   -
             |   |   |   |   |   |
             |   |   |   |   |   +--- day of week (0 - 6) (Sunday=0)
             |   |   |   |   +------- month (1 - 12)
             |   |   |   +----------- day of month (1 - 31)
             |   |   +--------------- hour (0 - 23)
             |   +------------------- min (0 - 59)
             +----------------------- sec (0 - 59)
Sun, 01 Jan 2023 04:00:00
Sun, 01 Jan 2023 08:00:00
Sun, 01 Jan 2023 12:00:00
Sun, 01 Jan 2023 16:00:00
Sun, 01 Jan 2023 20:00:00
Mon, 02 Jan 2023 00:00:00
Mon, 02 Jan 2023 04:00:00
Mon, 02 Jan 2023 08:00:00
Mon, 02 Jan 2023 12:00:00
Mon, 02 Jan 2023 16:00:00
Mon, 02 Jan 2023 20:00:00
Tue, 03 Jan 2023 00:00:00
...
</span><span class="koboSpan" id="kobo.343.2" xmlns="http://www.w3.org/1999/xhtml">Sat, 07 Jan 2023 12:00:00
Sat, 07 Jan 2023 16:00:00
</span></code></pre>
</li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">Note that although the start time is </span><code class="inlineCode"><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">Sun, 01 Jan 2023 00:00:00</span></code><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">, that value is excluded from the occurrences because it is not a “next” occurrence. </span><span class="koboSpan" id="kobo.346.2" xmlns="http://www.w3.org/1999/xhtml">So, Sunday only has five occurrences. </span><span class="koboSpan" id="kobo.346.3" xmlns="http://www.w3.org/1999/xhtml">Monday onward has the expected six occurrences per day.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-383"><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions versions and languages</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions version </span><a id="_idIndexMarker1062"/><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">4 of the runtime host is the only version still generally available. </span><span class="koboSpan" id="kobo.349.2" xmlns="http://www.w3.org/1999/xhtml">All older versions have reached end-of-life.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">: Microsoft recommends using v4 for functions in all languages. </span><span class="koboSpan" id="kobo.351.2" xmlns="http://www.w3.org/1999/xhtml">v1, v2, and v3 are in maintenance mode and should be avoided.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">Languages and platforms supported by Azure Functions v4 include:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">C#, F#</span></strong><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">: .NET 8, .NET 7, .NET 6, and .NET Framework 4.8. </span><span class="koboSpan" id="kobo.354.2" xmlns="http://www.w3.org/1999/xhtml">Note that .NET 6 and .NET 7 (and in future, .NET 9) are only supported in the isolated worker model because they</span><a id="_idIndexMarker1063"/><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml"> are </span><strong class="keyWord"><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">Standard-Term Support</span></strong><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">STS</span></strong><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">) releases, or, in the case of .NET 6, they are older LTS releases. </span><span class="koboSpan" id="kobo.359.2" xmlns="http://www.w3.org/1999/xhtml">.NET 8 is supported in both isolated</span><a id="_idIndexMarker1064"/><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml"> and in-process worker models because it is a </span><strong class="keyWord"><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">Long-Term Support</span></strong><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">LTS</span></strong><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">) release.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">JavaScript</span></strong><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">: Node 14, 16, and 18. </span><span class="koboSpan" id="kobo.366.2" xmlns="http://www.w3.org/1999/xhtml">TypeScript is supported via transpiling (transforming/compiling) to JavaScript.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">Java</span></strong><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml"> 8, 11, and 17.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml">PowerShell</span></strong><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml"> 7.2.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml">Python</span></strong><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml"> 3.7, 3.8, 3.9, and 3.10.</span></li>
</ul>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml">: You can review the whole table of languages at the following link: </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-versions?tabs=v4&amp;pivots=programming-language-csharp#languages"><span class="url"><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/azure-functions/functions-versions?tabs=v4&amp;pivots=programming-language-csharp#languages</span></span></a><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">In this book, we will only look at implementing Azure Functions using C# and .NET 8 so that we can use the in-process and isolated worker models and get LTS.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">For advanced uses, you </span><a id="_idIndexMarker1065"/><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">can even register a custom handler that would enable you to use any language you like for the implementation of an Azure function. </span><span class="koboSpan" id="kobo.379.2" xmlns="http://www.w3.org/1999/xhtml">You can read more about Azure Functions custom handlers at the following link: </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-custom-handlers"><span class="url"><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/azure-functions/functions-custom-handlers</span></span></a><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-384"><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions worker models</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions have two worker models, in-process and isolated, as described in the following list:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">In-process</span></strong><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">: Your function</span><a id="_idIndexMarker1066"/><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml"> is implemented in a </span><a id="_idIndexMarker1067"/><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">class library that must run in the same process as the host, which means your functions must run on the most recent LTS release of .NET. </span><span class="koboSpan" id="kobo.387.2" xmlns="http://www.w3.org/1999/xhtml">The latest LTS release is .NET 8. </span><span class="koboSpan" id="kobo.387.3" xmlns="http://www.w3.org/1999/xhtml">The next LTS release will be .NET 10 in November 2025, but .NET 8 will be the last</span><a id="_idIndexMarker1068"/><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml"> release that supports in-process hosting. </span><span class="koboSpan" id="kobo.388.2" xmlns="http://www.w3.org/1999/xhtml">After .NET 8, only the isolated worker model will be supported for all versions.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml">Isolated</span></strong><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">: Your function is implemented in a console app that runs in its own process. </span><span class="koboSpan" id="kobo.390.2" xmlns="http://www.w3.org/1999/xhtml">Your function</span><a id="_idIndexMarker1069"/><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml"> can therefore execute on any supported .NET version, have full control over its </span><code class="inlineCode"><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">Main</span></code><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml"> entry point, and have additional features like invocation middleware. </span><span class="koboSpan" id="kobo.393.2" xmlns="http://www.w3.org/1999/xhtml">From .NET 9 onward, this will be the only worker model. </span><span class="koboSpan" id="kobo.393.3" xmlns="http://www.w3.org/1999/xhtml">You can read more about this decision at the following link: </span><a href="https://techcommunity.microsoft.com/t5/apps-on-azure-blog/net-on-azure-functions-august-2023-roadmap-update/ba-p/3910098"><span class="url"><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">https://techcommunity.microsoft.com/t5/apps-on-azure-blog/net-on-azure-functions-august-2023-roadmap-update/ba-p/3910098</span></span></a><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">: New projects should use the isolated worker model.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-385"><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions hosting plans</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml">After testing locally, you must </span><a id="_idIndexMarker1070"/><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">deploy your Azure Functions project to an Azure hosting plan. </span><span class="koboSpan" id="kobo.400.2" xmlns="http://www.w3.org/1999/xhtml">There are three Azure Functions plans to choose from, as described in the following list:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">Consumption</span></strong><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">: In this plan, host instances are dynamically added and removed based on activity. </span><span class="koboSpan" id="kobo.402.2" xmlns="http://www.w3.org/1999/xhtml">This plan is the closest to </span><em class="italic"><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">serverless</span></em><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.404.2" xmlns="http://www.w3.org/1999/xhtml">It scales automatically during periods of high load. </span><span class="koboSpan" id="kobo.404.3" xmlns="http://www.w3.org/1999/xhtml">The cost is only for compute resources when your functions are running. </span><span class="koboSpan" id="kobo.404.4" xmlns="http://www.w3.org/1999/xhtml">You can configure a timeout for function execution</span><a id="_idIndexMarker1071"/><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml"> times to ensure your functions do not run forever.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">Premium</span></strong><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml">: This plan supports elastic scaling up and down, perpetually warm instances to avoid </span><a id="_idIndexMarker1072"/><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">cold starts, unlimited execution duration, multicore instance sizes up to four cores, potentially more predictable costs, and high-density app allocation for multiple Azure Functions projects. </span><span class="koboSpan" id="kobo.408.2" xmlns="http://www.w3.org/1999/xhtml">The cost is based on the number of core seconds and memory allocated across instances. </span><span class="koboSpan" id="kobo.408.3" xmlns="http://www.w3.org/1999/xhtml">At least one instance must be allocated at all times, so there will always be a minimum monthly cost per active plan, even if it never executes that month.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">Dedicated</span></strong><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">: Executes in the cloud equivalent of a server farm. </span><span class="koboSpan" id="kobo.410.2" xmlns="http://www.w3.org/1999/xhtml">Hosting is provided by an Azure App Service plan that controls the allocated server resources. </span><span class="koboSpan" id="kobo.410.3" xmlns="http://www.w3.org/1999/xhtml">Azure App Service plans include Basic, Standard, Premium, and Isolated. </span><span class="koboSpan" id="kobo.410.4" xmlns="http://www.w3.org/1999/xhtml">This plan</span><a id="_idIndexMarker1073"/><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml"> can be an especially good choice if you already have an App Service plan used for other projects like ASP.NET Core MVC websites, gRPC, OData, and GraphQL services, and so on. </span><span class="koboSpan" id="kobo.411.2" xmlns="http://www.w3.org/1999/xhtml">The cost is only for the App Service plan. </span><span class="koboSpan" id="kobo.411.3" xmlns="http://www.w3.org/1999/xhtml">You can host as many Azure Functions and other web apps in it as you like.</span><div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">Warning!</span></strong><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml"> Premium and Dedicated plans both run on Azure App Service plans. </span><span class="koboSpan" id="kobo.413.2" xmlns="http://www.w3.org/1999/xhtml">You must carefully select the correct App Service plan that works with your Azure Functions hosting plan. </span><span class="koboSpan" id="kobo.413.3" xmlns="http://www.w3.org/1999/xhtml">For example, for Premium, you should choose an Elastic Premium plan like </span><code class="inlineCode"><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">EP1</span></code><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.415.2" xmlns="http://www.w3.org/1999/xhtml">If you choose an App Service plan like </span><code class="inlineCode"><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">P1V1</span></code><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">, then you are choosing a</span><a id="_idIndexMarker1074"/><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml"> dedicated plan that will not elastically scale!</span></p>
</div>
</li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">You can read more about your choices at the following link: </span><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale"><span class="url"><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale</span></span></a><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-386"><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">Azure Storage requirements</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions requires an</span><a id="_idIndexMarker1075"/><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml"> Azure Storage account for storing information for some bindings and triggers. </span><span class="koboSpan" id="kobo.424.2" xmlns="http://www.w3.org/1999/xhtml">These Azure Storage services can also be used by your code for its implementation:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">Azure Files</span></strong><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">: Stores and runs your function app code in a Consumption or Premium plan.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">Azure Blob Storage</span></strong><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">: Stores state for bindings and function keys.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml">Azure Queue Storage</span></strong><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml">: Used for failure and retry handling by some triggers.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">Azure Table Storage</span></strong><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">: Task hubs in Durable Functions use Blob, Queue, and Table Storage.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-387"><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">Testing locally with Azurite</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">Azurite is an</span><a id="_idIndexMarker1076"/><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml"> open-source</span><a id="_idIndexMarker1077"/><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml"> local environment for testing Azure Functions with its related Blob, Queue, and Table Storage. </span><span class="koboSpan" id="kobo.436.2" xmlns="http://www.w3.org/1999/xhtml">Azurite is cross-platform on Windows, Linux, and macOS. </span><span class="koboSpan" id="kobo.436.3" xmlns="http://www.w3.org/1999/xhtml">Azurite supersedes the older Azure Storage Emulator.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">To install Azurite:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">For Visual Studio 2022, Azurite is included.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml">For Visual Studio Code, search for and install the Azurite extension.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">For JetBrains Rider, install the Azure Toolkit for Rider plugin, which includes Azurite.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml">For installation at the command prompt, you must have Node.js version 8 or later installed </span><a id="_idIndexMarker1078"/><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">and then you can enter the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml">npm install -g azurite
</span></code></pre>
</li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">Once you have locally tested </span><a id="_idIndexMarker1079"/><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">an Azure function, you can switch to an Azure Storage account in the cloud.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">You can learn more</span><a id="_idIndexMarker1080"/><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml"> about Azurite at the following link: </span><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azurite"><span class="url"><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azurite</span></span></a><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-388"><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions authorization levels</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions has three </span><a id="_idIndexMarker1081"/><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml">authorization levels that control whether an API key is required:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">Anonymous</span></strong><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">: No API </span><a id="_idIndexMarker1082"/><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">key is required.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">Function</span></strong><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml">: A </span><a id="_idIndexMarker1083"/><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml">function-level key is required.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">Admin</span></strong><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml">: The master </span><a id="_idIndexMarker1084"/><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">key is required.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">API keys are available through the Azure portal.</span></p>
<h2 class="heading-2" id="_idParaDest-389"><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions support for dependency injection</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml">Dependency injection in </span><a id="_idIndexMarker1085"/><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions is built on the standard .NET dependency injection features, but there are implementation differences depending on your chosen worker model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">To register dependency services, create a class that inherits from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">FunctionsStartup</span></code><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml"> class and override its </span><code class="inlineCode"><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">Configure</span></code><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.470.2" xmlns="http://www.w3.org/1999/xhtml">Add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml">[FunctionsStartup]</span></code><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml"> assembly attribute to specify the class name registered for startup. </span><span class="koboSpan" id="kobo.472.2" xmlns="http://www.w3.org/1999/xhtml">Add services to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">IFunctionsHostBuilder</span></code><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml"> instance passed to the method. </span><span class="koboSpan" id="kobo.474.2" xmlns="http://www.w3.org/1999/xhtml">You will do this in a task later in this chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml">Normally, the class that implements an Azure Functions function is </span><code class="inlineCode"><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">static</span></code><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml"> with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">static</span></code><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.479.2" xmlns="http://www.w3.org/1999/xhtml">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">static</span></code><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml"> class is not instantiated with a constructor. </span><span class="koboSpan" id="kobo.481.2" xmlns="http://www.w3.org/1999/xhtml">Dependency injection uses constructor injection so that means you must use instance classes for injected services and for your function class implementation. </span><span class="koboSpan" id="kobo.481.3" xmlns="http://www.w3.org/1999/xhtml">You will see how to do this in the coding task.</span></p>
<h2 class="heading-2" id="_idParaDest-390"><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml">Installing Azure Functions Core Tools</span></h2>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions Core Tools</span></strong><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml"> provides the core runtime and templates for creating functions, which enable local development on Windows, macOS, and Linux using any code editor.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions Core Tools is included in the </span><strong class="screenText"><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml">Azure development</span></strong><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml"> workload of Visual Studio 2022, so you might already have it installed.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">You can install the latest</span><a id="_idIndexMarker1086"/><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml"> version of </span><strong class="keyWord"><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions Core Tools</span></strong><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml"> from the following link:</span></p>
<p class="normal"><a href="https://www.npmjs.com/package/azure-functions-core-tools"><span class="url"><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml">https://www.npmjs.com/package/azure-functions-core-tools</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">The page found at the </span><a id="_idIndexMarker1087"/><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">preceding link has instructions for installing using </span><strong class="keyWord"><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft Software Installer</span></strong><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">MSI</span></strong><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml">) and </span><code class="inlineCode"><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml">winget</span></code><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml"> on Windows, Homebrew on Mac, </span><code class="inlineCode"><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">npm</span></code><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml"> on any operating system, and common Linux distributions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">If you are using JetBrains Rider, then install Azure Functions Core Tools via Rider.</span></p>
<h1 class="heading-1" id="_idParaDest-391"><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml">Building an Azure Functions project</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">Now, we can create an</span><a id="_idIndexMarker1088"/><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml"> Azure Functions project. </span><span class="koboSpan" id="kobo.506.2" xmlns="http://www.w3.org/1999/xhtml">Although they can be created in the cloud using the Azure portal, developers will have a better experience creating and running them locally first. </span><span class="koboSpan" id="kobo.506.3" xmlns="http://www.w3.org/1999/xhtml">You can then deploy to the cloud once you have tested your function on your own computer. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml">Each code editor has a slightly different experience to get started with an Azure Functions project, so let’s have a look at each in turn, starting with Visual Studio 2022.</span></p>
<h2 class="heading-2" id="_idParaDest-392"><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml">Using Visual Studio 2022</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">If you prefer to use</span><a id="_idIndexMarker1089"/><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml"> Visual Studio 2022, here are the steps</span><a id="_idIndexMarker1090"/><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml"> to create an Azure Functions project:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio 2022, create a new project, as defined in the following list:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">Project template: </span><strong class="screenText"><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions</span></strong></li>
<li class="bulletList"><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">Solution file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">Chapter10</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">Project file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">Functions worker</span></strong><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml">: </span><strong class="screenText"><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">.NET 8.0 Isolated (Long Term Support)</span></strong></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml">Function</span></strong><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">: </span><strong class="screenText"><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">Http trigger</span></strong></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">Use Azurite for runtime storage account (AzureWebJobsStorage)</span></strong><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">: Selected</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">Enable</span></strong> <strong class="screenText"><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">Docker</span></strong><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml">Authorization level</span></strong><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml">: </span><strong class="screenText"><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml">Anonymous</span></strong></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></strong><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">Configure the</span><a id="_idIndexMarker1091"/><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml"> startup project for the solution to be the current selection.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-393"><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml">Using Visual Studio Code</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml">If you prefer to use Visual </span><a id="_idIndexMarker1092"/><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml">Studio Code, here are the steps </span><a id="_idIndexMarker1093"/><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">to create an Azure Functions project:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio Code, navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml">Extensions</span></strong><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml"> and search for Azure Functions (</span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">ms-azuretools.vscode-azurefunctions</span></code><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.546.2" xmlns="http://www.w3.org/1999/xhtml">It has dependencies on two other extensions: Azure Account (</span><code class="inlineCode"><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml">ms-vscode.azure-account</span></code><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">) and Azure Resources (</span><code class="inlineCode"><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">ms-azuretools.vscode-azureresourcegroups</span></code><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">), so those will be installed too. </span><span class="koboSpan" id="kobo.550.2" xmlns="http://www.w3.org/1999/xhtml">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml">Install</span></strong><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml"> button to install the extension.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">Create a folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.555.2" xmlns="http://www.w3.org/1999/xhtml">(If you previously created the same project using Visual Studio 2022, then create a new folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">Chapter10-vscode</span></code><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml"> and create this new project folder in there instead.)</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio Code, open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">Navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">View</span></strong><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">Command Palette</span></strong><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">, type </span><code class="inlineCode"><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">azure f</span></code><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">, and then in the list of </span><strong class="screenText"><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions</span></strong><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml"> commands, click </span><strong class="screenText"><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions: Create New Project…</span></strong><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml">Select the </span><code class="inlineCode"><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml"> folder to contain your function project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">At the prompts, select the following:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml">Select a language: </span><strong class="screenText"><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml">C#</span></strong></li>
<li class="bulletList"><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">Select a .NET runtime: </span><strong class="screenText"><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml">.NET 8 Isolated LTS</span></strong><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">Select a template for your project’s first function: </span><strong class="screenText"><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">HTTP trigger</span></strong><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">. </span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml">Provide a function name: </span><code class="inlineCode"><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">Provide a namespace: </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml">Select the authorization level: </span><strong class="screenText"><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml">Anonymous</span></strong></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">Navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml">Terminal</span></strong><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml">New Terminal</span></strong><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml">At the command </span><a id="_idIndexMarker1094"/><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">prompt, build </span><a id="_idIndexMarker1095"/><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">the project, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">dotnet build
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-394"><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml">Using the func CLI</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">If you prefer to use the </span><a id="_idIndexMarker1096"/><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml">command line and some other code editor, here are the steps to create and start an Azure</span><a id="_idIndexMarker1097"/><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml"> Functions project:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">Create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml">Chapter10-cli</span></code><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml"> folder with a subfolder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">In command prompt or terminal, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a new Azure Functions project using C#, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml">func init --csharp
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml">In command prompt or terminal, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a new Azure Functions function using </span><code class="inlineCode"><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">HTTP trigger</span></code><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml"> that can be called anonymously, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">func new --name NumbersToWordsFunction --template "HTTP trigger" --authlevel "anonymous"
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">Optionally, you can start the function locally, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">func start
</span></code></pre>
</li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">If you cannot</span><a id="_idIndexMarker1098"/><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml"> find </span><code class="inlineCode"><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml">func</span></code><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml"> at the command prompt or terminal, then try installing the Azure Functions Core Tools using Chocolatey, as described at the following link: </span><a href="https://community.chocolatey.org/packages/azure-functions-core-tools"><span class="url"><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">https://community.chocolatey.org/packages/azure-functions-core-tools</span></span></a><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-395"><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml">Reviewing the Azure Functions project</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml">Before we write a function, let’s review what makes an Azure Functions project:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml">Open the</span><a id="_idIndexMarker1099"/><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml"> project file, and note the Azure Functions version and the package references needed to implement an Azure function that responds to HTTP requests, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk=</span><span class="hljs-string"><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.NET.Sdk"</span></span><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
    &lt;AzureFunctionsVersion&gt;v4&lt;/AzureFunctionsVersion&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;PackageReference Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml">"1.19.0"</span></span><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml"> 
      Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Azure.Functions.Worker"</span></span><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
    &lt;PackageReference Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">"3.0.13"</span></span><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml"> 
      Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Azure.Functions.Worker.Extensions.Http"</span></span><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
    &lt;PackageReference Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml">"1.14.0"</span></span><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">
      Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Azure.Functions.Worker.Sdk"</span></span><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;None Update=</span><span class="hljs-string"><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml">"host.json"</span></span><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
    &lt;/None&gt;
    &lt;None Update=</span><span class="hljs-string"><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml">"local.settings.json"</span></span><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
      &lt;CopyToPublishDirectory&gt;Never&lt;/CopyToPublishDirectory&gt;
    &lt;/None&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;Using Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml">"System.Threading.ExecutionContext"</span></span><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml"> 
           Alias=</span><span class="hljs-string"><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml">"ExecutionContext"</span></span><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml">host.json</span></code><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml">, note that logging to Application Insights is enabled but excludes </span><code class="inlineCode"><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">Request</span></code><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml"> types, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml">"version"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml">"2.0"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml">"logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">"applicationInsights"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml">"samplingSettings"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">"isEnabled"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">"excludedTypes"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">"Request"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml">"enableLiveMetricsFilters"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml">Application Insights is Azure’s monitoring and logging service. </span><span class="koboSpan" id="kobo.689.2" xmlns="http://www.w3.org/1999/xhtml">We will not be using it in this chapter.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">local.settings.json</span></code><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">, confirm</span><a id="_idIndexMarker1100"/><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml"> that during local development, your project will use local development storage and an isolated worker model, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml">"IsEncrypted"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml">"Values"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">"AzureWebJobsStorage"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">"UseDevelopmentStorage=true"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">"FUNCTIONS_WORKER_RUNTIME"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml">"dotnet-isolated"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml">AzureWebJobsStorage</span></code><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml"> setting is blank or missing, which might happen if you are using Visual Studio Code, then add it, set it to </span><code class="inlineCode"><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">UseDevelopmentStorage=true</span></code><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml">, and then save changes.
    </span><div class="note">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">FUNCTIONS_WORKER_RUNTIME</span></code><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml"> is the language being used by your project. </span><code class="inlineCode"><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">dotnet</span></code><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml"> means a .NET class library; </span><code class="inlineCode"><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">dotnet-isolated</span></code><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml"> means a .NET console app. </span><span class="koboSpan" id="kobo.721.2" xmlns="http://www.w3.org/1999/xhtml">Other values include </span><code class="inlineCode"><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">java</span></code><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml">node</span></code><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml">powershell</span></code><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">python</span></code><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></code><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml">launchSettings.json</span></code><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">, note the randomly assigned port number for the web service, as shown in the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml">"profiles"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.AzureFunctions.Service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml">"commandName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml">"Project"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">commandLineArgs"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">"--port 7274"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">"launchBrowser"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml">Change the port </span><a id="_idIndexMarker1101"/><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">number to </span><code class="inlineCode"><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml">5101</span></code><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml"> and save the changes to the file.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-396"><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">Implementing a simple function</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml">Let’s implement the</span><a id="_idIndexMarker1102"/><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml"> function to convert numbers into words by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml">Humanizer</span></code><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml"> package:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml">In the project file, add a package reference for Humanizer, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml">"Humanizer"</span></span><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml">"2.14.1"</span></span><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml">Build the project to restore packages.
    </span><p class="normal"><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml"> project, right-click </span><code class="inlineCode"><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">Function1.cs</span></code><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml"> and rename it to </span><code class="inlineCode"><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction.cs</span></code><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction.cs</span></code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">, modify the contents to implement an Azure function to convert an amount as a number into words, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml"> Humanizer; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml">// To use ToWords extension method.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Azure.Functions.Worker; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">// To use [HttpTrigger].</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Azure.Functions.Worker.Http; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">// To use HttpResponseData.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Extensions.Logging; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml">// To use ILogger.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></span><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction</span></span><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger _logger;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory loggerFactory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger = loggerFactory.CreateLogger&lt;NumbersToWordsFunction&gt;();
  }
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml">Function(nameof(NumbersToWordsFunction))</span></span><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">]
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml"> HttpResponseData </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">Run</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml">    [HttpTrigger(AuthorizationLevel.Anonymous, </span></span>
<span class="hljs-params"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">"get"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml">, </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml">"post"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">, Route = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">)] HttpRequestData req)</span></span><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">"C# HTTP trigger function processed a request."</span></span><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.828.2" xmlns="http://www.w3.org/1999/xhtml">amount = req.Query[</span><span class="hljs-string"><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml">"amount"</span></span><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml">];
    HttpResponseData response;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml">long</span></span><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml">.TryParse(amount, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml">out</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml">long</span></span><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml"> number))
    {
      response = req.CreateResponse(System.Net.HttpStatusCode.OK);
      response.WriteString(number.ToWords());
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml">else</span></span><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">
    {
      response = req.CreateResponse(System.Net.HttpStatusCode.BadRequest);
      response.WriteString(</span><span class="hljs-string"><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml">$"Failed to parse: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">{amount}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">);
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml"> response;
  }
}
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-397"><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">Testing a simple function</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml">Now we can test the </span><a id="_idIndexMarker1103"/><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml">function in our local development environment:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml"> project: </span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, you will need to navigate to the </span><strong class="screenText"><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml">Run and Debug</span></strong><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml"> pane, make sure that </span><strong class="screenText"><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml">Attach to .NET Functions</span></strong><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml"> is selected, and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">Run</span></strong><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">On Windows, if you see a </span><strong class="screenText"><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml">Windows Security Alert</span></strong><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml"> from </span><strong class="screenText"><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml">Windows Defender Firewall</span></strong><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml">, then click </span><strong class="screenText"><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml">Allow access</span></strong><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml">Note that </span><strong class="screenText"><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions Core Tools</span></strong><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml"> hosts your function, as shown in the following output and in </span><em class="italic"><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.1</span></em><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml">Azure Functions Core Tools
Core Tools Version:       4.0.5390 Commit hash: N/A  (64-bit)
Function Runtime Version: 4.25.3.21264
[2023-10-01T11:42:05.319Z] Found C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\Northwind.AzureFunctions.Service.csproj. </span><span class="koboSpan" id="kobo.871.2" xmlns="http://www.w3.org/1999/xhtml">Using for user secrets file configuration.
</span><span class="koboSpan" id="kobo.871.3" xmlns="http://www.w3.org/1999/xhtml">Functions:
        NumbersToWordsFunction: [GET,POST] http://localhost:5101/api/NumbersToWordsFunction
For detailed output, run func with --verbose flag.
</span><span class="koboSpan" id="kobo.871.4" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T11:42:14.265Z] Host lock lease acquired by instance ID '00000000000000000000000011150C3D'.
</span></code></pre>
<figure class="mediaobject"><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.1: Azure Functions Core Tools hosting a function</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">It might take a few minutes for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml">Host</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">lock</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml">lease</span></code><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml"> message to appear so do not worry if it doesn’t show immediately.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml">Select the</span><a id="_idIndexMarker1104"/><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml"> URL for your function and copy it to the clipboard.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml">Start Chrome.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">Paste the URL into the address box, append the query string </span><code class="inlineCode"><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml">?amount=123456</span></code><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">, and note the successful response in the browser of </span><strong class="screenText"><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml">one hundred and twenty-three thousand four hundred and fifty-six</span></strong><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.2</span></em><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.2: A successful call to the Azure function running locally</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">In the command prompt or terminal, note the function was called successfully, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">[2023-101-01T11:32:51.574Z] Executing 'NumbersToWordsFunction' (Reason='This function was programmatically called via the host APIs.', Id=234d3122-ff3d-4896-94b3-db3c8b5013d8)
[2023-10-01T11:32:51.603Z] C# HTTP trigger function processed a request.
</span><span class="koboSpan" id="kobo.892.2" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T11:32:51.629Z] Executed 'NumbersToWordsFunction' (Succeeded, Id=234d3122-ff3d-4896-94b3-db3c8b5013d8, Duration=96ms)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml">Try calling the </span><a id="_idIndexMarker1105"/><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">function without an amount in the query string, or a non-integer value for the amount like </span><code class="inlineCode"><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml">apples</span></code><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">, and note the function returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml">400</span></code><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml"> status code indicating a bad request with a custom message, </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml">Failed to parse: apples</span></code><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml">Close Chrome and shut down the web server (or in Visual Studio Code, stop debugging).</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-398"><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml">Responding to timer and resource triggers</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml">Now that you have seen an Azure Functions function that responds to an HTTP request, let’s build some that respond to other types of triggers.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">Support for HTTP and timer triggers is built in. </span><span class="koboSpan" id="kobo.904.2" xmlns="http://www.w3.org/1999/xhtml">Support for other bindings is implemented as extension packages.</span></p>
<h2 class="heading-2" id="_idParaDest-399"><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml">Implementing a Timer triggered function</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml">First, we will make</span><a id="_idIndexMarker1106"/><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml"> a function that runs every hour and requests a page from </span><a href="https://www.amazon.com/"><span class="url"><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">amazon.com</span></span></a><span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml"> for the eighth edition of my book, </span><em class="italic"><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">C# 12 and .NET 8 – Modern Cross-Platform Development Fundamentals</span></em><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml">, so that I can keep track of its Best Sellers Rank in the United States.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">The function will need to make HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml"> requests so we should inject the HTTP client factory. </span><span class="koboSpan" id="kobo.914.2" xmlns="http://www.w3.org/1999/xhtml">To do that, we will need to add some extra package references and create a special startup class:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml"> project, add package references for working with Azure Functions extensions and timers, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Azure.Functions.Extensions"</span></span><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml"> 
                  Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml">"1.1.0"</span></span><span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;PackageReference Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml">"4.2.0"</span></span><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml"> 
  Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Azure.Functions.Worker.Extensions.Timer"</span></span><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml"> project to restore packages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">, import</span><a id="_idIndexMarker1107"/><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml"> namespaces for working with dependency injection and HTTP media headers, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Extensions.DependencyInjection; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml">// To use AddHttpClient().</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml"> System.Net.Http.Headers; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml">// To use MediaTypeWithQualityHeaderValue.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to configure a HTTP client factory for making requests to Amazon as if it was the Chrome browser as a dependency service, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml"> host = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml"> HostBuilder()
  .ConfigureFunctionsWorkerDefaults()
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml">  .ConfigureServices(services =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">  { </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml">    services.AddHttpClient(name: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml">"Amazon"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml">      configureClient: options =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml">    {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">      options.BaseAddress = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml"> Uri(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml">"https://www.amazon.com"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">// Pretend to be Chrome with US English.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.Accept.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">text/html"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.Accept.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">"application/xhtml+xml"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.Accept.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml">"application/xml"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml">0.9</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.978.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.Accept.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.979.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.980.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.981.1" xmlns="http://www.w3.org/1999/xhtml">"image/avif"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.982.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.983.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.Accept.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.984.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.985.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.986.1" xmlns="http://www.w3.org/1999/xhtml">"image/webp"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.987.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.988.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.Accept.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.989.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.990.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.991.1" xmlns="http://www.w3.org/1999/xhtml">"image/apng"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.992.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.993.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.Accept.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.994.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.995.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.996.1" xmlns="http://www.w3.org/1999/xhtml">"*/*"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.997.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.998.1" xmlns="http://www.w3.org/1999/xhtml">0.8</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.999.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1000.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.AcceptLanguage.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1001.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1002.1" xmlns="http://www.w3.org/1999/xhtml"> StringWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1003.1" xmlns="http://www.w3.org/1999/xhtml">"en-US"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1004.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1005.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.AcceptLanguage.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1006.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1007.1" xmlns="http://www.w3.org/1999/xhtml"> StringWithQualityHeaderValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1008.1" xmlns="http://www.w3.org/1999/xhtml">"en"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1009.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1010.1" xmlns="http://www.w3.org/1999/xhtml">0.8</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1011.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1012.1" xmlns="http://www.w3.org/1999/xhtml">      options.DefaultRequestHeaders.UserAgent.Add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1013.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1014.1" xmlns="http://www.w3.org/1999/xhtml">(productName: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1015.1" xmlns="http://www.w3.org/1999/xhtml">"Chrome"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1016.1" xmlns="http://www.w3.org/1999/xhtml">, productVersion: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1017.1" xmlns="http://www.w3.org/1999/xhtml">"114.0.5735.91"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1018.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1019.1" xmlns="http://www.w3.org/1999/xhtml">    });</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1020.1" xmlns="http://www.w3.org/1999/xhtml">  })</span></strong></span><span class="koboSpan" id="kobo.1021.1" xmlns="http://www.w3.org/1999/xhtml">
  .Build();
host.Run();
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1022.1" xmlns="http://www.w3.org/1999/xhtml">The Chrome version on June 5, 2023, was </span><code class="inlineCode"><span class="koboSpan" id="kobo.1023.1" xmlns="http://www.w3.org/1999/xhtml">114.0.5735.91</span></code><span class="koboSpan" id="kobo.1024.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1024.2" xmlns="http://www.w3.org/1999/xhtml">The major version number usually increments monthly, so in November 2023, it will likely be </span><code class="inlineCode"><span class="koboSpan" id="kobo.1025.1" xmlns="http://www.w3.org/1999/xhtml">119</span></code><span class="koboSpan" id="kobo.1026.1" xmlns="http://www.w3.org/1999/xhtml">, and in November 2024, it will likely be </span><code class="inlineCode"><span class="koboSpan" id="kobo.1027.1" xmlns="http://www.w3.org/1999/xhtml">131</span></code><span class="koboSpan" id="kobo.1028.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1029.1" xmlns="http://www.w3.org/1999/xhtml">Add a class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1030.1" xmlns="http://www.w3.org/1999/xhtml">ScrapeAmazonFunction.cs</span></code><span class="koboSpan" id="kobo.1031.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1032.1" xmlns="http://www.w3.org/1999/xhtml">Modify its contents</span><a id="_idIndexMarker1108"/><span class="koboSpan" id="kobo.1033.1" xmlns="http://www.w3.org/1999/xhtml"> to implement a function that requests the page for the seventh edition of my book on the Amazon website and process the response, which is compressed using GZIP, to extract the book’s Best Seller Rank, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1034.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1035.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Azure.Functions.Worker; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1036.1" xmlns="http://www.w3.org/1999/xhtml">// To use [Function].</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1037.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1038.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Extensions.Logging; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1039.1" xmlns="http://www.w3.org/1999/xhtml">// To use ILogger.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1040.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1041.1" xmlns="http://www.w3.org/1999/xhtml"> System.IO.Compression; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1042.1" xmlns="http://www.w3.org/1999/xhtml">// To use GZipStream, CompressionMode.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1043.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1044.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></span><span class="koboSpan" id="kobo.1045.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1046.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1047.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1048.1" xmlns="http://www.w3.org/1999/xhtml">ScrapeAmazonFunction</span></span><span class="koboSpan" id="kobo.1049.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1050.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1051.1" xmlns="http://www.w3.org/1999/xhtml">const</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1052.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1053.1" xmlns="http://www.w3.org/1999/xhtml"> relativePath = 
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1054.1" xmlns="http://www.w3.org/1999/xhtml">"12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/"</span></span><span class="koboSpan" id="kobo.1055.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1056.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1057.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1058.1" xmlns="http://www.w3.org/1999/xhtml"> IHttpClientFactory _clientFactory;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1059.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1060.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1061.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger _logger;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1062.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1063.1" xmlns="http://www.w3.org/1999/xhtml">ScrapeAmazonFunction</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1064.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1065.1" xmlns="http://www.w3.org/1999/xhtml">IHttpClientFactory clientFactory,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1066.1" xmlns="http://www.w3.org/1999/xhtml">    ILoggerFactory loggerFactory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1067.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1068.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _clientFactory = clientFactory;
    _logger = loggerFactory.CreateLogger&lt;ScrapeAmazonFunction&gt;();
  }
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1069.1" xmlns="http://www.w3.org/1999/xhtml">Function(nameof(ScrapeAmazonFunction))</span></span><span class="koboSpan" id="kobo.1070.1" xmlns="http://www.w3.org/1999/xhtml">]
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1071.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1072.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1073.1" xmlns="http://www.w3.org/1999/xhtml"> Task </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1074.1" xmlns="http://www.w3.org/1999/xhtml">Run</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1075.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1076.1" xmlns="http://www.w3.org/1999/xhtml"> // Every hour.</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1077.1" xmlns="http://www.w3.org/1999/xhtml">    [TimerTrigger(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1078.1" xmlns="http://www.w3.org/1999/xhtml">"0 0 * * * *"</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1079.1" xmlns="http://www.w3.org/1999/xhtml">)] TimerInfo timer)</span></span><span class="koboSpan" id="kobo.1080.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1081.1" xmlns="http://www.w3.org/1999/xhtml">$"C# Timer trigger function executed at </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1082.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-subst"><span class="koboSpan" id="kobo.1083.1" xmlns="http://www.w3.org/1999/xhtml">      DateTime.UtcNow}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1084.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1085.1" xmlns="http://www.w3.org/1999/xhtml">);
    _logger.LogInformation(
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.1086.1" xmlns="http://www.w3.org/1999/xhtml">$"C# Timer trigger function next three occurrences at: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1087.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-subst"><span class="koboSpan" id="kobo.1088.1" xmlns="http://www.w3.org/1999/xhtml">        timer.ScheduleStatus?.Next}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1089.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1090.1" xmlns="http://www.w3.org/1999/xhtml">);
    HttpClient client = _clientFactory.CreateClient(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1091.1" xmlns="http://www.w3.org/1999/xhtml">"Amazon"</span></span><span class="koboSpan" id="kobo.1092.1" xmlns="http://www.w3.org/1999/xhtml">);
    HttpResponseMessage response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1093.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.1094.1" xmlns="http://www.w3.org/1999/xhtml"> client.GetAsync(relativePath);
    _logger.LogInformation(
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.1095.1" xmlns="http://www.w3.org/1999/xhtml">$"Request: GET </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1096.1" xmlns="http://www.w3.org/1999/xhtml">{client.BaseAddress}{relativePath}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1097.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1098.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1099.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1100.1" xmlns="http://www.w3.org/1999/xhtml"> (response.IsSuccessStatusCode)
    {
      _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1101.1" xmlns="http://www.w3.org/1999/xhtml">"Successful HTTP request."</span></span><span class="koboSpan" id="kobo.1102.1" xmlns="http://www.w3.org/1999/xhtml">);
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1103.1" xmlns="http://www.w3.org/1999/xhtml">// Read the content from a GZIP stream into a string.</span></span><span class="koboSpan" id="kobo.1104.1" xmlns="http://www.w3.org/1999/xhtml">
      Stream stream = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1105.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.1106.1" xmlns="http://www.w3.org/1999/xhtml"> response.Content.ReadAsStreamAsync();
      GZipStream gzipStream = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1107.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1108.1" xmlns="http://www.w3.org/1999/xhtml">(stream, CompressionMode.Decompress);
      StreamReader reader = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1109.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1110.1" xmlns="http://www.w3.org/1999/xhtml">(gzipStream);
      </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1111.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1112.1" xmlns="http://www.w3.org/1999/xhtml"> page = reader.ReadToEnd();
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1113.1" xmlns="http://www.w3.org/1999/xhtml">// Extract the Best Sellers Rank.</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1114.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.1115.1" xmlns="http://www.w3.org/1999/xhtml"> posBsr = page.IndexOf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1116.1" xmlns="http://www.w3.org/1999/xhtml">"Best Sellers Rank"</span></span><span class="koboSpan" id="kobo.1117.1" xmlns="http://www.w3.org/1999/xhtml">);
      </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1118.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1119.1" xmlns="http://www.w3.org/1999/xhtml"> bsrSection = page.Substring(posBsr, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1120.1" xmlns="http://www.w3.org/1999/xhtml">45</span></span><span class="koboSpan" id="kobo.1121.1" xmlns="http://www.w3.org/1999/xhtml">);
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1122.1" xmlns="http://www.w3.org/1999/xhtml">// bsrSection will be something like:</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1123.1" xmlns="http://www.w3.org/1999/xhtml">//   "Best Sellers Rank: &lt;/span&gt; #22,258 in Books ("</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1124.1" xmlns="http://www.w3.org/1999/xhtml">// Get the position of the # and the following space.</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1125.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.1126.1" xmlns="http://www.w3.org/1999/xhtml"> posHash = bsrSection.IndexOf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1127.1" xmlns="http://www.w3.org/1999/xhtml">"#"</span></span><span class="koboSpan" id="kobo.1128.1" xmlns="http://www.w3.org/1999/xhtml">) + </span><span class="hljs-number"><span class="koboSpan" id="kobo.1129.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.1130.1" xmlns="http://www.w3.org/1999/xhtml">;
      </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1131.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.1132.1" xmlns="http://www.w3.org/1999/xhtml"> posSpaceAfterHash = bsrSection.IndexOf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1133.1" xmlns="http://www.w3.org/1999/xhtml">" "</span></span><span class="koboSpan" id="kobo.1134.1" xmlns="http://www.w3.org/1999/xhtml">, posHash);
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1135.1" xmlns="http://www.w3.org/1999/xhtml">// Get the BSR number as text.</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1136.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1137.1" xmlns="http://www.w3.org/1999/xhtml"> bsr = bsrSection.Substring(
        posHash, posSpaceAfterHash - posHash);
      bsr = bsr.Replace(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1138.1" xmlns="http://www.w3.org/1999/xhtml">","</span></span><span class="koboSpan" id="kobo.1139.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1140.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="koboSpan" id="kobo.1141.1" xmlns="http://www.w3.org/1999/xhtml">); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1142.1" xmlns="http://www.w3.org/1999/xhtml">// remove commas</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1143.1" xmlns="http://www.w3.org/1999/xhtml">// Parse the text into a number.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1144.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1145.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1146.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.1147.1" xmlns="http://www.w3.org/1999/xhtml">.TryParse(bsr, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1148.1" xmlns="http://www.w3.org/1999/xhtml">out</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1149.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.1150.1" xmlns="http://www.w3.org/1999/xhtml"> bestSellersRank))
      {
        _logger.LogInformation(
          </span><span class="hljs-string"><span class="koboSpan" id="kobo.1151.1" xmlns="http://www.w3.org/1999/xhtml">$"Best Sellers Rank #</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1152.1" xmlns="http://www.w3.org/1999/xhtml">{bestSellersRank:N0}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1153.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1154.1" xmlns="http://www.w3.org/1999/xhtml">);
      }
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1155.1" xmlns="http://www.w3.org/1999/xhtml">else</span></span><span class="koboSpan" id="kobo.1156.1" xmlns="http://www.w3.org/1999/xhtml">
      {
        _logger.LogError(
          </span><span class="hljs-string"><span class="koboSpan" id="kobo.1157.1" xmlns="http://www.w3.org/1999/xhtml">$"Failed to extract BSR number from: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1158.1" xmlns="http://www.w3.org/1999/xhtml">{bsrSection}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1159.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1160.1" xmlns="http://www.w3.org/1999/xhtml">);
      }
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1161.1" xmlns="http://www.w3.org/1999/xhtml">else</span></span><span class="koboSpan" id="kobo.1162.1" xmlns="http://www.w3.org/1999/xhtml">
    {
      _logger.LogError(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1163.1" xmlns="http://www.w3.org/1999/xhtml">"Bad HTTP request."</span></span><span class="koboSpan" id="kobo.1164.1" xmlns="http://www.w3.org/1999/xhtml">);
    }
  }
}
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-400"><span class="koboSpan" id="kobo.1165.1" xmlns="http://www.w3.org/1999/xhtml">Testing the Timer triggered function</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1166.1" xmlns="http://www.w3.org/1999/xhtml">Information about a</span><a id="_idIndexMarker1109"/><span class="koboSpan" id="kobo.1167.1" xmlns="http://www.w3.org/1999/xhtml"> function can be retrieved by making an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.1168.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.1169.1" xmlns="http://www.w3.org/1999/xhtml"> request in the following format:</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1170.1" xmlns="http://www.w3.org/1999/xhtml">http://locahost:5101/admin/functions/&lt;functionname&gt;</span></code></p>
<p class="normal"><span class="koboSpan" id="kobo.1171.1" xmlns="http://www.w3.org/1999/xhtml">Now we can test the Timer function in our local development environment:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1172.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1173.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.1174.1" xmlns="http://www.w3.org/1999/xhtml"> project: </span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1175.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, you will need to make sure you have the Azurite extension installed and the Azurite services running. </span><span class="koboSpan" id="kobo.1175.2" xmlns="http://www.w3.org/1999/xhtml">Navigate to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1176.1" xmlns="http://www.w3.org/1999/xhtml">Run and Debug</span></strong><span class="koboSpan" id="kobo.1177.1" xmlns="http://www.w3.org/1999/xhtml"> pane, make sure that </span><strong class="screenText"><span class="koboSpan" id="kobo.1178.1" xmlns="http://www.w3.org/1999/xhtml">Attach to .NET Functions</span></strong><span class="koboSpan" id="kobo.1179.1" xmlns="http://www.w3.org/1999/xhtml"> is selected, and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1180.1" xmlns="http://www.w3.org/1999/xhtml">Run</span></strong><span class="koboSpan" id="kobo.1181.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1182.1" xmlns="http://www.w3.org/1999/xhtml">Note there are now two functions, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1183.1" xmlns="http://www.w3.org/1999/xhtml">Functions:
        NumbersToWordsFunction: [GET,POST] http://localhost:5101api/NumbersToWordsFunction
        ScrapeAmazonFunction: timerTrigger
For detailed output, run func with --verbose flag.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1184.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1185.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.1186.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1187.1" xmlns="http://www.w3.org/1999/xhtml">azurefunctions-scrapeamazon.http</span></code><span class="koboSpan" id="kobo.1188.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1189.1" xmlns="http://www.w3.org/1999/xhtml">Modify its contents to define a global variable and two requests to the Azure Functions locally hosted service, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1190.1" xmlns="http://www.w3.org/1999/xhtml">### Configure a variable for the Azure Functions service base address.
</span><span class="koboSpan" id="kobo.1190.2" xmlns="http://www.w3.org/1999/xhtml">@base_address = http://localhost:5101/
### Get information about the NumbersToWordsFunction function.
</span><span class="koboSpan" id="kobo.1190.3" xmlns="http://www.w3.org/1999/xhtml">{{base_address}}admin/functions/NumbersToWordsFunction
### Get information about the ScrapeAmazonFunction function.
</span><span class="koboSpan" id="kobo.1190.4" xmlns="http://www.w3.org/1999/xhtml">{{base_address}}admin/functions/ScrapeAmazonFunction
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1191.1" xmlns="http://www.w3.org/1999/xhtml">Send the first request and note that a JSON document is returned with information </span><a id="_idIndexMarker1110"/><span class="koboSpan" id="kobo.1192.1" xmlns="http://www.w3.org/1999/xhtml">about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1193.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction</span></code><span class="koboSpan" id="kobo.1194.1" xmlns="http://www.w3.org/1999/xhtml"> function, as shown in the following response:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1195.1" xmlns="http://www.w3.org/1999/xhtml">HTTP/</span><span class="hljs-number"><span class="koboSpan" id="kobo.1196.1" xmlns="http://www.w3.org/1999/xhtml">1.1</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1197.1" xmlns="http://www.w3.org/1999/xhtml">200</span></span><span class="koboSpan" id="kobo.1198.1" xmlns="http://www.w3.org/1999/xhtml"> OK
Content-Length</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1199.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1200.1" xmlns="http://www.w3.org/1999/xhtml">918</span></span><span class="koboSpan" id="kobo.1201.1" xmlns="http://www.w3.org/1999/xhtml">
Connection</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1202.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.1203.1" xmlns="http://www.w3.org/1999/xhtml"> close
Content-Type</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1204.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.1205.1" xmlns="http://www.w3.org/1999/xhtml"> application/json; charset=utf</span><span class="hljs-number"><span class="koboSpan" id="kobo.1206.1" xmlns="http://www.w3.org/1999/xhtml">-8</span></span><span class="koboSpan" id="kobo.1207.1" xmlns="http://www.w3.org/1999/xhtml">
Date</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1208.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.1209.1" xmlns="http://www.w3.org/1999/xhtml"> Mon</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1210.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1211.1" xmlns="http://www.w3.org/1999/xhtml">05</span></span><span class="koboSpan" id="kobo.1212.1" xmlns="http://www.w3.org/1999/xhtml"> Jun </span><span class="hljs-number"><span class="koboSpan" id="kobo.1213.1" xmlns="http://www.w3.org/1999/xhtml">2023</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1214.1" xmlns="http://www.w3.org/1999/xhtml">13</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1215.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1216.1" xmlns="http://www.w3.org/1999/xhtml">32</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1217.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1218.1" xmlns="http://www.w3.org/1999/xhtml">11</span></span><span class="koboSpan" id="kobo.1219.1" xmlns="http://www.w3.org/1999/xhtml"> GMT
Server</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1220.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.1221.1" xmlns="http://www.w3.org/1999/xhtml"> Kestrel
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1222.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1223.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1224.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1225.1" xmlns="http://www.w3.org/1999/xhtml">"NumbersToWordsFunction"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1226.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1227.1" xmlns="http://www.w3.org/1999/xhtml">"script_root_path_href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1228.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1229.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1230.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1231.1" xmlns="http://www.w3.org/1999/xhtml">"script_href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1232.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1233.1" xmlns="http://www.w3.org/1999/xhtml">"http://localhost:5101/admin/vfs/bin/Northwind.AzureFunctions.Service.dll"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1234.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1235.1" xmlns="http://www.w3.org/1999/xhtml">"config_href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1236.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1237.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1238.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1239.1" xmlns="http://www.w3.org/1999/xhtml">"test_data_href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1240.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1241.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1242.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1243.1" xmlns="http://www.w3.org/1999/xhtml">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1244.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1245.1" xmlns="http://www.w3.org/1999/xhtml">"http://localhost:5101/admin/functions/NumbersToWordsFunction"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1246.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1247.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1248.1" xmlns="http://www.w3.org/1999/xhtml">invoke_url_template"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1249.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1250.1" xmlns="http://www.w3.org/1999/xhtml">"http://localhost:5101/api/numberstowordsfunction"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1251.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1252.1" xmlns="http://www.w3.org/1999/xhtml">"language"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1253.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1254.1" xmlns="http://www.w3.org/1999/xhtml">"dotnet-isolated"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1255.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1256.1" xmlns="http://www.w3.org/1999/xhtml">"config"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1257.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1258.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1259.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1260.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1261.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1262.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1263.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1264.1" xmlns="http://www.w3.org/1999/xhtml">"entryPoint"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1265.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1266.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.AzureFunctions.Service.NumbersToWordsFunction.Run"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1267.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1268.1" xmlns="http://www.w3.org/1999/xhtml">"scriptFile"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1269.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1270.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.AzureFunctions.Service.dll"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1271.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1272.1" xmlns="http://www.w3.org/1999/xhtml">"language"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1273.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1274.1" xmlns="http://www.w3.org/1999/xhtml">"dotnet-isolated"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1275.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1276.1" xmlns="http://www.w3.org/1999/xhtml">"functionDirectory"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1277.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1278.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1279.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1280.1" xmlns="http://www.w3.org/1999/xhtml">"bindings"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1281.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1282.1" xmlns="http://www.w3.org/1999/xhtml">[</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1283.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1284.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1285.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1286.1" xmlns="http://www.w3.org/1999/xhtml">"req"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1287.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1288.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1289.1" xmlns="http://www.w3.org/1999/xhtml">direction"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1290.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1291.1" xmlns="http://www.w3.org/1999/xhtml">"In"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1292.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1293.1" xmlns="http://www.w3.org/1999/xhtml">"type"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1294.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1295.1" xmlns="http://www.w3.org/1999/xhtml">"httpTrigger"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1296.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1297.1" xmlns="http://www.w3.org/1999/xhtml">"authLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1298.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1299.1" xmlns="http://www.w3.org/1999/xhtml">"Anonymous"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1300.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1301.1" xmlns="http://www.w3.org/1999/xhtml">"methods"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1302.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1303.1" xmlns="http://www.w3.org/1999/xhtml">[</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1304.1" xmlns="http://www.w3.org/1999/xhtml">"get"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1305.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1306.1" xmlns="http://www.w3.org/1999/xhtml">"post"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1307.1" xmlns="http://www.w3.org/1999/xhtml">],</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1308.1" xmlns="http://www.w3.org/1999/xhtml">"properties"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1309.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1310.1" xmlns="http://www.w3.org/1999/xhtml">{}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1311.1" xmlns="http://www.w3.org/1999/xhtml">},</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1312.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1313.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1314.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1315.1" xmlns="http://www.w3.org/1999/xhtml">"$return"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1316.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1317.1" xmlns="http://www.w3.org/1999/xhtml">"type"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1318.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1319.1" xmlns="http://www.w3.org/1999/xhtml">"http"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1320.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1321.1" xmlns="http://www.w3.org/1999/xhtml">"direction"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1322.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1323.1" xmlns="http://www.w3.org/1999/xhtml">"Out"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1324.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1325.1" xmlns="http://www.w3.org/1999/xhtml">]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1326.1" xmlns="http://www.w3.org/1999/xhtml">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1327.1" xmlns="http://www.w3.org/1999/xhtml">"files"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1328.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1329.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1330.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1331.1" xmlns="http://www.w3.org/1999/xhtml">"test_data"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1332.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1333.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1334.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1335.1" xmlns="http://www.w3.org/1999/xhtml">"isDisabled"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1336.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1337.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1338.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1339.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1340.1" xmlns="http://www.w3.org/1999/xhtml">isDirect"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1341.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1342.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1343.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1344.1" xmlns="http://www.w3.org/1999/xhtml">"isProxy"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1345.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1346.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1347.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1348.1" xmlns="http://www.w3.org/1999/xhtml">Send the second request and note that a JSON document is returned with information about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1349.1" xmlns="http://www.w3.org/1999/xhtml">ScrapeAmazonFunction</span></code><span class="koboSpan" id="kobo.1350.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.1350.2" xmlns="http://www.w3.org/1999/xhtml">The most interesting information</span><a id="_idIndexMarker1111"/><span class="koboSpan" id="kobo.1351.1" xmlns="http://www.w3.org/1999/xhtml"> for this function is the binding type and schedule, as shown in the following partial response:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1352.1" xmlns="http://www.w3.org/1999/xhtml">"bindings"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1353.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1354.1" xmlns="http://www.w3.org/1999/xhtml">[</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1355.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1356.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1357.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1358.1" xmlns="http://www.w3.org/1999/xhtml">"timer"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1359.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1360.1" xmlns="http://www.w3.org/1999/xhtml">"direction"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1361.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1362.1" xmlns="http://www.w3.org/1999/xhtml">"In"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1363.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1364.1" xmlns="http://www.w3.org/1999/xhtml">"type"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1365.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1366.1" xmlns="http://www.w3.org/1999/xhtml">"timerTrigger"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1367.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1368.1" xmlns="http://www.w3.org/1999/xhtml">"schedule"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1369.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1370.1" xmlns="http://www.w3.org/1999/xhtml">"0 0 * * * *"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1371.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1372.1" xmlns="http://www.w3.org/1999/xhtml">"properties"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1373.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1374.1" xmlns="http://www.w3.org/1999/xhtml">{}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1375.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1376.1" xmlns="http://www.w3.org/1999/xhtml">],</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1377.1" xmlns="http://www.w3.org/1999/xhtml">Add a third request that will trigger the timer function manually without having to wait for the hour mark by sending a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1378.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.1379.1" xmlns="http://www.w3.org/1999/xhtml"> request with an empty JSON document in the body to its </span><code class="inlineCode"><span class="koboSpan" id="kobo.1380.1" xmlns="http://www.w3.org/1999/xhtml">admin</span></code><span class="koboSpan" id="kobo.1381.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.1382.1" xmlns="http://www.w3.org/1999/xhtml">### Make a manual request to the Timer function.</span></span><span class="koboSpan" id="kobo.1383.1" xmlns="http://www.w3.org/1999/xhtml">
POST {{base_address}}admin/functions/ScrapeAmazonFunction
Content-Type: application/json
{}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1384.1" xmlns="http://www.w3.org/1999/xhtml">Send the third request and note that it was successfully accepted, as shown in the following response:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1385.1" xmlns="http://www.w3.org/1999/xhtml">HTTP/1.1 202 Accepted
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1386.1" xmlns="http://www.w3.org/1999/xhtml">Remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1387.1" xmlns="http://www.w3.org/1999/xhtml">{}</span></code><span class="koboSpan" id="kobo.1388.1" xmlns="http://www.w3.org/1999/xhtml"> in the body of the request, send it again, and note the client error response from which we can deduce that an empty JSON document is required, as shown in the following response:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1389.1" xmlns="http://www.w3.org/1999/xhtml">HTTP/1.1 400 Bad Request
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1390.1" xmlns="http://www.w3.org/1999/xhtml">Add the empty JSON </span><a id="_idIndexMarker1112"/><span class="koboSpan" id="kobo.1391.1" xmlns="http://www.w3.org/1999/xhtml">document back.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1392.1" xmlns="http://www.w3.org/1999/xhtml">At the command prompt or terminal for the Azure Functions service, note that the function was triggered by our call. </span><span class="koboSpan" id="kobo.1392.2" xmlns="http://www.w3.org/1999/xhtml">It outputs the time it was triggered (13:49 p.m.) and the time of its next occurrence in its normal timer schedule (2 p.m.) if I were to leave the service running, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1393.1" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T13:49:53.939Z] Executing 'Functions.ScrapeAmazonFunction' (Reason='This function was programmatically called via the host APIs.', Id=1df349a1-79c5-4b52-a7f1-d0f8f0d5cd9c)
[2023-10-01T13:49:54.095Z] C# Timer trigger function executed at 01/10/2023 13:49:54.
</span><span class="koboSpan" id="kobo.1393.2" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T13:49:54.095Z] C# Timer trigger function next occurrence at: 01/10/2023 14:00:00.
</span><span class="koboSpan" id="kobo.1393.3" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T13:49:54.105Z] Start processing HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T13:49:54.106Z] Sending HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T13:49:54.520Z] Received HTTP response after 407.4353ms - OK
[2023-10-01T13:49:54.521Z] End processing HTTP request after 420.1273ms - OK
[2023-10-01T13:49:56.212Z] Successful HTTP request.
</span><span class="koboSpan" id="kobo.1393.4" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T13:49:56.212Z] Request: GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T13:49:56.251Z] Best Sellers Rank #384,269.
</span><span class="koboSpan" id="kobo.1393.5" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T13:49:56.275Z] Executed 'Functions.ScrapeAmazonFunction' (Succeeded, Id=1df349a1-79c5-4b52-a7f1-d0f8f0d5cd9c, Duration=2362ms)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1394.1" xmlns="http://www.w3.org/1999/xhtml">Optionally, wait until the hour mark and note that the next occurrence triggers, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1395.1" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T14:00:00.023Z] Executing 'Functions.ScrapeAmazonFunction' (Reason='Timer fired at 2023-10-01T15:00:00.0220351+01:00', Id=aa9f7495-6066-4b0a-ba81-42582d677321)
[2023-10-01T14:00:00.027Z] C# Timer trigger function executed at 01/10/2023 14:00:00.
</span><span class="koboSpan" id="kobo.1395.2" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T14:00:00.028Z] Start processing HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T14:00:00.027Z] C# Timer trigger function next occurrence at: 01/10/2023 15:00:00.
</span><span class="koboSpan" id="kobo.1395.3" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T14:00:00.028Z] Sending HTTP request GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T14:00:00.337Z] Received HTTP response after 305.1877ms - OK
[2023-10-01T14:00:00.339Z] End processing HTTP request after 305.5222ms - OK
[2023-10-01T14:00:01.899Z] Successful HTTP request.
</span><span class="koboSpan" id="kobo.1395.4" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T14:00:01.899Z] Request: GET https://www.amazon.com/12-NET-Cross-Platform-Development-Fundamentals/dp/1837635870/
[2023-10-01T14:00:01.931Z] Best Sellers Rank #387,339.
</span><span class="koboSpan" id="kobo.1395.5" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T14:00:01.931Z] Executed 'Functions.ScrapeAmazonFunction' (Succeeded, Id=aa9f7495-6066-4b0a-ba81-42582d677321, Duration=1909ms)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1396.1" xmlns="http://www.w3.org/1999/xhtml">If I were to stop the service running, wait for more than an hour, and then start the service, it </span><a id="_idIndexMarker1113"/><span class="koboSpan" id="kobo.1397.1" xmlns="http://www.w3.org/1999/xhtml">would immediately run the function because it is past due, as shown highlighted in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1398.1" xmlns="http://www.w3.org/1999/xhtml">[2023-10-01T16:19:31.369Z] Trigger Details: UnscheduledInvocationReason: IsPastDue, OriginalSchedule: 2023-10-01T15:00:00.0000000+01:00
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1399.1" xmlns="http://www.w3.org/1999/xhtml">Shut down the Azure Functions service.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-401"><span class="koboSpan" id="kobo.1400.1" xmlns="http://www.w3.org/1999/xhtml">Implementing a function that works with queues and BLOBs</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1401.1" xmlns="http://www.w3.org/1999/xhtml">The HTTP-triggered function responded directly to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1402.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.1403.1" xmlns="http://www.w3.org/1999/xhtml"> request with plain text. </span><span class="koboSpan" id="kobo.1403.2" xmlns="http://www.w3.org/1999/xhtml">We will now define a similar </span><a id="_idIndexMarker1114"/><span class="koboSpan" id="kobo.1404.1" xmlns="http://www.w3.org/1999/xhtml">function to bind to Queue Storage and add a message to a queue to indicate that an image needs to be generated and uploaded to Blob Storage. </span><span class="koboSpan" id="kobo.1404.2" xmlns="http://www.w3.org/1999/xhtml">This can then be printed as a check.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1405.1" xmlns="http://www.w3.org/1999/xhtml">When running the service locally, we want to generate the image of the check BLOB in the local filesystem to make it easier to ensure it is working correctly. </span><span class="koboSpan" id="kobo.1405.2" xmlns="http://www.w3.org/1999/xhtml">We will set a custom environment variable in local settings to detect that condition.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1406.1" xmlns="http://www.w3.org/1999/xhtml">We need a font that looks like handwriting. </span><span class="koboSpan" id="kobo.1406.2" xmlns="http://www.w3.org/1999/xhtml">Google has a useful website where you can search for, preview, and download fonts. </span><span class="koboSpan" id="kobo.1406.3" xmlns="http://www.w3.org/1999/xhtml">The one we will use is Caveat, as shown at the following link:</span></p>
<p class="normal"><a href="https://fonts.google.com/specimen/Caveat?category=Handwriting&amp;preview.text=one%20hundred%20and%20twenty%20three%20thousand,%20four%20hundred%20and%20fifty%20six&amp;preview.text_type=custom#standard-styles"><span class="url"><span class="koboSpan" id="kobo.1407.1" xmlns="http://www.w3.org/1999/xhtml">https://fonts.google.com/specimen/Caveat?category=Handwriting&amp;preview.text=one%20hundred%20and%20twenty%20three%20thousand,%20four%20hundred%20and%20fifty%20six&amp;preview.text_type=custom#standard-styles</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1408.1" xmlns="http://www.w3.org/1999/xhtml">Let’s go:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1409.1" xmlns="http://www.w3.org/1999/xhtml">Download the font at the link above, extract the ZIP file, and copy the files into a folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1410.1" xmlns="http://www.w3.org/1999/xhtml">fonts</span></code><span class="koboSpan" id="kobo.1411.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in Visual Studio 2022 in </span><em class="italic"><span class="koboSpan" id="kobo.1412.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.3</span></em><span class="koboSpan" id="kobo.1413.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1414.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1415.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.3: The fonts folder with the Caveat font files in Visual Studio 2022</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1416.1" xmlns="http://www.w3.org/1999/xhtml">Select the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1417.1" xmlns="http://www.w3.org/1999/xhtml">Caveat-Regular.ttf</span></code><span class="koboSpan" id="kobo.1418.1" xmlns="http://www.w3.org/1999/xhtml"> font file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1419.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.1420.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></strong><span class="koboSpan" id="kobo.1421.1" xmlns="http://www.w3.org/1999/xhtml">, set </span><strong class="screenText"><span class="koboSpan" id="kobo.1422.1" xmlns="http://www.w3.org/1999/xhtml">Copy to Output Directory</span></strong><span class="koboSpan" id="kobo.1423.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><strong class="screenText"><span class="koboSpan" id="kobo.1424.1" xmlns="http://www.w3.org/1999/xhtml">Copy always</span></strong><span class="koboSpan" id="kobo.1425.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1426.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.3</span></em><span class="koboSpan" id="kobo.1427.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1427.2" xmlns="http://www.w3.org/1999/xhtml">This adds an</span><a id="_idIndexMarker1115"/><span class="koboSpan" id="kobo.1428.1" xmlns="http://www.w3.org/1999/xhtml"> entry to the project file, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1429.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1430.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;None Update=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1431.1" xmlns="http://www.w3.org/1999/xhtml">"fonts\Caveat\static\Caveat-Regular.ttf"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1432.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1433.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1434.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;/None&gt;</span></strong></span><span class="koboSpan" id="kobo.1435.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;None Update=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1436.1" xmlns="http://www.w3.org/1999/xhtml">"host.json"</span></span><span class="koboSpan" id="kobo.1437.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
    &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
  &lt;/None&gt;
  &lt;None Update=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1438.1" xmlns="http://www.w3.org/1999/xhtml">"local.settings.json"</span></span><span class="koboSpan" id="kobo.1439.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
    &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
    &lt;CopyToPublishDirectory&gt;Never&lt;/CopyToPublishDirectory&gt;
  &lt;/None&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1440.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, manually add the preceding entry to the project file.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1441.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1442.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.1443.1" xmlns="http://www.w3.org/1999/xhtml"> project, add package references for working with the Azure Queue and Blob Storage extensions and drawing with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1444.1" xmlns="http://www.w3.org/1999/xhtml">ImageSharp</span></code><span class="koboSpan" id="kobo.1445.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1446.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PackageReference Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1447.1" xmlns="http://www.w3.org/1999/xhtml">"5.2.0"</span></span><span class="koboSpan" id="kobo.1448.1" xmlns="http://www.w3.org/1999/xhtml"> Include=
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.1449.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1450.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Azure.Functions.Worker.Extensions.Storage.Queues"</span></span><span class="koboSpan" id="kobo.1451.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;PackageReference Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1452.1" xmlns="http://www.w3.org/1999/xhtml">"6.2.0"</span></span><span class="koboSpan" id="kobo.1453.1" xmlns="http://www.w3.org/1999/xhtml"> Include=
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.1454.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Azure.Functions.Worker.Extensions.Storage.Blobs"</span></span><span class="koboSpan" id="kobo.1455.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1456.1" xmlns="http://www.w3.org/1999/xhtml">"SixLabors.ImageSharp"</span></span><span class="koboSpan" id="kobo.1457.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1458.1" xmlns="http://www.w3.org/1999/xhtml">"3.0.2"</span></span><span class="koboSpan" id="kobo.1459.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1460.1" xmlns="http://www.w3.org/1999/xhtml">"SixLabors.ImageSharp.Drawing"</span></span><span class="koboSpan" id="kobo.1461.1" xmlns="http://www.w3.org/1999/xhtml"> 
                  Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1462.1" xmlns="http://www.w3.org/1999/xhtml">"2.0.0"</span></span><span class="koboSpan" id="kobo.1463.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1464.1" xmlns="http://www.w3.org/1999/xhtml">Build the project to restore packages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1465.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1466.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.1467.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a new class named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1468.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToChecksFunction.cs</span></code><span class="koboSpan" id="kobo.1469.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1470.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1471.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToChecksFunction.cs</span></code><span class="koboSpan" id="kobo.1472.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to register the function with an output binding for Queue Storage so that it can write to a named queue, and when the</span><a id="_idIndexMarker1116"/><span class="koboSpan" id="kobo.1473.1" xmlns="http://www.w3.org/1999/xhtml"> amount is successfully parsed to return the words to the queue, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1474.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1475.1" xmlns="http://www.w3.org/1999/xhtml"> Humanizer; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1476.1" xmlns="http://www.w3.org/1999/xhtml">// To use ToWords extension method.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1477.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1478.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Azure.Functions.Worker; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1479.1" xmlns="http://www.w3.org/1999/xhtml">// To use [Function] and so on.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1480.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1481.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Azure.Functions.Worker.Http; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1482.1" xmlns="http://www.w3.org/1999/xhtml">// To use HttpRequestData.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1483.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1484.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Extensions.Logging; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1485.1" xmlns="http://www.w3.org/1999/xhtml">// To use ILogger.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1486.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1487.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></span><span class="koboSpan" id="kobo.1488.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1489.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1490.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1491.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToChecksFunction</span></span><span class="koboSpan" id="kobo.1492.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1493.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1494.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1495.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger _logger;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1496.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1497.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToChecksFunction</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1498.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1499.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory loggerFactory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1500.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1501.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger = loggerFactory.CreateLogger&lt;NumbersToChecksFunction&gt;();
  }
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1502.1" xmlns="http://www.w3.org/1999/xhtml">Function(nameof(NumbersToChecksFunction))</span></span><span class="koboSpan" id="kobo.1503.1" xmlns="http://www.w3.org/1999/xhtml">]
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1504.1" xmlns="http://www.w3.org/1999/xhtml">QueueOutput(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1505.1" xmlns="http://www.w3.org/1999/xhtml">"checksQueue"</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1506.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1507.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1508.1" xmlns="http://www.w3.org/1999/xhtml">// Return value is written to this queue.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1509.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1510.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1511.1" xmlns="http://www.w3.org/1999/xhtml">Run</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1512.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1513.1" xmlns="http://www.w3.org/1999/xhtml">    [HttpTrigger(AuthorizationLevel.Anonymous,</span></span>
<span class="hljs-params"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.1514.1" xmlns="http://www.w3.org/1999/xhtml">"get"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1515.1" xmlns="http://www.w3.org/1999/xhtml">, </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1516.1" xmlns="http://www.w3.org/1999/xhtml">"post"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1517.1" xmlns="http://www.w3.org/1999/xhtml">, Route = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.1518.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1519.1" xmlns="http://www.w3.org/1999/xhtml">)] HttpRequestData request)</span></span><span class="koboSpan" id="kobo.1520.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1521.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1522.1" xmlns="http://www.w3.org/1999/xhtml">C# HTTP trigger function processed a request."</span></span><span class="koboSpan" id="kobo.1523.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1524.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1525.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.1525.2" xmlns="http://www.w3.org/1999/xhtml">amount = request.Query[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1526.1" xmlns="http://www.w3.org/1999/xhtml">"amount"</span></span><span class="koboSpan" id="kobo.1527.1" xmlns="http://www.w3.org/1999/xhtml">];
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1528.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1529.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1530.1" xmlns="http://www.w3.org/1999/xhtml">long</span></span><span class="koboSpan" id="kobo.1531.1" xmlns="http://www.w3.org/1999/xhtml">.TryParse(amount, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1532.1" xmlns="http://www.w3.org/1999/xhtml">out</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1533.1" xmlns="http://www.w3.org/1999/xhtml">long</span></span><span class="koboSpan" id="kobo.1534.1" xmlns="http://www.w3.org/1999/xhtml"> number))
    {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1535.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1536.1" xmlns="http://www.w3.org/1999/xhtml"> number.ToWords();
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1537.1" xmlns="http://www.w3.org/1999/xhtml">else</span></span><span class="koboSpan" id="kobo.1538.1" xmlns="http://www.w3.org/1999/xhtml">
    {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1539.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1540.1" xmlns="http://www.w3.org/1999/xhtml">$"Failed to parse: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1541.1" xmlns="http://www.w3.org/1999/xhtml">{amount}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1542.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1543.1" xmlns="http://www.w3.org/1999/xhtml">;
    }
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1544.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1545.1" xmlns="http://www.w3.org/1999/xhtml">local.settings.json</span></code><span class="koboSpan" id="kobo.1546.1" xmlns="http://www.w3.org/1999/xhtml">, add an environment variable named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1547.1" xmlns="http://www.w3.org/1999/xhtml">IS_LOCAL</span></code><span class="koboSpan" id="kobo.1548.1" xmlns="http://www.w3.org/1999/xhtml"> with a value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1549.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.1550.1" xmlns="http://www.w3.org/1999/xhtml">, as shown </span><a id="_idIndexMarker1117"/><span class="koboSpan" id="kobo.1551.1" xmlns="http://www.w3.org/1999/xhtml">highlighted in the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1552.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1553.1" xmlns="http://www.w3.org/1999/xhtml">"IsEncrypted"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1554.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1555.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1556.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1557.1" xmlns="http://www.w3.org/1999/xhtml">"Values"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1558.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1559.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1560.1" xmlns="http://www.w3.org/1999/xhtml">"AzureWebJobsStorage"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1561.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1562.1" xmlns="http://www.w3.org/1999/xhtml">"UseDevelopmentStorage=true"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1563.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1564.1" xmlns="http://www.w3.org/1999/xhtml">"FUNCTIONS_WORKER_RUNTIME"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1565.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1566.1" xmlns="http://www.w3.org/1999/xhtml">"dotnet-isolated"</span></span><span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1567.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1568.1" xmlns="http://www.w3.org/1999/xhtml">"IS_LOCAL"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1569.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1570.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1571.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1572.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1573.1" xmlns="http://www.w3.org/1999/xhtml">Add a class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1574.1" xmlns="http://www.w3.org/1999/xhtml">CheckGeneratorFunction.cs</span></code><span class="koboSpan" id="kobo.1575.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1576.1" xmlns="http://www.w3.org/1999/xhtml">Modify its contents, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1577.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1578.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Azure.Functions.Worker; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1579.1" xmlns="http://www.w3.org/1999/xhtml">// To use [Function] and so on.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1580.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1581.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Extensions.Logging; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1582.1" xmlns="http://www.w3.org/1999/xhtml">// To use ILogger.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1583.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1584.1" xmlns="http://www.w3.org/1999/xhtml"> SixLabors.Fonts; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1585.1" xmlns="http://www.w3.org/1999/xhtml">// To use Font.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1586.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1587.1" xmlns="http://www.w3.org/1999/xhtml"> SixLabors.ImageSharp.Drawing; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1588.1" xmlns="http://www.w3.org/1999/xhtml">// To use IPath.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1589.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1590.1" xmlns="http://www.w3.org/1999/xhtml"> SixLabors.ImageSharp.Drawing.Processing; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1591.1" xmlns="http://www.w3.org/1999/xhtml">// To use Brush, Pen.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1592.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1593.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></span><span class="koboSpan" id="kobo.1594.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1595.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1596.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1597.1" xmlns="http://www.w3.org/1999/xhtml">CheckGeneratorFunction</span></span><span class="koboSpan" id="kobo.1598.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1599.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1600.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1601.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger _logger;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1602.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1603.1" xmlns="http://www.w3.org/1999/xhtml">CheckGeneratorFunction</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1604.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1605.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory loggerFactory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1606.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1607.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger = loggerFactory.CreateLogger&lt;NumbersToWordsFunction&gt;();
  }
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1608.1" xmlns="http://www.w3.org/1999/xhtml">Function(nameof(CheckGeneratorFunction))</span></span><span class="koboSpan" id="kobo.1609.1" xmlns="http://www.w3.org/1999/xhtml">]
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1610.1" xmlns="http://www.w3.org/1999/xhtml">BlobOutput(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1611.1" xmlns="http://www.w3.org/1999/xhtml">"checks-blob-container/check.png"</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1612.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1613.1" xmlns="http://www.w3.org/1999/xhtml">]
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1614.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1615.1" xmlns="http://www.w3.org/1999/xhtml">byte</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1616.1" xmlns="http://www.w3.org/1999/xhtml">[] </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1617.1" xmlns="http://www.w3.org/1999/xhtml">Run</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1618.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1619.1" xmlns="http://www.w3.org/1999/xhtml">    [QueueTrigger(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1620.1" xmlns="http://www.w3.org/1999/xhtml">"checksQueue"</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1621.1" xmlns="http://www.w3.org/1999/xhtml">)] </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1622.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1623.1" xmlns="http://www.w3.org/1999/xhtml"> message)</span></span><span class="koboSpan" id="kobo.1624.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1625.1" xmlns="http://www.w3.org/1999/xhtml">"C# Queue trigger function executed."</span></span><span class="koboSpan" id="kobo.1626.1" xmlns="http://www.w3.org/1999/xhtml">);
    _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1627.1" xmlns="http://www.w3.org/1999/xhtml">$"Body: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1628.1" xmlns="http://www.w3.org/1999/xhtml">{message}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1629.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1630.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1631.1" xmlns="http://www.w3.org/1999/xhtml">// Create a new blank image with a white background.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1632.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1633.1" xmlns="http://www.w3.org/1999/xhtml"> (Image&lt;Rgba32&gt; image = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1634.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1635.1" xmlns="http://www.w3.org/1999/xhtml">(width: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1636.1" xmlns="http://www.w3.org/1999/xhtml">1200</span></span><span class="koboSpan" id="kobo.1637.1" xmlns="http://www.w3.org/1999/xhtml">, height: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1638.1" xmlns="http://www.w3.org/1999/xhtml">600</span></span><span class="koboSpan" id="kobo.1639.1" xmlns="http://www.w3.org/1999/xhtml">,
      backgroundColor: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1640.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1641.1" xmlns="http://www.w3.org/1999/xhtml"> Rgba32(r: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1642.1" xmlns="http://www.w3.org/1999/xhtml">255</span></span><span class="koboSpan" id="kobo.1643.1" xmlns="http://www.w3.org/1999/xhtml">, g: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1644.1" xmlns="http://www.w3.org/1999/xhtml">255</span></span><span class="koboSpan" id="kobo.1645.1" xmlns="http://www.w3.org/1999/xhtml">, b: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1646.1" xmlns="http://www.w3.org/1999/xhtml">255</span></span><span class="koboSpan" id="kobo.1647.1" xmlns="http://www.w3.org/1999/xhtml">, a: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1648.1" xmlns="http://www.w3.org/1999/xhtml">100</span></span><span class="koboSpan" id="kobo.1649.1" xmlns="http://www.w3.org/1999/xhtml">)))
    {
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1650.1" xmlns="http://www.w3.org/1999/xhtml">// Load the font file and create a large font.</span></span><span class="koboSpan" id="kobo.1651.1" xmlns="http://www.w3.org/1999/xhtml">
      FontCollection collection = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1652.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1653.1" xmlns="http://www.w3.org/1999/xhtml">();
      FontFamily family = collection.Add(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1654.1" xmlns="http://www.w3.org/1999/xhtml">@"fonts\Caveat\static\Caveat-Regular.ttf"</span></span><span class="koboSpan" id="kobo.1655.1" xmlns="http://www.w3.org/1999/xhtml">);
      Font font = family.CreateFont(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1656.1" xmlns="http://www.w3.org/1999/xhtml">72</span></span><span class="koboSpan" id="kobo.1657.1" xmlns="http://www.w3.org/1999/xhtml">);
      </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1658.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1659.1" xmlns="http://www.w3.org/1999/xhtml"> amount = message.Body.ToString();
      DrawingOptions options = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1660.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1661.1" xmlns="http://www.w3.org/1999/xhtml">()
      {
        GraphicsOptions = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1662.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1663.1" xmlns="http://www.w3.org/1999/xhtml">()
        {
          ColorBlendingMode = PixelColorBlendingMode.Multiply
        }
      };
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1664.1" xmlns="http://www.w3.org/1999/xhtml">// Define some pens and brushes.</span></span><span class="koboSpan" id="kobo.1665.1" xmlns="http://www.w3.org/1999/xhtml">
      Pen blackPen = Pens.Solid(Color.Black, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1666.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.1667.1" xmlns="http://www.w3.org/1999/xhtml">);
      Pen blackThickPen = Pens.Solid(Color.Black, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1668.1" xmlns="http://www.w3.org/1999/xhtml">8</span></span><span class="koboSpan" id="kobo.1669.1" xmlns="http://www.w3.org/1999/xhtml">);
      Pen greenPen = Pens.Solid(Color.Green, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1670.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.1671.1" xmlns="http://www.w3.org/1999/xhtml">);
      Brush redBrush = Brushes.Solid(Color.Red);
      Brush blueBrush = Brushes.Solid(Color.Blue);
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1672.1" xmlns="http://www.w3.org/1999/xhtml">// Define some paths and draw them.</span></span><span class="koboSpan" id="kobo.1673.1" xmlns="http://www.w3.org/1999/xhtml">
      IPath border = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1674.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1675.1" xmlns="http://www.w3.org/1999/xhtml"> RectangularPolygon(
        x: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1676.1" xmlns="http://www.w3.org/1999/xhtml">50</span></span><span class="koboSpan" id="kobo.1677.1" xmlns="http://www.w3.org/1999/xhtml">, y: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1678.1" xmlns="http://www.w3.org/1999/xhtml">50</span></span><span class="koboSpan" id="kobo.1679.1" xmlns="http://www.w3.org/1999/xhtml">, width: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1680.1" xmlns="http://www.w3.org/1999/xhtml">1100</span></span><span class="koboSpan" id="kobo.1681.1" xmlns="http://www.w3.org/1999/xhtml">, height: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1682.1" xmlns="http://www.w3.org/1999/xhtml">500</span></span><span class="koboSpan" id="kobo.1683.1" xmlns="http://www.w3.org/1999/xhtml">);
      image.Mutate(x =&gt; x.Draw(options, blackPen, border));
      IPath star = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1684.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1685.1" xmlns="http://www.w3.org/1999/xhtml"> Star(x: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1686.1" xmlns="http://www.w3.org/1999/xhtml">150.0f</span></span><span class="koboSpan" id="kobo.1687.1" xmlns="http://www.w3.org/1999/xhtml">, y: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1688.1" xmlns="http://www.w3.org/1999/xhtml">150.0f</span></span><span class="koboSpan" id="kobo.1689.1" xmlns="http://www.w3.org/1999/xhtml">, 
        prongs: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1690.1" xmlns="http://www.w3.org/1999/xhtml">5</span></span><span class="koboSpan" id="kobo.1691.1" xmlns="http://www.w3.org/1999/xhtml">, innerRadii: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1692.1" xmlns="http://www.w3.org/1999/xhtml">20.0f</span></span><span class="koboSpan" id="kobo.1693.1" xmlns="http://www.w3.org/1999/xhtml">, outerRadii: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1694.1" xmlns="http://www.w3.org/1999/xhtml">30.0f</span></span><span class="koboSpan" id="kobo.1695.1" xmlns="http://www.w3.org/1999/xhtml">);
      image.Mutate(x =&gt; x.Fill(options, redBrush, star)
                         .Draw(options, greenPen, star));
      IPath line1 = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1696.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1697.1" xmlns="http://www.w3.org/1999/xhtml"> Polygon(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1698.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1699.1" xmlns="http://www.w3.org/1999/xhtml"> LinearLineSegment(
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1700.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1701.1" xmlns="http://www.w3.org/1999/xhtml"> PointF(x: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1702.1" xmlns="http://www.w3.org/1999/xhtml">100</span></span><span class="koboSpan" id="kobo.1703.1" xmlns="http://www.w3.org/1999/xhtml">, y: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1704.1" xmlns="http://www.w3.org/1999/xhtml">275</span></span><span class="koboSpan" id="kobo.1705.1" xmlns="http://www.w3.org/1999/xhtml">), </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1706.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1707.1" xmlns="http://www.w3.org/1999/xhtml"> PointF(x: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1708.1" xmlns="http://www.w3.org/1999/xhtml">1050</span></span><span class="koboSpan" id="kobo.1709.1" xmlns="http://www.w3.org/1999/xhtml">, y: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1710.1" xmlns="http://www.w3.org/1999/xhtml">275</span></span><span class="koboSpan" id="kobo.1711.1" xmlns="http://www.w3.org/1999/xhtml">)));
      
      image.Mutate(x =&gt; x.Draw(options, blackPen, line1));
      IPath line2 = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1712.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1713.1" xmlns="http://www.w3.org/1999/xhtml"> Polygon(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1714.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1715.1" xmlns="http://www.w3.org/1999/xhtml"> LinearLineSegment(
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1716.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1717.1" xmlns="http://www.w3.org/1999/xhtml"> PointF(x: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1718.1" xmlns="http://www.w3.org/1999/xhtml">100</span></span><span class="koboSpan" id="kobo.1719.1" xmlns="http://www.w3.org/1999/xhtml">, y: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1720.1" xmlns="http://www.w3.org/1999/xhtml">365</span></span><span class="koboSpan" id="kobo.1721.1" xmlns="http://www.w3.org/1999/xhtml">), </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1722.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1723.1" xmlns="http://www.w3.org/1999/xhtml"> PointF(x: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1724.1" xmlns="http://www.w3.org/1999/xhtml">1050</span></span><span class="koboSpan" id="kobo.1725.1" xmlns="http://www.w3.org/1999/xhtml">, y: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1726.1" xmlns="http://www.w3.org/1999/xhtml">365</span></span><span class="koboSpan" id="kobo.1727.1" xmlns="http://www.w3.org/1999/xhtml">)));
      image.Mutate(x =&gt; x.Draw(options, blackPen, line2));
      RichTextOptions textOptions = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1728.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1729.1" xmlns="http://www.w3.org/1999/xhtml">(font)
      {
        Origin = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1730.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1731.1" xmlns="http://www.w3.org/1999/xhtml"> PointF(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1732.1" xmlns="http://www.w3.org/1999/xhtml">100</span></span><span class="koboSpan" id="kobo.1733.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1734.1" xmlns="http://www.w3.org/1999/xhtml">200</span></span><span class="koboSpan" id="kobo.1735.1" xmlns="http://www.w3.org/1999/xhtml">),
        WrappingLength = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1736.1" xmlns="http://www.w3.org/1999/xhtml">1000</span></span><span class="koboSpan" id="kobo.1737.1" xmlns="http://www.w3.org/1999/xhtml">,
        HorizontalAlignment = HorizontalAlignment.Left
      };
      image.Mutate(x =&gt; x.DrawText(
        textOptions, amount, blueBrush, blackPen));
      </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1738.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1739.1" xmlns="http://www.w3.org/1999/xhtml"> blobName = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1740.1" xmlns="http://www.w3.org/1999/xhtml">$"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1741.1" xmlns="http://www.w3.org/1999/xhtml">{DateTime.UtcNow:yyyy-MM-dd-hh-mm-ss}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1742.1" xmlns="http://www.w3.org/1999/xhtml">.png"</span></span><span class="koboSpan" id="kobo.1743.1" xmlns="http://www.w3.org/1999/xhtml">;
      _logger.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1744.1" xmlns="http://www.w3.org/1999/xhtml">$"Blob filename: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1745.1" xmlns="http://www.w3.org/1999/xhtml">{blobName}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1746.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1747.1" xmlns="http://www.w3.org/1999/xhtml">);
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1748.1" xmlns="http://www.w3.org/1999/xhtml">try</span></span><span class="koboSpan" id="kobo.1749.1" xmlns="http://www.w3.org/1999/xhtml">
      {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1750.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1751.1" xmlns="http://www.w3.org/1999/xhtml"> (Environment.GetEnvironmentVariable(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1752.1" xmlns="http://www.w3.org/1999/xhtml">"IS_LOCAL"</span></span><span class="koboSpan" id="kobo.1753.1" xmlns="http://www.w3.org/1999/xhtml">) == </span><span class="hljs-string"><span class="koboSpan" id="kobo.1754.1" xmlns="http://www.w3.org/1999/xhtml">"true"</span></span><span class="koboSpan" id="kobo.1755.1" xmlns="http://www.w3.org/1999/xhtml">)
        {
          </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1756.1" xmlns="http://www.w3.org/1999/xhtml">// Create blob in the local filesystem.</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1757.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1758.1" xmlns="http://www.w3.org/1999/xhtml"> folder = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1759.1" xmlns="http://www.w3.org/1999/xhtml">$@"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1760.1" xmlns="http://www.w3.org/1999/xhtml">{System.Environment.CurrentDirectory}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1761.1" xmlns="http://www.w3.org/1999/xhtml">\blobs"</span></span><span class="koboSpan" id="kobo.1762.1" xmlns="http://www.w3.org/1999/xhtml">;
          </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1763.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1764.1" xmlns="http://www.w3.org/1999/xhtml"> (!Directory.Exists(folder))
          {
            Directory.CreateDirectory(folder);
          }
          log.LogInformation(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1765.1" xmlns="http://www.w3.org/1999/xhtml">$"Blobs folder: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1766.1" xmlns="http://www.w3.org/1999/xhtml">{folder}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1767.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1768.1" xmlns="http://www.w3.org/1999/xhtml">);
          </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1769.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1770.1" xmlns="http://www.w3.org/1999/xhtml"> blobPath = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1771.1" xmlns="http://www.w3.org/1999/xhtml">$@"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1772.1" xmlns="http://www.w3.org/1999/xhtml">{folder}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1773.1" xmlns="http://www.w3.org/1999/xhtml">\</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1774.1" xmlns="http://www.w3.org/1999/xhtml">{blobName}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1775.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1776.1" xmlns="http://www.w3.org/1999/xhtml">;
          image.SaveAsPng(blobPath);
        }
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1777.1" xmlns="http://www.w3.org/1999/xhtml">// Create BLOB in Blob Storage via a memory stream.</span></span><span class="koboSpan" id="kobo.1778.1" xmlns="http://www.w3.org/1999/xhtml">
        MemoryStream stream = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1779.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1780.1" xmlns="http://www.w3.org/1999/xhtml">();
        image.SaveAsPng(stream);
        stream.Seek(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1781.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.1782.1" xmlns="http://www.w3.org/1999/xhtml">, SeekOrigin.Begin);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1783.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1784.1" xmlns="http://www.w3.org/1999/xhtml"> stream.ToArray();
      }
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1785.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></span><span class="koboSpan" id="kobo.1786.1" xmlns="http://www.w3.org/1999/xhtml"> (System.Exception ex)
      {
        log.LogError(ex.Message);
      }
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1787.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1788.1" xmlns="http://www.w3.org/1999/xhtml"> Array.Empty&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1789.1" xmlns="http://www.w3.org/1999/xhtml">byte</span></span><span class="koboSpan" id="kobo.1790.1" xmlns="http://www.w3.org/1999/xhtml">&gt;();
    }
  }
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1791.1" xmlns="http://www.w3.org/1999/xhtml">Note the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1792.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1793.1" xmlns="http://www.w3.org/1999/xhtml">[QueueTrigger("checksQueue")] string message</span></code><span class="koboSpan" id="kobo.1794.1" xmlns="http://www.w3.org/1999/xhtml"> parameter means the function is</span><a id="_idIndexMarker1118"/><span class="koboSpan" id="kobo.1795.1" xmlns="http://www.w3.org/1999/xhtml"> triggered by a message being added to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1796.1" xmlns="http://www.w3.org/1999/xhtml">checksQueue</span></code><span class="koboSpan" id="kobo.1797.1" xmlns="http://www.w3.org/1999/xhtml"> and the queued item is automatically passed to the parameter named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1798.1" xmlns="http://www.w3.org/1999/xhtml">message</span></code><span class="koboSpan" id="kobo.1799.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1800.1" xmlns="http://www.w3.org/1999/xhtml">We use ImageSharp to create a 1200x600 image of a check.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1801.1" xmlns="http://www.w3.org/1999/xhtml">We use the current UTC date and time to name the BLOB to avoid duplicates. </span><span class="koboSpan" id="kobo.1801.2" xmlns="http://www.w3.org/1999/xhtml">In a real implementation, you would need something more robust like GUIDs.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1802.1" xmlns="http://www.w3.org/1999/xhtml">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1803.1" xmlns="http://www.w3.org/1999/xhtml">IS_LOCAL</span></code><span class="koboSpan" id="kobo.1804.1" xmlns="http://www.w3.org/1999/xhtml"> environment variable is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1805.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.1806.1" xmlns="http://www.w3.org/1999/xhtml">, then we save the image as a PNG to the local filesystem in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1807.1" xmlns="http://www.w3.org/1999/xhtml">blobs</span></code><span class="koboSpan" id="kobo.1808.1" xmlns="http://www.w3.org/1999/xhtml"> subfolder.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1809.1" xmlns="http://www.w3.org/1999/xhtml">We save the image as a PNG to a memory stream that is then returned as a byte array </span><a id="_idIndexMarker1119"/><span class="koboSpan" id="kobo.1810.1" xmlns="http://www.w3.org/1999/xhtml">and uploaded to the BLOB container defined by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1811.1" xmlns="http://www.w3.org/1999/xhtml">[BlobOutput("checks-blob-container/check.png")]</span></code><span class="koboSpan" id="kobo.1812.1" xmlns="http://www.w3.org/1999/xhtml"> attribute.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-402"><span class="koboSpan" id="kobo.1813.1" xmlns="http://www.w3.org/1999/xhtml">Testing the function that works with queues and BLOBs</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1814.1" xmlns="http://www.w3.org/1999/xhtml">Now we can test the</span><a id="_idIndexMarker1120"/><span class="koboSpan" id="kobo.1815.1" xmlns="http://www.w3.org/1999/xhtml"> function that works with queues and BLOBs in our local development environment:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1816.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1817.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.1818.1" xmlns="http://www.w3.org/1999/xhtml"> project:
    </span><p class="normal"><span class="koboSpan" id="kobo.1819.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, you will need to navigate to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1820.1" xmlns="http://www.w3.org/1999/xhtml">Run and Debug</span></strong><span class="koboSpan" id="kobo.1821.1" xmlns="http://www.w3.org/1999/xhtml"> pane, make sure that </span><strong class="screenText"><span class="koboSpan" id="kobo.1822.1" xmlns="http://www.w3.org/1999/xhtml">Attach to .NET Functions</span></strong><span class="koboSpan" id="kobo.1823.1" xmlns="http://www.w3.org/1999/xhtml"> is selected, and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1824.1" xmlns="http://www.w3.org/1999/xhtml">Run</span></strong><span class="koboSpan" id="kobo.1825.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1826.1" xmlns="http://www.w3.org/1999/xhtml">Note there are now four functions, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1827.1" xmlns="http://www.w3.org/1999/xhtml">Functions:
        NumbersToChecksFunction: [GET,POST] http://localhost:5101/api/NumbersToChecksFunction
        NumbersToWordsFunction: [GET,POST] http://localhost:5101/api/NumbersToWordsFunction
        CheckGeneratorFunction: queueTrigger
        ScrapeAmazonFunction: timerTrigger
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1828.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1829.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.1830.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1831.1" xmlns="http://www.w3.org/1999/xhtml">azurefunctions-numberstochecks.http</span></code><span class="koboSpan" id="kobo.1832.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1833.1" xmlns="http://www.w3.org/1999/xhtml">Modify its </span><a id="_idIndexMarker1121"/><span class="koboSpan" id="kobo.1834.1" xmlns="http://www.w3.org/1999/xhtml">contents, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.1835.1" xmlns="http://www.w3.org/1999/xhtml">### Configure a variable for the Azure Functions base address.</span></span><span class="koboSpan" id="kobo.1836.1" xmlns="http://www.w3.org/1999/xhtml">
@base_address = http:</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1837.1" xmlns="http://www.w3.org/1999/xhtml">//localhost:5101/</span></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.1838.1" xmlns="http://www.w3.org/1999/xhtml">### Trigger the NumbersToChecksFunction function.</span></span><span class="koboSpan" id="kobo.1839.1" xmlns="http://www.w3.org/1999/xhtml">
GET {{base_address}}api/NumbersToChecksFunction?amount=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1840.1" xmlns="http://www.w3.org/1999/xhtml">123456</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1841.1" xmlns="http://www.w3.org/1999/xhtml">Send the request and note that a JSON document is returned with information about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1842.1" xmlns="http://www.w3.org/1999/xhtml">NumbersToWordsFunction</span></code><span class="koboSpan" id="kobo.1843.1" xmlns="http://www.w3.org/1999/xhtml"> function, as shown in the following response:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1844.1" xmlns="http://www.w3.org/1999/xhtml">Response time: 2524 ms
Status code: OK (200)
Transfer-Encoding: chunked
Date: Mon, 05 Jun 2023 13:53:11 GMT
Server: Kestrel
Content-Type: text/plain; charset=utf-8
Content-Length: 64
------------------------------------------------
Content:
one hundred and twenty-three thousand four hundred and fifty-six
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1845.1" xmlns="http://www.w3.org/1999/xhtml">At the command prompt or terminal, note the function call was successful and a message</span><a id="_idIndexMarker1122"/><span class="koboSpan" id="kobo.1846.1" xmlns="http://www.w3.org/1999/xhtml"> was sent to the queue that then triggered the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1847.1" xmlns="http://www.w3.org/1999/xhtml">CheckGeneratorFunction</span></code><span class="koboSpan" id="kobo.1848.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1849.1" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:12.175Z] Executing 'NumbersToWordsFunction' (Reason='This function was programmatically called via the host APIs.', Id=b6a49d34-edbf-4c2a-97f2-195f8d06cd13)
[2023-06-05T13:53:12.195Z] C# HTTP trigger function processed a request.
</span><span class="koboSpan" id="kobo.1849.2" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:12.262Z] Executed 'NumbersToWordsFunction' (Succeeded, Id=b6a49d34-edbf-4c2a-97f2-195f8d06cd13, Duration=104ms)
[2023-06-05T13:53:14.302Z] Executing 'CheckGeneratorFunction' (Reason='New queue message detected on 'checksqueue'.', Id=2697ddc0-46dd-4c06-b960-fb5a443ec929)
[2023-06-05T13:53:14.305Z] Trigger Details: MessageId: 229e4961-bfaf-46da-bb17-040ffc2bbf91, DequeueCount: 1, InsertedOn: 2023-06-05T13:53:12.000+00:00
[2023-06-05T13:53:14.313Z] C# Queue trigger function executed.
</span><span class="koboSpan" id="kobo.1849.3" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:14.314Z] MessageId: 229e4961-bfaf-46da-bb17-040ffc2bbf91.
</span><span class="koboSpan" id="kobo.1849.4" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:14.316Z] InsertedOn: 05/06/2023 13:53:12 +00:00.
</span><span class="koboSpan" id="kobo.1849.5" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:14.317Z] ExpiresOn: 12/06/2023 13:53:12 +00:00.
</span><span class="koboSpan" id="kobo.1849.6" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:14.318Z] Body: one hundred and twenty-three thousand four hundred and fifty-six.
</span><span class="koboSpan" id="kobo.1849.7" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:14.845Z] Blob name: 2023-06-05-01-53-14.png.
</span><span class="koboSpan" id="kobo.1849.8" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:14.848Z] Blobs folder: C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\bin\Debug\net8.0\blobs
[2023-06-05T13:53:15.057Z] Blob sequence number: 0.
</span><span class="koboSpan" id="kobo.1849.9" xmlns="http://www.w3.org/1999/xhtml">[2023-06-05T13:53:15.060Z] Executed 'CheckGeneratorFunction' (Succeeded, Id=2697ddc0-46dd-4c06-b960-fb5a443ec929, Duration=776ms)
[2023-06-05T13:53:20.979Z] Host lock lease acquired by instance ID '00000000000000000000000011150C3D'.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1850.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1851.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service\bin\Debug\net8.0\blobs</span></code><span class="koboSpan" id="kobo.1852.1" xmlns="http://www.w3.org/1999/xhtml"> folder, note the</span><a id="_idIndexMarker1123"/><span class="koboSpan" id="kobo.1853.1" xmlns="http://www.w3.org/1999/xhtml"> image created locally in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1854.1" xmlns="http://www.w3.org/1999/xhtml">blobs</span></code><span class="koboSpan" id="kobo.1855.1" xmlns="http://www.w3.org/1999/xhtml"> folder, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1856.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.4</span></em><span class="koboSpan" id="kobo.1857.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1858.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1859.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.4: The check image generated in the project blobs folder</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.1860.1" xmlns="http://www.w3.org/1999/xhtml">Note the check image, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1861.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.5</span></em><span class="koboSpan" id="kobo.1862.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1863.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1864.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.5: The check image opened in Windows Paint</span></p>
<h1 class="heading-1" id="_idParaDest-403"><span class="koboSpan" id="kobo.1865.1" xmlns="http://www.w3.org/1999/xhtml">Publishing an Azure Functions project to the cloud</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1866.1" xmlns="http://www.w3.org/1999/xhtml">Now, let’s create</span><a id="_idIndexMarker1124"/><span class="koboSpan" id="kobo.1867.1" xmlns="http://www.w3.org/1999/xhtml"> a function app and related resources in an Azure subscription, then deploy your functions to the cloud and run it there.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1868.1" xmlns="http://www.w3.org/1999/xhtml">If you do not already have an Azure account, then you can sign up for a free one at the following link: </span><a href="https://azure.microsoft.com/en-us/free/"><span class="url"><span class="koboSpan" id="kobo.1869.1" xmlns="http://www.w3.org/1999/xhtml">https://azure.microsoft.com/en-us/free/</span></span></a><span class="koboSpan" id="kobo.1870.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<h2 class="heading-2" id="_idParaDest-404"><span class="koboSpan" id="kobo.1871.1" xmlns="http://www.w3.org/1999/xhtml">Using Visual Studio 2022 to publish</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1872.1" xmlns="http://www.w3.org/1999/xhtml">Visual Studio 2022 has </span><a id="_idIndexMarker1125"/><span class="koboSpan" id="kobo.1873.1" xmlns="http://www.w3.org/1999/xhtml">a GUI to publish to </span><a id="_idIndexMarker1126"/><span class="koboSpan" id="kobo.1874.1" xmlns="http://www.w3.org/1999/xhtml">Azure:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1875.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.1876.1" xmlns="http://www.w3.org/1999/xhtml">Solution Explorer</span></strong><span class="koboSpan" id="kobo.1877.1" xmlns="http://www.w3.org/1999/xhtml">, right-click the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1878.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.AzureFunctions.Service</span></code><span class="koboSpan" id="kobo.1879.1" xmlns="http://www.w3.org/1999/xhtml"> project and select </span><strong class="screenText"><span class="koboSpan" id="kobo.1880.1" xmlns="http://www.w3.org/1999/xhtml">Publish</span></strong><span class="koboSpan" id="kobo.1881.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1882.1" xmlns="http://www.w3.org/1999/xhtml">Select </span><strong class="screenText"><span class="koboSpan" id="kobo.1883.1" xmlns="http://www.w3.org/1999/xhtml">Azure</span></strong><span class="koboSpan" id="kobo.1884.1" xmlns="http://www.w3.org/1999/xhtml"> and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.1885.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.1886.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1887.1" xmlns="http://www.w3.org/1999/xhtml">Select </span><strong class="screenText"><span class="koboSpan" id="kobo.1888.1" xmlns="http://www.w3.org/1999/xhtml">Azure Function App (Linux)</span></strong><span class="koboSpan" id="kobo.1889.1" xmlns="http://www.w3.org/1999/xhtml"> and click </span><strong class="screenText"><span class="koboSpan" id="kobo.1890.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.1891.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1892.1" xmlns="http://www.w3.org/1999/xhtml">Sign in and enter your Azure credentials.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1893.1" xmlns="http://www.w3.org/1999/xhtml">Select your subscription; for example, I chose my subscription named </span><strong class="screenText"><span class="koboSpan" id="kobo.1894.1" xmlns="http://www.w3.org/1999/xhtml">Pay-As-You-Go</span></strong><span class="koboSpan" id="kobo.1895.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1896.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.1897.1" xmlns="http://www.w3.org/1999/xhtml">Function Instance</span></strong><span class="koboSpan" id="kobo.1898.1" xmlns="http://www.w3.org/1999/xhtml"> section, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1899.1" xmlns="http://www.w3.org/1999/xhtml">+ Create New</span></strong><span class="koboSpan" id="kobo.1900.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1901.1" xmlns="http://www.w3.org/1999/xhtml">Complete the dialog box, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1902.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.6</span></em><span class="koboSpan" id="kobo.1903.1" xmlns="http://www.w3.org/1999/xhtml">:</span><ul>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1904.1" xmlns="http://www.w3.org/1999/xhtml">Name</span></strong><span class="koboSpan" id="kobo.1905.1" xmlns="http://www.w3.org/1999/xhtml">: This must be globally unique. </span><span class="koboSpan" id="kobo.1905.2" xmlns="http://www.w3.org/1999/xhtml">It suggested a name based on the project name and the current date and time.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1906.1" xmlns="http://www.w3.org/1999/xhtml">Subscription name</span></strong><span class="koboSpan" id="kobo.1907.1" xmlns="http://www.w3.org/1999/xhtml">: Select your subscription.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1908.1" xmlns="http://www.w3.org/1999/xhtml">Resource group</span></strong><span class="koboSpan" id="kobo.1909.1" xmlns="http://www.w3.org/1999/xhtml">: Select or create a new resource group to make it easier to delete everything later. </span><span class="koboSpan" id="kobo.1909.2" xmlns="http://www.w3.org/1999/xhtml">I chose </span><code class="inlineCode"><span class="koboSpan" id="kobo.1910.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-book</span></code><span class="koboSpan" id="kobo.1911.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1912.1" xmlns="http://www.w3.org/1999/xhtml">Plan Type</span></strong><span class="koboSpan" id="kobo.1913.1" xmlns="http://www.w3.org/1999/xhtml">: </span><strong class="screenText"><span class="koboSpan" id="kobo.1914.1" xmlns="http://www.w3.org/1999/xhtml">Consumption</span></strong><span class="koboSpan" id="kobo.1915.1" xmlns="http://www.w3.org/1999/xhtml"> (pay for only what you use).</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1916.1" xmlns="http://www.w3.org/1999/xhtml">Location</span></strong><span class="koboSpan" id="kobo.1917.1" xmlns="http://www.w3.org/1999/xhtml">: A data center</span><a id="_idIndexMarker1127"/><span class="koboSpan" id="kobo.1918.1" xmlns="http://www.w3.org/1999/xhtml"> nearest to you. </span><span class="koboSpan" id="kobo.1918.2" xmlns="http://www.w3.org/1999/xhtml">I chose </span><strong class="screenText"><span class="koboSpan" id="kobo.1919.1" xmlns="http://www.w3.org/1999/xhtml">UK South</span></strong><span class="koboSpan" id="kobo.1920.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1921.1" xmlns="http://www.w3.org/1999/xhtml">Azure Storage</span></strong><span class="koboSpan" id="kobo.1922.1" xmlns="http://www.w3.org/1999/xhtml">: Create a</span><a id="_idIndexMarker1128"/><span class="koboSpan" id="kobo.1923.1" xmlns="http://www.w3.org/1999/xhtml"> new account named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1924.1" xmlns="http://www.w3.org/1999/xhtml">northwindazurefunctions</span></code><span class="koboSpan" id="kobo.1925.1" xmlns="http://www.w3.org/1999/xhtml"> (or something else that is globally unique) in a data center nearest to you and choose </span><strong class="screenText"><span class="koboSpan" id="kobo.1926.1" xmlns="http://www.w3.org/1999/xhtml">Standard – Locally Redundant Storage</span></strong><span class="koboSpan" id="kobo.1927.1" xmlns="http://www.w3.org/1999/xhtml"> for the account type.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1928.1" xmlns="http://www.w3.org/1999/xhtml">Application Insights</span></strong><span class="koboSpan" id="kobo.1929.1" xmlns="http://www.w3.org/1999/xhtml">: </span><strong class="screenText"><span class="koboSpan" id="kobo.1930.1" xmlns="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1931.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
</li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1932.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1933.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.6: Creating a new Azure function app</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.1934.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.1935.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></strong><span class="koboSpan" id="kobo.1936.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1936.2" xmlns="http://www.w3.org/1999/xhtml">This</span><a id="_idIndexMarker1129"/><span class="koboSpan" id="kobo.1937.1" xmlns="http://www.w3.org/1999/xhtml"> process can take</span><a id="_idIndexMarker1130"/><span class="koboSpan" id="kobo.1938.1" xmlns="http://www.w3.org/1999/xhtml"> a minute or more.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1939.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.1940.1" xmlns="http://www.w3.org/1999/xhtml">Publish</span></strong><span class="koboSpan" id="kobo.1941.1" xmlns="http://www.w3.org/1999/xhtml"> dialog, click </span><strong class="screenText"><span class="koboSpan" id="kobo.1942.1" xmlns="http://www.w3.org/1999/xhtml">Finish</span></strong><span class="koboSpan" id="kobo.1943.1" xmlns="http://www.w3.org/1999/xhtml"> and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.1944.1" xmlns="http://www.w3.org/1999/xhtml">Close</span></strong><span class="koboSpan" id="kobo.1945.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1946.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.1947.1" xmlns="http://www.w3.org/1999/xhtml">Publish</span></strong><span class="koboSpan" id="kobo.1948.1" xmlns="http://www.w3.org/1999/xhtml"> window, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1949.1" xmlns="http://www.w3.org/1999/xhtml">Publish</span></strong><span class="koboSpan" id="kobo.1950.1" xmlns="http://www.w3.org/1999/xhtml"> button, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1951.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.7</span></em><span class="koboSpan" id="kobo.1952.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1953.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1954.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.7: An Azure Function App ready to publish using Visual Studio 2022</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="11"><span class="koboSpan" id="kobo.1955.1" xmlns="http://www.w3.org/1999/xhtml">Review the </span><a id="_idIndexMarker1131"/><span class="koboSpan" id="kobo.1956.1" xmlns="http://www.w3.org/1999/xhtml">output window, as </span><a id="_idIndexMarker1132"/><span class="koboSpan" id="kobo.1957.1" xmlns="http://www.w3.org/1999/xhtml">shown in the following publishing output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1958.1" xmlns="http://www.w3.org/1999/xhtml">Build started...
</span><span class="koboSpan" id="kobo.1958.2" xmlns="http://www.w3.org/1999/xhtml">1&gt;------ Build started: Project: Northwind.AzureFunctions.Service, Configuration: Release Any CPU ------
1&gt;Northwind.AzureFunctions.Service -&gt; C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\bin\Release\net8.0\Northwind.AzureFunctions.Service.dll
2&gt;------ Publish started: Project: Northwind.AzureFunctions.Service, Configuration: Release Any CPU ------
2&gt;Northwind.AzureFunctions.Service -&gt; C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\bin\Release\net8.0\Northwind.AzureFunctions.Service.dll
2&gt;Northwind.AzureFunctions.Service -&gt; C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\obj\Release\net8.0\PubTmp\Out\
2&gt;Publishing C:\apps-services-net8\Chapter10\Northwind.AzureFunctions.Service\obj\Release\net8.0\PubTmp\Northwind.AzureFunctions.Service - 20230605152148071.zip to https://northwindazurefunctionsservice20230605151137.scm.azurewebsites.net/api/zipdeploy...
</span><span class="koboSpan" id="kobo.1958.3" xmlns="http://www.w3.org/1999/xhtml">2&gt;Zip Deployment succeeded.
</span><span class="koboSpan" id="kobo.1958.4" xmlns="http://www.w3.org/1999/xhtml">========== Build: 1 succeeded, 0 failed, 0 up-to-date, 0 skipped ==========
========== Build started at 3:21 PM and took 03:34.100 minutes ==========
========== Publish: 1 succeeded, 0 failed, 0 skipped ==========
========== Publish started at 3:21 PM and took 03:34.100 minutes ==========
Waiting for Function app to be ready...
</span><span class="koboSpan" id="kobo.1958.5" xmlns="http://www.w3.org/1999/xhtml">Function app is ready
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1959.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.1960.1" xmlns="http://www.w3.org/1999/xhtml">Publish</span></strong><span class="koboSpan" id="kobo.1961.1" xmlns="http://www.w3.org/1999/xhtml"> window, click </span><strong class="screenText"><span class="koboSpan" id="kobo.1962.1" xmlns="http://www.w3.org/1999/xhtml">Open site</span></strong><span class="koboSpan" id="kobo.1963.1" xmlns="http://www.w3.org/1999/xhtml"> and note your Azure Functions v4 host site is ready.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1964.1" xmlns="http://www.w3.org/1999/xhtml">Test the function</span><a id="_idIndexMarker1133"/><span class="koboSpan" id="kobo.1965.1" xmlns="http://www.w3.org/1999/xhtml"> in your browser by appending the following relative URL to the address box, as </span><a id="_idIndexMarker1134"/><span class="koboSpan" id="kobo.1966.1" xmlns="http://www.w3.org/1999/xhtml">shown in </span><em class="italic"><span class="koboSpan" id="kobo.1967.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.8</span></em><span class="koboSpan" id="kobo.1968.1" xmlns="http://www.w3.org/1999/xhtml">: 
    </span><p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1969.1" xmlns="http://www.w3.org/1999/xhtml">/api/NumbersToWordsFunction?amount=987654321</span></code></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1970.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_10_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1971.1" xmlns="http://www.w3.org/1999/xhtml">Figure 10.8: Calling the function hosted in the Azure cloud</span></p>
<h2 class="heading-2" id="_idParaDest-405"><span class="koboSpan" id="kobo.1972.1" xmlns="http://www.w3.org/1999/xhtml">Using Visual Studio Code to publish</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1973.1" xmlns="http://www.w3.org/1999/xhtml">You can learn how to publish using Visual Studio </span><a id="_idIndexMarker1135"/><span class="koboSpan" id="kobo.1974.1" xmlns="http://www.w3.org/1999/xhtml">Code at the following link:</span></p></li>
</ol>
<p class="normal"><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-develop-vs-code?tabs=csharp#sign-in-to-azure"><span class="url"><span class="koboSpan" id="kobo.1975.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/azure-functions/functions-develop-vs-code?tabs=csharp#sign-in-to-azure</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1976.1" xmlns="http://www.w3.org/1999/xhtml">Now that you’ve successfully</span><a id="_idIndexMarker1136"/><span class="koboSpan" id="kobo.1977.1" xmlns="http://www.w3.org/1999/xhtml"> published your Azure Functions project to the cloud, it’s important to understand how to manage your resources efficiently. </span><span class="koboSpan" id="kobo.1977.2" xmlns="http://www.w3.org/1999/xhtml">Let’s explore how to clean up our Azure Functions</span><a id="_idIndexMarker1137"/><span class="koboSpan" id="kobo.1978.1" xmlns="http://www.w3.org/1999/xhtml"> resources to avoid unnecessary costs and ensure tidy resource</span><a id="_idIndexMarker1138"/><span class="koboSpan" id="kobo.1979.1" xmlns="http://www.w3.org/1999/xhtml"> management.</span></p>
<h1 class="heading-1" id="_idParaDest-406"><span class="koboSpan" id="kobo.1980.1" xmlns="http://www.w3.org/1999/xhtml">Cleaning up Azure Functions resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1981.1" xmlns="http://www.w3.org/1999/xhtml">You can use the following</span><a id="_idIndexMarker1139"/><span class="koboSpan" id="kobo.1982.1" xmlns="http://www.w3.org/1999/xhtml"> steps to delete the function app and its related resources to avoid incurring further costs:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1983.1" xmlns="http://www.w3.org/1999/xhtml">In your browser, navigate to </span><a href="https://portal.azure.com/"><span class="url"><span class="koboSpan" id="kobo.1984.1" xmlns="http://www.w3.org/1999/xhtml">https://portal.azure.com/</span></span></a><span class="koboSpan" id="kobo.1985.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1986.1" xmlns="http://www.w3.org/1999/xhtml">In the Azure portal, in your function app’s </span><strong class="screenText"><span class="koboSpan" id="kobo.1987.1" xmlns="http://www.w3.org/1999/xhtml">Overview</span></strong><span class="koboSpan" id="kobo.1988.1" xmlns="http://www.w3.org/1999/xhtml"> blade, select </span><strong class="screenText"><span class="koboSpan" id="kobo.1989.1" xmlns="http://www.w3.org/1999/xhtml">Resource Group</span></strong><span class="koboSpan" id="kobo.1990.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1991.1" xmlns="http://www.w3.org/1999/xhtml">Confirm that it contains only resources that you want to delete; for example, there should be a </span><strong class="screenText"><span class="koboSpan" id="kobo.1992.1" xmlns="http://www.w3.org/1999/xhtml">Storage account</span></strong><span class="koboSpan" id="kobo.1993.1" xmlns="http://www.w3.org/1999/xhtml">, a </span><strong class="screenText"><span class="koboSpan" id="kobo.1994.1" xmlns="http://www.w3.org/1999/xhtml">Function App</span></strong><span class="koboSpan" id="kobo.1995.1" xmlns="http://www.w3.org/1999/xhtml">, and an </span><strong class="screenText"><span class="koboSpan" id="kobo.1996.1" xmlns="http://www.w3.org/1999/xhtml">App Service plan</span></strong><span class="koboSpan" id="kobo.1997.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1998.1" xmlns="http://www.w3.org/1999/xhtml">If you are sure you want to delete all the resources in the group, then click </span><strong class="screenText"><span class="koboSpan" id="kobo.1999.1" xmlns="http://www.w3.org/1999/xhtml">Delete resource group</span></strong><span class="koboSpan" id="kobo.2000.1" xmlns="http://www.w3.org/1999/xhtml"> and accept any other confirmations. </span><span class="koboSpan" id="kobo.2000.2" xmlns="http://www.w3.org/1999/xhtml">Alternatively, you can delete each resource individually.</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-407"><span class="koboSpan" id="kobo.2001.1" xmlns="http://www.w3.org/1999/xhtml">Practicing and exploring</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2002.1" xmlns="http://www.w3.org/1999/xhtml">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring this chapter’s topics with deeper research.</span></p>
<h2 class="heading-2" id="_idParaDest-408"><span class="koboSpan" id="kobo.2003.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 10.1 – Test your knowledge</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2004.1" xmlns="http://www.w3.org/1999/xhtml">Answer the following questions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2005.1" xmlns="http://www.w3.org/1999/xhtml">What is the difference between the in-process and isolated worker models for Azure Functions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2006.1" xmlns="http://www.w3.org/1999/xhtml">What attribute do you use to cause a function to trigger when a message arrives in a queue?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2007.1" xmlns="http://www.w3.org/1999/xhtml">What attribute do you use to make a queue available to send messages to?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2008.1" xmlns="http://www.w3.org/1999/xhtml">What schedule does the following NCRONTAB expression define?</span></li>
</ol>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2009.1" xmlns="http://www.w3.org/1999/xhtml">0 0 */6 * 6 6</span></code></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.2010.1" xmlns="http://www.w3.org/1999/xhtml">How can you configure a dependency service for use in a function?</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-409"><span class="koboSpan" id="kobo.2011.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 10.2 – Explore topics</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2012.1" xmlns="http://www.w3.org/1999/xhtml">Use the links on the following page for more details on the topics covered in this chapter:</span></p>
<p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-10---building-serverless-nanoservices-using-azure-functions"><span class="url"><span class="koboSpan" id="kobo.2013.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-10---building-serverless-nanoservices-using-azure-functions</span></span></a></p>
<h1 class="heading-1" id="_idParaDest-410"><span class="koboSpan" id="kobo.2014.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2015.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, you learned:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2016.1" xmlns="http://www.w3.org/1999/xhtml">Some of the concepts around Azure Functions</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2017.1" xmlns="http://www.w3.org/1999/xhtml">How to build serverless services using Azure Functions</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2018.1" xmlns="http://www.w3.org/1999/xhtml">How to respond to HTTP, Timer, and Queue triggers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2019.1" xmlns="http://www.w3.org/1999/xhtml">How to bind to Queue and Blob Storage</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2020.1" xmlns="http://www.w3.org/1999/xhtml">How to deploy an Azure Functions project to the cloud</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2021.1" xmlns="http://www.w3.org/1999/xhtml">In the next chapter, you will learn about SignalR, a technology for performing real-time communication between client and server.</span></p>
</div>
</body>
</html>
