<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>Chapter_02</title>
<link href="../Styles/syntax-highlighting.css" rel="stylesheet" type="text/css"/>
<link href="../Styles/epub.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body id="Chapter_02" lang="en-US" xml:lang="en-US">
<div class="Basic-Text-Frame" id="_idContainer091">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">2</span></h1>
<h1 class="chapterTitle" id="_idParaDest-82"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Managing Relational Data Using SQL Server</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">This chapter is about managing relational data stored in SQL Server, Azure SQL Database, or Azure SQL Edge. </span><span class="koboSpan" id="kobo.3.2" xmlns="http://www.w3.org/1999/xhtml">First, you will learn how to manage the data using native Transact-SQL statements. </span><span class="koboSpan" id="kobo.3.3" xmlns="http://www.w3.org/1999/xhtml">Next, you will learn how to manage data at a low level using ADO.NET libraries (</span><code class="inlineCode"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient</span></code><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.5.2" xmlns="http://www.w3.org/1999/xhtml">Finally, you will use Dapper to make it easier to work with entity models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">This chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Understanding modern databases</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">Managing data with Transact-SQL</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">Managing SQL Server data with low-level APIs</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Managing SQL Server data with Dapper</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">Cleaning up data resources</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-83"><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">Understanding modern databases</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">Two </span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">of </span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">the </span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">most</span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml"> common places to</span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml"> store data are</span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml"> in a </span><strong class="keyWord"><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">Relational Database Management System</span></strong><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">RDBMS</span></strong><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">) such </span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">as </span><strong class="keyWord"><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server</span></strong><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">PostgreSQL</span></strong><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">MySQL</span></strong><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><strong class="keyWord"><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">SQLite</span></strong><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">, or</span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml"> in a </span><strong class="keyWord"><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">NoSQL</span></strong><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml"> database </span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">such </span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">as </span><strong class="keyWord"><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">Azure Cosmos DB</span></strong><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">MongoDB</span></strong><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">Redis</span></strong><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><strong class="keyWord"><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">Apache Cassandra</span></strong><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we will focus on the most popular RDBMS for Windows, which is SQL Server. </span><span class="koboSpan" id="kobo.46.2" xmlns="http://www.w3.org/1999/xhtml">This product is also available in a version for Linux. </span><span class="koboSpan" id="kobo.46.3" xmlns="http://www.w3.org/1999/xhtml">For cross-platform development, you can use either Azure SQL Database, which stores the data in the cloud, or Azure SQL Edge, which can run in a Docker container on Windows, macOS, or Linux, on both Intel and ARM architecture CPUs.</span></p>
<h2 class="heading-2" id="_idParaDest-84"><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">Using a sample relational database</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">To learn </span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">how to manage an RDBMS using .NET, it would be useful to have a sample one so that you can practice on a database that has a medium complexity and a decent number of sample records. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft offers several sample databases, most of which are too complex for our needs, so instead, we will use a database that was first created in the early 1990s known as </span><strong class="keyWord"><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">Northwind</span></strong><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml">Let’s take a minute to look at a diagram of the </span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">Northwind database and its eight most important tables. </span><span class="koboSpan" id="kobo.54.2" xmlns="http://www.w3.org/1999/xhtml">You can use the diagram in </span><em class="italic"><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.1</span></em><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml"> to refer to as we write code and queries throughout this book:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.1: The Northwind database tables and relationships</span></p>
<p class="normal"><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">Note that:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">Each </span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">category has a unique identifier, name, description, and picture. </span><span class="koboSpan" id="kobo.61.2" xmlns="http://www.w3.org/1999/xhtml">The picture is stored as a byte array in JPEG format.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">Each </span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">product has a unique identifier, name, unit price, number of units in stock, and other columns.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">Each product is associated with a category by storing the category’s unique identifier.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">The relationship between </span><code class="inlineCode"><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">Categories</span></code><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></code><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml"> is one-to-many, meaning each category can have zero, one, or more products.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">Each product is supplied by a supplier company indicated by storing the supplier’s unique identifier.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">The quantity and unit price of a product is stored for each detail of an order.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">Each order is made by a customer, taken by an employee, and shipped by a shipping company.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">Each employee has a name, address, contact details, birth, and hire dates, a reference to their manager (except for the boss, whose </span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">ReportsTo</span></code><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml"> field is </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">null</span></code><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">), and a photo stored as a byte array in JPEG format. </span><span class="koboSpan" id="kobo.77.2" xmlns="http://www.w3.org/1999/xhtml">The table has a one-to-many relationship to itself because one employee can manage many other employees.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-85"><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">Connecting to a SQL Server database</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">To connect to a </span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server database, we need to know multiple pieces of information, as </span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">shown in the following list:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">The name of the server (and the name of the instance if it has more than the default one). </span><span class="koboSpan" id="kobo.82.2" xmlns="http://www.w3.org/1999/xhtml">This can include the protocol, IP address, and port number if connecting over a network.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">The name of the database.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">Security information, such as the username and password, or if we should pass the currently logged-on user’s credentials automatically using Windows Authentication.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">We specify this information in a </span><strong class="keyWord"><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">connection string</span></strong><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">For backward compatibility, there are multiple possible keywords we can use in a SQL Server connection</span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml"> string for </span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">the various parameters, as shown in the following list:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">Data Source</span></code><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">server</span></code><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">addr</span></code><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">: These keywords are the name of the server (and an optional instance). </span><span class="koboSpan" id="kobo.96.2" xmlns="http://www.w3.org/1999/xhtml">You can use a dot (</span><code class="inlineCode"><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">.</span></code><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">) to mean the local server.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">Initial Catalog</span></code><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">database</span></code><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">: These keywords are the name of the database that will be active initially. </span><span class="koboSpan" id="kobo.102.2" xmlns="http://www.w3.org/1999/xhtml">A SQL statement could change that using the command: </span><code class="inlineCode"><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">USE &lt;databasename&gt;</span></code><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml">Integrated Security</span></code><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">trusted_connection</span></code><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">: These keywords are set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">SSPI</span></code><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml"> to pass the thread’s current user credentials using Windows Authentication.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">User Id</span></code><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">Password</span></code><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">: These keywords are used to authenticate with any edition of SQL Server. </span><span class="koboSpan" id="kobo.116.2" xmlns="http://www.w3.org/1999/xhtml">This is important for Azure SQL Database or Azure SQL Edge because they do not support Windows Authentication. </span><span class="koboSpan" id="kobo.116.3" xmlns="http://www.w3.org/1999/xhtml">The full edition of SQL Server on Windows supports both username with password and Windows Authentication.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">Authentication</span></code><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">: This keyword is used to authenticate by using Azure AD identities that can enable password-less authentication. </span><span class="koboSpan" id="kobo.118.2" xmlns="http://www.w3.org/1999/xhtml">Values can be </span><code class="inlineCode"><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">Active Directory Integrated</span></code><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml">Active Directory Password</span></code><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">Sql Password</span></code><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">Persist Security Info</span></code><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">: If set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">, this keyword tells the connection to remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">Password</span></code><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml"> from the connection string after authenticating.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">Encrypt</span></code><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">: If set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">, this keyword tells the connections to use SSL to encrypt transmissions between client and server.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">TrustServerCertificate</span></code><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">: Set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml"> if hosting locally and you get the error “A connection was successfully established with the server, but then an error occurred during the login process. </span><span class="koboSpan" id="kobo.138.2" xmlns="http://www.w3.org/1999/xhtml">(provider: SSL Provider, error: 0 - The certificate chain was issued by an authority that is not trusted.)”.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">Connection Timeout</span></code><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">: This keyword defaults to 30 seconds.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">MultipleActiveResultSets</span></code><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">: This keyword is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml"> to enable a single connection to be used to work with multiple tables simultaneously to improve efficiency. </span><span class="koboSpan" id="kobo.144.2" xmlns="http://www.w3.org/1999/xhtml">It is used for lazy loading rows from related tables.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">As described in the list above, when you write code to connect to a SQL Server database, you</span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml"> need to know its server name. </span><span class="koboSpan" id="kobo.146.2" xmlns="http://www.w3.org/1999/xhtml">The server name depends on the edition and version</span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml"> of SQL Server that you will connect to, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.1</span></em><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table001-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server edition</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">Server name \ Instance name</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">LocalDB 2012</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">(localdb)\v11.0</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">LocalDB 2016 or later</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">(localdb)\mssqllocaldb</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">Express</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">.\sqlexpress</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">Full/Developer (default instance)</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">.</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">Full/Developer (named instance)</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">.\apps-services-book</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml">Azure SQL Edge (local Docker)</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">tcp:127.0.0.1,1433</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml">Azure SQL Database</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">tcp:[custom server name].database.windows.net,1433</span></code></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.1: Server name examples for various editions of SQL Server</span></p>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">: Use a dot (.) as shorthand for the local computer name (localhost). </span><span class="koboSpan" id="kobo.168.2" xmlns="http://www.w3.org/1999/xhtml">Remember that server names for SQL Server can be made up of two parts: the name of the computer and the name of a SQL Server instance. </span><span class="koboSpan" id="kobo.168.3" xmlns="http://www.w3.org/1999/xhtml">You provide instance names during custom installation.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-86"><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml">Installing and setting up SQL Server locally</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft </span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">offers various editions of its popular and capable SQL Server product </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">for Windows, Linux, and Docker containers. </span><span class="koboSpan" id="kobo.172.2" xmlns="http://www.w3.org/1999/xhtml">If you have Windows, then you can use a free version that runs standalone, known as SQL Server Developer Edition. </span><span class="koboSpan" id="kobo.172.3" xmlns="http://www.w3.org/1999/xhtml">You can also use the Express edition or the free SQL Server LocalDB edition that can be installed with Visual Studio 2022 for Windows.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">If you do not have a Windows computer or if you want to use a cross-platform database system, then you</span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml"> can skip ahead to the topic </span><em class="italic"><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">Setting up Azure SQL Database</span></em><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">, or the online-only section </span><em class="italic"><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">Installing Azure SQL Edge in Docker</span></em><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml"> found at the following link:</span></p>
<p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/ch02-sql-edge.md"><span class="url"><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/ch02-sql-edge.md</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">If you prefer to install SQL Server locally on Linux, then you will find instructions at the following link: </span><a href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-setup"><span class="url"><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-setup</span></span></a><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<h3 class="heading-3" id="_idParaDest-87"><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">Installing SQL Server Developer Edition for Windows</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">On Windows, if </span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">you want to use the full edition of SQL Server instead of the simplified LocalDB or Express editions, then you can find all SQL Server editions at the following link: </span><a href="https://www.microsoft.com/en-us/sql-server/sql-server-downloads"><span class="url"><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">https://www.microsoft.com/en-us/sql-server/sql-server-downloads</span></span></a><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">Take the following steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">Download the </span><strong class="screenText"><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">Developer</span></strong><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml"> edition.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">Run the installer.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">Select the </span><strong class="screenText"><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">Custom</span></strong><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml"> installation type.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">Select a folder for the installation files and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">Install</span></strong><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">Wait for the 1.5 GB of installer files to download.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Installation Center</span></strong><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">Installation</span></strong><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml">, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">New SQL Server stand-alone installation or add features to an existing installation</span></strong><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.2</span></em><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.2: Installing a new instance of SQL Server</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">Select </span><strong class="screenText"><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">Developer</span></strong><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml"> as the free edition and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">Accept the license terms and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">Review the </span><strong class="screenText"><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft Update</span></strong><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml"> options and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">Review</span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml"> the install rules, fix any issues although you might want to ignore any firewall warnings since you might not want to expose those ports anyway, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">Feature Selection</span></strong><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">, select </span><strong class="screenText"><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">Database Engine Services</span></strong><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">Azure Extension for SQL Server</span></strong><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">, you can turn this off.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml">Instance Configuration</span></strong><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">, select </span><strong class="screenText"><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml">Default instance</span></strong><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.244.2" xmlns="http://www.w3.org/1999/xhtml">If you already have a default instance configured, then you could create a named instance, perhaps called </span><code class="inlineCode"><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-book</span></code><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">Server Configuration</span></strong><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">, note the </span><strong class="screenText"><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Database Engine</span></strong><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml"> is configured to start automatically. </span><span class="koboSpan" id="kobo.251.2" xmlns="http://www.w3.org/1999/xhtml">If not already set by default, then set the </span><strong class="screenText"><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Browser</span></strong><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml"> to start automatically, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">Database Engine Configuration</span></strong><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">, on the </span><strong class="screenText"><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">Server Configuration</span></strong><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml"> tab, set </span><strong class="screenText"><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">Authentication Mode</span></strong><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><strong class="screenText"><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">Mixed</span></strong><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">, set the </span><strong class="screenText"><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">sa</span></strong><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml"> account password to a strong password, click </span><strong class="screenText"><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">Add Current User</span></strong><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">Next</span></strong><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">Ready to Install</span></strong><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">, review the actions that will be taken, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">Install</span></strong><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">Complete</span></strong><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">, note the successful actions taken, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">Close</span></strong><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Installation Center</span></strong><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">, in </span><strong class="screenText"><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">Installation</span></strong><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">Install SQL Server Management Tools</span></strong><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">In the browser window, click to download the latest version of SSMS, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.3</span></em><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.3: Downloading SQL Server Management Studio (SSMS)</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml">The direct link to download SSMS is as follows: </span><a href="https://learn.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms"><span class="url"><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms</span></span></a><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="20"><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">Run </span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">the SSMS installer and click </span><strong class="screenText"><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">Install</span></strong><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">When the installer has finished, click </span><strong class="screenText"><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">Restart</span></strong><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml"> if needed or </span><strong class="screenText"><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">Close</span></strong><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ol>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">Azure Data Studio </span></strong><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">ADS</span></strong><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">) is automatically installed alongside SSMS. </span><span class="koboSpan" id="kobo.308.2" xmlns="http://www.w3.org/1999/xhtml">ADS is cross-platform and open-source, so you can use it to work with SQL Server databases on any desktop operating system.</span></p>
</div>
<h3 class="heading-3" id="_idParaDest-88"><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">Visual Studio Code extension for working with SQL Server</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">There are many</span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml"> tools that make it easy to work with SQL Server. </span><span class="koboSpan" id="kobo.311.2" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, then you can install the </span><strong class="screenText"><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server (mssql)</span></strong> <code class="inlineCode"><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">ms-mssql.mssql</span></code><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml"> extension. </span><span class="koboSpan" id="kobo.314.2" xmlns="http://www.w3.org/1999/xhtml">If you install the extension, it adds a new view to the Primary Side Bar titled </span><strong class="screenText"><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server</span></strong><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.4</span></em><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B19587_02_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.4: SQL Server (mssql) extension for Visual Studio Code</span></p>
<h3 class="heading-3" id="_idParaDest-89"><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">Creating the Northwind sample database locally</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">Now</span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml"> we can run a database script to create the Northwind sample </span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml">database locally on Windows using </span><strong class="keyWord"><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Management Studio </span></strong><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">SSMS</span></strong><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml">):</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">If you have not previously downloaded or cloned the GitHub repository for this book, then do so now using the following link: </span><a href="https://github.com/markjprice/apps-services-net8/"><span class="url"><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/</span></span></a><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">In your </span><code class="inlineCode"><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-net8</span></code><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">Chapter02</span></code><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">Copy the script to create the Northwind database for SQL Server from the following path in your local Git repository: </span><code class="inlineCode"><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml">/scripts/sql-scripts/Northwind4SQLServer.sql</span></code><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml"> into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">Chapter02</span></code><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">Start </span><strong class="screenText"><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Management Studio</span></strong><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">Connect to Server</span></strong><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml"> dialog, for </span><strong class="screenText"><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml">Server name</span></strong><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">, enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">.</span></code><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml"> (a dot), meaning the local computer name, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">Connect</span></strong><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">.</span><div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">Warning!</span></strong><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml"> If you had to create a named instance, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-book</span></code><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">, then enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">.\apps-services-book</span></code><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.359.2" xmlns="http://www.w3.org/1999/xhtml">If you see an error about the server certificate, then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml">Options &gt;&gt; </span></strong><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml"> button and select the </span><strong class="screenText"><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml">Trust server certificate</span></strong><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml"> check box.</span></p>
</div>
</li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">Navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">File</span></strong><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">Open</span></strong><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml">File...</span></strong><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml">Browse</span><a id="_idIndexMarker144"/><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml"> to select the </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">Northwind4SQLServer.sql</span></code><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml"> file and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">Open</span></strong><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">In the toolbar, click </span><strong class="screenText"><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></strong><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">, and note the </span><strong class="screenText"><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml">Command(s) completed successfully</span></strong><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml"> message.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml">Object Explorer</span></strong><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">, expand the </span><strong class="screenText"><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">Northwind</span></strong><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml"> database, and then expand </span><strong class="screenText"><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">Tables</span></strong><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml">Right-click </span><strong class="screenText"><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></strong><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">Select Top 1000 Rows</span></strong><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml">, and note the returned results, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.5</span></em><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B19587_02_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.5: The Products table in SQL Server Management Studio</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="11"><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml">Object Explorer</span></strong><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml"> toolbar, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">Disconnect</span></strong><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">Exit </span><strong class="screenText"><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Management Studio</span></strong><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">We did not have to use </span><strong class="screenText"><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Management Studio</span></strong><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml"> to execute the database script. </span><span class="koboSpan" id="kobo.408.2" xmlns="http://www.w3.org/1999/xhtml">We can also use tools in Visual Studio 2022, including the </span><strong class="screenText"><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Object Explorer</span></strong><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml">Server Explorer</span></strong><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">, or cross-platform tools like the Visual Studio Code extension for SQL Server, or </span><strong class="screenText"><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml">Azure Data Studio</span></strong><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">, which you can download and install separately from the following link: </span><a href="https://aka.ms/getazuredatastudio"><span class="url"><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">https://aka.ms/getazuredatastudio</span></span></a><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-90"><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">Setting up Azure SQL Database</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">If you do </span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">not have a Windows computer, then you can create a cloud-hosted instance of SQL Server. </span><span class="koboSpan" id="kobo.419.2" xmlns="http://www.w3.org/1999/xhtml">You will need an Azure account. </span><span class="koboSpan" id="kobo.419.3" xmlns="http://www.w3.org/1999/xhtml">You can sign up at the following link: </span><a href="https://signup.azure.com"><span class="url"><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">https://signup.azure.com</span></span></a><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.421.2" xmlns="http://www.w3.org/1999/xhtml">Next, you need to take the following steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">Log in to your Azure account: </span><a href="https://portal.azure.com/"><span class="url"><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">https://portal.azure.com/</span></span></a></li>
<li class="numberedList"><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml">Navigate to </span><a href="https://portal.azure.com/#create/hub"><span class="url"><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">https://portal.azure.com/#create/hub</span></span></a><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">Search for </span><strong class="screenText"><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">Resource group</span></strong><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml"> and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></strong><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">Enter a resource group name of </span><code class="inlineCode"><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-book</span></code><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml"> and select a suitable region close to you, and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml">Review + create</span></strong><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml"> button, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.6</span></em><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.6: Creating a resource group in the Azure portal</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml">Review your choices and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></strong><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">Create another resource, search for </span><strong class="screenText"><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">SQL Database</span></strong><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">, and click </span><strong class="screenText"><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></strong><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">Create SQL Database</span></strong><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml"> page, in the </span><strong class="screenText"><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml">Basics</span></strong><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml"> tab, for the </span><strong class="screenText"><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">Database name</span></strong><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">, enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">Northwind</span></code><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml">, and select the resource group that you created before.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">Server</span></strong><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml"> section, click </span><strong class="screenText"><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">Create New</span></strong><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">Enter</span><a id="_idIndexMarker146"/><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml"> the following details for the SQL Database server, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.7</span></em><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">:</span><ul>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">Server name</span></strong><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">: </span><code class="inlineCode"><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-book-[your initials]</span></code><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml"> or something else entirely. </span><span class="koboSpan" id="kobo.470.2" xmlns="http://www.w3.org/1999/xhtml">The server name must be globally unique because it becomes part of a public URL.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml">Location</span></strong><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml">: A region close to you. </span><span class="koboSpan" id="kobo.472.2" xmlns="http://www.w3.org/1999/xhtml">I chose </span><strong class="screenText"><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">(Europe) UK South</span></strong><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.474.2" xmlns="http://www.w3.org/1999/xhtml">Not all regions support all types of resources. </span><span class="koboSpan" id="kobo.474.3" xmlns="http://www.w3.org/1999/xhtml">You will see an error if the region you select does not support SQL Database server resources.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml">Authentication method</span></strong><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">: Use SQL authentication.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">Server admin login</span></strong><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">: [Your email or another username], for example, I entered </span><code class="inlineCode"><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">markjprice</span></code><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml">Password</span></strong><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml">/</span><strong class="screenText"><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">Confirm password</span></strong><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">: [Enter a strong password].</span></li>
</ul>
</li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.7: Entering the server details for a SQL Database instance</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">OK</span></strong><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml">Leave </span><strong class="screenText"><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">Want to use SQL elastic pool</span></strong><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml"> set to </span><strong class="screenText"><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">No</span></strong><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">For </span><strong class="screenText"><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml">Workload environment</span></strong><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">, select </span><strong class="screenText"><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml">Development</span></strong><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml"> (instead of </span><strong class="screenText"><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">Production</span></strong><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">).</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">Create SQL Database</span></strong><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml"> page, in the </span><strong class="screenText"><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">Compute + storage</span></strong><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml"> section, click </span><strong class="screenText"><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml">Configure database</span></strong><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">For </span><strong class="screenText"><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml">Service tier</span></strong><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">, select </span><strong class="screenText"><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml">Basic (For less demanding workloads)</span></strong><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.513.2" xmlns="http://www.w3.org/1999/xhtml">Note the maximum</span><a id="_idIndexMarker147"/><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml"> database size is 2 GB and the estimated cost is about $5 per month (or less than 1 cent per hour). </span><span class="koboSpan" id="kobo.514.2" xmlns="http://www.w3.org/1999/xhtml">You can delete the resources as soon as you have completed this chapter to reduce the cost further.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">Apply</span></strong><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">Create SQL Database</span></strong><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml"> page, set </span><strong class="screenText"><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">Backup storage redundancy</span></strong><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><strong class="screenText"><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">Locally-redundant backup storage</span></strong><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">Next : Networking</span></strong><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">In </span><a id="_idIndexMarker148"/><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">the </span><strong class="screenText"><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml">Network connectivity</span></strong><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml"> section, select </span><strong class="screenText"><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml">Public endpoint</span></strong><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">Firewall rules</span></strong><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml"> section, set </span><strong class="screenText"><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">Add current client IP address</span></strong><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><strong class="screenText"><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml">Yes</span></strong><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">Next : Security</span></strong><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml">Review the options but leave them as the defaults.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">Next : Additional settings</span></strong><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">Review the options but leave them as the defaults.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">Review + create</span></strong><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">Create</span></strong><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">Wait for the deployment to complete, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.8</span></em><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.8: Deployment progress for SQL Database</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="27"><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">When deployment has completed, click </span><strong class="screenText"><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">Go to resource</span></strong><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">Overview</span></strong><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml"> and note the database details, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.9</span></em><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.9: SQL Database details</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="29"><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">See connection strings</span></strong><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml"> (or click </span><strong class="screenText"><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">Connection strings</span></strong><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml"> in the left navigation).</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">Copy the </span><strong class="screenText"><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml">ADO.NET (SQL authentication)</span></strong><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml"> connection string to your clipboard.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">Start </span><strong class="screenText"><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml">Notepad</span></strong><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml"> or</span><a id="_idIndexMarker149"/><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml"> your preferred plain text editor, paste the connection string, and add carriage returns after each semicolon to separate each part to make them easier to work with, as shown in the following text:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">Server=tcp:apps-services-book.database.windows.net,</span><span class="hljs-number"><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">1433</span></span><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml">;
Initial Catalog=Northwind;
Persist Security Info=False;
User ID=markjprice;
Password={your_password};
MultipleActiveResultSets=False;
Encrypt=True;
TrustServerCertificate=False;
Connection Timeout=</span><span class="hljs-number"><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">30</span></span><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml">Server</span></code><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml"> value will be different because the custom server name part, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-book</span></code><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml">, is public and must be globally unique.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="32"><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml">Optionally, save</span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml"> the Notepad file for future reference.</span></li>
</ol>
<h3 class="heading-3" id="_idParaDest-91"><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">JetBrains Rider tool window for working with SQL Server</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml">If you use </span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">JetBrains Rider on any operating system, then you can use the following steps to connect with a SQL Server database:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">In JetBrains Rider, select </span><strong class="screenText"><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">View</span></strong><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">Tool Windows</span></strong><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml">Database</span></strong><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml">Database</span></strong><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml"> tool window, click </span><strong class="screenText"><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">Connect to database...</span></strong><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml">Select the </span><strong class="screenText"><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml">Use connection string</span></strong><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml"> option button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml">Set the </span><strong class="screenText"><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml">Database type</span></strong><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><strong class="screenText"><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft SQL Server</span></strong><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">String</span></strong><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml"> box, enter the database connection string.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">Change </span><code class="inlineCode"><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">{your_password}</span></code><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml"> to the password you chose.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml">Optionally, click </span><strong class="screenText"><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">Test Connection</span></strong><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml"> and correct any errors if necessary. </span><span class="koboSpan" id="kobo.625.2" xmlns="http://www.w3.org/1999/xhtml">If you get an </span><strong class="screenText"><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml">Inconsistent language</span></strong><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml"> error, then you can ignore it as we are using SQL Server as the dialect.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml">Connect to Database</span></strong><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ol>
<h3 class="heading-3" id="_idParaDest-92"><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">Creating the Northwind sample database in the cloud</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">Now we can</span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml"> run a database script to create the Northwind sample database in the Azure SQL Database:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">Use your preferred database tool to connect to the SQL server in Azure:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio 2022, view </span><strong class="screenText"><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml">Server Explorer</span></strong><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml">On Windows, start </span><strong class="screenText"><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Management Studio</span></strong><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio Code, view the </span><strong class="screenText"><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server</span></strong><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml"> tool.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml">In JetBrains Rider, navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">View</span></strong><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml">Tool Windows</span></strong><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">Database</span></strong><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml">, and then click </span><strong class="screenText"><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">Connect to database…</span></strong><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml">Add a data connection, and fill in the dialog box with all the required connection string information, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.10</span></em><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.10: Connecting to your Azure SQL database from Visual Studio</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml">You might also be prompted to </span><strong class="screenText"><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">Choose</span></strong> <strong class="screenText"><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml">Data Source</span></strong><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.661.2" xmlns="http://www.w3.org/1999/xhtml">Choose </span><strong class="screenText"><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft SQL Server</span></strong><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.663.2" xmlns="http://www.w3.org/1999/xhtml">You can select a checkbox to always use this selection.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml">Right-click</span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml"> the data connection and choose </span><strong class="screenText"><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml">New Query</span></strong><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">.
    </span><div class="note">
<p class="normal"><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml">If you are using JetBrains Rider, then right-click the SQL Server, in the popup menu, select </span><strong class="screenText"><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">SQL Scripts</span></strong><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">Run SQL Script…</span></strong><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml">, and then select the </span><code class="inlineCode"><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml">Northwind4AzureSQLdatabase.sql</span></code><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml"> file.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">Copy and paste the contents of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">Northwind4AzureSQLdatabase.sql</span></code><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml"> file into the query window and execute it.</span><div class="note">
<p class="normal"><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">The main difference between the </span><code class="inlineCode"><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">Northwind4SQLServer.sql</span></code><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">Northwind4AzureSQLdatabase.sql</span></code><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml"> scripts is that the local SQL Server script will delete and recreate the Northwind database. </span><span class="koboSpan" id="kobo.682.2" xmlns="http://www.w3.org/1999/xhtml">The Azure SQL database script will not because the database needs to be created as an Azure resource. </span><span class="koboSpan" id="kobo.682.3" xmlns="http://www.w3.org/1999/xhtml">You can download SQL script files from the following link: </span><a href="https://github.com/markjprice/apps-services-net8/tree/main/scripts/sql-scripts"><span class="url"><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/tree/main/scripts/sql-scripts</span></span></a><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
</li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">Wait</span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml"> to see the </span><strong class="screenText"><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml">Command completed successfully</span></strong><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml"> message. </span><span class="koboSpan" id="kobo.688.2" xmlns="http://www.w3.org/1999/xhtml">This can take a few minutes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml">In </span><strong class="screenText"><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">Server Explorer</span></strong><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">, right-click </span><strong class="screenText"><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">Tables</span></strong><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml"> and select </span><strong class="screenText"><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">Refresh</span></strong><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml">, and note that 13 tables have been created, for example, </span><strong class="screenText"><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">Categories</span></strong><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong class="screenText"><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">Customers</span></strong><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><strong class="screenText"><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></strong><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.701.2" xmlns="http://www.w3.org/1999/xhtml">Also note that dozens of views and stored procedures have also been created.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">You now have a running Azure SQL database in the cloud that you can connect to from a .NET project.</span></p>
<h1 class="heading-1" id="_idParaDest-93"><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml">Managing data with Transact-SQL</span></h1>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">Transact-SQL </span></strong><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">T-SQL</span></strong><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml">) is </span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server’s dialect of </span><strong class="keyWord"><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">Structured Query Language </span></strong><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">SQL</span></strong><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.712.2" xmlns="http://www.w3.org/1999/xhtml">Some </span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml">pronounce it </span><em class="italic"><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">tee-sequel</span></em><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml">, others </span><em class="italic"><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">tee-es-queue-el</span></em><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">Unlike C#, T-SQL is </span><a id="_idIndexMarker157"/><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml">not case-sensitive; for example, you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">INT</span></code><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml"> to specify the 32-bit integer data type, and you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml">select</span></code><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml"> to start a query expression. </span><span class="koboSpan" id="kobo.727.2" xmlns="http://www.w3.org/1999/xhtml">Text data stored in SQL Server tables can be treated as case-sensitive or not, depending on the configuration.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">The complete reference for T-SQL is found at the following link: </span><a href="https://learn.microsoft.com/en-us/sql/t-sql/language-reference"><span class="url"><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/sql/t-sql/language-reference</span></span></a><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.730.2" xmlns="http://www.w3.org/1999/xhtml">From that documentation starting page, use the left side navigation to view topics like </span><strong class="keyWord"><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">Data types</span></strong><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml">Queries</span></strong><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><strong class="keyWord"><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">Statements</span></strong><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-94"><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">T-SQL data types</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml">T-SQL has data types</span><a id="_idIndexMarker158"/><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml"> that are used for columns, variables, parameters, and so on, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.2</span></em><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table002-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml">Category</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml">Examples</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml">Numbers</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">bigint</span></code><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">bit</span></code><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">money</span></code><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml">numeric</span></code><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml">real</span></code><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">smallint</span></code><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">smallmoney</span></code><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml">tinyint</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml">Date and time</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">date</span></code><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">datetime2</span></code><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">datetimeoffset</span></code><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">smalldatetime</span></code><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml">time</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml">Text</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">char</span></code><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">nchar</span></code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml">ntext</span></code><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml">nvarchar</span></code><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml">text</span></code><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml">varchar</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml">Binary</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">binary</span></code><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">image</span></code><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">varbinary</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml">Other</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">cursor</span></code><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">hierarchyid</span></code><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">sql_variant</span></code><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml">table</span></code><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">rowversion</span></code><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml">uniqueidentifier</span></code><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml">xml</span></code></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.2: Categories of SQL Server data types</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml">There is an </span><code class="inlineCode"><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">xml</span></code><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml"> data type but no JSON data type. </span><span class="koboSpan" id="kobo.813.2" xmlns="http://www.w3.org/1999/xhtml">Use </span><code class="inlineCode"><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">nvarchar</span></code><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml"> to store JSON values. </span><span class="koboSpan" id="kobo.815.2" xmlns="http://www.w3.org/1999/xhtml">T-SQL also has support for spatial </span><code class="inlineCode"><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">geometry</span></code><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">geography</span></code><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml"> types.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-95"><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml">Documenting with comments</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">To</span><a id="_idIndexMarker159"/><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml"> comment out the rest of a line, use </span><code class="inlineCode"><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">--</span></code><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">, which is the equivalent of </span><code class="inlineCode"><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">//</span></code><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml">To comment out a block, use </span><code class="inlineCode"><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">/*</span></code><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml"> at the start and </span><code class="inlineCode"><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml">*/</span></code><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml"> at the end, just like in C#.</span></p>
<h2 class="heading-2" id="_idParaDest-96"><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml">Declaring variables</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml">Local variable </span><a id="_idIndexMarker160"/><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml">names are prefixed with </span><code class="inlineCode"><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml">@</span></code><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml"> and they are defined using </span><code class="inlineCode"><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml">SET</span></code><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">DECLARE</span></code><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">DECLARE</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml">@WholeNumber</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml">INT</span></span><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml">-- Declare a variable and specify its type.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml">SET</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">@WholeNumber</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml">-- Set the variable to a literal value.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml">SET</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml">@WholeNumber</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">@WholeNumber</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml">+</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">-- Increment the variable.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml">@WholeNumber</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml">COUNT</span></span><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-operator"><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml">*</span></span><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml">FROM</span></span><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml"> Employees; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml">-- Set to the number of employees.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml">@WholeNumber</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml"> EmployeeId </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">FROM</span></span><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml"> Employees </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">WHERE</span></span><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml"> FirstName </span><span class="hljs-operator"><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">Janet'</span></span><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">Global variables are prefixed with </span><code class="inlineCode"><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml">@@</span></code><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.886.2" xmlns="http://www.w3.org/1999/xhtml">For example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml">@@ROWCOUNT</span></code><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml"> is a context-dependent value that returns the number of rows affected by a statement executed within the current scope, for example, the number of rows updated or deleted.</span></p>
<h2 class="heading-2" id="_idParaDest-97"><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml">Specifying data types</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">Most </span><a id="_idIndexMarker161"/><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">types have a fixed size. </span><span class="koboSpan" id="kobo.891.2" xmlns="http://www.w3.org/1999/xhtml">For example, an </span><code class="inlineCode"><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml"> uses four bytes, a </span><code class="inlineCode"><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">smallint</span></code><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml"> uses two bytes, and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">tinyint</span></code><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml"> uses one byte.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml">For text and binary types, you can either specify a type prefixed with </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml">var</span></code><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml">nvar</span></code><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml"> (meaning variable size), which will automatically change its size based on its current value up to a maximum, as shown in the following example: </span><code class="inlineCode"><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml">varchar(40)</span></code><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">; or you can specify a fixed number of characters that will always be allocated, as shown in the following example: </span><code class="inlineCode"><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml">char(40)</span></code><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml">For text types, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">n</span></code><span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml"> prefix indicates Unicode, meaning it will use two bytes per character. </span><span class="koboSpan" id="kobo.909.2" xmlns="http://www.w3.org/1999/xhtml">Text types not prefixed with </span><code class="inlineCode"><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">n</span></code><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml"> use one byte per character.</span></p>
<h2 class="heading-2" id="_idParaDest-98"><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">Controlling flow</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml">T-SQL </span><a id="_idIndexMarker162"/><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml">has similar flow control keywords as C#, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">BREAK</span></code><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml">CONTINUE</span></code><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml">GOTO</span></code><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml">IF...ELSE</span></code><span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml">CASE</span></code><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml">THROW</span></code><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml">TRY...CATCH</span></code><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml">WHILE</span></code><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml">RETURN</span></code><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.932.2" xmlns="http://www.w3.org/1999/xhtml">The main difference is the use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml">BEGIN</span></code><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml">END</span></code><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml"> to indicate the start and end of a block, the equivalent of curly braces in C#.</span></p>
<h2 class="heading-2" id="_idParaDest-99"><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml">Operators</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml">T-SQL has </span><a id="_idIndexMarker163"/><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml">similar operators as C#, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml">=</span></code><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml"> (assignment), </span><code class="inlineCode"><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml">+</span></code><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml">-</span></code><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml">*</span></code><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">/</span></code><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml">%</span></code><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></code><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></code><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml">&lt;=</span></code><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">==</span></code><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">!=</span></code><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml">&amp;</span></code><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">|</span></code><span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">^</span></code><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml">, and so on. </span><span class="koboSpan" id="kobo.967.2" xmlns="http://www.w3.org/1999/xhtml">It has logical operators like </span><code class="inlineCode"><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml">AND</span></code><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">OR</span></code><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml">NOT</span></code><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml">, and LINQ-like operators like </span><code class="inlineCode"><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml">ANY</span></code><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml">ALL</span></code><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.978.1" xmlns="http://www.w3.org/1999/xhtml">SOME</span></code><span class="koboSpan" id="kobo.979.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.980.1" xmlns="http://www.w3.org/1999/xhtml">EXISTS</span></code><span class="koboSpan" id="kobo.981.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.982.1" xmlns="http://www.w3.org/1999/xhtml">BETWEEN</span></code><span class="koboSpan" id="kobo.983.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.984.1" xmlns="http://www.w3.org/1999/xhtml">IN</span></code><span class="koboSpan" id="kobo.985.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.986.1" xmlns="http://www.w3.org/1999/xhtml">LIKE</span></code><span class="koboSpan" id="kobo.987.1" xmlns="http://www.w3.org/1999/xhtml"> is used for text pattern matching. </span><span class="koboSpan" id="kobo.987.2" xmlns="http://www.w3.org/1999/xhtml">The pattern can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.988.1" xmlns="http://www.w3.org/1999/xhtml">%</span></code><span class="koboSpan" id="kobo.989.1" xmlns="http://www.w3.org/1999/xhtml"> for any number of characters. </span><span class="koboSpan" id="kobo.989.2" xmlns="http://www.w3.org/1999/xhtml">The pattern can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.990.1" xmlns="http://www.w3.org/1999/xhtml">_</span></code><span class="koboSpan" id="kobo.991.1" xmlns="http://www.w3.org/1999/xhtml"> for a single character. </span><span class="koboSpan" id="kobo.991.2" xmlns="http://www.w3.org/1999/xhtml">The pattern can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.992.1" xmlns="http://www.w3.org/1999/xhtml">[]</span></code><span class="koboSpan" id="kobo.993.1" xmlns="http://www.w3.org/1999/xhtml"> to specify a range and set of allowed characters, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.994.1" xmlns="http://www.w3.org/1999/xhtml">[0-9A-Z.-,]</span></code><span class="koboSpan" id="kobo.995.1" xmlns="http://www.w3.org/1999/xhtml">, which looks like a simplified regular expression syntax but keep in mind that it is </span><em class="italic"><span class="koboSpan" id="kobo.996.1" xmlns="http://www.w3.org/1999/xhtml">not</span></em><span class="koboSpan" id="kobo.997.1" xmlns="http://www.w3.org/1999/xhtml"> regular expression syntax.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.998.1" xmlns="http://www.w3.org/1999/xhtml">If a table or column name contains spaces, then you must surround the name in square brackets, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.999.1" xmlns="http://www.w3.org/1999/xhtml">[Order Details]</span></code><span class="koboSpan" id="kobo.1000.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1000.2" xmlns="http://www.w3.org/1999/xhtml">The SQL scripts to create the Northwind database include the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.1001.1" xmlns="http://www.w3.org/1999/xhtml">set quoted_identifier on</span></code><span class="koboSpan" id="kobo.1002.1" xmlns="http://www.w3.org/1999/xhtml">, so you can also use double quotes, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1003.1" xmlns="http://www.w3.org/1999/xhtml">"Order Details"</span></code><span class="koboSpan" id="kobo.1004.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1004.2" xmlns="http://www.w3.org/1999/xhtml">Single quotes are used for literal text, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1005.1" xmlns="http://www.w3.org/1999/xhtml">'USA'</span></code><span class="koboSpan" id="kobo.1006.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-100"><span class="koboSpan" id="kobo.1007.1" xmlns="http://www.w3.org/1999/xhtml">Data Manipulation Language (DML)</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1008.1" xmlns="http://www.w3.org/1999/xhtml">DML </span><a id="_idIndexMarker164"/><span class="koboSpan" id="kobo.1009.1" xmlns="http://www.w3.org/1999/xhtml">is used to query and change data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1010.1" xmlns="http://www.w3.org/1999/xhtml">The most common statement in DML is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1011.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1012.1" xmlns="http://www.w3.org/1999/xhtml">, which is used to retrieve data from one or more tables. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1013.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1014.1" xmlns="http://www.w3.org/1999/xhtml"> is extremely complicated because it is so powerful. </span><span class="koboSpan" id="kobo.1014.2" xmlns="http://www.w3.org/1999/xhtml">This book is not about learning T-SQL, so the quickest way to get a feel for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1015.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1016.1" xmlns="http://www.w3.org/1999/xhtml"> is to see some examples, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1017.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.3</span></em><span class="koboSpan" id="kobo.1018.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table003-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1019.1" xmlns="http://www.w3.org/1999/xhtml">Example</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1020.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1021.1" xmlns="http://www.w3.org/1999/xhtml">SELECT * </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1022.1" xmlns="http://www.w3.org/1999/xhtml">FROM Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1023.1" xmlns="http://www.w3.org/1999/xhtml">Get all columns of all the employees.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1024.1" xmlns="http://www.w3.org/1999/xhtml">SELECT FirstName, LastName </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1025.1" xmlns="http://www.w3.org/1999/xhtml">FROM Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1026.1" xmlns="http://www.w3.org/1999/xhtml">Get the first and last name columns of all employees.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1027.1" xmlns="http://www.w3.org/1999/xhtml">SELECT emp.FirstName, emp.LastName </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1028.1" xmlns="http://www.w3.org/1999/xhtml">FROM Employees AS emp</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1029.1" xmlns="http://www.w3.org/1999/xhtml">Give an alias for the table name. </span><span class="koboSpan" id="kobo.1029.2" xmlns="http://www.w3.org/1999/xhtml">Table name prefixes are not needed when there is only one table, but become useful to disambiguate when there are multiple tables that have columns with the same name, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1030.1" xmlns="http://www.w3.org/1999/xhtml">Customers.CustomerId</span></code><span class="koboSpan" id="kobo.1031.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1032.1" xmlns="http://www.w3.org/1999/xhtml">Orders.CustomerId</span></code><span class="koboSpan" id="kobo.1033.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1034.1" xmlns="http://www.w3.org/1999/xhtml">SELECT emp.FirstName, emp.LastName </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1035.1" xmlns="http://www.w3.org/1999/xhtml">FROM Employees emp</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1036.1" xmlns="http://www.w3.org/1999/xhtml">Give an alias for the table name without needing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1037.1" xmlns="http://www.w3.org/1999/xhtml">AS</span></code><span class="koboSpan" id="kobo.1038.1" xmlns="http://www.w3.org/1999/xhtml"> keyword.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1039.1" xmlns="http://www.w3.org/1999/xhtml">SELECT FirstName, LastName AS Surname </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1040.1" xmlns="http://www.w3.org/1999/xhtml">FROM Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1041.1" xmlns="http://www.w3.org/1999/xhtml">Give an alias for the column name.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1042.1" xmlns="http://www.w3.org/1999/xhtml">SELECT FirstName, LastName </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1043.1" xmlns="http://www.w3.org/1999/xhtml">FROM Employees</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1044.1" xmlns="http://www.w3.org/1999/xhtml">WHERE Country = 'USA'</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1045.1" xmlns="http://www.w3.org/1999/xhtml">Filter the results to only include employees in the USA.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1046.1" xmlns="http://www.w3.org/1999/xhtml">SELECT DISTINCT Country</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1047.1" xmlns="http://www.w3.org/1999/xhtml">FROM Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1048.1" xmlns="http://www.w3.org/1999/xhtml">Get a list of countries used as values in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1049.1" xmlns="http://www.w3.org/1999/xhtml">Country</span></code><span class="koboSpan" id="kobo.1050.1" xmlns="http://www.w3.org/1999/xhtml"> column of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1051.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></code><span class="koboSpan" id="kobo.1052.1" xmlns="http://www.w3.org/1999/xhtml"> table without duplicates.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1053.1" xmlns="http://www.w3.org/1999/xhtml">SELECT UnitPrice * Quantity AS Subtotal</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1054.1" xmlns="http://www.w3.org/1999/xhtml">FROM [Order Details]</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1055.1" xmlns="http://www.w3.org/1999/xhtml">Calculate a subtotal for each order detail row.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1056.1" xmlns="http://www.w3.org/1999/xhtml">SELECT OrderId, </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1057.1" xmlns="http://www.w3.org/1999/xhtml"> SUM(UnitPrice * Quantity) AS Total</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1058.1" xmlns="http://www.w3.org/1999/xhtml">FROM [Order Details]</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1059.1" xmlns="http://www.w3.org/1999/xhtml">GROUP BY OrderId</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1060.1" xmlns="http://www.w3.org/1999/xhtml">ORDER BY Total DESC</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1061.1" xmlns="http://www.w3.org/1999/xhtml">Calculate a total for each order and sort with the largest order value at the top.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1062.1" xmlns="http://www.w3.org/1999/xhtml">SELECT CompanyName </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1063.1" xmlns="http://www.w3.org/1999/xhtml">FROM Customers</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1064.1" xmlns="http://www.w3.org/1999/xhtml">UNION</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1065.1" xmlns="http://www.w3.org/1999/xhtml">SELECT CompanyName </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1066.1" xmlns="http://www.w3.org/1999/xhtml">FROM Suppliers</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1067.1" xmlns="http://www.w3.org/1999/xhtml">Return all the company names of all customers and suppliers.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1068.1" xmlns="http://www.w3.org/1999/xhtml">SELECT CategoryName, ProductName</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1069.1" xmlns="http://www.w3.org/1999/xhtml">FROM Categories, Products</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1070.1" xmlns="http://www.w3.org/1999/xhtml">Match </span><em class="italic"><span class="koboSpan" id="kobo.1071.1" xmlns="http://www.w3.org/1999/xhtml">every</span></em><span class="koboSpan" id="kobo.1072.1" xmlns="http://www.w3.org/1999/xhtml"> category with </span><em class="italic"><span class="koboSpan" id="kobo.1073.1" xmlns="http://www.w3.org/1999/xhtml">every</span></em><span class="koboSpan" id="kobo.1074.1" xmlns="http://www.w3.org/1999/xhtml"> product using a Cartesian join and output their names (not what you normally want!).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1075.1" xmlns="http://www.w3.org/1999/xhtml">616 rows (8 categories x 77 products).</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1076.1" xmlns="http://www.w3.org/1999/xhtml">SELECT CategoryName, ProductName</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1077.1" xmlns="http://www.w3.org/1999/xhtml">FROM Categories c, Products p</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1078.1" xmlns="http://www.w3.org/1999/xhtml">WHERE c.CategoryId = p.CategoryId</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1079.1" xmlns="http://www.w3.org/1999/xhtml">Match each product with its category using a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1080.1" xmlns="http://www.w3.org/1999/xhtml">WHERE</span></code><span class="koboSpan" id="kobo.1081.1" xmlns="http://www.w3.org/1999/xhtml"> clause for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1082.1" xmlns="http://www.w3.org/1999/xhtml">CategoryId</span></code><span class="koboSpan" id="kobo.1083.1" xmlns="http://www.w3.org/1999/xhtml"> column in each table and output the category name and product name.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1084.1" xmlns="http://www.w3.org/1999/xhtml">77 rows.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1085.1" xmlns="http://www.w3.org/1999/xhtml">SELECT CategoryName, ProductName</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1086.1" xmlns="http://www.w3.org/1999/xhtml">FROM Categories c</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1087.1" xmlns="http://www.w3.org/1999/xhtml">INNER JOIN Products p</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1088.1" xmlns="http://www.w3.org/1999/xhtml">ON c.CategoryId = p.CategoryId</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1089.1" xmlns="http://www.w3.org/1999/xhtml">Match each product with its category using an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1090.1" xmlns="http://www.w3.org/1999/xhtml">INNER JOIN...ON</span></code><span class="koboSpan" id="kobo.1091.1" xmlns="http://www.w3.org/1999/xhtml"> clause for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1092.1" xmlns="http://www.w3.org/1999/xhtml">CategoryId</span></code><span class="koboSpan" id="kobo.1093.1" xmlns="http://www.w3.org/1999/xhtml"> column in each table and output the category name and product name. </span><span class="koboSpan" id="kobo.1093.2" xmlns="http://www.w3.org/1999/xhtml">This is a modern alternative syntax to using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1094.1" xmlns="http://www.w3.org/1999/xhtml">WHERE</span></code><span class="koboSpan" id="kobo.1095.1" xmlns="http://www.w3.org/1999/xhtml">, and it allows outer joins, which would also include non-matches.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1096.1" xmlns="http://www.w3.org/1999/xhtml">77 rows.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.1097.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.3: Example SELECT statements with descriptions</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1098.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.1099.1" xmlns="http://www.w3.org/1999/xhtml">: You can read the full documentation for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1100.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1101.1" xmlns="http://www.w3.org/1999/xhtml"> at the following link: </span><a href="https://learn.microsoft.com/en-us/sql/t-sql/queries/select-transact-sql"><span class="url"><span class="koboSpan" id="kobo.1102.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/sql/t-sql/queries/select-transact-sql</span></span></a><span class="koboSpan" id="kobo.1103.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1104.1" xmlns="http://www.w3.org/1999/xhtml">Use your </span><a id="_idIndexMarker165"/><span class="koboSpan" id="kobo.1105.1" xmlns="http://www.w3.org/1999/xhtml">favorite database querying tool, like Visual Studio’s </span><strong class="screenText"><span class="koboSpan" id="kobo.1106.1" xmlns="http://www.w3.org/1999/xhtml">Server Explorer</span></strong><span class="koboSpan" id="kobo.1107.1" xmlns="http://www.w3.org/1999/xhtml"> or Visual Studio Code’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1108.1" xmlns="http://www.w3.org/1999/xhtml">mssql</span></code><span class="koboSpan" id="kobo.1109.1" xmlns="http://www.w3.org/1999/xhtml"> extension, to connect to your Northwind database and try out some of the queries above, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1110.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.11</span></em><span class="koboSpan" id="kobo.1111.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em class="italic"><span class="koboSpan" id="kobo.1112.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2:12</span></em><span class="koboSpan" id="kobo.1113.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1114.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1115.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.11: Executing T-SQL queries using Visual Studio’s Server Explorer</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1116.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1117.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.12: Executing T-SQL queries using Visual Studio Code’s mssql extension</span></p>
<h2 class="heading-2" id="_idParaDest-101"><span class="koboSpan" id="kobo.1118.1" xmlns="http://www.w3.org/1999/xhtml">DML for adding, updating, and deleting data</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1119.1" xmlns="http://www.w3.org/1999/xhtml">DML statements</span><a id="_idIndexMarker166"/><span class="koboSpan" id="kobo.1120.1" xmlns="http://www.w3.org/1999/xhtml"> for adding, updating, and </span><a id="_idIndexMarker167"/><span class="koboSpan" id="kobo.1121.1" xmlns="http://www.w3.org/1999/xhtml">deleting data</span><a id="_idIndexMarker168"/><span class="koboSpan" id="kobo.1122.1" xmlns="http://www.w3.org/1999/xhtml"> include those shown in </span><em class="italic"><span class="koboSpan" id="kobo.1123.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.4</span></em><span class="koboSpan" id="kobo.1124.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table004-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1125.1" xmlns="http://www.w3.org/1999/xhtml">Example</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1126.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1127.1" xmlns="http://www.w3.org/1999/xhtml">INSERT Employees(FirstName, LastName)</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1128.1" xmlns="http://www.w3.org/1999/xhtml">VALUES('Mark', 'Price')</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1129.1" xmlns="http://www.w3.org/1999/xhtml">Add a new row to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1130.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></code><span class="koboSpan" id="kobo.1131.1" xmlns="http://www.w3.org/1999/xhtml"> table. </span><span class="koboSpan" id="kobo.1131.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1132.1" xmlns="http://www.w3.org/1999/xhtml">EmployeeId</span></code><span class="koboSpan" id="kobo.1133.1" xmlns="http://www.w3.org/1999/xhtml"> primary key value is automatically assigned. </span><span class="koboSpan" id="kobo.1133.2" xmlns="http://www.w3.org/1999/xhtml">Use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1134.1" xmlns="http://www.w3.org/1999/xhtml">@@IDENTITY</span></code><span class="koboSpan" id="kobo.1135.1" xmlns="http://www.w3.org/1999/xhtml"> to get this value.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1136.1" xmlns="http://www.w3.org/1999/xhtml">UPDATE Employees</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1137.1" xmlns="http://www.w3.org/1999/xhtml">SET Country = 'UK'</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1138.1" xmlns="http://www.w3.org/1999/xhtml">WHERE FirstName = 'Mark' </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1139.1" xmlns="http://www.w3.org/1999/xhtml"> AND LastName = 'Price'</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1140.1" xmlns="http://www.w3.org/1999/xhtml">Update my employee row to set my </span><code class="inlineCode"><span class="koboSpan" id="kobo.1141.1" xmlns="http://www.w3.org/1999/xhtml">Country</span></code><span class="koboSpan" id="kobo.1142.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1143.1" xmlns="http://www.w3.org/1999/xhtml">UK</span></code><span class="koboSpan" id="kobo.1144.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1145.1" xmlns="http://www.w3.org/1999/xhtml">DELETE Employees</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1146.1" xmlns="http://www.w3.org/1999/xhtml">WHERE FirstName = 'Mark' </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1147.1" xmlns="http://www.w3.org/1999/xhtml"> AND LastName = 'Price'</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1148.1" xmlns="http://www.w3.org/1999/xhtml">Delete my employee row.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1149.1" xmlns="http://www.w3.org/1999/xhtml">DELETE Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1150.1" xmlns="http://www.w3.org/1999/xhtml">Delete all rows in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1151.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></code><span class="koboSpan" id="kobo.1152.1" xmlns="http://www.w3.org/1999/xhtml"> table and record those deletions in the transaction log.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1153.1" xmlns="http://www.w3.org/1999/xhtml">TRUNCATE TABLE Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1154.1" xmlns="http://www.w3.org/1999/xhtml">Delete all rows in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1155.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></code><span class="koboSpan" id="kobo.1156.1" xmlns="http://www.w3.org/1999/xhtml"> table more efficiently because it does not log the individual row deletions.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.1157.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.4: Example DML statements with descriptions</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1158.1" xmlns="http://www.w3.org/1999/xhtml">The above examples use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1159.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></code><span class="koboSpan" id="kobo.1160.1" xmlns="http://www.w3.org/1999/xhtml"> table in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1161.1" xmlns="http://www.w3.org/1999/xhtml">Northwind</span></code><span class="koboSpan" id="kobo.1162.1" xmlns="http://www.w3.org/1999/xhtml"> database. </span><span class="koboSpan" id="kobo.1162.2" xmlns="http://www.w3.org/1999/xhtml">That table has referential integrity constraints that would mean that, for example, deleting all rows in the table cannot happen because every employee has related data in other tables like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1163.1" xmlns="http://www.w3.org/1999/xhtml">Orders</span></code><span class="koboSpan" id="kobo.1164.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-102"><span class="koboSpan" id="kobo.1165.1" xmlns="http://www.w3.org/1999/xhtml">Data Definition Language (DDL)</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1166.1" xmlns="http://www.w3.org/1999/xhtml">DDL statements</span><a id="_idIndexMarker169"/><span class="koboSpan" id="kobo.1167.1" xmlns="http://www.w3.org/1999/xhtml"> change the structure of the database, including creating new objects like tables, functions, and stored procedures. </span><span class="koboSpan" id="kobo.1167.2" xmlns="http://www.w3.org/1999/xhtml">The following table shows some examples of DDL statements to give you an idea, but the examples are simple and cannot be executed within the </span><a id="_idIndexMarker170"/><span class="koboSpan" id="kobo.1168.1" xmlns="http://www.w3.org/1999/xhtml">Northwind database, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1169.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.5</span></em><span class="koboSpan" id="kobo.1170.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table005-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1171.1" xmlns="http://www.w3.org/1999/xhtml">Example</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1172.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1173.1" xmlns="http://www.w3.org/1999/xhtml">CREATE TABLE dbo.Shippers (</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1174.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperId INT PRIMARY KEY CLUSTERED,</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1175.1" xmlns="http://www.w3.org/1999/xhtml"> CompanyName NVARCHAR(40)</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1176.1" xmlns="http://www.w3.org/1999/xhtml">);</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1177.1" xmlns="http://www.w3.org/1999/xhtml">Create a table to store shippers.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1178.1" xmlns="http://www.w3.org/1999/xhtml">ALTER TABLE Shippers</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1179.1" xmlns="http://www.w3.org/1999/xhtml">ADD Country NVARCHAR(40)</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1180.1" xmlns="http://www.w3.org/1999/xhtml">Add a column to a table.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1181.1" xmlns="http://www.w3.org/1999/xhtml">CREATE NONCLUSTERED INDEX IX_Country</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1182.1" xmlns="http://www.w3.org/1999/xhtml">ON Shippers(Country)</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1183.1" xmlns="http://www.w3.org/1999/xhtml">Add a non-clustered index for a column in a table.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1184.1" xmlns="http://www.w3.org/1999/xhtml">CREATE INDEX IX_FullName</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1185.1" xmlns="http://www.w3.org/1999/xhtml">ON Employees(LastName, FirstName DESC)</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1186.1" xmlns="http://www.w3.org/1999/xhtml">WITH (DROP_EXISTING = ON)</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1187.1" xmlns="http://www.w3.org/1999/xhtml">Change an aggregate index with multiple columns and control the sort order.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1188.1" xmlns="http://www.w3.org/1999/xhtml">DROP TABLE Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1189.1" xmlns="http://www.w3.org/1999/xhtml">Delete the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1190.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></code><span class="koboSpan" id="kobo.1191.1" xmlns="http://www.w3.org/1999/xhtml"> table. </span><span class="koboSpan" id="kobo.1191.2" xmlns="http://www.w3.org/1999/xhtml">If it does not exist, then this throws an error.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1192.1" xmlns="http://www.w3.org/1999/xhtml">DROP TABLE IF EXISTS Employees</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1193.1" xmlns="http://www.w3.org/1999/xhtml">Delete the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1194.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></code><span class="koboSpan" id="kobo.1195.1" xmlns="http://www.w3.org/1999/xhtml"> table if it already exists. </span><span class="koboSpan" id="kobo.1195.2" xmlns="http://www.w3.org/1999/xhtml">This avoids the potential error from using the statement in the previous row.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1196.1" xmlns="http://www.w3.org/1999/xhtml">IF OBJECT_ID(N'Employees', N'U') </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1197.1" xmlns="http://www.w3.org/1999/xhtml"> IS NOT NULL</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1198.1" xmlns="http://www.w3.org/1999/xhtml">Check if a table exists. </span><span class="koboSpan" id="kobo.1198.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1199.1" xmlns="http://www.w3.org/1999/xhtml">N</span></code><span class="koboSpan" id="kobo.1200.1" xmlns="http://www.w3.org/1999/xhtml"> prefix before a text literal means Unicode. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1201.1" xmlns="http://www.w3.org/1999/xhtml">'U'</span></code><span class="koboSpan" id="kobo.1202.1" xmlns="http://www.w3.org/1999/xhtml"> means a user table as opposed to a system table.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.1203.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.5: Example DDL statements with descriptions</span></p>
<h1 class="heading-1" id="_idParaDest-103"><span class="koboSpan" id="kobo.1204.1" xmlns="http://www.w3.org/1999/xhtml">Managing data with low-level APIs</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1205.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1206.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient</span></code><span class="koboSpan" id="kobo.1207.1" xmlns="http://www.w3.org/1999/xhtml"> package provides database connectivity to SQL Server for .NET applications. </span><span class="koboSpan" id="kobo.1207.2" xmlns="http://www.w3.org/1999/xhtml">It </span><a id="_idIndexMarker171"/><span class="koboSpan" id="kobo.1208.1" xmlns="http://www.w3.org/1999/xhtml">is also known as the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1209.1" xmlns="http://www.w3.org/1999/xhtml">ADO.NET driver for SQL Server</span></strong><span class="koboSpan" id="kobo.1210.1" xmlns="http://www.w3.org/1999/xhtml"> and</span><a id="_idIndexMarker172"/><span class="koboSpan" id="kobo.1211.1" xmlns="http://www.w3.org/1999/xhtml"> Azure SQL Database.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1212.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.1213.1" xmlns="http://www.w3.org/1999/xhtml">: You can find the GitHub repository for ADO.NET at the following link: </span><a href="https://github.com/dotnet/SqlClient"><span class="url"><span class="koboSpan" id="kobo.1214.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/dotnet/SqlClient</span></span></a><span class="koboSpan" id="kobo.1215.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1216.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1217.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient</span></code><span class="koboSpan" id="kobo.1218.1" xmlns="http://www.w3.org/1999/xhtml"> package supports the following .NET platforms:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1219.1" xmlns="http://www.w3.org/1999/xhtml">.NET Framework 4.6.2 and later.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1220.1" xmlns="http://www.w3.org/1999/xhtml">.NET Core 3.1 and later.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1221.1" xmlns="http://www.w3.org/1999/xhtml">.NET Standard 2.0 and later.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-104"><span class="koboSpan" id="kobo.1222.1" xmlns="http://www.w3.org/1999/xhtml">Understanding the types in ADO.NET</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1223.1" xmlns="http://www.w3.org/1999/xhtml">ADO.NET </span><a id="_idIndexMarker173"/><span class="koboSpan" id="kobo.1224.1" xmlns="http://www.w3.org/1999/xhtml">defines abstract types that represent minimal objects for working with data, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1225.1" xmlns="http://www.w3.org/1999/xhtml">DbConnection</span></code><span class="koboSpan" id="kobo.1226.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1227.1" xmlns="http://www.w3.org/1999/xhtml">DbCommand</span></code><span class="koboSpan" id="kobo.1228.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1229.1" xmlns="http://www.w3.org/1999/xhtml">DbDataReader</span></code><span class="koboSpan" id="kobo.1230.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1230.2" xmlns="http://www.w3.org/1999/xhtml">Database software manufacturers can inherit from and provide specific implementations that are optimized for and expose additional features for their database. </span><span class="koboSpan" id="kobo.1230.3" xmlns="http://www.w3.org/1999/xhtml">Microsoft has done this for SQL Server. </span><span class="koboSpan" id="kobo.1230.4" xmlns="http://www.w3.org/1999/xhtml">The most important types with their most used members are shown in </span><em class="italic"><span class="koboSpan" id="kobo.1231.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.6</span></em><span class="koboSpan" id="kobo.1232.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table006-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1233.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1234.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1235.1" xmlns="http://www.w3.org/1999/xhtml">Methods</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1236.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1237.1" xmlns="http://www.w3.org/1999/xhtml">SqlConnection</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1238.1" xmlns="http://www.w3.org/1999/xhtml">ConnectionString</span></code><span class="koboSpan" id="kobo.1239.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1240.1" xmlns="http://www.w3.org/1999/xhtml">State</span></code><span class="koboSpan" id="kobo.1241.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1242.1" xmlns="http://www.w3.org/1999/xhtml">ServerVersion</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1243.1" xmlns="http://www.w3.org/1999/xhtml">Open</span></code><span class="koboSpan" id="kobo.1244.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1245.1" xmlns="http://www.w3.org/1999/xhtml">Close</span></code><span class="koboSpan" id="kobo.1246.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1247.1" xmlns="http://www.w3.org/1999/xhtml">CreateCommand</span></code><span class="koboSpan" id="kobo.1248.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1249.1" xmlns="http://www.w3.org/1999/xhtml">RetrieveStatistics</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1250.1" xmlns="http://www.w3.org/1999/xhtml">Manage the connection to the database.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1251.1" xmlns="http://www.w3.org/1999/xhtml">SqlConnectionStringBuilder</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1252.1" xmlns="http://www.w3.org/1999/xhtml">InitialCatalog</span></code><span class="koboSpan" id="kobo.1253.1" xmlns="http://www.w3.org/1999/xhtml">,</span><code class="inlineCode"><span class="koboSpan" id="kobo.1254.1" xmlns="http://www.w3.org/1999/xhtml"> DataSource</span></code><span class="koboSpan" id="kobo.1255.1" xmlns="http://www.w3.org/1999/xhtml">,</span><code class="inlineCode"><span class="koboSpan" id="kobo.1256.1" xmlns="http://www.w3.org/1999/xhtml"> Encrypt</span></code><span class="koboSpan" id="kobo.1257.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1258.1" xmlns="http://www.w3.org/1999/xhtml">UserID</span></code><span class="koboSpan" id="kobo.1259.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1260.1" xmlns="http://www.w3.org/1999/xhtml">Password</span></code><span class="koboSpan" id="kobo.1261.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1262.1" xmlns="http://www.w3.org/1999/xhtml">ConnectTimeout</span></code><span class="koboSpan" id="kobo.1263.1" xmlns="http://www.w3.org/1999/xhtml">, and so on</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1264.1" xmlns="http://www.w3.org/1999/xhtml">Clear</span></code><span class="koboSpan" id="kobo.1265.1" xmlns="http://www.w3.org/1999/xhtml">,</span><code class="inlineCode"><span class="koboSpan" id="kobo.1266.1" xmlns="http://www.w3.org/1999/xhtml"> ContainsKey</span></code><span class="koboSpan" id="kobo.1267.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1268.1" xmlns="http://www.w3.org/1999/xhtml">Remove</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1269.1" xmlns="http://www.w3.org/1999/xhtml">Build a valid connection string for a SQL Server database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1270.1" xmlns="http://www.w3.org/1999/xhtml">After setting all the relevant individual properties, get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1271.1" xmlns="http://www.w3.org/1999/xhtml">ConnectionString</span></code><span class="koboSpan" id="kobo.1272.1" xmlns="http://www.w3.org/1999/xhtml"> property.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1273.1" xmlns="http://www.w3.org/1999/xhtml">SqlCommand</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1274.1" xmlns="http://www.w3.org/1999/xhtml">Connection, </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1275.1" xmlns="http://www.w3.org/1999/xhtml">CommandType, </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1276.1" xmlns="http://www.w3.org/1999/xhtml">CommandText, </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1277.1" xmlns="http://www.w3.org/1999/xhtml">Parameters, </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1278.1" xmlns="http://www.w3.org/1999/xhtml">Transaction</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1279.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteReader</span></code><span class="koboSpan" id="kobo.1280.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1281.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteNonQuery</span></code><span class="koboSpan" id="kobo.1282.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1283.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteXmlReader</span></code><span class="koboSpan" id="kobo.1284.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1285.1" xmlns="http://www.w3.org/1999/xhtml">CreateParameter</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1286.1" xmlns="http://www.w3.org/1999/xhtml">Configure the command to execute.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1287.1" xmlns="http://www.w3.org/1999/xhtml">SqlParameter</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1288.1" xmlns="http://www.w3.org/1999/xhtml">ParameterName</span></code><span class="koboSpan" id="kobo.1289.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1290.1" xmlns="http://www.w3.org/1999/xhtml">Value</span></code><span class="koboSpan" id="kobo.1291.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1292.1" xmlns="http://www.w3.org/1999/xhtml">DbType, </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1293.1" xmlns="http://www.w3.org/1999/xhtml">SqlValue</span></code><span class="koboSpan" id="kobo.1294.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1295.1" xmlns="http://www.w3.org/1999/xhtml">SqlDbType, </span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1" xmlns="http://www.w3.org/1999/xhtml">Direction</span></code><span class="koboSpan" id="kobo.1297.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1" xmlns="http://www.w3.org/1999/xhtml">IsNullable</span></code></p>
</td>
<td class="table-cell"/>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1299.1" xmlns="http://www.w3.org/1999/xhtml">Configure a parameter for a command.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1300.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataReader</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1301.1" xmlns="http://www.w3.org/1999/xhtml">FieldCount</span></code><span class="koboSpan" id="kobo.1302.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1303.1" xmlns="http://www.w3.org/1999/xhtml">HasRows</span></code><span class="koboSpan" id="kobo.1304.1" xmlns="http://www.w3.org/1999/xhtml">,</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1305.1" xmlns="http://www.w3.org/1999/xhtml">IsClosed</span></code><span class="koboSpan" id="kobo.1306.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1307.1" xmlns="http://www.w3.org/1999/xhtml">RecordsAffected</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1308.1" xmlns="http://www.w3.org/1999/xhtml">Read</span></code><span class="koboSpan" id="kobo.1309.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1310.1" xmlns="http://www.w3.org/1999/xhtml">Close</span></code><span class="koboSpan" id="kobo.1311.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1312.1" xmlns="http://www.w3.org/1999/xhtml">GetOrdinal</span></code><span class="koboSpan" id="kobo.1313.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1314.1" xmlns="http://www.w3.org/1999/xhtml">GetInt32</span></code><span class="koboSpan" id="kobo.1315.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1316.1" xmlns="http://www.w3.org/1999/xhtml">GetString</span></code><span class="koboSpan" id="kobo.1317.1" xmlns="http://www.w3.org/1999/xhtml">, </span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1318.1" xmlns="http://www.w3.org/1999/xhtml">GetDecimal</span></code><span class="koboSpan" id="kobo.1319.1" xmlns="http://www.w3.org/1999/xhtml">,</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1320.1" xmlns="http://www.w3.org/1999/xhtml">GetFieldValue&lt;T&gt;</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1321.1" xmlns="http://www.w3.org/1999/xhtml">Process the result set from executing a query.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.1322.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.6: Important types in ADO.NET SqlClient</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1323.1" xmlns="http://www.w3.org/1999/xhtml">SqlConnection</span></code><span class="koboSpan" id="kobo.1324.1" xmlns="http://www.w3.org/1999/xhtml"> has two useful events: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1325.1" xmlns="http://www.w3.org/1999/xhtml">StateChange</span></code><span class="koboSpan" id="kobo.1326.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1327.1" xmlns="http://www.w3.org/1999/xhtml">InfoMessage</span></code><span class="koboSpan" id="kobo.1328.1" xmlns="http://www.w3.org/1999/xhtml">. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1329.1" xmlns="http://www.w3.org/1999/xhtml">All the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1330.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteXxx</span></code><span class="koboSpan" id="kobo.1331.1" xmlns="http://www.w3.org/1999/xhtml"> methods of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1332.1" xmlns="http://www.w3.org/1999/xhtml">SqlCommand</span></code><span class="koboSpan" id="kobo.1333.1" xmlns="http://www.w3.org/1999/xhtml"> will execute any command. </span><span class="koboSpan" id="kobo.1333.2" xmlns="http://www.w3.org/1999/xhtml">The one you use depends </span><a id="_idIndexMarker174"/><span class="koboSpan" id="kobo.1334.1" xmlns="http://www.w3.org/1999/xhtml">on what you expect to get back:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1335.1" xmlns="http://www.w3.org/1999/xhtml">If the command includes at least one </span><code class="inlineCode"><span class="koboSpan" id="kobo.1336.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1337.1" xmlns="http://www.w3.org/1999/xhtml"> statement that returns a result set, then call </span><code class="inlineCode"><span class="koboSpan" id="kobo.1338.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteReader</span></code><span class="koboSpan" id="kobo.1339.1" xmlns="http://www.w3.org/1999/xhtml"> to execute the command. </span><span class="koboSpan" id="kobo.1339.2" xmlns="http://www.w3.org/1999/xhtml">This method returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1340.1" xmlns="http://www.w3.org/1999/xhtml">DbDataReader</span></code><span class="koboSpan" id="kobo.1341.1" xmlns="http://www.w3.org/1999/xhtml">-derived object for reading row-by-row through the result set.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1342.1" xmlns="http://www.w3.org/1999/xhtml">If the command does not include at least one </span><code class="inlineCode"><span class="koboSpan" id="kobo.1343.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1344.1" xmlns="http://www.w3.org/1999/xhtml"> statement, then it is more efficient to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.1345.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteNonQuery</span></code><span class="koboSpan" id="kobo.1346.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1346.2" xmlns="http://www.w3.org/1999/xhtml">This method returns an integer for the number of rows affected.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1347.1" xmlns="http://www.w3.org/1999/xhtml">If the command includes at least one </span><code class="inlineCode"><span class="koboSpan" id="kobo.1348.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1349.1" xmlns="http://www.w3.org/1999/xhtml"> statement that returns XML because it uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1350.1" xmlns="http://www.w3.org/1999/xhtml">AS XML</span></code><span class="koboSpan" id="kobo.1351.1" xmlns="http://www.w3.org/1999/xhtml"> command, then call </span><code class="inlineCode"><span class="koboSpan" id="kobo.1352.1" xmlns="http://www.w3.org/1999/xhtml">ExecuteXmlReader</span></code><span class="koboSpan" id="kobo.1353.1" xmlns="http://www.w3.org/1999/xhtml"> to execute the command.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-110"><span class="koboSpan" id="kobo.1354.1" xmlns="http://www.w3.org/1999/xhtml">Creating a console app for working with ADO.NET</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1355.1" xmlns="http://www.w3.org/1999/xhtml">First, we will create</span><a id="_idIndexMarker175"/><span class="koboSpan" id="kobo.1356.1" xmlns="http://www.w3.org/1999/xhtml"> a console app project for working with ADO.NET:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1357.1" xmlns="http://www.w3.org/1999/xhtml">Use your preferred code editor to create a console app project, as defined in the following list:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1358.1" xmlns="http://www.w3.org/1999/xhtml">Project template: </span><strong class="screenText"><span class="koboSpan" id="kobo.1359.1" xmlns="http://www.w3.org/1999/xhtml">Console App</span></strong><span class="koboSpan" id="kobo.1360.1" xmlns="http://www.w3.org/1999/xhtml"> / </span><code class="inlineCode"><span class="koboSpan" id="kobo.1361.1" xmlns="http://www.w3.org/1999/xhtml">console</span></code><span class="koboSpan" id="kobo.1362.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1363.1" xmlns="http://www.w3.org/1999/xhtml">Solution file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1364.1" xmlns="http://www.w3.org/1999/xhtml">Chapter02</span></code><span class="koboSpan" id="kobo.1365.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1366.1" xmlns="http://www.w3.org/1999/xhtml">Project file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1367.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Console.SqlClient</span></code><span class="koboSpan" id="kobo.1368.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1369.1" xmlns="http://www.w3.org/1999/xhtml">Do not use top-level statements</span></strong><span class="koboSpan" id="kobo.1370.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1371.1" xmlns="http://www.w3.org/1999/xhtml">Enable native AOT publish</span></strong><span class="koboSpan" id="kobo.1372.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1373.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice:</span></strong><span class="koboSpan" id="kobo.1374.1" xmlns="http://www.w3.org/1999/xhtml"> For all the projects that you create for this book, keep your root path short and avoid using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1375.1" xmlns="http://www.w3.org/1999/xhtml">#</span></code><span class="koboSpan" id="kobo.1376.1" xmlns="http://www.w3.org/1999/xhtml"> in your folder and file names, or you might see compiler errors like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1377.1" xmlns="http://www.w3.org/1999/xhtml">RSG002: TargetPath not specified for additional file</span></code><span class="koboSpan" id="kobo.1378.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1378.2" xmlns="http://www.w3.org/1999/xhtml">For example, do </span><em class="italic"><span class="koboSpan" id="kobo.1379.1" xmlns="http://www.w3.org/1999/xhtml">not</span></em><span class="koboSpan" id="kobo.1380.1" xmlns="http://www.w3.org/1999/xhtml"> use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1381.1" xmlns="http://www.w3.org/1999/xhtml">C:\My C# projects\</span></code><span class="koboSpan" id="kobo.1382.1" xmlns="http://www.w3.org/1999/xhtml"> as your root path!</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1383.1" xmlns="http://www.w3.org/1999/xhtml">In the</span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.1384.1" xmlns="http://www.w3.org/1999/xhtml"> project file, treat warnings as errors, add a package reference for the latest version of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1385.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient</span></code><span class="koboSpan" id="kobo.1386.1" xmlns="http://www.w3.org/1999/xhtml">, and statically and globally import </span><code class="inlineCode"><span class="koboSpan" id="kobo.1387.1" xmlns="http://www.w3.org/1999/xhtml">System.Console</span></code><span class="koboSpan" id="kobo.1388.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1389.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1390.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.NET.Sdk"</span></span><span class="koboSpan" id="kobo.1391.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.1392.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.1393.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1394.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;TreatWarningsAsErrors&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1395.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1396.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TreatWarningsAsErrors&gt;</span></strong></span><span class="koboSpan" id="kobo.1397.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;/PropertyGroup&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1398.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;ItemGroup&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1399.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;PackageReference Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1400.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Data.SqlClient"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1401.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1402.1" xmlns="http://www.w3.org/1999/xhtml">"5.1.2"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1403.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1404.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;/ItemGroup&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1405.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;ItemGroup&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1406.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;Using Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1407.1" xmlns="http://www.w3.org/1999/xhtml">"System.Console"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1408.1" xmlns="http://www.w3.org/1999/xhtml"> Static=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1409.1" xmlns="http://www.w3.org/1999/xhtml">"true"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1410.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1411.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;/ItemGroup&gt;</span></strong></span><span class="koboSpan" id="kobo.1412.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/Project&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1413.1" xmlns="http://www.w3.org/1999/xhtml">You can check the most recent version of the package at the following link: </span><a href="https://www.nuget.org/packages/Microsoft.Data.SqlClient#versions-body-tab"><span class="url"><span class="koboSpan" id="kobo.1414.1" xmlns="http://www.w3.org/1999/xhtml">https://www.nuget.org/packages/Microsoft.Data.SqlClient#versions-body-tab</span></span></a><span class="koboSpan" id="kobo.1415.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1416.1" xmlns="http://www.w3.org/1999/xhtml">Build the project to restore the referenced package.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1417.1" xmlns="http://www.w3.org/1999/xhtml">Add </span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.1418.1" xmlns="http://www.w3.org/1999/xhtml">a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1419.1" xmlns="http://www.w3.org/1999/xhtml">Program.Helpers.cs</span></code><span class="koboSpan" id="kobo.1420.1" xmlns="http://www.w3.org/1999/xhtml">, and modify its contents to define a method to configure the console to enable special characters like the Euro currency symbol and set the current culture, and a method that will output some text to the console in a specified color, with a default color of black, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1421.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1422.1" xmlns="http://www.w3.org/1999/xhtml"> System.Globalization; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1423.1" xmlns="http://www.w3.org/1999/xhtml">// To use CultureInfo.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1424.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1425.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1426.1" xmlns="http://www.w3.org/1999/xhtml">Program</span></span><span class="koboSpan" id="kobo.1427.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1428.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1429.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1430.1" xmlns="http://www.w3.org/1999/xhtml">void</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1431.1" xmlns="http://www.w3.org/1999/xhtml">ConfigureConsole</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1432.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1433.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1434.1" xmlns="http://www.w3.org/1999/xhtml"> culture = </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1435.1" xmlns="http://www.w3.org/1999/xhtml">"en-US"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1436.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-params"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1437.1" xmlns="http://www.w3.org/1999/xhtml">bool</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1438.1" xmlns="http://www.w3.org/1999/xhtml"> useComputerCulture = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.1439.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1440.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1441.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1442.1" xmlns="http://www.w3.org/1999/xhtml">// To enable Unicode characters like Euro symbol in the console.</span></span><span class="koboSpan" id="kobo.1443.1" xmlns="http://www.w3.org/1999/xhtml">
    OutputEncoding = System.Text.Encoding.UTF8;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1444.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1445.1" xmlns="http://www.w3.org/1999/xhtml"> (!useComputerCulture)
    {
      CultureInfo.CurrentCulture = CultureInfo.GetCultureInfo(culture);
    }
    WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1446.1" xmlns="http://www.w3.org/1999/xhtml">$"CurrentCulture: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1447.1" xmlns="http://www.w3.org/1999/xhtml">{CultureInfo.CurrentCulture.DisplayName}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1448.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1449.1" xmlns="http://www.w3.org/1999/xhtml">);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1450.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1451.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1452.1" xmlns="http://www.w3.org/1999/xhtml">void</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1453.1" xmlns="http://www.w3.org/1999/xhtml">WriteLineInColor</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1454.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1455.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-params"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1456.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1457.1" xmlns="http://www.w3.org/1999/xhtml">, </span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1458.1" xmlns="http://www.w3.org/1999/xhtml">    ConsoleColor color = ConsoleColor.White</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1459.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1460.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = color;
    WriteLine(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1461.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="koboSpan" id="kobo.1462.1" xmlns="http://www.w3.org/1999/xhtml">);
    ForegroundColor = previousColor;
  }
}
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1463.1" xmlns="http://www.w3.org/1999/xhtml">The default foreground color in the preceding code is white because I have assumed that most readers will have a default background color of black. </span><span class="koboSpan" id="kobo.1463.2" xmlns="http://www.w3.org/1999/xhtml">On my computer, I set the default background color of the console to white so that I can take screenshots for this book. </span><span class="koboSpan" id="kobo.1463.3" xmlns="http://www.w3.org/1999/xhtml">Set whatever default color is best for your computer.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1464.1" xmlns="http://www.w3.org/1999/xhtml">Add a </span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.1465.1" xmlns="http://www.w3.org/1999/xhtml">new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1466.1" xmlns="http://www.w3.org/1999/xhtml">Program.EventHandlers.cs</span></code><span class="koboSpan" id="kobo.1467.1" xmlns="http://www.w3.org/1999/xhtml">, and modify its contents to define methods that will act as event handlers for a database connection state change by showing the original and current states, and for when the database sends an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1468.1" xmlns="http://www.w3.org/1999/xhtml">InfoMessage</span></code><span class="koboSpan" id="kobo.1469.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1470.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1471.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Data.SqlClient; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1472.1" xmlns="http://www.w3.org/1999/xhtml">// To use SqlInfoMessageEventArgs.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1473.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1474.1" xmlns="http://www.w3.org/1999/xhtml"> System.Data; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1475.1" xmlns="http://www.w3.org/1999/xhtml">// To use StateChangeEventArgs.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1476.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1477.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1478.1" xmlns="http://www.w3.org/1999/xhtml">Program</span></span><span class="koboSpan" id="kobo.1479.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1480.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1481.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1482.1" xmlns="http://www.w3.org/1999/xhtml">void</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1483.1" xmlns="http://www.w3.org/1999/xhtml">Connection_StateChange</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1484.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1485.1" xmlns="http://www.w3.org/1999/xhtml">object</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1486.1" xmlns="http://www.w3.org/1999/xhtml"> sender, StateChangeEventArgs e</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1487.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1488.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    WriteLineInColor(
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.1489.1" xmlns="http://www.w3.org/1999/xhtml">$"State change from </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1490.1" xmlns="http://www.w3.org/1999/xhtml">{e.OriginalState}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1491.1" xmlns="http://www.w3.org/1999/xhtml"> to </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1492.1" xmlns="http://www.w3.org/1999/xhtml">{e.CurrentState}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1493.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1494.1" xmlns="http://www.w3.org/1999/xhtml">,
      ConsoleColor.DarkYellow);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1495.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1496.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1497.1" xmlns="http://www.w3.org/1999/xhtml">void</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1498.1" xmlns="http://www.w3.org/1999/xhtml">Connection_InfoMessage</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1499.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1500.1" xmlns="http://www.w3.org/1999/xhtml">object</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1501.1" xmlns="http://www.w3.org/1999/xhtml"> sender, SqlInfoMessageEventArgs e</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1502.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1503.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    WriteLineInColor(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1504.1" xmlns="http://www.w3.org/1999/xhtml">$"Info: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1505.1" xmlns="http://www.w3.org/1999/xhtml">{e.Message}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1506.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1507.1" xmlns="http://www.w3.org/1999/xhtml">, ConsoleColor.DarkBlue);
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1508.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1509.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1510.1" xmlns="http://www.w3.org/1999/xhtml">, delete the existing statements. </span><span class="koboSpan" id="kobo.1510.2" xmlns="http://www.w3.org/1999/xhtml">Add statements to connect to SQL Server locally, to Azure SQL Database, or to SQL Edge, using either SQL authentication with a user ID and password or Windows Authentication without a user ID and password, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1511.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1512.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Data.SqlClient; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1513.1" xmlns="http://www.w3.org/1999/xhtml">// To use SqlConnection and so on.</span></span><span class="koboSpan" id="kobo.1514.1" xmlns="http://www.w3.org/1999/xhtml">
ConfigureConsole();
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1515.1" xmlns="http://www.w3.org/1999/xhtml">#</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1516.1" xmlns="http://www.w3.org/1999/xhtml">region</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1517.1" xmlns="http://www.w3.org/1999/xhtml"> Set up the connection string builder</span></span><span class="koboSpan" id="kobo.1518.1" xmlns="http://www.w3.org/1999/xhtml">
SqlConnectionStringBuilder builder = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1519.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1520.1" xmlns="http://www.w3.org/1999/xhtml">()
{
  InitialCatalog = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1521.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind"</span></span><span class="koboSpan" id="kobo.1522.1" xmlns="http://www.w3.org/1999/xhtml">,
  MultipleActiveResultSets = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1523.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.1524.1" xmlns="http://www.w3.org/1999/xhtml">,
  Encrypt = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1525.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.1526.1" xmlns="http://www.w3.org/1999/xhtml">,
  TrustServerCertificate = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1527.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.1528.1" xmlns="http://www.w3.org/1999/xhtml">,
  ConnectTimeout = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1529.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1530.1" xmlns="http://www.w3.org/1999/xhtml">// Default is 30 seconds.</span></span><span class="koboSpan" id="kobo.1531.1" xmlns="http://www.w3.org/1999/xhtml">
};
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1532.1" xmlns="http://www.w3.org/1999/xhtml">"Connect to:"</span></span><span class="koboSpan" id="kobo.1533.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1534.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1535.1" xmlns="http://www.w3.org/1999/xhtml">  1 - SQL Server on local machine"</span></span><span class="koboSpan" id="kobo.1536.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1537.1" xmlns="http://www.w3.org/1999/xhtml">"  2 - Azure SQL Database"</span></span><span class="koboSpan" id="kobo.1538.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1539.1" xmlns="http://www.w3.org/1999/xhtml">"  3 – Azure SQL Edge"</span></span><span class="koboSpan" id="kobo.1540.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine();
Write(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1541.1" xmlns="http://www.w3.org/1999/xhtml">"Press a key: "</span></span><span class="koboSpan" id="kobo.1542.1" xmlns="http://www.w3.org/1999/xhtml">);
ConsoleKey key = ReadKey().Key;
WriteLine(); WriteLine();
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1543.1" xmlns="http://www.w3.org/1999/xhtml">switch</span></span><span class="koboSpan" id="kobo.1544.1" xmlns="http://www.w3.org/1999/xhtml"> (key)
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1545.1" xmlns="http://www.w3.org/1999/xhtml">case</span></span><span class="koboSpan" id="kobo.1546.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D1 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1547.1" xmlns="http://www.w3.org/1999/xhtml">or</span></span><span class="koboSpan" id="kobo.1548.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad1:
    builder.DataSource = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1549.1" xmlns="http://www.w3.org/1999/xhtml">"."</span></span><span class="koboSpan" id="kobo.1550.1" xmlns="http://www.w3.org/1999/xhtml">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1551.1" xmlns="http://www.w3.org/1999/xhtml">break</span></span><span class="koboSpan" id="kobo.1552.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1553.1" xmlns="http://www.w3.org/1999/xhtml">case</span></span><span class="koboSpan" id="kobo.1554.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D2 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1555.1" xmlns="http://www.w3.org/1999/xhtml">or</span></span><span class="koboSpan" id="kobo.1556.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad2:
    builder.DataSource = 
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1557.1" xmlns="http://www.w3.org/1999/xhtml">// Use your Azure SQL Database server name.</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1558.1" xmlns="http://www.w3.org/1999/xhtml">"tcp:apps-services-book.database.windows.net,1433"</span></span><span class="koboSpan" id="kobo.1559.1" xmlns="http://www.w3.org/1999/xhtml">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1560.1" xmlns="http://www.w3.org/1999/xhtml">break</span></span><span class="koboSpan" id="kobo.1561.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1562.1" xmlns="http://www.w3.org/1999/xhtml">case</span></span><span class="koboSpan" id="kobo.1563.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D3 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1564.1" xmlns="http://www.w3.org/1999/xhtml">or</span></span><span class="koboSpan" id="kobo.1565.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad3:
    builder.DataSource = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1566.1" xmlns="http://www.w3.org/1999/xhtml">"tcp:127.0.0.1,1433"</span></span><span class="koboSpan" id="kobo.1567.1" xmlns="http://www.w3.org/1999/xhtml">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1568.1" xmlns="http://www.w3.org/1999/xhtml">break</span></span><span class="koboSpan" id="kobo.1569.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1570.1" xmlns="http://www.w3.org/1999/xhtml">default</span></span><span class="koboSpan" id="kobo.1571.1" xmlns="http://www.w3.org/1999/xhtml">:
    WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1572.1" xmlns="http://www.w3.org/1999/xhtml">"No data source selected."</span></span><span class="koboSpan" id="kobo.1573.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1574.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1575.1" xmlns="http://www.w3.org/1999/xhtml">;
}
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1576.1" xmlns="http://www.w3.org/1999/xhtml">"Authenticate using:"</span></span><span class="koboSpan" id="kobo.1577.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1578.1" xmlns="http://www.w3.org/1999/xhtml">"  1 – Windows Integrated Security"</span></span><span class="koboSpan" id="kobo.1579.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1580.1" xmlns="http://www.w3.org/1999/xhtml">"  2 – SQL Login, for example, sa"</span></span><span class="koboSpan" id="kobo.1581.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine();
Write(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1582.1" xmlns="http://www.w3.org/1999/xhtml">"Press a key: "</span></span><span class="koboSpan" id="kobo.1583.1" xmlns="http://www.w3.org/1999/xhtml">);
key = ReadKey().Key;
WriteLine(); WriteLine();
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1584.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1585.1" xmlns="http://www.w3.org/1999/xhtml"> (key </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1586.1" xmlns="http://www.w3.org/1999/xhtml">is</span></span><span class="koboSpan" id="kobo.1587.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D1 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1588.1" xmlns="http://www.w3.org/1999/xhtml">or</span></span><span class="koboSpan" id="kobo.1589.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad1)
{
  builder.IntegratedSecurity = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1590.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.1591.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1592.1" xmlns="http://www.w3.org/1999/xhtml">else</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1593.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1594.1" xmlns="http://www.w3.org/1999/xhtml"> (key </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1595.1" xmlns="http://www.w3.org/1999/xhtml">is</span></span><span class="koboSpan" id="kobo.1596.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D2 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1597.1" xmlns="http://www.w3.org/1999/xhtml">or</span></span><span class="koboSpan" id="kobo.1598.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad2)
{
  Write(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1599.1" xmlns="http://www.w3.org/1999/xhtml">"Enter your SQL Server user ID: "</span></span><span class="koboSpan" id="kobo.1600.1" xmlns="http://www.w3.org/1999/xhtml">);
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1601.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1602.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.1602.2" xmlns="http://www.w3.org/1999/xhtml">userId = ReadLine();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1603.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1604.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1605.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1606.1" xmlns="http://www.w3.org/1999/xhtml">.IsNullOrWhiteSpace(userId))
  {
    WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1607.1" xmlns="http://www.w3.org/1999/xhtml">"User ID cannot be empty or null."</span></span><span class="koboSpan" id="kobo.1608.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1609.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1610.1" xmlns="http://www.w3.org/1999/xhtml">;
  }
  builder.UserID = userId;
  Write(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1611.1" xmlns="http://www.w3.org/1999/xhtml">"Enter your SQL Server password: "</span></span><span class="koboSpan" id="kobo.1612.1" xmlns="http://www.w3.org/1999/xhtml">);
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1613.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1614.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.1614.2" xmlns="http://www.w3.org/1999/xhtml">password = ReadLine();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1615.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1616.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1617.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1618.1" xmlns="http://www.w3.org/1999/xhtml">.IsNullOrWhiteSpace(password))
  {
    WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1619.1" xmlns="http://www.w3.org/1999/xhtml">"Password cannot be empty or null."</span></span><span class="koboSpan" id="kobo.1620.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1621.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1622.1" xmlns="http://www.w3.org/1999/xhtml">;
  }
  builder.Password = password;
  builder.PersistSecurityInfo = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1623.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="koboSpan" id="kobo.1624.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1625.1" xmlns="http://www.w3.org/1999/xhtml">else</span></span><span class="koboSpan" id="kobo.1626.1" xmlns="http://www.w3.org/1999/xhtml">
{
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1627.1" xmlns="http://www.w3.org/1999/xhtml">"No authentication selected."</span></span><span class="koboSpan" id="kobo.1628.1" xmlns="http://www.w3.org/1999/xhtml">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1629.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1630.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1631.1" xmlns="http://www.w3.org/1999/xhtml">#</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1632.1" xmlns="http://www.w3.org/1999/xhtml">endregion</span></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.1633.1" xmlns="http://www.w3.org/1999/xhtml">#</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1634.1" xmlns="http://www.w3.org/1999/xhtml">region</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1635.1" xmlns="http://www.w3.org/1999/xhtml"> Create and open the connection</span></span><span class="koboSpan" id="kobo.1636.1" xmlns="http://www.w3.org/1999/xhtml">
SqlConnection connection = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1637.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1638.1" xmlns="http://www.w3.org/1999/xhtml">(builder.ConnectionString);
WriteLine(connection.ConnectionString);
WriteLine();
connection.StateChange += Connection_StateChange;
connection.InfoMessage += Connection_InfoMessage;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1639.1" xmlns="http://www.w3.org/1999/xhtml">try</span></span><span class="koboSpan" id="kobo.1640.1" xmlns="http://www.w3.org/1999/xhtml">
{
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1641.1" xmlns="http://www.w3.org/1999/xhtml">"Opening connection. </span><span class="koboSpan" id="kobo.1641.2" xmlns="http://www.w3.org/1999/xhtml">Please wait up to {0} seconds..."</span></span><span class="koboSpan" id="kobo.1642.1" xmlns="http://www.w3.org/1999/xhtml">, 
    builder.ConnectTimeout);
  WriteLine();
  connection.Open();
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1643.1" xmlns="http://www.w3.org/1999/xhtml">$"SQL Server version: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1644.1" xmlns="http://www.w3.org/1999/xhtml">{connection.ServerVersion}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1645.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1646.1" xmlns="http://www.w3.org/1999/xhtml">);
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1647.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></span><span class="koboSpan" id="kobo.1648.1" xmlns="http://www.w3.org/1999/xhtml"> (SqlException ex)
{
  WriteLineInColor(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1649.1" xmlns="http://www.w3.org/1999/xhtml">$"SQL exception: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1650.1" xmlns="http://www.w3.org/1999/xhtml">{ex.Message}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1651.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1652.1" xmlns="http://www.w3.org/1999/xhtml">, 
    ConsoleColor.Red);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1653.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1654.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1655.1" xmlns="http://www.w3.org/1999/xhtml">#</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1656.1" xmlns="http://www.w3.org/1999/xhtml">endregion</span></span><span class="koboSpan" id="kobo.1657.1" xmlns="http://www.w3.org/1999/xhtml">
connection.Close();
</span></code></pre>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1658.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.1659.1" xmlns="http://www.w3.org/1999/xhtml">: In this coding task, we prompt the user to enter the password to connect to the database. </span><span class="koboSpan" id="kobo.1659.2" xmlns="http://www.w3.org/1999/xhtml">In a real-world app you are more likely to store the password in an environment variable or secure storage like Azure Key Vault. </span><span class="koboSpan" id="kobo.1659.3" xmlns="http://www.w3.org/1999/xhtml">You must definitely never store passwords in your source code!</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.1660.1" xmlns="http://www.w3.org/1999/xhtml">Run</span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.1661.1" xmlns="http://www.w3.org/1999/xhtml"> the console app, select options that work with your SQL Server setup, and note the results, including the state change event output written in dark yellow to make them easier to see, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1662.1" xmlns="http://www.w3.org/1999/xhtml">Connect to:
  1 - SQL Server on local machine
  2 - Azure SQL Database
  3 - Azure SQL Edge
Press a key: 1
Authenticate using:
  1 - Windows Integrated Security
  2 - SQL Login, for example, sa
Press a key: 1
Data Source=.;Initial Catalog=Northwind;Integrated Security=True;Multiple Active Result Sets=True;Connect Timeout=10;Encrypt=True;Trust Server Certificate=True
Opening connection. </span><span class="koboSpan" id="kobo.1662.2" xmlns="http://www.w3.org/1999/xhtml">Please wait up to 10 seconds...
</span><span class="koboSpan" id="kobo.1662.3" xmlns="http://www.w3.org/1999/xhtml">State change from Closed to Open.
</span><span class="koboSpan" id="kobo.1662.4" xmlns="http://www.w3.org/1999/xhtml">SQL Server version: 15.00.2101
State change from Open to Closed.
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1663.1" xmlns="http://www.w3.org/1999/xhtml">The following steps show the experience when connecting to Azure SQL Database or Azure SQL Edge, which require a username and password. </span><span class="koboSpan" id="kobo.1663.2" xmlns="http://www.w3.org/1999/xhtml">If you are connecting to a local SQL Server using Windows Integrated Security, then you will not need to enter a password.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.1664.1" xmlns="http://www.w3.org/1999/xhtml">Run</span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.1665.1" xmlns="http://www.w3.org/1999/xhtml"> the console app, select choices that require a user ID and password, for example, with Azure SQL Database, and note the result, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1666.1" xmlns="http://www.w3.org/1999/xhtml">Enter your SQL Server user ID: markjprice
Enter your SQL Server password: [censored]
Data Source=tcp:apps-services-book.database.windows.net,1433;Initial Catalog=Northwind;Persist Security Info=False;User ID=markjprice;Password=[censored];Multiple Active Result Sets=True;Connect Timeout=10;Encrypt=True;Trust Server Certificate=True
Opening connection. </span><span class="koboSpan" id="kobo.1666.2" xmlns="http://www.w3.org/1999/xhtml">Please wait up to 10 seconds...
</span><span class="koboSpan" id="kobo.1666.3" xmlns="http://www.w3.org/1999/xhtml">State change from Closed to Open.
</span><span class="koboSpan" id="kobo.1666.4" xmlns="http://www.w3.org/1999/xhtml">SQL Server version: 12.00.5168
State change from Open to Closed.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1667.1" xmlns="http://www.w3.org/1999/xhtml">Run the console app, select choices that require a user ID and password, enter a wrong password, and note the result, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1668.1" xmlns="http://www.w3.org/1999/xhtml">Enter your SQL Server user ID: markjprice
Enter your SQL Server password: 123456
Data Source=tcp:apps-services-book.database.windows.net,1433;Initial Catalog=Northwind;Persist Security Info=False;User ID=markjprice;Password=123456;Multiple Active Result Sets=True;Connect Timeout=10;Encrypt=True;Trust Server Certificate=True
Opening connection. </span><span class="koboSpan" id="kobo.1668.2" xmlns="http://www.w3.org/1999/xhtml">Please wait up to 10 seconds...
</span><span class="koboSpan" id="kobo.1668.3" xmlns="http://www.w3.org/1999/xhtml">SQL exception: Login failed for user 'markjprice'.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1669.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1670.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1671.1" xmlns="http://www.w3.org/1999/xhtml">, change the server name (the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1672.1" xmlns="http://www.w3.org/1999/xhtml">DataSource</span></code><span class="koboSpan" id="kobo.1673.1" xmlns="http://www.w3.org/1999/xhtml"> property) to something wrong.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1674.1" xmlns="http://www.w3.org/1999/xhtml">Run the </span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.1675.1" xmlns="http://www.w3.org/1999/xhtml">console app and note the result (depending on where your database is hosted, the exception message might be slightly different), as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1676.1" xmlns="http://www.w3.org/1999/xhtml">SQL exception: A network-related or instance-specific error occurred while establishing a connection to SQL Server. </span><span class="koboSpan" id="kobo.1676.2" xmlns="http://www.w3.org/1999/xhtml">The server was not found or was not accessible. </span><span class="koboSpan" id="kobo.1676.3" xmlns="http://www.w3.org/1999/xhtml">Verify that the instance name is correct and that SQL Server is configured to allow remote connections. </span><span class="koboSpan" id="kobo.1676.4" xmlns="http://www.w3.org/1999/xhtml">(provider: TCP Provider, error: 0 - No such host is known.)
</span></code></pre>
</li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1677.1" xmlns="http://www.w3.org/1999/xhtml">When opening a SQL Server connection, the default timeout is 30 seconds for server connection problems, so be patient! </span><span class="koboSpan" id="kobo.1677.2" xmlns="http://www.w3.org/1999/xhtml">We changed the timeout to 10 seconds to avoid having to wait so long.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-111"><span class="koboSpan" id="kobo.1678.1" xmlns="http://www.w3.org/1999/xhtml">Executing queries and working with data readers using ADO.NET</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1679.1" xmlns="http://www.w3.org/1999/xhtml">Now that </span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.1680.1" xmlns="http://www.w3.org/1999/xhtml">we have a successful </span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.1681.1" xmlns="http://www.w3.org/1999/xhtml">connection to the SQL Server database, we can run commands that retrieve rows from a table and process the results using a data reader:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1682.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1683.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1684.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for working with ADO.NET command types, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1685.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1686.1" xmlns="http://www.w3.org/1999/xhtml"> System.Data; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1687.1" xmlns="http://www.w3.org/1999/xhtml">// To use CommandType.</span></span>
</code></pre>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1688.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.1689.1" xmlns="http://www.w3.org/1999/xhtml">: To save space in this book, I will use the names </span><code class="inlineCode"><span class="koboSpan" id="kobo.1690.1" xmlns="http://www.w3.org/1999/xhtml">cmd</span></code><span class="koboSpan" id="kobo.1691.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1692.1" xmlns="http://www.w3.org/1999/xhtml">r</span></code><span class="koboSpan" id="kobo.1693.1" xmlns="http://www.w3.org/1999/xhtml"> to represent an SQL command and an SQL data reader. </span><span class="koboSpan" id="kobo.1693.2" xmlns="http://www.w3.org/1999/xhtml">In your code, give variables proper word names like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1694.1" xmlns="http://www.w3.org/1999/xhtml">command</span></code><span class="koboSpan" id="kobo.1695.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1696.1" xmlns="http://www.w3.org/1999/xhtml">reader</span></code><span class="koboSpan" id="kobo.1697.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
</li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1698.1" xmlns="http://www.w3.org/1999/xhtml">Before the statement that closes the connection, add statements to define a command that selects the ID, name, and price from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1699.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></code><span class="koboSpan" id="kobo.1700.1" xmlns="http://www.w3.org/1999/xhtml"> table, executes it, and outputs the product IDs, names, and prices using a data reader, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1701.1" xmlns="http://www.w3.org/1999/xhtml">SqlCommand cmd = connection.CreateCommand();
cmd.CommandType = CommandType.Text;
cmd.CommandText = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1702.1" xmlns="http://www.w3.org/1999/xhtml">"SELECT ProductId, ProductName, UnitPrice FROM Products"</span></span><span class="koboSpan" id="kobo.1703.1" xmlns="http://www.w3.org/1999/xhtml">;
SqlDataReader r = cmd.ExecuteReader();
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1704.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1705.1" xmlns="http://www.w3.org/1999/xhtml"> horizontalLine = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1706.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1707.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1708.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1709.1" xmlns="http://www.w3.org/1999/xhtml">'-'</span></span><span class="koboSpan" id="kobo.1710.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1711.1" xmlns="http://www.w3.org/1999/xhtml">60</span></span><span class="koboSpan" id="kobo.1712.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(horizontalLine);
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1713.1" xmlns="http://www.w3.org/1999/xhtml">"| {0,5} | {1,-35} | {2,10} |"</span></span><span class="koboSpan" id="kobo.1714.1" xmlns="http://www.w3.org/1999/xhtml">, 
  arg0: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1715.1" xmlns="http://www.w3.org/1999/xhtml">"Id"</span></span><span class="koboSpan" id="kobo.1716.1" xmlns="http://www.w3.org/1999/xhtml">, arg1: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1717.1" xmlns="http://www.w3.org/1999/xhtml">"Name"</span></span><span class="koboSpan" id="kobo.1718.1" xmlns="http://www.w3.org/1999/xhtml">, arg2: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1719.1" xmlns="http://www.w3.org/1999/xhtml">"Price"</span></span><span class="koboSpan" id="kobo.1720.1" xmlns="http://www.w3.org/1999/xhtml">);
WriteLine(horizontalLine);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1721.1" xmlns="http://www.w3.org/1999/xhtml">while</span></span><span class="koboSpan" id="kobo.1722.1" xmlns="http://www.w3.org/1999/xhtml"> (r.Read())
{
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1723.1" xmlns="http://www.w3.org/1999/xhtml">"| {0,5} | {1,-35} | {2,10:C} |"</span></span><span class="koboSpan" id="kobo.1724.1" xmlns="http://www.w3.org/1999/xhtml">,
    r.GetInt32(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1725.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="koboSpan" id="kobo.1726.1" xmlns="http://www.w3.org/1999/xhtml">), 
    r.GetString(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1727.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="koboSpan" id="kobo.1728.1" xmlns="http://www.w3.org/1999/xhtml">),
    r.GetDecimal(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1729.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="koboSpan" id="kobo.1730.1" xmlns="http://www.w3.org/1999/xhtml">));
}
WriteLine(horizontalLine);
r.Close();
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1731.1" xmlns="http://www.w3.org/1999/xhtml">We format the unit price using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1732.1" xmlns="http://www.w3.org/1999/xhtml">C</span></code><span class="koboSpan" id="kobo.1733.1" xmlns="http://www.w3.org/1999/xhtml"> format, which uses the current culture to format currency values. </span><span class="koboSpan" id="kobo.1733.2" xmlns="http://www.w3.org/1999/xhtml">The call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1734.1" xmlns="http://www.w3.org/1999/xhtml">ConfigureConsole</span></code><span class="koboSpan" id="kobo.1735.1" xmlns="http://www.w3.org/1999/xhtml"> sets the current culture to US English so the output for all readers uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.1736.1" xmlns="http://www.w3.org/1999/xhtml">$</span></code><span class="koboSpan" id="kobo.1737.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1737.2" xmlns="http://www.w3.org/1999/xhtml">To test alternative cultures like French that use the Euro currency symbol, modify the call at the top of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1738.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1739.1" xmlns="http://www.w3.org/1999/xhtml"> file, as shown in the following code: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1740.1" xmlns="http://www.w3.org/1999/xhtml">ConfigureConsole("fr-FR");</span></code><span class="koboSpan" id="kobo.1741.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1742.1" xmlns="http://www.w3.org/1999/xhtml">Run</span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.1743.1" xmlns="http://www.w3.org/1999/xhtml"> the console app </span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.1744.1" xmlns="http://www.w3.org/1999/xhtml">and note the results, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1745.1" xmlns="http://www.w3.org/1999/xhtml">----------------------------------------------------------
|    Id | Name                                |    Price |
----------------------------------------------------------
|     1 | Chai                                |   $18.00 |
|     2 | Chang                               |   $19.00 |
...
</span><span class="koboSpan" id="kobo.1745.2" xmlns="http://www.w3.org/1999/xhtml">|    76 | Lakkalikööri                        |   $18.00 |
|    77 | Original Frankfurter grüne Soße     |   $13.00 |
----------------------------------------------------------
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1746.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1747.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1748.1" xmlns="http://www.w3.org/1999/xhtml">, modify the SQL statement to define a parameter for the unit price and use it to filter the results to products that cost more than that unit price, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1749.1" xmlns="http://www.w3.org/1999/xhtml">Write(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1750.1" xmlns="http://www.w3.org/1999/xhtml">"Enter a unit price: "</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1751.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1752.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1753.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.1753.2" xmlns="http://www.w3.org/1999/xhtml">priceText = ReadLine();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1754.1" xmlns="http://www.w3.org/1999/xhtml">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1755.1" xmlns="http://www.w3.org/1999/xhtml">(!</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1756.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1757.1" xmlns="http://www.w3.org/1999/xhtml">.TryParse(priceText, </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1758.1" xmlns="http://www.w3.org/1999/xhtml">out</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1759.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1760.1" xmlns="http://www.w3.org/1999/xhtml"> price))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1761.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1762.1" xmlns="http://www.w3.org/1999/xhtml">  WriteLine(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1763.1" xmlns="http://www.w3.org/1999/xhtml">"You must enter a valid unit price."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1764.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1765.1" xmlns="http://www.w3.org/1999/xhtml">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1766.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1767.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span><span class="koboSpan" id="kobo.1768.1" xmlns="http://www.w3.org/1999/xhtml">
SqlCommand cmd = connection.CreateCommand();
cmd.CommandType = CommandType.Text;
cmd.CommandText = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1769.1" xmlns="http://www.w3.org/1999/xhtml">"SELECT ProductId, ProductName, UnitPrice FROM Products"</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1770.1" xmlns="http://www.w3.org/1999/xhtml">  + </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1771.1" xmlns="http://www.w3.org/1999/xhtml">" WHERE UnitPrice &gt;= @minimumPrice</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1772.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1773.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1774.1" xmlns="http://www.w3.org/1999/xhtml">cmd.Parameters.AddWithValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1775.1" xmlns="http://www.w3.org/1999/xhtml">"minimumPrice"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1776.1" xmlns="http://www.w3.org/1999/xhtml">, price);</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1777.1" xmlns="http://www.w3.org/1999/xhtml">Run the </span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.1778.1" xmlns="http://www.w3.org/1999/xhtml">console app, enter a unit price like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1779.1" xmlns="http://www.w3.org/1999/xhtml">50</span></code><span class="koboSpan" id="kobo.1780.1" xmlns="http://www.w3.org/1999/xhtml">, and note the results, as shown in the following </span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.1781.1" xmlns="http://www.w3.org/1999/xhtml">partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1782.1" xmlns="http://www.w3.org/1999/xhtml">Enter a unit price: 50
----------------------------------------------------------
|    Id | Name                                |    Price |
----------------------------------------------------------
|     9 | Mishi Kobe Niku                     |   $97.00 |
|    18 | Carnarvon Tigers                    |   $62.50 |
|    20 | Sir Rodney's Marmalade              |   $81.00 |
|    29 | Thüringer Rostbratwurst             |  $123.79 |
|    38 | Côte de Blaye                       |  $263.50 |
|    51 | Manjimup Dried Apples               |   $53.00 |
|    59 | Raclette Courdavault                |   $55.00 |
----------------------------------------------------------
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-112"><span class="koboSpan" id="kobo.1783.1" xmlns="http://www.w3.org/1999/xhtml">Outputting statistics</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1784.1" xmlns="http://www.w3.org/1999/xhtml">An ADO.NET connection can </span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.1785.1" xmlns="http://www.w3.org/1999/xhtml">track useful statistics during its lifetime, including those listed in </span><em class="italic"><span class="koboSpan" id="kobo.1786.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.7</span></em><span class="koboSpan" id="kobo.1787.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table007-1">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1788.1" xmlns="http://www.w3.org/1999/xhtml">Key</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1789.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1790.1" xmlns="http://www.w3.org/1999/xhtml">BuffersReceived</span></code><span class="koboSpan" id="kobo.1791.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1792.1" xmlns="http://www.w3.org/1999/xhtml">BuffersSent</span></code><span class="koboSpan" id="kobo.1793.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1794.1" xmlns="http://www.w3.org/1999/xhtml">BytesReceived</span></code><span class="koboSpan" id="kobo.1795.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1796.1" xmlns="http://www.w3.org/1999/xhtml">BytesSent</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1797.1" xmlns="http://www.w3.org/1999/xhtml">Data is transmitted as bytes stored in buffers.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1798.1" xmlns="http://www.w3.org/1999/xhtml">CursorOpens</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1799.1" xmlns="http://www.w3.org/1999/xhtml">Cursors are an expensive operation because they require state on the server, and should be avoided when possible.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1800.1" xmlns="http://www.w3.org/1999/xhtml">Prepares</span></code><span class="koboSpan" id="kobo.1801.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1802.1" xmlns="http://www.w3.org/1999/xhtml">PreparedExecs</span></code><span class="koboSpan" id="kobo.1803.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1804.1" xmlns="http://www.w3.org/1999/xhtml">UnpreparedExecs</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1805.1" xmlns="http://www.w3.org/1999/xhtml">Number of prepares (compilations), executions of prepared commands, and executions of unprepared commands.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1806.1" xmlns="http://www.w3.org/1999/xhtml">SelectCount</span></code><span class="koboSpan" id="kobo.1807.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1808.1" xmlns="http://www.w3.org/1999/xhtml">SelectRows</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1809.1" xmlns="http://www.w3.org/1999/xhtml">Number of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1810.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1811.1" xmlns="http://www.w3.org/1999/xhtml"> statements and rows returned by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1812.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.1813.1" xmlns="http://www.w3.org/1999/xhtml"> statements.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1814.1" xmlns="http://www.w3.org/1999/xhtml">ServerRoundtrips</span></code><span class="koboSpan" id="kobo.1815.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1816.1" xmlns="http://www.w3.org/1999/xhtml">SumResultSets</span></code><span class="koboSpan" id="kobo.1817.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1818.1" xmlns="http://www.w3.org/1999/xhtml">Transactions</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1819.1" xmlns="http://www.w3.org/1999/xhtml">Number of server round trips, result sets, and transactions.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1820.1" xmlns="http://www.w3.org/1999/xhtml">ConnectionTime</span></code><span class="koboSpan" id="kobo.1821.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1822.1" xmlns="http://www.w3.org/1999/xhtml">ExecutionTime</span></code><span class="koboSpan" id="kobo.1823.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1824.1" xmlns="http://www.w3.org/1999/xhtml">NetworkServerTime</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.1825.1" xmlns="http://www.w3.org/1999/xhtml">Time in milliseconds spent connected, executing commands, or due to the network.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.1826.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.7: Connection statistics that can be tracked</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1827.1" xmlns="http://www.w3.org/1999/xhtml">Let’s enable this and</span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.1828.1" xmlns="http://www.w3.org/1999/xhtml"> output some of those statistics:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1829.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1830.1" xmlns="http://www.w3.org/1999/xhtml">Program.Helpers.cs</span></code><span class="koboSpan" id="kobo.1831.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespaces for working with ADO.NET and common collections, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1832.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1833.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Data.SqlClient; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1834.1" xmlns="http://www.w3.org/1999/xhtml">// To use SqlConnection.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1835.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1836.1" xmlns="http://www.w3.org/1999/xhtml"> System.Collections; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1837.1" xmlns="http://www.w3.org/1999/xhtml">// To use IDictionary.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1838.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1839.1" xmlns="http://www.w3.org/1999/xhtml">Program.Helpers.cs</span></code><span class="koboSpan" id="kobo.1840.1" xmlns="http://www.w3.org/1999/xhtml">, in the partial </span><code class="inlineCode"><span class="koboSpan" id="kobo.1841.1" xmlns="http://www.w3.org/1999/xhtml">Program</span></code><span class="koboSpan" id="kobo.1842.1" xmlns="http://www.w3.org/1999/xhtml"> class, add a method to output statistics about the current connection, with an array of string values to control which of the dozen or more statistics we want to output, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1843.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1844.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1845.1" xmlns="http://www.w3.org/1999/xhtml">void</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1846.1" xmlns="http://www.w3.org/1999/xhtml">OutputStatistics</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1847.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1848.1" xmlns="http://www.w3.org/1999/xhtml">SqlConnection connection</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1849.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1850.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1851.1" xmlns="http://www.w3.org/1999/xhtml">// Remove all the string values to see all the statistics.</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1852.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1853.1" xmlns="http://www.w3.org/1999/xhtml">[] includeKeys = { 
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1854.1" xmlns="http://www.w3.org/1999/xhtml">"BytesSent"</span></span><span class="koboSpan" id="kobo.1855.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1856.1" xmlns="http://www.w3.org/1999/xhtml">"BytesReceived"</span></span><span class="koboSpan" id="kobo.1857.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1858.1" xmlns="http://www.w3.org/1999/xhtml">"ConnectionTime"</span></span><span class="koboSpan" id="kobo.1859.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1860.1" xmlns="http://www.w3.org/1999/xhtml">"SelectRows"</span></span><span class="koboSpan" id="kobo.1861.1" xmlns="http://www.w3.org/1999/xhtml"> 
  };
  IDictionary statistics = connection.RetrieveStatistics();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1862.1" xmlns="http://www.w3.org/1999/xhtml">foreach</span></span><span class="koboSpan" id="kobo.1863.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1864.1" xmlns="http://www.w3.org/1999/xhtml">object</span></span><span class="koboSpan" id="kobo.1865.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.1865.2" xmlns="http://www.w3.org/1999/xhtml">key </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1866.1" xmlns="http://www.w3.org/1999/xhtml">in</span></span><span class="koboSpan" id="kobo.1867.1" xmlns="http://www.w3.org/1999/xhtml"> statistics.Keys)
  {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1868.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1869.1" xmlns="http://www.w3.org/1999/xhtml"> (!includeKeys.Any() || includeKeys.Contains(key))
    {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1870.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.1871.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1872.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.1873.1" xmlns="http://www.w3.org/1999/xhtml">.TryParse(statistics[key]?.ToString(), </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1874.1" xmlns="http://www.w3.org/1999/xhtml">out</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1875.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1876.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="koboSpan" id="kobo.1877.1" xmlns="http://www.w3.org/1999/xhtml">))
      {
        WriteLineInColor(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1878.1" xmlns="http://www.w3.org/1999/xhtml">$"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1879.1" xmlns="http://www.w3.org/1999/xhtml">{key}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1880.1" xmlns="http://www.w3.org/1999/xhtml">: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1881.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1882.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1883.1" xmlns="http://www.w3.org/1999/xhtml">:N0}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1884.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1885.1" xmlns="http://www.w3.org/1999/xhtml">, ConsoleColor.Cyan);
      }
    }
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1886.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1887.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1888.1" xmlns="http://www.w3.org/1999/xhtml">, after </span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.1889.1" xmlns="http://www.w3.org/1999/xhtml">writing the SQL Server version to the console, add a statement to enable statistics for the connection, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1890.1" xmlns="http://www.w3.org/1999/xhtml">WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1891.1" xmlns="http://www.w3.org/1999/xhtml">$"SQL Server version: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1892.1" xmlns="http://www.w3.org/1999/xhtml">{connection.ServerVersion}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1893.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1894.1" xmlns="http://www.w3.org/1999/xhtml">);
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1895.1" xmlns="http://www.w3.org/1999/xhtml">connection.StatisticsEnabled = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1896.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1897.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1898.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1899.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1900.1" xmlns="http://www.w3.org/1999/xhtml">, before closing the connection, add a statement to output statistics for the connection, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1901.1" xmlns="http://www.w3.org/1999/xhtml">OutputStatistics(connection);</span></strong></span><span class="koboSpan" id="kobo.1902.1" xmlns="http://www.w3.org/1999/xhtml">
connection.Close();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1903.1" xmlns="http://www.w3.org/1999/xhtml">Run the console app and note the statistics, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1904.1" xmlns="http://www.w3.org/1999/xhtml">BytesReceived: 3,888
BytesSent: 336
SelectRows: 77
ExecutionTime: 25
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-113"><span class="koboSpan" id="kobo.1905.1" xmlns="http://www.w3.org/1999/xhtml">Working with ADO.NET asynchronously</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1906.1" xmlns="http://www.w3.org/1999/xhtml">You can improve the</span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.1907.1" xmlns="http://www.w3.org/1999/xhtml"> responsiveness of data access code by making it asynchronous. </span><span class="koboSpan" id="kobo.1907.2" xmlns="http://www.w3.org/1999/xhtml">You will see more details of how asynchronous operations work in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1908.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 5</span></em><span class="koboSpan" id="kobo.1909.1" xmlns="http://www.w3.org/1999/xhtml">,</span><em class="chapterRef"> </em><em class="italic"><span class="koboSpan" id="kobo.1910.1" xmlns="http://www.w3.org/1999/xhtml">Multitasking and Concurrency</span></em><span class="koboSpan" id="kobo.1911.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1911.2" xmlns="http://www.w3.org/1999/xhtml">For now, just enter the code as instructed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1912.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see how to change the statements to work asynchronously:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1913.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1914.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1915.1" xmlns="http://www.w3.org/1999/xhtml">, change the statement to open the connection to make it asynchronous, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1916.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1917.1" xmlns="http://www.w3.org/1999/xhtml"> connection.Open</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1918.1" xmlns="http://www.w3.org/1999/xhtml">Async</span></strong></span><span class="koboSpan" id="kobo.1919.1" xmlns="http://www.w3.org/1999/xhtml">();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1920.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1921.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1922.1" xmlns="http://www.w3.org/1999/xhtml">, change the statement to execute the command to make it asynchronous, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1923.1" xmlns="http://www.w3.org/1999/xhtml">SqlDataReader r = </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1924.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1925.1" xmlns="http://www.w3.org/1999/xhtml"> cmd.ExecuteReader</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1926.1" xmlns="http://www.w3.org/1999/xhtml">Async</span></strong></span><span class="koboSpan" id="kobo.1927.1" xmlns="http://www.w3.org/1999/xhtml">();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1928.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1929.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1930.1" xmlns="http://www.w3.org/1999/xhtml">, change </span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.1931.1" xmlns="http://www.w3.org/1999/xhtml">the statements to read the next row and get the field values to make them asynchronous, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1932.1" xmlns="http://www.w3.org/1999/xhtml">while</span></span><span class="koboSpan" id="kobo.1933.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1934.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1935.1" xmlns="http://www.w3.org/1999/xhtml"> r.Read</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1936.1" xmlns="http://www.w3.org/1999/xhtml">Async</span></strong></span><span class="koboSpan" id="kobo.1937.1" xmlns="http://www.w3.org/1999/xhtml">())
{
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1938.1" xmlns="http://www.w3.org/1999/xhtml">"| {0,5} | {1,-35} | {2,8:C} |"</span></span><span class="koboSpan" id="kobo.1939.1" xmlns="http://www.w3.org/1999/xhtml">,
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1940.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1941.1" xmlns="http://www.w3.org/1999/xhtml"> r.Get</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1942.1" xmlns="http://www.w3.org/1999/xhtml">FieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1943.1" xmlns="http://www.w3.org/1999/xhtml">int</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1944.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span><span class="koboSpan" id="kobo.1945.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1946.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="koboSpan" id="kobo.1947.1" xmlns="http://www.w3.org/1999/xhtml">),
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1948.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1949.1" xmlns="http://www.w3.org/1999/xhtml"> r.Get</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1950.1" xmlns="http://www.w3.org/1999/xhtml">FieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1951.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1952.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span><span class="koboSpan" id="kobo.1953.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1954.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="koboSpan" id="kobo.1955.1" xmlns="http://www.w3.org/1999/xhtml">),
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1956.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1957.1" xmlns="http://www.w3.org/1999/xhtml"> r.Get</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1958.1" xmlns="http://www.w3.org/1999/xhtml">FieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1959.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1960.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span><span class="koboSpan" id="kobo.1961.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1962.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="koboSpan" id="kobo.1963.1" xmlns="http://www.w3.org/1999/xhtml">));
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1964.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1965.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1966.1" xmlns="http://www.w3.org/1999/xhtml">, change the statements to close the data reader and connection to make them asynchronous, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1967.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1968.1" xmlns="http://www.w3.org/1999/xhtml"> r.Close</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1969.1" xmlns="http://www.w3.org/1999/xhtml">Async</span></strong></span><span class="koboSpan" id="kobo.1970.1" xmlns="http://www.w3.org/1999/xhtml">();
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1971.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong></span><span class="koboSpan" id="kobo.1972.1" xmlns="http://www.w3.org/1999/xhtml"> connection.Close</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1973.1" xmlns="http://www.w3.org/1999/xhtml">Async</span></strong></span><span class="koboSpan" id="kobo.1974.1" xmlns="http://www.w3.org/1999/xhtml">();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1975.1" xmlns="http://www.w3.org/1999/xhtml">Run the console app and confirm that it has the same results as before, but it would run better in a multithreaded system, for example, not blocking the user interface in a GUI app, and not blocking I/O threads in a website.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-114"><span class="koboSpan" id="kobo.1976.1" xmlns="http://www.w3.org/1999/xhtml">Executing stored procedures using ADO.NET</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1977.1" xmlns="http://www.w3.org/1999/xhtml">If you </span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.1978.1" xmlns="http://www.w3.org/1999/xhtml">need to execute the same query or another SQL statement multiple times, it is best to create a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1979.1" xmlns="http://www.w3.org/1999/xhtml">stored procedure</span></strong><span class="koboSpan" id="kobo.1980.1" xmlns="http://www.w3.org/1999/xhtml">, often with parameters, so that it can be precompiled and optimized. </span><span class="koboSpan" id="kobo.1980.2" xmlns="http://www.w3.org/1999/xhtml">Stored procedure parameters have a direction to indicate if they are inputs, outputs, or return values.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1981.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see an example that uses all three types of parameter direction. </span><span class="koboSpan" id="kobo.1981.2" xmlns="http://www.w3.org/1999/xhtml">First, we will create the stored procedure in the database:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1982.1" xmlns="http://www.w3.org/1999/xhtml">In your preferred database tool, connect to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1983.1" xmlns="http://www.w3.org/1999/xhtml">Northwind</span></code><span class="koboSpan" id="kobo.1984.1" xmlns="http://www.w3.org/1999/xhtml"> database.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1985.1" xmlns="http://www.w3.org/1999/xhtml">In your preferred database tool, add a new stored procedure:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1986.1" xmlns="http://www.w3.org/1999/xhtml">If you are using </span><strong class="screenText"><span class="koboSpan" id="kobo.1987.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Management Studio</span></strong><span class="koboSpan" id="kobo.1988.1" xmlns="http://www.w3.org/1999/xhtml">, then in </span><strong class="screenText"><span class="koboSpan" id="kobo.1989.1" xmlns="http://www.w3.org/1999/xhtml">Object Explorer</span></strong><span class="koboSpan" id="kobo.1990.1" xmlns="http://www.w3.org/1999/xhtml">, navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.1991.1" xmlns="http://www.w3.org/1999/xhtml">Databases</span></strong><span class="koboSpan" id="kobo.1992.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.1993.1" xmlns="http://www.w3.org/1999/xhtml">Northwind</span></strong><span class="koboSpan" id="kobo.1994.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.1995.1" xmlns="http://www.w3.org/1999/xhtml">Programmability</span></strong><span class="koboSpan" id="kobo.1996.1" xmlns="http://www.w3.org/1999/xhtml">, right-click </span><strong class="screenText"><span class="koboSpan" id="kobo.1997.1" xmlns="http://www.w3.org/1999/xhtml">Stored Procedures</span></strong><span class="koboSpan" id="kobo.1998.1" xmlns="http://www.w3.org/1999/xhtml">, and select </span><strong class="screenText"><span class="koboSpan" id="kobo.1999.1" xmlns="http://www.w3.org/1999/xhtml">New</span></strong><span class="koboSpan" id="kobo.2000.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.2001.1" xmlns="http://www.w3.org/1999/xhtml">Stored Procedure</span></strong><span class="koboSpan" id="kobo.2002.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2003.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, then in </span><strong class="screenText"><span class="koboSpan" id="kobo.2004.1" xmlns="http://www.w3.org/1999/xhtml">Server Explorer</span></strong><span class="koboSpan" id="kobo.2005.1" xmlns="http://www.w3.org/1999/xhtml">, right-click </span><strong class="screenText"><span class="koboSpan" id="kobo.2006.1" xmlns="http://www.w3.org/1999/xhtml">Stored Procedures</span></strong><span class="koboSpan" id="kobo.2007.1" xmlns="http://www.w3.org/1999/xhtml"> and select </span><strong class="screenText"><span class="koboSpan" id="kobo.2008.1" xmlns="http://www.w3.org/1999/xhtml">Add New Stored Procedure</span></strong><span class="koboSpan" id="kobo.2009.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2010.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, then in </span><strong class="screenText"><span class="koboSpan" id="kobo.2011.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server</span></strong><span class="koboSpan" id="kobo.2012.1" xmlns="http://www.w3.org/1999/xhtml">, right-click your connection profile and select </span><strong class="screenText"><span class="koboSpan" id="kobo.2013.1" xmlns="http://www.w3.org/1999/xhtml">New Query</span></strong><span class="koboSpan" id="kobo.2014.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2015.1" xmlns="http://www.w3.org/1999/xhtml">If you are using JetBrains Rider, then in the </span><strong class="screenText"><span class="koboSpan" id="kobo.2016.1" xmlns="http://www.w3.org/1999/xhtml">Database</span></strong><span class="koboSpan" id="kobo.2017.1" xmlns="http://www.w3.org/1999/xhtml"> toolbar, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.2018.1" xmlns="http://www.w3.org/1999/xhtml">Jump to Query Console…</span></strong><span class="koboSpan" id="kobo.2019.1" xmlns="http://www.w3.org/1999/xhtml"> button, and then remove any existing statements. </span><span class="koboSpan" id="kobo.2019.2" xmlns="http://www.w3.org/1999/xhtml">As well as the following SQL statements, start with a command to set the active database to Northwind: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2020.1" xmlns="http://www.w3.org/1999/xhtml">USE Northwind GO</span></code><span class="koboSpan" id="kobo.2021.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2021.2" xmlns="http://www.w3.org/1999/xhtml">This should prevent JetBrains Rider from creating the stored procedure in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2022.1" xmlns="http://www.w3.org/1999/xhtml">master</span></code><span class="koboSpan" id="kobo.2023.1" xmlns="http://www.w3.org/1999/xhtml"> database!</span></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2024.1" xmlns="http://www.w3.org/1999/xhtml">Modify </span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.2025.1" xmlns="http://www.w3.org/1999/xhtml">the SQL statements to define a stored procedure named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2026.1" xmlns="http://www.w3.org/1999/xhtml">GetExpensiveProducts</span></code><span class="koboSpan" id="kobo.2027.1" xmlns="http://www.w3.org/1999/xhtml"> with two parameters, an input parameter for the minimum unit price and an output parameter for the row count of matching products, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2028.1" xmlns="http://www.w3.org/1999/xhtml">CREATE</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2029.1" xmlns="http://www.w3.org/1999/xhtml">PROCEDURE</span></span><span class="koboSpan" id="kobo.2030.1" xmlns="http://www.w3.org/1999/xhtml"> [dbo].[GetExpensiveProducts]
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.2031.1" xmlns="http://www.w3.org/1999/xhtml">@price</span></span><span class="koboSpan" id="kobo.2032.1" xmlns="http://www.w3.org/1999/xhtml"> money,
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.2033.1" xmlns="http://www.w3.org/1999/xhtml">@count</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2034.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2035.1" xmlns="http://www.w3.org/1999/xhtml">OUT</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2036.1" xmlns="http://www.w3.org/1999/xhtml">AS</span></span><span class="koboSpan" id="kobo.2037.1" xmlns="http://www.w3.org/1999/xhtml">
  PRINT </span><span class="hljs-string"><span class="koboSpan" id="kobo.2038.1" xmlns="http://www.w3.org/1999/xhtml">'Getting expensive products: '</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.2039.1" xmlns="http://www.w3.org/1999/xhtml">+</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.2040.1" xmlns="http://www.w3.org/1999/xhtml">TRIM</span></span><span class="koboSpan" id="kobo.2041.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2042.1" xmlns="http://www.w3.org/1999/xhtml">CAST</span></span><span class="koboSpan" id="kobo.2043.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.2044.1" xmlns="http://www.w3.org/1999/xhtml">@price</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2045.1" xmlns="http://www.w3.org/1999/xhtml">AS</span></span><span class="koboSpan" id="kobo.2046.1" xmlns="http://www.w3.org/1999/xhtml"> NVARCHAR(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2047.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span><span class="koboSpan" id="kobo.2048.1" xmlns="http://www.w3.org/1999/xhtml">)))
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2049.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2050.1" xmlns="http://www.w3.org/1999/xhtml">@count</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.2051.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2052.1" xmlns="http://www.w3.org/1999/xhtml">COUNT</span></span><span class="koboSpan" id="kobo.2053.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-operator"><span class="koboSpan" id="kobo.2054.1" xmlns="http://www.w3.org/1999/xhtml">*</span></span><span class="koboSpan" id="kobo.2055.1" xmlns="http://www.w3.org/1999/xhtml">)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2056.1" xmlns="http://www.w3.org/1999/xhtml">FROM</span></span><span class="koboSpan" id="kobo.2057.1" xmlns="http://www.w3.org/1999/xhtml"> Products
	</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2058.1" xmlns="http://www.w3.org/1999/xhtml">WHERE</span></span><span class="koboSpan" id="kobo.2059.1" xmlns="http://www.w3.org/1999/xhtml"> UnitPrice </span><span class="hljs-operator"><span class="koboSpan" id="kobo.2060.1" xmlns="http://www.w3.org/1999/xhtml">&gt;=</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2061.1" xmlns="http://www.w3.org/1999/xhtml">@price</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2062.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></span> <span class="hljs-operator"><span class="koboSpan" id="kobo.2063.1" xmlns="http://www.w3.org/1999/xhtml">*</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2064.1" xmlns="http://www.w3.org/1999/xhtml">FROM</span></span><span class="koboSpan" id="kobo.2065.1" xmlns="http://www.w3.org/1999/xhtml"> Products
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2066.1" xmlns="http://www.w3.org/1999/xhtml">WHERE</span></span><span class="koboSpan" id="kobo.2067.1" xmlns="http://www.w3.org/1999/xhtml"> UnitPrice </span><span class="hljs-operator"><span class="koboSpan" id="kobo.2068.1" xmlns="http://www.w3.org/1999/xhtml">&gt;=</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2069.1" xmlns="http://www.w3.org/1999/xhtml">@price</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2070.1" xmlns="http://www.w3.org/1999/xhtml">RETURN</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2071.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span>
</code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2072.1" xmlns="http://www.w3.org/1999/xhtml">The stored procedure uses two </span><code class="inlineCode"><span class="koboSpan" id="kobo.2073.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.2074.1" xmlns="http://www.w3.org/1999/xhtml"> statements. </span><span class="koboSpan" id="kobo.2074.2" xmlns="http://www.w3.org/1999/xhtml">The first sets the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2075.1" xmlns="http://www.w3.org/1999/xhtml">@count</span></code><span class="koboSpan" id="kobo.2076.1" xmlns="http://www.w3.org/1999/xhtml"> output parameter to a count of the matching product rows. </span><span class="koboSpan" id="kobo.2076.2" xmlns="http://www.w3.org/1999/xhtml">The second returns the matching product rows. </span><span class="koboSpan" id="kobo.2076.3" xmlns="http://www.w3.org/1999/xhtml">It also calls the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2077.1" xmlns="http://www.w3.org/1999/xhtml">PRINT</span></code><span class="koboSpan" id="kobo.2078.1" xmlns="http://www.w3.org/1999/xhtml"> command, which will raise the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2079.1" xmlns="http://www.w3.org/1999/xhtml">InfoMessage</span></code><span class="koboSpan" id="kobo.2080.1" xmlns="http://www.w3.org/1999/xhtml"> event.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.2081.1" xmlns="http://www.w3.org/1999/xhtml">Right-click </span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.2082.1" xmlns="http://www.w3.org/1999/xhtml">in the SQL statements and select </span><strong class="screenText"><span class="koboSpan" id="kobo.2083.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></strong><span class="koboSpan" id="kobo.2084.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><strong class="screenText"><span class="koboSpan" id="kobo.2085.1" xmlns="http://www.w3.org/1999/xhtml">Execute Query</span></strong><span class="koboSpan" id="kobo.2086.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2087.1" xmlns="http://www.w3.org/1999/xhtml">Right-click </span><strong class="screenText"><span class="koboSpan" id="kobo.2088.1" xmlns="http://www.w3.org/1999/xhtml">Stored Procedures</span></strong><span class="koboSpan" id="kobo.2089.1" xmlns="http://www.w3.org/1999/xhtml"> and select </span><strong class="screenText"><span class="koboSpan" id="kobo.2090.1" xmlns="http://www.w3.org/1999/xhtml">Refresh</span></strong><span class="koboSpan" id="kobo.2091.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2091.2" xmlns="http://www.w3.org/1999/xhtml">In JetBrains Rider, it is named </span><strong class="screenText"><span class="koboSpan" id="kobo.2092.1" xmlns="http://www.w3.org/1999/xhtml">routines</span></strong><span class="koboSpan" id="kobo.2093.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2094.1" xmlns="http://www.w3.org/1999/xhtml">Expand </span><strong class="screenText"><span class="koboSpan" id="kobo.2095.1" xmlns="http://www.w3.org/1999/xhtml">GetExpensiveProducts</span></strong><span class="koboSpan" id="kobo.2096.1" xmlns="http://www.w3.org/1999/xhtml"> and note the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2097.1" xmlns="http://www.w3.org/1999/xhtml">@price money</span></code><span class="koboSpan" id="kobo.2098.1" xmlns="http://www.w3.org/1999/xhtml"> input, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2099.1" xmlns="http://www.w3.org/1999/xhtml">@count int</span></code><span class="koboSpan" id="kobo.2100.1" xmlns="http://www.w3.org/1999/xhtml"> input/output, and return value parameters, as shown in </span><strong class="screenText"><span class="koboSpan" id="kobo.2101.1" xmlns="http://www.w3.org/1999/xhtml">SQL Server Management Studio</span></strong><span class="koboSpan" id="kobo.2102.1" xmlns="http://www.w3.org/1999/xhtml"> in </span><em class="italic"><span class="koboSpan" id="kobo.2103.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.13</span></em><span class="koboSpan" id="kobo.2104.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2105.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2106.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.13: Parameters of the GetExpensiveProducts stored procedure </span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.2107.1" xmlns="http://www.w3.org/1999/xhtml">Close the SQL query without saving changes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2108.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2109.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2110.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to allow the user to choose between running the text command and the stored procedure. </span><span class="koboSpan" id="kobo.2110.2" xmlns="http://www.w3.org/1999/xhtml">Add statements defining the stored procedure and its parameters, and then execute the command, as shown </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.2111.1" xmlns="http://www.w3.org/1999/xhtml">highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2112.1" xmlns="http://www.w3.org/1999/xhtml">SqlCommand cmd = connection.CreateCommand();
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2113.1" xmlns="http://www.w3.org/1999/xhtml">WriteLine(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2114.1" xmlns="http://www.w3.org/1999/xhtml">"Execute command using:"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2115.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2116.1" xmlns="http://www.w3.org/1999/xhtml">WriteLine(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2117.1" xmlns="http://www.w3.org/1999/xhtml">"  1 - Text"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2118.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2119.1" xmlns="http://www.w3.org/1999/xhtml">WriteLine(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2120.1" xmlns="http://www.w3.org/1999/xhtml">"  2 - Stored Procedure"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2121.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2122.1" xmlns="http://www.w3.org/1999/xhtml">WriteLine();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2123.1" xmlns="http://www.w3.org/1999/xhtml">Write(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2124.1" xmlns="http://www.w3.org/1999/xhtml">"Press a key: "</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2125.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2126.1" xmlns="http://www.w3.org/1999/xhtml">key = ReadKey().Key;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2127.1" xmlns="http://www.w3.org/1999/xhtml">WriteLine(); WriteLine();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2128.1" xmlns="http://www.w3.org/1999/xhtml">SqlParameter p1, p2 = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2129.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2130.1" xmlns="http://www.w3.org/1999/xhtml">(), p3 = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2131.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2132.1" xmlns="http://www.w3.org/1999/xhtml">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2133.1" xmlns="http://www.w3.org/1999/xhtml">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2134.1" xmlns="http://www.w3.org/1999/xhtml"> (key </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2135.1" xmlns="http://www.w3.org/1999/xhtml">is</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2136.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D1 </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2137.1" xmlns="http://www.w3.org/1999/xhtml">or</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2138.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad1)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2139.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span><span class="koboSpan" id="kobo.2140.1" xmlns="http://www.w3.org/1999/xhtml">
  cmd.CommandType = CommandType.Text;
  cmd.CommandText = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2141.1" xmlns="http://www.w3.org/1999/xhtml">"SELECT ProductId, ProductName, UnitPrice FROM Products"</span></span><span class="koboSpan" id="kobo.2142.1" xmlns="http://www.w3.org/1999/xhtml">
    + </span><span class="hljs-string"><span class="koboSpan" id="kobo.2143.1" xmlns="http://www.w3.org/1999/xhtml">" WHERE UnitPrice &gt;= @minimumPrice"</span></span><span class="koboSpan" id="kobo.2144.1" xmlns="http://www.w3.org/1999/xhtml">;
  cmd.Parameters.AddWithValue(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2145.1" xmlns="http://www.w3.org/1999/xhtml">"minimumPrice"</span></span><span class="koboSpan" id="kobo.2146.1" xmlns="http://www.w3.org/1999/xhtml">, price);
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2147.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2148.1" xmlns="http://www.w3.org/1999/xhtml">else</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2149.1" xmlns="http://www.w3.org/1999/xhtml">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2150.1" xmlns="http://www.w3.org/1999/xhtml"> (key </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2151.1" xmlns="http://www.w3.org/1999/xhtml">is</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2152.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D2 </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2153.1" xmlns="http://www.w3.org/1999/xhtml">or</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2154.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad2)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2155.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2156.1" xmlns="http://www.w3.org/1999/xhtml">  cmd.CommandType = CommandType.StoredProcedure;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2157.1" xmlns="http://www.w3.org/1999/xhtml">  cmd.CommandText = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2158.1" xmlns="http://www.w3.org/1999/xhtml">"GetExpensiveProducts"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2159.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2160.1" xmlns="http://www.w3.org/1999/xhtml">  p1 = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2161.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2162.1" xmlns="http://www.w3.org/1999/xhtml">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2163.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2164.1" xmlns="http://www.w3.org/1999/xhtml">    ParameterName = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2165.1" xmlns="http://www.w3.org/1999/xhtml">"price"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2166.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2167.1" xmlns="http://www.w3.org/1999/xhtml">    SqlDbType = SqlDbType.Money,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2168.1" xmlns="http://www.w3.org/1999/xhtml">    SqlValue = price</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2169.1" xmlns="http://www.w3.org/1999/xhtml">  };</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2170.1" xmlns="http://www.w3.org/1999/xhtml">  p2 = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2171.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2172.1" xmlns="http://www.w3.org/1999/xhtml">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2173.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2174.1" xmlns="http://www.w3.org/1999/xhtml">    Direction = ParameterDirection.Output,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2175.1" xmlns="http://www.w3.org/1999/xhtml">    ParameterName = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2176.1" xmlns="http://www.w3.org/1999/xhtml">"count"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2177.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2178.1" xmlns="http://www.w3.org/1999/xhtml">    SqlDbType = SqlDbType.Int</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2179.1" xmlns="http://www.w3.org/1999/xhtml">  };</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2180.1" xmlns="http://www.w3.org/1999/xhtml">  p3 = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2181.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2182.1" xmlns="http://www.w3.org/1999/xhtml">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2183.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2184.1" xmlns="http://www.w3.org/1999/xhtml">    Direction= ParameterDirection.ReturnValue,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2185.1" xmlns="http://www.w3.org/1999/xhtml">    ParameterName = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2186.1" xmlns="http://www.w3.org/1999/xhtml">"rv"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2187.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2188.1" xmlns="http://www.w3.org/1999/xhtml">    SqlDbType = SqlDbType.Int</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2189.1" xmlns="http://www.w3.org/1999/xhtml">  };</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2190.1" xmlns="http://www.w3.org/1999/xhtml">  cmd.Parameters.AddRange(</span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2191.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2192.1" xmlns="http://www.w3.org/1999/xhtml">[] { p1, p2, p3 });</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2193.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span><span class="koboSpan" id="kobo.2194.1" xmlns="http://www.w3.org/1999/xhtml">
SqlDataReader r = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2195.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2196.1" xmlns="http://www.w3.org/1999/xhtml"> cmd.ExecuteReaderAsync();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2197.1" xmlns="http://www.w3.org/1999/xhtml">After</span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.2198.1" xmlns="http://www.w3.org/1999/xhtml"> the statement that closes the data reader, add statements to output the output parameter and the return value, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2199.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2200.1" xmlns="http://www.w3.org/1999/xhtml"> r.CloseAsync();
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2201.1" xmlns="http://www.w3.org/1999/xhtml">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2202.1" xmlns="http://www.w3.org/1999/xhtml"> (key </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2203.1" xmlns="http://www.w3.org/1999/xhtml">is</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2204.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.D2 </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2205.1" xmlns="http://www.w3.org/1999/xhtml">or</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2206.1" xmlns="http://www.w3.org/1999/xhtml"> ConsoleKey.NumPad2)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2207.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2208.1" xmlns="http://www.w3.org/1999/xhtml">  WriteLine(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2209.1" xmlns="http://www.w3.org/1999/xhtml">$"Output count: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.2210.1" xmlns="http://www.w3.org/1999/xhtml">{p2.Value}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2211.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2212.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2213.1" xmlns="http://www.w3.org/1999/xhtml">  WriteLine(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2214.1" xmlns="http://www.w3.org/1999/xhtml">$"Return value: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.2215.1" xmlns="http://www.w3.org/1999/xhtml">{p3.Value}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2216.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2217.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2218.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2219.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2220.1" xmlns="http://www.w3.org/1999/xhtml"> connection.CloseAsync();
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2221.1" xmlns="http://www.w3.org/1999/xhtml">If a stored procedure returns result sets as well as parameters, then the data reader for the result sets must be closed before the parameters can be read.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.2222.1" xmlns="http://www.w3.org/1999/xhtml">Run the console app and note the results if the price entered is </span><code class="inlineCode"><span class="koboSpan" id="kobo.2223.1" xmlns="http://www.w3.org/1999/xhtml">60</span></code><span class="koboSpan" id="kobo.2224.1" xmlns="http://www.w3.org/1999/xhtml">, and note the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2225.1" xmlns="http://www.w3.org/1999/xhtml">InfoMessage</span></code><span class="koboSpan" id="kobo.2226.1" xmlns="http://www.w3.org/1999/xhtml"> event handler writes a message in dark blue, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2227.1" xmlns="http://www.w3.org/1999/xhtml">Enter a unit price: 60
Execute command using:
  1 - Text
  2 - Stored Procedure
Press a key: 2
Info: Getting expensive products: 60.00.
</span><span class="koboSpan" id="kobo.2227.2" xmlns="http://www.w3.org/1999/xhtml">----------------------------------------------------------
|    Id | Name                                |    Price |
----------------------------------------------------------
|     9 | Mishi Kobe Niku                     |   $97.00 |
|    18 | Carnarvon Tigers                    |   $62.50 |
|    20 | Sir Rodney's Marmalade              |   $81.00 |
|    29 | Thüringer Rostbratwurst             |  $123.79 |
|    38 | Côte de Blaye                       |  $263.50 |
----------------------------------------------------------
Output count: 5
Return value: 0
State change from Open to Closed.
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-115"><span class="koboSpan" id="kobo.2228.1" xmlns="http://www.w3.org/1999/xhtml">Outputting streams with a data reader</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2229.1" xmlns="http://www.w3.org/1999/xhtml">In a real app or</span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.2230.1" xmlns="http://www.w3.org/1999/xhtml"> service, we would likely not output to the console. </span><span class="koboSpan" id="kobo.2230.2" xmlns="http://www.w3.org/1999/xhtml">More likely, as we read each row with a data reader, we might output to a stream that writes HTML tags inside a web page, or text formats like XML and JSON for returning data from a service.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2231.1" xmlns="http://www.w3.org/1999/xhtml">Let’s add the ability to generate a JSON file:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2232.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2233.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2234.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for working efficiently with JSON and to statically import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2235.1" xmlns="http://www.w3.org/1999/xhtml">Environment</span></code><span class="koboSpan" id="kobo.2236.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2237.1" xmlns="http://www.w3.org/1999/xhtml">Path</span></code><span class="koboSpan" id="kobo.2238.1" xmlns="http://www.w3.org/1999/xhtml"> classes, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2239.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2240.1" xmlns="http://www.w3.org/1999/xhtml"> System.Text.Json; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2241.1" xmlns="http://www.w3.org/1999/xhtml">// To use Utf8JsonWriter, JsonSerializer.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2242.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2243.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="koboSpan" id="kobo.2244.1" xmlns="http://www.w3.org/1999/xhtml"> System.Environment;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2245.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2246.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="koboSpan" id="kobo.2247.1" xmlns="http://www.w3.org/1999/xhtml"> System.IO.Path;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2248.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2249.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2250.1" xmlns="http://www.w3.org/1999/xhtml">, before the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2251.1" xmlns="http://www.w3.org/1999/xhtml">while</span></code><span class="koboSpan" id="kobo.2252.1" xmlns="http://www.w3.org/1999/xhtml"> statement that processes the data reader, add statements to define a file path for a JSON file, create a file stream, and start a JSON array, then in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2253.1" xmlns="http://www.w3.org/1999/xhtml">while</span></code><span class="koboSpan" id="kobo.2254.1" xmlns="http://www.w3.org/1999/xhtml"> block, write a JSON object that represents each product row, and finally, end the array and close the stream, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2255.1" xmlns="http://www.w3.org/1999/xhtml">// Define a file path to write to.</span></strong></span>
<span class="code-highlight"><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2256.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2257.1" xmlns="http://www.w3.org/1999/xhtml"> jsonPath = Combine(CurrentDirectory, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2258.1" xmlns="http://www.w3.org/1999/xhtml">"products.json"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2259.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2260.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2261.1" xmlns="http://www.w3.org/1999/xhtml">using</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2262.1" xmlns="http://www.w3.org/1999/xhtml"> (FileStream jsonStream = File.Create(jsonPath))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2263.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2264.1" xmlns="http://www.w3.org/1999/xhtml">  Utf8JsonWriter jsonWriter = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2265.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2266.1" xmlns="http://www.w3.org/1999/xhtml">(jsonStream);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2267.1" xmlns="http://www.w3.org/1999/xhtml">  jsonWriter.WriteStartArray();</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2268.1" xmlns="http://www.w3.org/1999/xhtml">while</span></span><span class="koboSpan" id="kobo.2269.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2270.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2271.1" xmlns="http://www.w3.org/1999/xhtml"> r.ReadAsync())
  {
    WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2272.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2273.1" xmlns="http://www.w3.org/1999/xhtml">| {0,5} | {1,-35} | {2,10:C} |"</span></span><span class="koboSpan" id="kobo.2274.1" xmlns="http://www.w3.org/1999/xhtml">,
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2275.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2276.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2277.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.2278.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2279.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="koboSpan" id="kobo.2280.1" xmlns="http://www.w3.org/1999/xhtml">),
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2281.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2282.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2283.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2284.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2285.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="koboSpan" id="kobo.2286.1" xmlns="http://www.w3.org/1999/xhtml">),
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2287.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2288.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2289.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2290.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2291.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="koboSpan" id="kobo.2292.1" xmlns="http://www.w3.org/1999/xhtml">));
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2293.1" xmlns="http://www.w3.org/1999/xhtml">    jsonWriter.WriteStartObject();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2294.1" xmlns="http://www.w3.org/1999/xhtml">    jsonWriter.WriteNumber(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2295.1" xmlns="http://www.w3.org/1999/xhtml">"productId"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2296.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2297.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2298.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2299.1" xmlns="http://www.w3.org/1999/xhtml">int</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2300.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2301.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2302.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2303.1" xmlns="http://www.w3.org/1999/xhtml">    jsonWriter.WriteString(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2304.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2305.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2306.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2307.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2308.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2309.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2310.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2311.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2312.1" xmlns="http://www.w3.org/1999/xhtml">    jsonWriter.WriteNumber(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2313.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2314.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2315.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2316.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2317.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2318.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2319.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2320.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2321.1" xmlns="http://www.w3.org/1999/xhtml">    jsonWriter.WriteEndObject();</span></strong></span><span class="koboSpan" id="kobo.2322.1" xmlns="http://www.w3.org/1999/xhtml">
  }
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2323.1" xmlns="http://www.w3.org/1999/xhtml">  jsonWriter.WriteEndArray();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2324.1" xmlns="http://www.w3.org/1999/xhtml">  jsonWriter.Flush();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2325.1" xmlns="http://www.w3.org/1999/xhtml">  jsonStream.Close();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2326.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2327.1" xmlns="http://www.w3.org/1999/xhtml">WriteLineInColor(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2328.1" xmlns="http://www.w3.org/1999/xhtml">$"Written to: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.2329.1" xmlns="http://www.w3.org/1999/xhtml">{jsonPath}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2330.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2331.1" xmlns="http://www.w3.org/1999/xhtml">, ConsoleColor.DarkGreen);</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2332.1" xmlns="http://www.w3.org/1999/xhtml">Run </span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.2333.1" xmlns="http://www.w3.org/1999/xhtml">the console app, enter a price of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2334.1" xmlns="http://www.w3.org/1999/xhtml">60</span></code><span class="koboSpan" id="kobo.2335.1" xmlns="http://www.w3.org/1999/xhtml">, and note the path to the JSON file, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2336.1" xmlns="http://www.w3.org/1999/xhtml">Written to: C:\apps-services-net8\Chapter02\Northwind.Console.SqlClient\bin\Debug\net8.0\products.json
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2337.1" xmlns="http://www.w3.org/1999/xhtml">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2338.1" xmlns="http://www.w3.org/1999/xhtml">products.json</span></code><span class="koboSpan" id="kobo.2339.1" xmlns="http://www.w3.org/1999/xhtml"> file and note that the JSON is written with no whitespace, so it all appears on one line, as shown in the following file:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2340.1" xmlns="http://www.w3.org/1999/xhtml">[{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2341.1" xmlns="http://www.w3.org/1999/xhtml">"productId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2342.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2343.1" xmlns="http://www.w3.org/1999/xhtml">9</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2344.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2345.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2346.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2347.1" xmlns="http://www.w3.org/1999/xhtml">"Mishi Kobe Niku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2348.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2349.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2350.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2351.1" xmlns="http://www.w3.org/1999/xhtml">97.0000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2352.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2353.1" xmlns="http://www.w3.org/1999/xhtml">"productId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2354.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2355.1" xmlns="http://www.w3.org/1999/xhtml">18</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2356.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2357.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2358.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2359.1" xmlns="http://www.w3.org/1999/xhtml">"Carnarvon Tigers"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2360.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2361.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2362.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2363.1" xmlns="http://www.w3.org/1999/xhtml">62.5000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2364.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2365.1" xmlns="http://www.w3.org/1999/xhtml">"productId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2366.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2367.1" xmlns="http://www.w3.org/1999/xhtml">20</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2368.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2369.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2370.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2371.1" xmlns="http://www.w3.org/1999/xhtml">"Sir Rodney\u0027s Marmalade"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2372.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2373.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2374.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2375.1" xmlns="http://www.w3.org/1999/xhtml">81.0000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2376.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2377.1" xmlns="http://www.w3.org/1999/xhtml">"productId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2378.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2379.1" xmlns="http://www.w3.org/1999/xhtml">29</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2380.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2381.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2382.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2383.1" xmlns="http://www.w3.org/1999/xhtml">"Th\u00FCringer Rostbratwurst"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2384.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2385.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2386.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2387.1" xmlns="http://www.w3.org/1999/xhtml">123.7900</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2388.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2389.1" xmlns="http://www.w3.org/1999/xhtml">"productId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2390.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2391.1" xmlns="http://www.w3.org/1999/xhtml">38</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2392.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2393.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2394.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2395.1" xmlns="http://www.w3.org/1999/xhtml">"C\u00F4te de Blaye"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2396.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2397.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2398.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2399.1" xmlns="http://www.w3.org/1999/xhtml">263.5000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2400.1" xmlns="http://www.w3.org/1999/xhtml">}]</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2401.1" xmlns="http://www.w3.org/1999/xhtml">If you </span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.2402.1" xmlns="http://www.w3.org/1999/xhtml">are using Visual Studio 2022, then you can right-click and select </span><strong class="screenText"><span class="koboSpan" id="kobo.2403.1" xmlns="http://www.w3.org/1999/xhtml">Format Document</span></strong><span class="koboSpan" id="kobo.2404.1" xmlns="http://www.w3.org/1999/xhtml">, and note that it is now easier to read, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2405.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.14</span></em><span class="koboSpan" id="kobo.2406.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2407.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_02_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2408.1" xmlns="http://www.w3.org/1999/xhtml">Figure 2.14: The products.json file generated from a data reader</span></p>
<h2 class="heading-2" id="_idParaDest-116"><span class="koboSpan" id="kobo.2409.1" xmlns="http://www.w3.org/1999/xhtml">Generating objects with a data reader</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2410.1" xmlns="http://www.w3.org/1999/xhtml">For </span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.2411.1" xmlns="http://www.w3.org/1999/xhtml">maximum flexibility, we likely want to convert the rows in a data reader into object instances stored in an array or collection. </span><span class="koboSpan" id="kobo.2411.2" xmlns="http://www.w3.org/1999/xhtml">After that, we could serialize the object graph however we want. </span><span class="koboSpan" id="kobo.2411.3" xmlns="http://www.w3.org/1999/xhtml">ADO.NET does not have a built-in ability to map a data reader row to an object, so we will have to do it manually.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2412.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see an example:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2413.1" xmlns="http://www.w3.org/1999/xhtml">Add a </span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.2414.1" xmlns="http://www.w3.org/1999/xhtml">new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2415.1" xmlns="http://www.w3.org/1999/xhtml">Product.cs</span></code><span class="koboSpan" id="kobo.2416.1" xmlns="http://www.w3.org/1999/xhtml">, and modify its contents to define a class to represent just the three columns we want from each row in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2417.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></code><span class="koboSpan" id="kobo.2418.1" xmlns="http://www.w3.org/1999/xhtml"> table, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2419.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2420.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Models</span></span><span class="koboSpan" id="kobo.2421.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2422.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2423.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2424.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></span><span class="koboSpan" id="kobo.2425.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2426.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2427.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.2428.1" xmlns="http://www.w3.org/1999/xhtml"> ProductId { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2429.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.2430.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2431.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.2432.1" xmlns="http://www.w3.org/1999/xhtml">; }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2433.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2434.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2435.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.2435.2" xmlns="http://www.w3.org/1999/xhtml">ProductName { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2436.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.2437.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2438.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.2439.1" xmlns="http://www.w3.org/1999/xhtml">; }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2440.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2441.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2442.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.2442.2" xmlns="http://www.w3.org/1999/xhtml">UnitPrice { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2443.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.2444.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2445.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.2446.1" xmlns="http://www.w3.org/1999/xhtml">; }
}
</span></code></pre>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2447.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.2448.1" xmlns="http://www.w3.org/1999/xhtml">: In this task, we will use this type only for read-only instances, so we could have used an immutable </span><code class="inlineCode"><span class="koboSpan" id="kobo.2449.1" xmlns="http://www.w3.org/1999/xhtml">record</span></code><span class="koboSpan" id="kobo.2450.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2450.2" xmlns="http://www.w3.org/1999/xhtml">But later we will need to change property values after the object is created, so we have to define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2451.1" xmlns="http://www.w3.org/1999/xhtml">class</span></code><span class="koboSpan" id="kobo.2452.1" xmlns="http://www.w3.org/1999/xhtml"> instead.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.2453.1" xmlns="http://www.w3.org/1999/xhtml">At the top of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2454.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2455.1" xmlns="http://www.w3.org/1999/xhtml">, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2456.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Models</span></code><span class="koboSpan" id="kobo.2457.1" xmlns="http://www.w3.org/1999/xhtml"> namespace so we can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2458.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.2459.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2460.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2461.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2462.1" xmlns="http://www.w3.org/1999/xhtml">, before creating the file stream, instantiate a list of products with an initial storage for 77 items (but this is not a limit) because when first created the Northwind database has 77 products, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2463.1" xmlns="http://www.w3.org/1999/xhtml">List&lt;Product&gt; products = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2464.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2465.1" xmlns="http://www.w3.org/1999/xhtml">(capacity: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2466.1" xmlns="http://www.w3.org/1999/xhtml">77</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2467.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2468.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2469.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2470.1" xmlns="http://www.w3.org/1999/xhtml"> (FileStream jsonStream = File.Create(jsonPath))
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2471.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2472.1" xmlns="http://www.w3.org/1999/xhtml">while</span></code><span class="koboSpan" id="kobo.2473.1" xmlns="http://www.w3.org/1999/xhtml"> block, add statements to instantiate the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2474.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.2475.1" xmlns="http://www.w3.org/1999/xhtml"> type per row in the data reader and add it to the list, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2476.1" xmlns="http://www.w3.org/1999/xhtml">while</span></span><span class="koboSpan" id="kobo.2477.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2478.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2479.1" xmlns="http://www.w3.org/1999/xhtml"> r.ReadAsync())
{
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2480.1" xmlns="http://www.w3.org/1999/xhtml">  Product product = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2481.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2482.1" xmlns="http://www.w3.org/1999/xhtml">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2483.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2484.1" xmlns="http://www.w3.org/1999/xhtml">    ProductId = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2485.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2486.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2487.1" xmlns="http://www.w3.org/1999/xhtml">int</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2488.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2489.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2490.1" xmlns="http://www.w3.org/1999/xhtml">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2491.1" xmlns="http://www.w3.org/1999/xhtml">    ProductName = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2492.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2493.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2494.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2495.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2496.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2497.1" xmlns="http://www.w3.org/1999/xhtml">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2498.1" xmlns="http://www.w3.org/1999/xhtml">    UnitPrice = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2499.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2500.1" xmlns="http://www.w3.org/1999/xhtml"> r.GetFieldValueAsync&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2501.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2502.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2503.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2504.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2505.1" xmlns="http://www.w3.org/1999/xhtml">  };</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2506.1" xmlns="http://www.w3.org/1999/xhtml">  products.Add(product);</span></strong></span><span class="koboSpan" id="kobo.2507.1" xmlns="http://www.w3.org/1999/xhtml">
  ...
</span><span class="koboSpan" id="kobo.2507.2" xmlns="http://www.w3.org/1999/xhtml">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2508.1" xmlns="http://www.w3.org/1999/xhtml">Before </span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.2509.1" xmlns="http://www.w3.org/1999/xhtml">closing the data reader, add a statement to use the static </span><code class="inlineCode"><span class="koboSpan" id="kobo.2510.1" xmlns="http://www.w3.org/1999/xhtml">Serialize</span></code><span class="koboSpan" id="kobo.2511.1" xmlns="http://www.w3.org/1999/xhtml"> method of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2512.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializer</span></code><span class="koboSpan" id="kobo.2513.1" xmlns="http://www.w3.org/1999/xhtml"> class to write the list of products to the console, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2514.1" xmlns="http://www.w3.org/1999/xhtml">WriteLineInColor(JsonSerializer.Serialize(products),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2515.1" xmlns="http://www.w3.org/1999/xhtml">  ConsoleColor.Magenta);</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2516.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2517.1" xmlns="http://www.w3.org/1999/xhtml"> r.CloseAsync();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2518.1" xmlns="http://www.w3.org/1999/xhtml">Run the console app, enter a price of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2519.1" xmlns="http://www.w3.org/1999/xhtml">60</span></code><span class="koboSpan" id="kobo.2520.1" xmlns="http://www.w3.org/1999/xhtml">, and note the JSON generated from the list of products, as shown in the following output:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2521.1" xmlns="http://www.w3.org/1999/xhtml">Written to</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2522.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.2523.1" xmlns="http://www.w3.org/1999/xhtml"> C</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2524.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.2525.1" xmlns="http://www.w3.org/1999/xhtml">\apps-services-net8\Chapter02\Northwind.Console.SqlClient\bin\Debug\net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.2526.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.2527.1" xmlns="http://www.w3.org/1999/xhtml">\products.json
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2528.1" xmlns="http://www.w3.org/1999/xhtml">[{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2529.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2530.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2531.1" xmlns="http://www.w3.org/1999/xhtml">9</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2532.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2533.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2534.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2535.1" xmlns="http://www.w3.org/1999/xhtml">"Mishi Kobe Niku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2536.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2537.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2538.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2539.1" xmlns="http://www.w3.org/1999/xhtml">97.0000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2540.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2541.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2542.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2543.1" xmlns="http://www.w3.org/1999/xhtml">18</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2544.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2545.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2546.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2547.1" xmlns="http://www.w3.org/1999/xhtml">"Carnarvon Tigers"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2548.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2549.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2550.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2551.1" xmlns="http://www.w3.org/1999/xhtml">62.5000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2552.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2553.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2554.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2555.1" xmlns="http://www.w3.org/1999/xhtml">20</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2556.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2557.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2558.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2559.1" xmlns="http://www.w3.org/1999/xhtml">"Sir Rodney\u0027s Marmalade"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2560.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2561.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2562.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2563.1" xmlns="http://www.w3.org/1999/xhtml">81.0000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2564.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2565.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2566.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2567.1" xmlns="http://www.w3.org/1999/xhtml">29</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2568.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2569.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2570.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2571.1" xmlns="http://www.w3.org/1999/xhtml">"Th\u00FCringer Rostbratwurst"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2572.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2573.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2574.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2575.1" xmlns="http://www.w3.org/1999/xhtml">123.7900</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2576.1" xmlns="http://www.w3.org/1999/xhtml">},{</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2577.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2578.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2579.1" xmlns="http://www.w3.org/1999/xhtml">38</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2580.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2581.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2582.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2583.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2584.1" xmlns="http://www.w3.org/1999/xhtml">C\u00F4te de Blaye"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2585.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2586.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2587.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2588.1" xmlns="http://www.w3.org/1999/xhtml">263.5000</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2589.1" xmlns="http://www.w3.org/1999/xhtml">}]</span></span>
</code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2590.1" xmlns="http://www.w3.org/1999/xhtml">Instead of manually instantiating objects, to simplify even more, we can use a simple </span><strong class="keyWord"><span class="koboSpan" id="kobo.2591.1" xmlns="http://www.w3.org/1999/xhtml">object-relational mapper </span></strong><span class="koboSpan" id="kobo.2592.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.2593.1" xmlns="http://www.w3.org/1999/xhtml">ORM</span></strong><span class="koboSpan" id="kobo.2594.1" xmlns="http://www.w3.org/1999/xhtml">) like Dapper.</span></p>
<h1 class="heading-1" id="_idParaDest-117"><span class="koboSpan" id="kobo.2595.1" xmlns="http://www.w3.org/1999/xhtml">Managing data with Dapper</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2596.1" xmlns="http://www.w3.org/1999/xhtml">Dapper </span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.2597.1" xmlns="http://www.w3.org/1999/xhtml">uses ADO.NET underneath when working</span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.2598.1" xmlns="http://www.w3.org/1999/xhtml"> with SQL Server. </span><span class="koboSpan" id="kobo.2598.2" xmlns="http://www.w3.org/1999/xhtml">Because it is a higher-level technology, it is not as efficient as using ADO.NET directly, but it can be easier. </span><span class="koboSpan" id="kobo.2598.3" xmlns="http://www.w3.org/1999/xhtml">Dapper is an alternative ORM to EF Core. </span><span class="koboSpan" id="kobo.2598.4" xmlns="http://www.w3.org/1999/xhtml">It is more efficient because it extends the low-level ADO.NET </span><code class="inlineCode"><span class="koboSpan" id="kobo.2599.1" xmlns="http://www.w3.org/1999/xhtml">IDbConnection</span></code><span class="koboSpan" id="kobo.2600.1" xmlns="http://www.w3.org/1999/xhtml"> interface with very basic functionality without trying to be all things to all people.</span></p>
<h2 class="heading-2" id="_idParaDest-118"><span class="koboSpan" id="kobo.2601.1" xmlns="http://www.w3.org/1999/xhtml">Dapper connection extension methods</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2602.1" xmlns="http://www.w3.org/1999/xhtml">Dapper adds</span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.2603.1" xmlns="http://www.w3.org/1999/xhtml"> three extension methods to any class that implements </span><code class="inlineCode"><span class="koboSpan" id="kobo.2604.1" xmlns="http://www.w3.org/1999/xhtml">IDbConnection</span></code><span class="koboSpan" id="kobo.2605.1" xmlns="http://www.w3.org/1999/xhtml"> (like </span><code class="inlineCode"><span class="koboSpan" id="kobo.2606.1" xmlns="http://www.w3.org/1999/xhtml">SqlConnection</span></code><span class="koboSpan" id="kobo.2607.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.2607.2" xmlns="http://www.w3.org/1999/xhtml">They are </span><code class="inlineCode"><span class="koboSpan" id="kobo.2608.1" xmlns="http://www.w3.org/1999/xhtml">Query&lt;T&gt;</span></code><span class="koboSpan" id="kobo.2609.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2610.1" xmlns="http://www.w3.org/1999/xhtml">Query</span></code><span class="koboSpan" id="kobo.2611.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2612.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></code><span class="koboSpan" id="kobo.2613.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2613.2" xmlns="http://www.w3.org/1999/xhtml">Dapper will automatically open and close the associated connection as needed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2614.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2615.1" xmlns="http://www.w3.org/1999/xhtml">Query&lt;T&gt;</span></code><span class="koboSpan" id="kobo.2616.1" xmlns="http://www.w3.org/1999/xhtml"> extension method is the most used because it runs any specified SQL command and then returns the results as an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2617.1" xmlns="http://www.w3.org/1999/xhtml">IEnumerable&lt;T&gt;</span></code><span class="koboSpan" id="kobo.2618.1" xmlns="http://www.w3.org/1999/xhtml"> (a sequence of objects). </span><span class="koboSpan" id="kobo.2618.2" xmlns="http://www.w3.org/1999/xhtml">It is designed to run commands that retrieve data like </span><code class="inlineCode"><span class="koboSpan" id="kobo.2619.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.2620.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2620.2" xmlns="http://www.w3.org/1999/xhtml">It has several parameters, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2621.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.8</span></em><span class="koboSpan" id="kobo.2622.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table008">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2623.1" xmlns="http://www.w3.org/1999/xhtml">Parameter</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2624.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2625.1" xmlns="http://www.w3.org/1999/xhtml">string sql</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.2626.1" xmlns="http://www.w3.org/1999/xhtml">This is the only mandatory parameter. </span><span class="koboSpan" id="kobo.2626.2" xmlns="http://www.w3.org/1999/xhtml">It is either the text of a SQL command or the name of a stored procedure.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2627.1" xmlns="http://www.w3.org/1999/xhtml">object param = null</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.2628.1" xmlns="http://www.w3.org/1999/xhtml">A complex object for passing parameters used in the query. </span><span class="koboSpan" id="kobo.2628.2" xmlns="http://www.w3.org/1999/xhtml">This can be an anonymous type.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2629.1" xmlns="http://www.w3.org/1999/xhtml">IDbTransaction transaction = null</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.2630.1" xmlns="http://www.w3.org/1999/xhtml">To manage distributed transactions.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2631.1" xmlns="http://www.w3.org/1999/xhtml">bool buffered = true</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.2632.1" xmlns="http://www.w3.org/1999/xhtml">By default, it will buffer the entire reader on return. </span><span class="koboSpan" id="kobo.2632.2" xmlns="http://www.w3.org/1999/xhtml">With large datasets, you can minimize memory and only load objects as needed by setting </span><code class="inlineCode"><span class="koboSpan" id="kobo.2633.1" xmlns="http://www.w3.org/1999/xhtml">buffered</span></code><span class="koboSpan" id="kobo.2634.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2635.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.2636.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2637.1" xmlns="http://www.w3.org/1999/xhtml">int? </span><span class="koboSpan" id="kobo.2637.2" xmlns="http://www.w3.org/1999/xhtml">commandTimeout = null</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.2638.1" xmlns="http://www.w3.org/1999/xhtml">To change the default command timeout.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2639.1" xmlns="http://www.w3.org/1999/xhtml">CommandType? </span><span class="koboSpan" id="kobo.2639.2" xmlns="http://www.w3.org/1999/xhtml">commandType = null)</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.2640.1" xmlns="http://www.w3.org/1999/xhtml">To switch to a stored procedure instead of the default of text.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.2641.1" xmlns="http://www.w3.org/1999/xhtml">Table 2.8: Dapper’s Query&lt;T&gt; extension method parameters</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2642.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2643.1" xmlns="http://www.w3.org/1999/xhtml">Query</span></code><span class="koboSpan" id="kobo.2644.1" xmlns="http://www.w3.org/1999/xhtml"> extension method is a loosely-typed equivalent so it is less frequently used.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2645.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2646.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></code><span class="koboSpan" id="kobo.2647.1" xmlns="http://www.w3.org/1999/xhtml"> extension method runs any specified SQL command and then returns the number of rows affected as an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2648.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.2649.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2649.2" xmlns="http://www.w3.org/1999/xhtml">It is designed to run commands like </span><code class="inlineCode"><span class="koboSpan" id="kobo.2650.1" xmlns="http://www.w3.org/1999/xhtml">INSERT</span></code><span class="koboSpan" id="kobo.2651.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2652.1" xmlns="http://www.w3.org/1999/xhtml">UPDATE</span></code><span class="koboSpan" id="kobo.2653.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2654.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code><span class="koboSpan" id="kobo.2655.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2655.2" xmlns="http://www.w3.org/1999/xhtml">It has the same parameters as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2656.1" xmlns="http://www.w3.org/1999/xhtml">Query&lt;T&gt;</span></code><span class="koboSpan" id="kobo.2657.1" xmlns="http://www.w3.org/1999/xhtml"> extension method.</span></p>
<h2 class="heading-2" id="_idParaDest-119"><span class="koboSpan" id="kobo.2658.1" xmlns="http://www.w3.org/1999/xhtml">Querying using Dapper</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2659.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see a</span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.2660.1" xmlns="http://www.w3.org/1999/xhtml"> simple example that queries the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2661.1" xmlns="http://www.w3.org/1999/xhtml">Suppliers</span></code><span class="koboSpan" id="kobo.2662.1" xmlns="http://www.w3.org/1999/xhtml"> table instead of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2663.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></code><span class="koboSpan" id="kobo.2664.1" xmlns="http://www.w3.org/1999/xhtml"> table:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2665.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2666.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Console.SqlClient</span></code><span class="koboSpan" id="kobo.2667.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a package reference for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2668.1" xmlns="http://www.w3.org/1999/xhtml">Dapper</span></code><span class="koboSpan" id="kobo.2669.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2670.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2671.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Data.SqlClient"</span></span><span class="koboSpan" id="kobo.2672.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2673.1" xmlns="http://www.w3.org/1999/xhtml">"5.1.2"</span></span><span class="koboSpan" id="kobo.2674.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2675.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;PackageReference Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2676.1" xmlns="http://www.w3.org/1999/xhtml">"Dapper"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2677.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2678.1" xmlns="http://www.w3.org/1999/xhtml">"2.1.21"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2679.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.2680.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2681.1" xmlns="http://www.w3.org/1999/xhtml">At the time of writing, the latest version of Dapper is 2.1.21, released on November 11, 2023. </span><span class="koboSpan" id="kobo.2681.2" xmlns="http://www.w3.org/1999/xhtml">You can check if it has been updated since then at the following link: </span><a href="https://www.nuget.org/packages/Dapper"><span class="url"><span class="koboSpan" id="kobo.2682.1" xmlns="http://www.w3.org/1999/xhtml">https://www.nuget.org/packages/Dapper</span></span></a><span class="koboSpan" id="kobo.2683.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.2684.1" xmlns="http://www.w3.org/1999/xhtml">Build the project to restore packages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2685.1" xmlns="http://www.w3.org/1999/xhtml">Add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2686.1" xmlns="http://www.w3.org/1999/xhtml">Supplier.cs</span></code><span class="koboSpan" id="kobo.2687.1" xmlns="http://www.w3.org/1999/xhtml">, and modify its contents to define a class to represent four columns from each row in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2688.1" xmlns="http://www.w3.org/1999/xhtml">Suppliers</span></code><span class="koboSpan" id="kobo.2689.1" xmlns="http://www.w3.org/1999/xhtml"> table, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2690.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2691.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Models</span></span><span class="koboSpan" id="kobo.2692.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2693.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2694.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2695.1" xmlns="http://www.w3.org/1999/xhtml">Supplier</span></span><span class="koboSpan" id="kobo.2696.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2697.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2698.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.2699.1" xmlns="http://www.w3.org/1999/xhtml"> SupplierId { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2700.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.2701.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2702.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.2703.1" xmlns="http://www.w3.org/1999/xhtml">; }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2704.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2705.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2706.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.2706.2" xmlns="http://www.w3.org/1999/xhtml">CompanyName { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2707.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.2708.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2709.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.2710.1" xmlns="http://www.w3.org/1999/xhtml">; }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2711.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2712.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2713.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.2713.2" xmlns="http://www.w3.org/1999/xhtml">City { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2714.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.2715.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2716.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.2717.1" xmlns="http://www.w3.org/1999/xhtml">; }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2718.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2719.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2720.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.2720.2" xmlns="http://www.w3.org/1999/xhtml">Country { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2721.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.2722.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2723.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.2724.1" xmlns="http://www.w3.org/1999/xhtml">; }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2725.1" xmlns="http://www.w3.org/1999/xhtml">At the bottom of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2726.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2727.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to retrieve </span><code class="inlineCode"><span class="koboSpan" id="kobo.2728.1" xmlns="http://www.w3.org/1999/xhtml">Supplier</span></code><span class="koboSpan" id="kobo.2729.1" xmlns="http://www.w3.org/1999/xhtml"> entities in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2730.1" xmlns="http://www.w3.org/1999/xhtml">Germany</span></code><span class="koboSpan" id="kobo.2731.1" xmlns="http://www.w3.org/1999/xhtml">, enumerate the collection outputting basic information about each one, and then serialize the collection as JSON to the console, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2732.1" xmlns="http://www.w3.org/1999/xhtml">WriteLineInColor(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2733.1" xmlns="http://www.w3.org/1999/xhtml">"Using Dapper"</span></span><span class="koboSpan" id="kobo.2734.1" xmlns="http://www.w3.org/1999/xhtml">, ConsoleColor.DarkGreen);
connection.ResetStatistics(); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2735.1" xmlns="http://www.w3.org/1999/xhtml">// So we can compare using Dapper.</span></span><span class="koboSpan" id="kobo.2736.1" xmlns="http://www.w3.org/1999/xhtml">
IEnumerable&lt;Supplier&gt; suppliers = connection.Query&lt;Supplier&gt;(
  sql: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2737.1" xmlns="http://www.w3.org/1999/xhtml">"SELECT * FROM Suppliers WHERE Country=@Country"</span></span><span class="koboSpan" id="kobo.2738.1" xmlns="http://www.w3.org/1999/xhtml">,
  param: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2739.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2740.1" xmlns="http://www.w3.org/1999/xhtml"> { Country = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2741.1" xmlns="http://www.w3.org/1999/xhtml">"Germany"</span></span><span class="koboSpan" id="kobo.2742.1" xmlns="http://www.w3.org/1999/xhtml"> });
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2743.1" xmlns="http://www.w3.org/1999/xhtml">foreach</span></span><span class="koboSpan" id="kobo.2744.1" xmlns="http://www.w3.org/1999/xhtml"> (Supplier s </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2745.1" xmlns="http://www.w3.org/1999/xhtml">in</span></span><span class="koboSpan" id="kobo.2746.1" xmlns="http://www.w3.org/1999/xhtml"> suppliers)
{
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2747.1" xmlns="http://www.w3.org/1999/xhtml">"{0}: {1}, {2}, {3}"</span></span><span class="koboSpan" id="kobo.2748.1" xmlns="http://www.w3.org/1999/xhtml">,
    s.SupplierId, s.CompanyName, s.City, s.Country);
}
WriteLineInColor(JsonSerializer.Serialize(suppliers),
  ConsoleColor.Green);
OutputStatistics(connection);
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2749.1" xmlns="http://www.w3.org/1999/xhtml">Run the </span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.2750.1" xmlns="http://www.w3.org/1999/xhtml">console app, and in the section where we used Dapper, note the same connection was used, so its events were raised while the Dapper query was executed, the enumerated collection output, and then JSON generated from the list of suppliers, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2751.1" xmlns="http://www.w3.org/1999/xhtml">Using Dapper
11: Heli Süßwaren GmbH &amp; Co. </span><span class="koboSpan" id="kobo.2751.2" xmlns="http://www.w3.org/1999/xhtml">KG, Berlin, Germany
12: Plutzer Lebensmittelgroßmärkte AG, Frankfurt, Germany
13: Nord-Ost-Fisch Handelsgesellschaft mbH, Cuxhaven, Germany
[{"SupplierId":11,  "CompanyName":"Heli S\u00FC\u00DFwaren GmbH \u0026 Co. </span><span class="koboSpan" id="kobo.2751.3" xmlns="http://www.w3.org/1999/xhtml">KG",
  "City":"Berlin","Country":"Germany"},
 {"SupplierId":12,
  "CompanyName":"Plutzer Lebensmittelgro\u00DFm\u00E4rkte AG",
  "City":"Frankfurt","Country":"Germany"},
 {"SupplierId":13,
  "CompanyName":"Nord-Ost-Fisch Handelsgesellschaft mbH",
  "City":"Cuxhaven","Country":"Germany"}]
BytesReceived: 1,430
BytesSent: 240
SelectRows: 3
ExecutionTime: 5
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2752.1" xmlns="http://www.w3.org/1999/xhtml">At the bottom of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2753.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2754.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2755.1" xmlns="http://www.w3.org/1999/xhtml">GetExpensiveProducts</span></code><span class="koboSpan" id="kobo.2756.1" xmlns="http://www.w3.org/1999/xhtml"> stored procedure, passing a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2757.1" xmlns="http://www.w3.org/1999/xhtml">price</span></code><span class="koboSpan" id="kobo.2758.1" xmlns="http://www.w3.org/1999/xhtml"> parameter value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2759.1" xmlns="http://www.w3.org/1999/xhtml">100</span></code><span class="koboSpan" id="kobo.2760.1" xmlns="http://www.w3.org/1999/xhtml">, enumerate the collection outputting basic information about each one, and</span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.2761.1" xmlns="http://www.w3.org/1999/xhtml"> then serialize the collection as JSON to the console, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2762.1" xmlns="http://www.w3.org/1999/xhtml">IEnumerable&lt;Product&gt; productsFromDapper = 
  connection.Query&lt;Product&gt;(sql: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2763.1" xmlns="http://www.w3.org/1999/xhtml">"GetExpensiveProducts"</span></span><span class="koboSpan" id="kobo.2764.1" xmlns="http://www.w3.org/1999/xhtml">,
  param: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2765.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2766.1" xmlns="http://www.w3.org/1999/xhtml"> { price = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2767.1" xmlns="http://www.w3.org/1999/xhtml">100</span></span><span class="koboSpan" id="kobo.2768.1" xmlns="http://www.w3.org/1999/xhtml">M, count = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2769.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.2770.1" xmlns="http://www.w3.org/1999/xhtml"> }, 
  commandType: CommandType.StoredProcedure);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2771.1" xmlns="http://www.w3.org/1999/xhtml">foreach</span></span><span class="koboSpan" id="kobo.2772.1" xmlns="http://www.w3.org/1999/xhtml"> (Product p </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2773.1" xmlns="http://www.w3.org/1999/xhtml">in</span></span><span class="koboSpan" id="kobo.2774.1" xmlns="http://www.w3.org/1999/xhtml"> productsFromDapper)
{
  WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2775.1" xmlns="http://www.w3.org/1999/xhtml">"{0}: {1}, {2}"</span></span><span class="koboSpan" id="kobo.2776.1" xmlns="http://www.w3.org/1999/xhtml">,
    p.ProductId, p.ProductName, p.UnitPrice);
}
WriteLineInColor(JsonSerializer.Serialize(productsFromDapper),
  ConsoleColor.Green);
</span></code></pre>
</li>
</ol>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2777.1" xmlns="http://www.w3.org/1999/xhtml">Warning!</span></strong><span class="koboSpan" id="kobo.2778.1" xmlns="http://www.w3.org/1999/xhtml"> With Dapper, you must pass a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2779.1" xmlns="http://www.w3.org/1999/xhtml">param</span></code><span class="koboSpan" id="kobo.2780.1" xmlns="http://www.w3.org/1999/xhtml"> object with all parameters, even if they are only used as output parameters. </span><span class="koboSpan" id="kobo.2780.2" xmlns="http://www.w3.org/1999/xhtml">For example, we must define </span><code class="inlineCode"><span class="koboSpan" id="kobo.2781.1" xmlns="http://www.w3.org/1999/xhtml">count</span></code><span class="koboSpan" id="kobo.2782.1" xmlns="http://www.w3.org/1999/xhtml">, or an exception will be thrown. </span><span class="koboSpan" id="kobo.2782.2" xmlns="http://www.w3.org/1999/xhtml">You must also remember to explicitly set the command type to stored procedure!</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2783.1" xmlns="http://www.w3.org/1999/xhtml">Run the console app, and in the section where we used Dapper to run the stored procedure to get the products that cost more than 100, note the same connection was used so its events were raised while the Dapper query was executed, the enumerated collection output, and then JSON generated from the list of products, as shown in the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2784.1" xmlns="http://www.w3.org/1999/xhtml">Info: Getting expensive products: 100.00.
</span><span class="koboSpan" id="kobo.2784.2" xmlns="http://www.w3.org/1999/xhtml">29: Thüringer Rostbratwurst, 123.7900
38: Côte de Blaye, 263.5000
[{"ProductId":29,"ProductName":"Th\u00FCringer Rostbratwurst","UnitPrice":123.7900},{"ProductId":38,"ProductName":"C\u00F4te de Blaye","UnitPrice":263.5000}]
</span></code></pre>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2785.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.2786.1" xmlns="http://www.w3.org/1999/xhtml">: You can learn more about Dapper at the following link: </span><a href="https://github.com/DapperLib/Dapper/blob/main/Readme.md"><span class="url"><span class="koboSpan" id="kobo.2787.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/DapperLib/Dapper/blob/main/Readme.md</span></span></a><span class="koboSpan" id="kobo.2788.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-120"><span class="koboSpan" id="kobo.2789.1" xmlns="http://www.w3.org/1999/xhtml">Cleaning up data resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2790.1" xmlns="http://www.w3.org/1999/xhtml">When you </span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.2791.1" xmlns="http://www.w3.org/1999/xhtml">are done with a SQL Server database, you can clean up the resources used.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2792.1" xmlns="http://www.w3.org/1999/xhtml">The Northwind database is used in most chapters of this book so if you plan to immediately continue with more chapters after this one, do not delete Northwind yet! </span><span class="koboSpan" id="kobo.2792.2" xmlns="http://www.w3.org/1999/xhtml">If you created the database on your local computer, then you can leave it forever.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-121"><span class="koboSpan" id="kobo.2793.1" xmlns="http://www.w3.org/1999/xhtml">Removing Azure resources</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2794.1" xmlns="http://www.w3.org/1999/xhtml">To remove </span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.2795.1" xmlns="http://www.w3.org/1999/xhtml">the resources used by SQL Database to save costs:</span></p>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2796.1" xmlns="http://www.w3.org/1999/xhtml">Warning!</span></strong><span class="koboSpan" id="kobo.2797.1" xmlns="http://www.w3.org/1999/xhtml"> If you do not remove the resources used by an Azure SQL database, then you will incur costs.</span></p>
</div>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2798.1" xmlns="http://www.w3.org/1999/xhtml">In the Azure portal, find the resource group named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2799.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-book</span></code><span class="koboSpan" id="kobo.2800.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2801.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.2802.1" xmlns="http://www.w3.org/1999/xhtml">Delete</span></strong><span class="koboSpan" id="kobo.2803.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2804.1" xmlns="http://www.w3.org/1999/xhtml">Enter the name of the resource group.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2805.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.2806.1" xmlns="http://www.w3.org/1999/xhtml">Delete</span></strong><span class="koboSpan" id="kobo.2807.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-122"><span class="koboSpan" id="kobo.2808.1" xmlns="http://www.w3.org/1999/xhtml">Practicing and exploring</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2809.1" xmlns="http://www.w3.org/1999/xhtml">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring this chapter’s topics with deeper research.</span></p>
<h2 class="heading-2" id="_idParaDest-123"><span class="koboSpan" id="kobo.2810.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 2.1 – Test your knowledge</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2811.1" xmlns="http://www.w3.org/1999/xhtml">Answer the following questions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2812.1" xmlns="http://www.w3.org/1999/xhtml">Which NuGet package should you reference in a .NET project to get the best performance when working with data in SQL Server?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2813.1" xmlns="http://www.w3.org/1999/xhtml">What is the safest way to define a database connection string?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2814.1" xmlns="http://www.w3.org/1999/xhtml">What must T-SQL parameters and variables be prefixed with?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2815.1" xmlns="http://www.w3.org/1999/xhtml">What must you do before reading an output parameter?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2816.1" xmlns="http://www.w3.org/1999/xhtml">What type does Dapper add its extension methods to?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2817.1" xmlns="http://www.w3.org/1999/xhtml">What are the two most commonly used extension methods provided by Dapper?</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-124"><span class="koboSpan" id="kobo.2818.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 2.2 – Explore topics</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2819.1" xmlns="http://www.w3.org/1999/xhtml">Use the links on the following page to learn more details about the topics covered in this chapter:</span></p>
<p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-2---managing-relational-data-using-sql-server"><span class="url"><span class="koboSpan" id="kobo.2820.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-2---managing-relational-data-using-sql-server</span></span></a></p>
<h2 class="heading-2" id="_idParaDest-125"><span class="koboSpan" id="kobo.2821.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 2.3 – Alternatives for storing secrets</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2822.1" xmlns="http://www.w3.org/1999/xhtml">Secrets like passwords and other values used in database connection strings, or values like keys to access a service, are often stored in environment variables. </span><span class="koboSpan" id="kobo.2822.2" xmlns="http://www.w3.org/1999/xhtml">Other places for storing these values include App Secrets. </span><span class="koboSpan" id="kobo.2822.3" xmlns="http://www.w3.org/1999/xhtml">You can learn more about them in the article </span><em class="italic"><span class="koboSpan" id="kobo.2823.1" xmlns="http://www.w3.org/1999/xhtml">Safe storage of app secrets in development in ASP.NET Core</span></em><span class="koboSpan" id="kobo.2824.1" xmlns="http://www.w3.org/1999/xhtml">, found at the following link:</span></p>
<p class="normal"><a href="https://learn.microsoft.com/en-us/aspnet/core/security/app-secrets"><span class="url"><span class="koboSpan" id="kobo.2825.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/security/app-secrets</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.2826.1" xmlns="http://www.w3.org/1999/xhtml">For related guidance about handling connection strings, you can read the following link:</span></p>
<p class="normal"><a href="https://learn.microsoft.com/en-us/ef/core/miscellaneous/connection-strings"><span class="url"><span class="koboSpan" id="kobo.2827.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/ef/core/miscellaneous/connection-strings</span></span></a></p>
<h1 class="heading-1" id="_idParaDest-126"><span class="koboSpan" id="kobo.2828.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2829.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, you learned:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2830.1" xmlns="http://www.w3.org/1999/xhtml">How to connect to an existing SQL Server database.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2831.1" xmlns="http://www.w3.org/1999/xhtml">How to execute a simple query and process the results using fast and low-level ADO.NET.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2832.1" xmlns="http://www.w3.org/1999/xhtml">How to execute a simple query and process the results using Dapper.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2833.1" xmlns="http://www.w3.org/1999/xhtml">In the next chapter, you will learn how to use the more powerful and complex ORM from Microsoft named EF Core.</span></p>
</div>
</body>
</html>
