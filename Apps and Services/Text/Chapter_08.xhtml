<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>Chapter_08</title>
<link href="../Styles/syntax-highlighting.css" rel="stylesheet" type="text/css"/>
<link href="../Styles/epub.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body id="Chapter_08" lang="en-US" xml:lang="en-US">
<div class="Basic-Text-Frame" id="_idContainer278">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">8</span></h1>
<h1 class="chapterTitle" id="_idParaDest-300"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Building and Securing Web Services Using Minimal APIs</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">This chapter is about building and securing web services using ASP.NET Core Minimal APIs. </span><span class="koboSpan" id="kobo.3.2" xmlns="http://www.w3.org/1999/xhtml">This includes implementing techniques to protect a web service from attacks as well as authentication and authorization.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">This chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">Building web services using ASP.NET Core Minimal APIs</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">Relaxing the same origin security policy using CORS</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Preventing denial of service attacks using rate limiting</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">Improving startup time and resources using native AOT</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">Understanding identity services</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-301"><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Building web services using ASP.NET Core Minimal APIs</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">In older versions of </span><a id="_idIndexMarker718"/><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core, you would build a web service using controllers with an action method for each endpoint, a bit like</span><a id="_idIndexMarker719"/><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml"> building a website with </span><a id="_idIndexMarker720"/><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core MVC using controllers and models but without the views. </span><span class="koboSpan" id="kobo.14.2" xmlns="http://www.w3.org/1999/xhtml">Since .NET 6, you have another, often better, choice: </span><strong class="keyWord"><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core</span></strong> <strong class="keyWord"><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">Minimal APIs</span></strong><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<h2 class="heading-2" id="_idParaDest-302"><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">Benefits of Minimal API-based web services</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">In earlier versions of ASP.NET Core, implementing even a simple web service required a lot of boilerplate code compared to</span><a id="_idIndexMarker721"/><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml"> alternative web development platforms. </span><span class="koboSpan" id="kobo.20.2" xmlns="http://www.w3.org/1999/xhtml">For example, a minimal </span><code class="inlineCode"><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">Hello World</span></code><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml"> web service implementation that</span><a id="_idIndexMarker722"/><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml"> has a single endpoint that returns plain text could be</span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml"> implemented using </span><strong class="keyWord"><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">Express.js</span></strong><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml"> in just nine lines of code, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">const</span></span><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml"> express = require(</span><span class="hljs-string"><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">express'</span></span><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">const</span></span><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml"> app = express()
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">const</span></span><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml"> port = </span><span class="hljs-number"><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">3000</span></span><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">
app.</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">'/'</span></span><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">, (req, res) =&gt; {
  res.send(</span><span class="hljs-string"><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">'Hello World!'</span></span><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">)
})
app.listen(port, () =&gt; {
  console.log(`Example app listening </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">on</span></span><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml"> port ${port}`)
})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">With ASP.NET Core 5 or earlier, that would require more than fifty lines of code!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">The equivalent using ASP.NET Core 6 or later using ASP.NET Core Minimal APIs is now only five lines of code and six lines of configuration, as shown in the following two code blocks:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in"><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml"> port = </span><span class="hljs-number"><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">3000</span></span><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml"> app = WebApplication.Create();
app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">, () =&gt; </span><span class="hljs-string"><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">"Hello World!"</span></span><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">);
Console.WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">$"Example app listening on port </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">{port}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml"> app.RunAsync(</span><span class="hljs-string"><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">$"https://localhost:</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">{port}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">/"</span></span><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">The platform is specified in the project file, and the implicit </span><code class="inlineCode"><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">using</span></code><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml"> statements SDK feature does some heavy lifting. </span><span class="koboSpan" id="kobo.70.2" xmlns="http://www.w3.org/1999/xhtml">It is enabled by default, as shown highlighted in the following markup:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk=</span><span class="hljs-string"><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.NET.Sdk.Web"</span></span><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;</span></strong></span><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;/PropertyGroup&gt;
&lt;/Project&gt;
</span></code></pre>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">: Another benefit of minimal APIs is that they do not use dynamically generated code, unlike controller-based Web APIs. </span><span class="koboSpan" id="kobo.79.2" xmlns="http://www.w3.org/1999/xhtml">This allows them to use native AOT to produce smaller, faster services that are better for implementing and hosting microservices in containers. </span><span class="koboSpan" id="kobo.79.3" xmlns="http://www.w3.org/1999/xhtml">We will cover native AOT with minimal APIs later in this chapter. </span><span class="koboSpan" id="kobo.79.4" xmlns="http://www.w3.org/1999/xhtml">Whenever possible, implement your web services </span><a id="_idIndexMarker724"/><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">using minimal APIs instead of </span><a id="_idIndexMarker725"/><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">controllers.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-303"><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">Understanding Minimal API route mappings</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml"> instance has </span><a id="_idIndexMarker726"/><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">methods that you can call to map a route to a </span><a id="_idIndexMarker727"/><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">lambda expression or statement:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">MapGet</span></code><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">: Map a route to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml"> request to retrieve an entity.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">MapPost</span></code><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">: Map a route to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml"> request to insert an entity.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">MapPut</span></code><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">: Map a route to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml"> request to update an entity.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">MapPatch</span></code><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">: Map a route to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">PATCH</span></code><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml"> request to update an entity.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">MapDelete</span></code><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml">: Map a route to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml"> request to delete an entity.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">MapMethods</span></code><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">: Map a route to any other HTTP method or methods, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">CONNECT</span></code><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">HEAD</span></code><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">For example, you might want to map an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml"> request for the relative path </span><code class="inlineCode"><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">api/customers</span></code><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml"> to a delegate defined by a lambda expression or a function that returns a JSON document containing a list of customers, and equivalent mappings to insert and delete, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">"api/customers"</span></span><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml">, GetCustomers);
app.MapPost(</span><span class="hljs-string"><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">"api/customers"</span></span><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">, InsertCustomer);
app.MapDelete(</span><span class="hljs-string"><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">"api/customers/{id}"</span></span><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">, DeleteCustomer);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">You might want to map an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">CONNECT</span></code><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml"> request for the relative path </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">api/customers</span></code><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml"> to a lambda statement block, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">app.MapMethods(</span><span class="hljs-string"><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">"api/customers"</span></span><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">[] { </span><span class="hljs-string"><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">"CONNECT"</span></span><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml"> }, () =&gt;
  { 
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">// Do something.</span></span><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">
  });
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">If you have multiple endpoints that share a common relative path, then you can define a </span><strong class="keyWord"><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">route group</span></strong><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.142.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">MapGroup</span></code><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml"> method</span><a id="_idIndexMarker728"/><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml"> was </span><a id="_idIndexMarker729"/><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml">introduced in .NET 7:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">RouteGroupBuilder </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">group</span></span><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml"> = app.MapGroup(</span><span class="hljs-string"><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">"api/customers"</span></span><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">group</span></span><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">, GetCustomers)
  .MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">"/{id}"</span></span><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">, GetCustomerById)
  .MapPost(</span><span class="hljs-string"><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">, InsertCustomer)
  .MapDelete(</span><span class="hljs-string"><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">"/{id}"</span></span><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">, DeleteCustomer);
</span></code></pre>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">: You</span><a id="_idIndexMarker730"/><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml"> can learn more about mapping routes at the following link: </span><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis/route-handlers"><span class="url"><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis/route-handlers</span></span></a><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-304"><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">Understanding parameter mapping</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">The delegate can have parameters defined that can be set automatically. </span><span class="koboSpan" id="kobo.168.2" xmlns="http://www.w3.org/1999/xhtml">Although most mappings can be configured without</span><a id="_idIndexMarker731"/><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml"> explicitly being specified, you can optionally use </span><a id="_idIndexMarker732"/><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">attributes to define where ASP.NET Core Minimal APIs should set the parameter values from:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">[FromServices]</span></code><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">: The parameter will be set from the registered dependency services.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">[FromRoute]</span></code><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">: The parameter will be set from a matching named route segment.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">[FromQuery]</span></code><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">: The parameter will be set from a matching named query string parameter.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">[FromBody]</span></code><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">: The parameter will be set from the body of the HTTP request.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">For example, to update an entity in a database, you would need a database context to be retrieved from the registered dependency services, an identifier passed as a query string or route segment, and the new entity in the body of the request, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">app.MapPut(</span><span class="hljs-string"><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">"api/customers/{id}"</span></span><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml"> (
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">FromServices</span></span><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">] NorthwindContext db,
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">FromRoute</span></span><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml"> id, </span><span class="hljs-comment"><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">// or [FromQuery] string id,</span></span><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">FromBody</span></span><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">] Customer customer) =&gt;
{
  Customer? </span><span class="koboSpan" id="kobo.194.2" xmlns="http://www.w3.org/1999/xhtml">existingCustomer = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml"> db.Customers.FindAsync(id);
  ...
</span><span class="koboSpan" id="kobo.196.2" xmlns="http://www.w3.org/1999/xhtml">});
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-305"><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">Understanding return values</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml">A minimal</span><a id="_idIndexMarker733"/><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml"> API service can return </span><a id="_idIndexMarker734"/><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">data in some common formats, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">Table 8.1</span></em><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table001-6">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml">Lambda</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">Plain text</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; "Hello World!"</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.Text("Hello World!")</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">JSON document</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; new { FirstName = "Bob", LastName = "Jones" }</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.Json(new { FirstName = "Bob", LastName = "Jones" })</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">IResult</span></code><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml"> with status codes</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.Ok(new { FirstName = "Bob", LastName = "Jones" })</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.NoContent()</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.Redirect("new/path")</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.NotFound()</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.BadRequest()</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.Problem()</span></code></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.StatusCode(405)</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">File</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">() =&gt; Results.File("/path/filename.ext")</span></code></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">Table 8.1: Examples of minimal API return values</span></p>
<h2 class="heading-2" id="_idParaDest-306"><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">Documenting a Minimal APIs service</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">You can call </span><a id="_idIndexMarker735"/><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">additional methods as many times as you need to specify what</span><a id="_idIndexMarker736"/><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml"> return types and status codes can be expected from an endpoint, for example:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">Produces&lt;T&gt;(StatusCodes.Status200OK)</span></code><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">: When successful, this route returns a response containing a type </span><code class="inlineCode"><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">T</span></code><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml"> and status code </span><code class="inlineCode"><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">200</span></code><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">Produces(StatusCodes.Status404NotFound)</span></code><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">: When no match for the route is found, this</span><a id="_idIndexMarker737"/><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml"> route returns an empty response and status code 404.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-307"><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">Setting up an ASP.NET Core Web API project</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">First, we will create a simple ASP.NET Core Web API project that we will later protect using various techniques like</span><a id="_idIndexMarker738"/><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml"> rate limiting, CORS, and authentication and authorization.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml">The API for this web service is defined as shown in </span><em class="italic"><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">Table 8.2</span></em><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table002-6">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">Method</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">Path</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">Request body</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">Response body</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">Success code</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">/</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">Hello World!</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">200</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">/api/products</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">Array of in-stock </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml"> objects</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">200</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">/api/products/outofstock</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">Array of out-of-stock </span><code class="inlineCode"><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml"> objects</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">200</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">/api/products/discontinued</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">Array of discontinued </span><code class="inlineCode"><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml"> objects</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">200</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">/api/products/{id}</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml"> object</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">200</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml">/api/products/{name}</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">Array of </span><code class="inlineCode"><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml"> objects that contain the name</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">200</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">/api/products</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml"> object (no </span><code class="inlineCode"><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">Id</span></code><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml"> value)</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml"> object</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">201</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">/api/products/{id}</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml"> object</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">204</span></code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">/api/products/{id}</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">None</span></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">204</span></code></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">Table 8.2: API methods implemented by the example project</span></p>
<p class="normal"><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">Let’s go:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">Use your</span><a id="_idIndexMarker739"/><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml"> preferred code editor to create a new solution named </span><code class="inlineCode"><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">Chapter08</span></code><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">Add a Web API project, as defined in the following list:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">Project template: </span><strong class="screenText"><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core Web API</span></strong><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml"> / </span><code class="inlineCode"><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">webapi</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">Solution file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">Chapter08</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">Project file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">Authentication type</span></strong><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">: </span><strong class="screenText"><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">Configure for HTTPS</span></strong><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">: Selected.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">Enable Docker</span></strong><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">Enable OpenAPI support</span></strong><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">: Selected.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">Do not use top-level statements</span></strong><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">Use controllers</span></strong><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">To create a Web API project using minimal APIs with </span><code class="inlineCode"><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">dotnet new</span></code><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml"> for pre-.NET 8 SDKs, you must use either the </span><code class="inlineCode"><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml">-minimal</span></code><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml"> switch or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">--use-minimal-apis</span></code><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml"> switch. </span><span class="koboSpan" id="kobo.341.2" xmlns="http://www.w3.org/1999/xhtml">For .NET 8 SDKs, minimal APIs are the default and to use controllers, you must specify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">--use-controllers</span></code><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">-controllers</span></code><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml"> switch.</span></p>
</div>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">Warning!</span></strong><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml"> If you are using JetBrains Rider, its user interface might not yet have an option to create a web API project using minimal APIs. </span><span class="koboSpan" id="kobo.347.2" xmlns="http://www.w3.org/1999/xhtml">I recommend creating the project using </span><code class="inlineCode"><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml">dotnet new</span></code><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml"> and then adding the project to your solution.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">Add a project</span><a id="_idIndexMarker740"/><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml"> reference to the Northwind database context project for SQL Server that you created in </span><em class="chapterRef"><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 3</span></em><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">Building Entity Models for SQL Server Using EF Core</span></em><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">"..\..\Chapter03\Northwind.Common.DataContext</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">.SqlServer\Northwind.Common.DataContext.SqlServer.csproj"</span></span><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml">The path cannot have a line break. </span><span class="koboSpan" id="kobo.360.2" xmlns="http://www.w3.org/1999/xhtml">If you did not complete the task of creating the class libraries in </span><em class="chapterRef"><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 3</span></em><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml">, then download the solution projects from the GitHub repository.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">In the project file, change </span><code class="inlineCode"><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">invariantGlobalization</span></code><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">, and treat warnings as errors, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk=</span><span class="hljs-string"><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.NET.Sdk.Web"</span></span><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;InvariantGlobalization&gt;</span><span class="code-highlight"><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">false</span></strong></span><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/InvariantGlobalization&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;TreatWarningsAsErrors&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TreatWarningsAsErrors&gt;</span></strong></span><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;/PropertyGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">Explicitly setting invariant globalization to </span><code class="inlineCode"><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml"> is new in the ASP.NET Core Web API project template with .NET 8. </span><span class="koboSpan" id="kobo.381.2" xmlns="http://www.w3.org/1999/xhtml">It is designed to make a web service non-culture-specific so it can be deployed anywhere in the world and have the same behavior. </span><span class="koboSpan" id="kobo.381.3" xmlns="http://www.w3.org/1999/xhtml">By setting this property to </span><code class="inlineCode"><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml">, the web service will default to the culture of the current computer it is hosted on. </span><span class="koboSpan" id="kobo.383.2" xmlns="http://www.w3.org/1999/xhtml">You can read more about invariant globalization mode at the following link: </span><a href="https://github.com/dotnet/runtime/blob/main/docs/design/features/globalization-invariant-mode.md"><span class="url"><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/dotnet/runtime/blob/main/docs/design/features/globalization-invariant-mode.md</span></span></a></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">At the command </span><a id="_idIndexMarker741"/><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">prompt or terminal, build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml"> project to make sure the entity model class library projects outside the current solution are properly compiled, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml">dotnet build
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></code><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml">launchSettings.json</span></code><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">, modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">applicationUrl</span></code><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml"> of the profile named </span><code class="inlineCode"><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml"> to use port </span><code class="inlineCode"><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml">5081</span></code><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">"profiles"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">
  ...
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">"https"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">"commandName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">"Project"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">"dotnetRunMessages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">"launchBrowser"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">"launchUrl"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">"swagger"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml">"applicationUrl"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5081"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">"environmentVariables"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">"ASPNETCORE_ENVIRONMENT"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">"Development"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml">Visual Studio 2022 will read this settings file and automatically run a web browser if </span><code class="inlineCode"><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml">launchBrowser</span></code><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml">, and then navigate to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">applicationUrl</span></code><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">launchUrl</span></code><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.443.2" xmlns="http://www.w3.org/1999/xhtml">Visual Studio Code and </span><code class="inlineCode"><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">dotnet run</span></code><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml"> will not, so you will need to run a web browser and navigate manually to </span><a href="https://localhost:5081/swagger"><span class="url"><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5081/swagger</span></span></a><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">, delete the statements about the weather service and replace them with statements to import the namespace to add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindContext</span></code><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><a id="_idIndexMarker742"/><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">configured services, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">using</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.EntityModels; </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">// To use the AddNorthwindContext method.</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml"> builder = WebApplication.CreateBuilder(args);
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">// Add services to the container.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml">// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle</span></span><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddNorthwindContext();</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml"> app = builder.Build();
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">// Configure the HTTP request pipeline.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml"> (app.Environment.IsDevelopment())
{
  app.UseSwagger();
  app.UseSwaggerUI();
}
app.UseHttpsRedirection();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">Add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml">.
    </span><div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml">: Instead of cluttering your </span><code class="inlineCode"><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml"> file with hundreds of lines of code, define extension methods for the common types that are configured in minimal APIs, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection</span></code><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml">, import namespaces for controlling HTTP results, binding </span><a id="_idIndexMarker743"/><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml">a parameter to a dependency service, and working with </span><code class="inlineCode"><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">Northwind</span></code><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml"> entity models, and then define an extension method for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml"> class to configure responses to all the HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml"> requests documented in our API table, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.AspNetCore.Http.HttpResults; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">// To use Results.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.AspNetCore.Mvc; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">// To use [FromServices] and so on.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.EntityModels; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">// To use NorthwindContext, Product.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml">Packt.Extensions</span></span><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml">WebApplicationExtensions</span></span><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">MapGets</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication app,</span></span>
<span class="hljs-params"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml"> pageSize = </span></span><span class="hljs-number"><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">, () =&gt; </span><span class="hljs-string"><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml">"Hello World!"</span></span><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">)
      .ExcludeFromDescription();
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml">"api/products"</span></span><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">, (
      [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">FromServices</span></span><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">] NorthwindContext db,
      [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">FromQuery</span></span><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.529.2" xmlns="http://www.w3.org/1999/xhtml">page) =&gt;
      db.Products
        .Where(p =&gt; p.UnitsInStock &gt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml"> &amp;&amp; !p.Discontinued)
        .OrderBy(product =&gt; product.ProductId)
        .Skip(((page ?? </span><span class="hljs-number"><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">) - </span><span class="hljs-number"><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">) * pageSize)
        .Take(pageSize)
      )
      .WithName(</span><span class="hljs-string"><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">"GetProducts"</span></span><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">)
      .WithOpenApi(operation =&gt;
      {
        operation.Description =
          </span><span class="hljs-string"><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml">"Get products with UnitsInStock &gt; 0 and Discontinued = false."</span></span><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml">;
        operation.Summary = </span><span class="hljs-string"><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml">"Get in-stock products that are not discontinued."</span></span><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml"> operation;
      })
      .Produces&lt;Product[]&gt;(StatusCodes.Status200OK);
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/outofstock"</span></span><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">, 
      ([FromServices] NorthwindContext db) =&gt; db.Products
        .Where(p =&gt; p.UnitsInStock == </span><span class="hljs-number"><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml"> &amp;&amp; !p.Discontinued)
      )
      .WithName(</span><span class="hljs-string"><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">"GetProductsOutOfStock"</span></span><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">)
      .WithOpenApi()
      .Produces&lt;Product[]&gt;(StatusCodes.Status200OK);
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/discontinued"</span></span><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml">, 
      ([FromServices] NorthwindContext db) =&gt;
        db.Products.Where(product =&gt; product.Discontinued)
      )
      .WithName(</span><span class="hljs-string"><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml">"GetProductsDiscontinued"</span></span><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">)
      .WithOpenApi()
      .Produces&lt;Product[]&gt;(StatusCodes.Status200OK);
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/{id:int}"</span></span><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">,
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml">Task</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">Results</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">Ok</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">&gt;, NotFound&gt;&gt; (</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">      [FromServices] NorthwindContext db,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">      [FromRoute] </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml"> id</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml"> =&gt;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml"> db.Products.FindAsync(id) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">is</span></span><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml"> Product product ?
          </span><span class="koboSpan" id="kobo.574.2" xmlns="http://www.w3.org/1999/xhtml">TypedResults.Ok(product) : TypedResults.NotFound())
      .WithName(</span><span class="hljs-string"><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">"GetProductById"</span></span><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml">)
      .WithOpenApi()
      .Produces&lt;Product&gt;(StatusCodes.Status200OK)
      .Produces(StatusCodes.Status404NotFound);
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/{name}"</span></span><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">, (
      [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml">FromServices</span></span><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">] NorthwindContext db,
      [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">FromRoute</span></span><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml"> name) =&gt;
        db.Products.Where(p =&gt; p.ProductName.Contains(name)))
      .WithName(</span><span class="hljs-string"><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">GetProductsByName"</span></span><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml">)
      .WithOpenApi()
      .Produces&lt;Product[]&gt;(StatusCodes.Status200OK);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml"> app;
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml">, define an extension method for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml"> class to </span><a id="_idIndexMarker744"/><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml">configure a response to the HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml"> request documented in the API table, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml">MapPosts</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication app</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml">
{
  app.MapPost(</span><span class="hljs-string"><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">"api/products"</span></span><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml"> ([FromBody] Product product, 
    [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml">FromServices</span></span><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml">] NorthwindContext db) =&gt;
  {
    db.Products.Add(product);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml"> db.SaveChangesAsync();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml"> Results.Created(</span><span class="hljs-string"><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">$"api/products/</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">{product.ProductId}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">, product);
  }).WithOpenApi()
    .Produces&lt;Product&gt;(StatusCodes.Status201Created);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml"> app;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">, define an extension method for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml"> class to configure a response to the HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml"> request documented in the</span><a id="_idIndexMarker745"/><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml"> API table, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">MapPuts</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication app</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">
{
  app.MapPut(</span><span class="hljs-string"><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/{id:int}"</span></span><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml"> (
    [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml">FromRoute</span></span><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml"> id, 
    [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml">FromBody</span></span><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">] Product product, 
    [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml">FromServices</span></span><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">] NorthwindContext db) =&gt;
  {
    Product? </span><span class="koboSpan" id="kobo.651.2" xmlns="http://www.w3.org/1999/xhtml">foundProduct = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml"> db.Products.FindAsync(id);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml"> (foundProduct </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml">is</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml"> Results.NotFound();
    foundProduct.ProductName = product.ProductName;
    foundProduct.CategoryId = product.CategoryId;
    foundProduct.SupplierId = product.SupplierId;
    foundProduct.QuantityPerUnit = product.QuantityPerUnit;
    foundProduct.UnitsInStock = product.UnitsInStock;
    foundProduct.UnitsOnOrder = product.UnitsOnOrder;
    foundProduct.ReorderLevel = product.ReorderLevel;
    foundProduct.UnitPrice = product.UnitPrice;
    foundProduct.Discontinued = product.Discontinued;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml"> db.SaveChangesAsync();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml"> Results.NoContent();
  }).WithOpenApi()
    .Produces(StatusCodes.Status404NotFound)
    .Produces(StatusCodes.Status204NoContent);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml"> app;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">, define an extension method for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml"> class to configure a response to the HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml"> request documented in the</span><a id="_idIndexMarker746"/><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml"> API table, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">MapDeletes</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication app</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml">
{
  app.MapDelete(</span><span class="hljs-string"><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/{id:int}"</span></span><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml"> (
    [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml">FromRoute</span></span><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml"> id, 
    [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">FromServices</span></span><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml">] NorthwindContext db) =&gt;
  {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml"> db.Products.FindAsync(id) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">is</span></span><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml"> Product product)
    {
      db.Products.Remove(product);
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml"> db.SaveChangesAsync();
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml"> Results.NoContent();
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml"> Results.NotFound();
  }).WithOpenApi()
    .Produces(StatusCodes.Status404NotFound)
    .Produces(StatusCodes.Status204NoContent);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml"> app;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace to use the extension methods you just defined, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml"> Packt.Extensions; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml">// To use MapGets and so on.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">, before the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml">app.Run()</span></code><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">, call your custom extension methods to map </span><code class="inlineCode"><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml"> requests, noting that you can override the default page size of 10 entities when requesting all products, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGets() </span><span class="hljs-comment"><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">// Default pageSize: 10.</span></span><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml">
  .MapPosts()
  .MapPuts()
  .MapDeletes();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml">, make sure the last statement in the file runs the web app, as shown in the following code:
        </span><pre class="programlisting gen"><code class="hljs"><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml">app.Run();
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-308"><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">Testing web services using Swagger</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">Now we can start the web</span><a id="_idIndexMarker747"/><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml"> service, see its documentation using </span><a id="_idIndexMarker748"/><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">Swagger, and perform basic manual testing:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml">If your database server is not running (for example, because you are hosting it in Docker, a virtual machine, or in the cloud), then make sure to start it.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">Start the web service project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml"> profile:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, then select the </span><strong class="screenText"><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml">https</span></strong><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml"> profile in the drop-down list and then navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">Debug</span></strong><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">Start Without Debugging</span></strong><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml"> or press </span><em class="keystroke"><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">Ctrl</span></em><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">F5</span></em><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.752.2" xmlns="http://www.w3.org/1999/xhtml">A web browser should navigate to the Swagger documentation web page automatically.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, then enter the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml">dotnet run --launch-profile https</span></code><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">, manually start a web browser, and navigate to the Swagger documentation web page: </span><a href="https://localhost:5081/swagger"><span class="url"><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5081/swagger</span></span></a><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">On Windows, if prompted to do so, you will have to set Windows Defender Firewall to allow access to your local web service.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml">In the console or</span><a id="_idIndexMarker749"/><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml"> terminal, note the information about your web service, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:5081
info: Microsoft.Hosting.Lifetime[0]
      Application started. </span><span class="koboSpan" id="kobo.761.2" xmlns="http://www.w3.org/1999/xhtml">Press Ctrl+C to shut down.
</span><span class="koboSpan" id="kobo.761.3" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: C:\apps-services-net8\Chapter08\Northwind.WebApi.Service
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml">In your web browser, note </span><a id="_idIndexMarker750"/><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">the Swagger documentation, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.1</span></em><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.1: Swagger documentation for the Northwind Web API service</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">GET /api/products</span></strong><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><a id="_idIndexMarker751"/><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">expand that section.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">Try it out</span></strong><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml"> button, note the optional query string parameter named </span><strong class="screenText"><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">page</span></strong><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">, and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></strong><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">Note the response</span><a id="_idIndexMarker752"/><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml"> includes the first ten products that are in stock and not discontinued: </span><code class="inlineCode"><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">1</span></code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml">2</span></code><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml">3</span></code><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml">4</span></code><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml">6</span></code><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">7</span></code><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">8</span></code><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">10</span></code><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">11</span></code><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">12</span></code><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">For the </span><strong class="screenText"><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">page</span></strong><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml"> parameter, enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml">3</span></code><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">, and then click the </span><strong class="screenText"><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></strong><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml"> button.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">Note the response includes</span><a id="_idIndexMarker753"/><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml"> the third page of ten products that are in stock and are not discontinued: </span><code class="inlineCode"><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">25</span></code><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">26</span></code><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">27</span></code><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">30</span></code><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">32</span></code><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml">33</span></code><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml">34</span></code><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">35</span></code><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml">36</span></code><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">37</span></code><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml">GET /api/products</span></strong><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml"> to collapse that section.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml">Try executing the </span><strong class="screenText"><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml">GET /api/products/outofstock</span></strong><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml"> path and note it returns one product, </span><strong class="screenText"><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml">31 Gorgonzola Telino</span></strong><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml">, which has zero units in stock and is not discontinued.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml">Try executing the </span><strong class="screenText"><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">GET /api/products/discontinued</span></strong><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml"> path and note it returns eight products, </span><code class="inlineCode"><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">5</span></code><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">9</span></code><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml">17</span></code><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml">24</span></code><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">28</span></code><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">29</span></code><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml">42</span></code><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml">53</span></code><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml">, which all have their </span><code class="inlineCode"><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">Discontinued</span></code><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml"> properties set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">true</span></code><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml">GET /api/products/{id}</span></strong><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml"> to expand that section.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml">Try it out</span></strong><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml">, enter the required </span><strong class="screenText"><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml">id</span></strong><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml"> parameter as </span><code class="inlineCode"><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml">77</span></code><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></strong><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">, and note the response</span><a id="_idIndexMarker754"/><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml"> contains the product named </span><strong class="screenText"><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">Original Frankfurter grüne Soße</span></strong><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following JSON document:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml">"productId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml">77</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml">"Original Frankfurter grüne Soße"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml">"supplierId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml">12</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml">"categoryId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml">"quantityPerUnit"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml">"12 boxes"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml">13</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml">"unitsInStock"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml">32</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml">"unitsOnOrder"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml">"reorderLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml">15</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml">"discontinued"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml">"category"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml">"supplier"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml">"orderDetails"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml">[]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml">GET /api/products/{id}</span></strong><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml"> to collapse that section.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml">GET /api/products/{name}</span></strong><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml"> to expand that section.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml">Try it out</span></strong><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml">, enter the required </span><strong class="screenText"><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml">name</span></strong><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml"> parameter as </span><code class="inlineCode"><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml">man</span></code><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml">Execute</span></strong><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml">, and note the response contains the products named </span><strong class="screenText"><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml">Queso Manchego La Pastora</span></strong><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml">Manjimup Dried Apples</span></strong><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">Leave the web service running.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-309"><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml">Testing web services with code editor tools</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml">Using the Swagger user interface to test web services can quickly get clumsy. </span><span class="koboSpan" id="kobo.950.2" xmlns="http://www.w3.org/1999/xhtml">A better tool is either the Visual </span><a id="_idIndexMarker755"/><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">Studio Code extension named </span><strong class="keyWord"><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml">REST Client</span></strong><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml"> or the </span><strong class="screenText"><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">Endpoints Explorer</span></strong><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml">.http</span></code><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml"> file support available </span><a id="_idIndexMarker756"/><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">with Visual Studio 2022 version 17.6 or later. </span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">: You can learn about Visual Studio 2022 and its HTTP editor at the following link: </span><a href="https://learn.microsoft.com/en-us/aspnet/core/test/http-files"><span class="url"><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/test/http-files</span></span></a><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml">JetBrains Rider has a similar tool window named </span><strong class="screenText"><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">Endpoints</span></strong><span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">If you are using JetBrains Rider, you can read about its tools for HTTP files at the following link: </span><a href="https://www.jetbrains.com/help/rider/Http_client_in__product__code_editor.html"><span class="url"><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml">https://www.jetbrains.com/help/rider/Http_client_in__product__code_editor.html</span></span></a><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.968.2" xmlns="http://www.w3.org/1999/xhtml">It is slightly different from the other two code editors. </span><span class="koboSpan" id="kobo.968.3" xmlns="http://www.w3.org/1999/xhtml">In particular, how Rider handles setting variables is more awkward, as shown at the following link: </span><a href="https://www.jetbrains.com/help/rider/Exploring_HTTP_Syntax.html#example-working-with-environment-files"><span class="url"><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">https://www.jetbrains.com/help/rider/Exploring_HTTP_Syntax.html#example-working-with-environment-files</span></span></a><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.970.2" xmlns="http://www.w3.org/1999/xhtml">You might prefer to use Visual Studio Code with the REST Client extension for this section.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see how these help us test a web service:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml">Make sure you have the web service testing tools installed:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, then make sure you have version 17.6 or later (released in May 2023).</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, then make sure you have installed the REST Client extension by Huachao Mao (</span><code class="inlineCode"><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">humao.rest-client</span></code><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml">).</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.978.1" xmlns="http://www.w3.org/1999/xhtml">View</span></strong><span class="koboSpan" id="kobo.979.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.980.1" xmlns="http://www.w3.org/1999/xhtml">Other Windows</span></strong><span class="koboSpan" id="kobo.981.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.982.1" xmlns="http://www.w3.org/1999/xhtml">Endpoints Explorer</span></strong><span class="koboSpan" id="kobo.983.1" xmlns="http://www.w3.org/1999/xhtml">, and note the current project is scanned for potential Web API endpoints, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.984.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.2</span></em><span class="koboSpan" id="kobo.985.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.986.1" xmlns="http://www.w3.org/1999/xhtml">In your preferred code editor, start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.987.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.988.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.989.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.990.1" xmlns="http://www.w3.org/1999/xhtml"> profile (if it is not already running) and leave it running.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.991.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.992.1" xmlns="http://www.w3.org/1999/xhtml">apps-services-net8</span></code><span class="koboSpan" id="kobo.993.1" xmlns="http://www.w3.org/1999/xhtml"> folder, if it does not already exist, create an </span><code class="inlineCode"><span class="koboSpan" id="kobo.994.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.995.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.996.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.997.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.998.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.999.1" xmlns="http://www.w3.org/1999/xhtml">webapi-get-products.http</span></code><span class="koboSpan" id="kobo.1000.1" xmlns="http://www.w3.org/1999/xhtml"> and modify its contents to declare a variable to hold the base address of the Web API service products endpoint and a request to get the first page of ten products, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1001.1" xmlns="http://www.w3.org/1999/xhtml">### Configure a variable for the web service base address.
</span><span class="koboSpan" id="kobo.1001.2" xmlns="http://www.w3.org/1999/xhtml">@base_address = https://localhost:5081/api/products/
### Get first page of 10 products that are in stock and not discontinued.
</span><span class="koboSpan" id="kobo.1001.3" xmlns="http://www.w3.org/1999/xhtml">GET {{base_address}} 
</span></code></pre>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1002.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.1003.1" xmlns="http://www.w3.org/1999/xhtml">: REST Client</span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.1004.1" xmlns="http://www.w3.org/1999/xhtml"> does not require </span><code class="inlineCode"><span class="koboSpan" id="kobo.1005.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.1006.1" xmlns="http://www.w3.org/1999/xhtml"> at the beginning of a request because it will assume </span><code class="inlineCode"><span class="koboSpan" id="kobo.1007.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.1008.1" xmlns="http://www.w3.org/1999/xhtml"> as the default. </span><span class="koboSpan" id="kobo.1008.2" xmlns="http://www.w3.org/1999/xhtml">But at the time of writing, Visual Studio’s HTTP editor requires </span><code class="inlineCode"><span class="koboSpan" id="kobo.1009.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.1010.1" xmlns="http://www.w3.org/1999/xhtml"> to be explicitly specified. </span><span class="koboSpan" id="kobo.1010.2" xmlns="http://www.w3.org/1999/xhtml">For now, I recommend that you specify the HTTP method for all tools, and I will do so for all </span><code class="inlineCode"><span class="koboSpan" id="kobo.1011.1" xmlns="http://www.w3.org/1999/xhtml">.http</span></code><span class="koboSpan" id="kobo.1012.1" xmlns="http://www.w3.org/1999/xhtml"> files for my books.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1013.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.1014.1" xmlns="http://www.w3.org/1999/xhtml">Send Request</span></strong><span class="koboSpan" id="kobo.1015.1" xmlns="http://www.w3.org/1999/xhtml">, and note </span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.1016.1" xmlns="http://www.w3.org/1999/xhtml">the response is the same as what was returned by Swagger, a JSON document response containing the first ten products that are in stock and not discontinued, as shown in Visual Studio 2022 in </span><em class="italic"><span class="koboSpan" id="kobo.1017.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.2</span></em><span class="koboSpan" id="kobo.1018.1" xmlns="http://www.w3.org/1999/xhtml"> and Visual Studio Code in </span><em class="italic"><span class="koboSpan" id="kobo.1019.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.3</span></em><span class="koboSpan" id="kobo.1020.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1021.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1022.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.2: Visual Studio 2022 getting products from the web API service</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1023.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1024.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.3: Visual Studio Code REST Client getting products from the web API service</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.1025.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1026.1" xmlns="http://www.w3.org/1999/xhtml">webapi-get-products.http</span></code><span class="koboSpan" id="kobo.1027.1" xmlns="http://www.w3.org/1999/xhtml">, add </span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.1028.1" xmlns="http://www.w3.org/1999/xhtml">more requests separated by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1029.1" xmlns="http://www.w3.org/1999/xhtml">###</span></code><span class="koboSpan" id="kobo.1030.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the</span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.1031.1" xmlns="http://www.w3.org/1999/xhtml"> following file:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1032.1" xmlns="http://www.w3.org/1999/xhtml">### Get third page of 10 products that are in stock and not discontinued
GET {{base_address}}?page=3
### Get products that are out-of-stock but not discontinued
GET {{base_address}}outofstock
### Get products that are discontinued
GET {{base_address}}discontinued
### Get product 77
GET {{base_address}}77
### Get products that contain "man"
GET {{base_address}}man
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1033.1" xmlns="http://www.w3.org/1999/xhtml">You can execute an HTTP request in Visual Studio 2022 by clicking the green triangle “play” button, by right-clicking and selecting </span><strong class="screenText"><span class="koboSpan" id="kobo.1034.1" xmlns="http://www.w3.org/1999/xhtml">Send Request</span></strong><span class="koboSpan" id="kobo.1035.1" xmlns="http://www.w3.org/1999/xhtml">, or by pressing </span><em class="keystroke"><span class="koboSpan" id="kobo.1036.1" xmlns="http://www.w3.org/1999/xhtml">Ctrl</span></em><span class="koboSpan" id="kobo.1037.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.1038.1" xmlns="http://www.w3.org/1999/xhtml">Alt</span></em><span class="koboSpan" id="kobo.1039.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.1040.1" xmlns="http://www.w3.org/1999/xhtml">S</span></em><span class="koboSpan" id="kobo.1041.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1041.2" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio Code, click </span><strong class="screenText"><span class="koboSpan" id="kobo.1042.1" xmlns="http://www.w3.org/1999/xhtml">Send Request</span></strong><span class="koboSpan" id="kobo.1043.1" xmlns="http://www.w3.org/1999/xhtml"> above each query, or navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.1044.1" xmlns="http://www.w3.org/1999/xhtml">View</span></strong><span class="koboSpan" id="kobo.1045.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.1046.1" xmlns="http://www.w3.org/1999/xhtml">Command Palette</span></strong><span class="koboSpan" id="kobo.1047.1" xmlns="http://www.w3.org/1999/xhtml"> and select </span><strong class="screenText"><span class="koboSpan" id="kobo.1048.1" xmlns="http://www.w3.org/1999/xhtml">Rest Client: Send Request</span></strong><span class="koboSpan" id="kobo.1049.1" xmlns="http://www.w3.org/1999/xhtml">, or use its keyboard shortcut (</span><em class="keystroke"><span class="koboSpan" id="kobo.1050.1" xmlns="http://www.w3.org/1999/xhtml">Ctrl</span></em><span class="koboSpan" id="kobo.1051.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.1052.1" xmlns="http://www.w3.org/1999/xhtml">Alt</span></em><span class="koboSpan" id="kobo.1053.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.1054.1" xmlns="http://www.w3.org/1999/xhtml">R</span></em><span class="koboSpan" id="kobo.1055.1" xmlns="http://www.w3.org/1999/xhtml"> on Windows).</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.1056.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1057.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.1058.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1059.1" xmlns="http://www.w3.org/1999/xhtml">webapi-insert-product.http</span></code><span class="koboSpan" id="kobo.1060.1" xmlns="http://www.w3.org/1999/xhtml"> and modify</span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.1061.1" xmlns="http://www.w3.org/1999/xhtml"> its contents to contain a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1062.1" xmlns="http://www.w3.org/1999/xhtml">POST </span></strong><span class="koboSpan" id="kobo.1063.1" xmlns="http://www.w3.org/1999/xhtml">request to insert a new product, as shown</span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.1064.1" xmlns="http://www.w3.org/1999/xhtml"> in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1065.1" xmlns="http://www.w3.org/1999/xhtml">POST https</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1066.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1067.1" xmlns="http://www.w3.org/1999/xhtml">//localhost:5081/api/products/</span></span><span class="koboSpan" id="kobo.1068.1" xmlns="http://www.w3.org/1999/xhtml">
Content-Type</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1069.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.1070.1" xmlns="http://www.w3.org/1999/xhtml"> application/json
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1071.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1072.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1073.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1074.1" xmlns="http://www.w3.org/1999/xhtml">"Harry's Hamburgers"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1075.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1076.1" xmlns="http://www.w3.org/1999/xhtml">"supplierId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1077.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1078.1" xmlns="http://www.w3.org/1999/xhtml">7</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1079.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1080.1" xmlns="http://www.w3.org/1999/xhtml">"categoryId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1081.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1082.1" xmlns="http://www.w3.org/1999/xhtml">6</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1083.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1084.1" xmlns="http://www.w3.org/1999/xhtml">"quantityPerUnit"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1085.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1086.1" xmlns="http://www.w3.org/1999/xhtml">"6 per box"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1087.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1088.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1089.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1090.1" xmlns="http://www.w3.org/1999/xhtml">24.99</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1091.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1092.1" xmlns="http://www.w3.org/1999/xhtml">"unitsInStock"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1093.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1094.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1095.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1096.1" xmlns="http://www.w3.org/1999/xhtml">"unitsOnOrder"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1097.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1098.1" xmlns="http://www.w3.org/1999/xhtml">20</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1099.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1100.1" xmlns="http://www.w3.org/1999/xhtml">"reorderLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1101.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1102.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1103.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1104.1" xmlns="http://www.w3.org/1999/xhtml">"discontinued"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1105.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1106.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1107.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1108.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.1109.1" xmlns="http://www.w3.org/1999/xhtml">Send Request</span></strong><span class="koboSpan" id="kobo.1110.1" xmlns="http://www.w3.org/1999/xhtml">, and note the response indicates that the new product was added successfully because the status code is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1111.1" xmlns="http://www.w3.org/1999/xhtml">201</span></code><span class="koboSpan" id="kobo.1112.1" xmlns="http://www.w3.org/1999/xhtml">, and its location includes its product ID, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1113.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.4</span></em><span class="koboSpan" id="kobo.1114.1" xmlns="http://www.w3.org/1999/xhtml">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.1115.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1116.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.4: REST Client inserting a new product by calling the web API service</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1117.1" xmlns="http://www.w3.org/1999/xhtml">Originally, there were 77</span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.1118.1" xmlns="http://www.w3.org/1999/xhtml"> products in the Northwind database. </span><span class="koboSpan" id="kobo.1118.2" xmlns="http://www.w3.org/1999/xhtml">The next product ID would be 78. </span><span class="koboSpan" id="kobo.1118.3" xmlns="http://www.w3.org/1999/xhtml">The actual product ID assigned automatically will depend on whether you have previously added any other products, so your assigned number might be higher.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.1119.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1120.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.1121.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create </span><a id="_idIndexMarker764"/><span class="koboSpan" id="kobo.1122.1" xmlns="http://www.w3.org/1999/xhtml">a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1123.1" xmlns="http://www.w3.org/1999/xhtml">webapi-update-product.http</span></code><span class="koboSpan" id="kobo.1124.1" xmlns="http://www.w3.org/1999/xhtml"> and modify its contents to contain a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1125.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.1126.1" xmlns="http://www.w3.org/1999/xhtml"> request to update the product with ID </span><code class="inlineCode"><span class="koboSpan" id="kobo.1127.1" xmlns="http://www.w3.org/1999/xhtml">78</span></code><span class="koboSpan" id="kobo.1128.1" xmlns="http://www.w3.org/1999/xhtml"> (or whatever number was assigned to your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1129.1" xmlns="http://www.w3.org/1999/xhtml">Harry's Hamburgers</span></code><span class="koboSpan" id="kobo.1130.1" xmlns="http://www.w3.org/1999/xhtml">) with a different quantity per unit, unit price, and units in stock, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1131.1" xmlns="http://www.w3.org/1999/xhtml">PUT https</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1132.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1133.1" xmlns="http://www.w3.org/1999/xhtml">//localhost:5081/api/products/78</span></span><span class="koboSpan" id="kobo.1134.1" xmlns="http://www.w3.org/1999/xhtml">
Content-Type</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1135.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span><span class="koboSpan" id="kobo.1136.1" xmlns="http://www.w3.org/1999/xhtml"> application/json
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1137.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1138.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1139.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1140.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1141.1" xmlns="http://www.w3.org/1999/xhtml">Harry's Hamburgers"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1142.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1143.1" xmlns="http://www.w3.org/1999/xhtml">"supplierId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1144.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1145.1" xmlns="http://www.w3.org/1999/xhtml">7</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1146.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1147.1" xmlns="http://www.w3.org/1999/xhtml">"categoryId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1148.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1149.1" xmlns="http://www.w3.org/1999/xhtml">6</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1150.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1151.1" xmlns="http://www.w3.org/1999/xhtml">"quantityPerUnit"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1152.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1153.1" xmlns="http://www.w3.org/1999/xhtml">"12 per box"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1154.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1155.1" xmlns="http://www.w3.org/1999/xhtml">"unitPrice"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1156.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1157.1" xmlns="http://www.w3.org/1999/xhtml">44.99</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1158.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1159.1" xmlns="http://www.w3.org/1999/xhtml">"unitsInStock"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1160.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1161.1" xmlns="http://www.w3.org/1999/xhtml">50</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1162.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1163.1" xmlns="http://www.w3.org/1999/xhtml">"unitsOnOrder"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1164.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1165.1" xmlns="http://www.w3.org/1999/xhtml">20</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1166.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1167.1" xmlns="http://www.w3.org/1999/xhtml">"reorderLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1168.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1169.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1170.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1171.1" xmlns="http://www.w3.org/1999/xhtml">"discontinued"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1172.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1173.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1174.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1175.1" xmlns="http://www.w3.org/1999/xhtml">Send the request and note you should get a 204 status code in the response, meaning a successful update.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1176.1" xmlns="http://www.w3.org/1999/xhtml">Confirm the product was updated by executing a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1177.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.1178.1" xmlns="http://www.w3.org/1999/xhtml"> request for the product ID.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1179.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1180.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.1181.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1182.1" xmlns="http://www.w3.org/1999/xhtml">webapi-delete-product.http</span></code><span class="koboSpan" id="kobo.1183.1" xmlns="http://www.w3.org/1999/xhtml"> and modify its contents to contain a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1184.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code><span class="koboSpan" id="kobo.1185.1" xmlns="http://www.w3.org/1999/xhtml"> request for the new product, as</span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.1186.1" xmlns="http://www.w3.org/1999/xhtml"> shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1187.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></span><span class="koboSpan" id="kobo.1188.1" xmlns="http://www.w3.org/1999/xhtml"> https:</span><span class="hljs-operator"><span class="koboSpan" id="kobo.1189.1" xmlns="http://www.w3.org/1999/xhtml">//</span></span><span class="koboSpan" id="kobo.1190.1" xmlns="http://www.w3.org/1999/xhtml">localhost:</span><span class="hljs-number"><span class="koboSpan" id="kobo.1191.1" xmlns="http://www.w3.org/1999/xhtml">5081</span></span><span class="hljs-operator"><span class="koboSpan" id="kobo.1192.1" xmlns="http://www.w3.org/1999/xhtml">/</span></span><span class="koboSpan" id="kobo.1193.1" xmlns="http://www.w3.org/1999/xhtml">api</span><span class="hljs-operator"><span class="koboSpan" id="kobo.1194.1" xmlns="http://www.w3.org/1999/xhtml">/</span></span><span class="koboSpan" id="kobo.1195.1" xmlns="http://www.w3.org/1999/xhtml">products</span><span class="hljs-operator"><span class="koboSpan" id="kobo.1196.1" xmlns="http://www.w3.org/1999/xhtml">/</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1197.1" xmlns="http://www.w3.org/1999/xhtml">78</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1198.1" xmlns="http://www.w3.org/1999/xhtml">Note the successful </span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.1199.1" xmlns="http://www.w3.org/1999/xhtml">response, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1200.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.5</span></em><span class="koboSpan" id="kobo.1201.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1202.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1203.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.5: Deleting a product using the Web API service</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="14"><span class="koboSpan" id="kobo.1204.1" xmlns="http://www.w3.org/1999/xhtml">Send the request again and note the response contains a 404 status code because the product has now been deleted.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1205.1" xmlns="http://www.w3.org/1999/xhtml">Shut down the web server.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-310"><span class="koboSpan" id="kobo.1206.1" xmlns="http://www.w3.org/1999/xhtml">Excluding paths from OpenAPI documentation</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1207.1" xmlns="http://www.w3.org/1999/xhtml">Sometimes you want to have a path that works but is not shown in the Swagger documentation. </span><span class="koboSpan" id="kobo.1207.2" xmlns="http://www.w3.org/1999/xhtml">Let’s see how to</span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.1208.1" xmlns="http://www.w3.org/1999/xhtml"> remove the service base address that returns a plain text </span><code class="inlineCode"><span class="koboSpan" id="kobo.1209.1" xmlns="http://www.w3.org/1999/xhtml">Hello World!</span></code><span class="koboSpan" id="kobo.1210.1" xmlns="http://www.w3.org/1999/xhtml"> response from the Swagger documentation web page:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1211.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1212.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.1213.1" xmlns="http://www.w3.org/1999/xhtml">, for the root path that returns </span><code class="inlineCode"><span class="koboSpan" id="kobo.1214.1" xmlns="http://www.w3.org/1999/xhtml">Hello World</span></code><span class="koboSpan" id="kobo.1215.1" xmlns="http://www.w3.org/1999/xhtml">, exclude it from the OpenAPI documentation, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1216.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1217.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.1218.1" xmlns="http://www.w3.org/1999/xhtml">, () =&gt; </span><span class="hljs-string"><span class="koboSpan" id="kobo.1219.1" xmlns="http://www.w3.org/1999/xhtml">"Hello World!"</span></span><span class="koboSpan" id="kobo.1220.1" xmlns="http://www.w3.org/1999/xhtml">)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1221.1" xmlns="http://www.w3.org/1999/xhtml">  .ExcludeFromDescription();</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1222.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1223.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.1224.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1225.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.1226.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging and note the path is now not documented.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1227.1" xmlns="http://www.w3.org/1999/xhtml">We have a working web service implemented using ASP.NET Core Minimal APIs. </span><span class="koboSpan" id="kobo.1227.2" xmlns="http://www.w3.org/1999/xhtml">Now let’s attack it! </span><span class="koboSpan" id="kobo.1227.3" xmlns="http://www.w3.org/1999/xhtml">(So that we can learn how to prevent those attacks.)</span></p>
<h2 class="heading-2" id="_idParaDest-311"><span class="koboSpan" id="kobo.1228.1" xmlns="http://www.w3.org/1999/xhtml">Visual Studio 2022 scaffolding for Minimal APIs</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1229.1" xmlns="http://www.w3.org/1999/xhtml">It is important to learn how to implement a</span><a id="_idIndexMarker768"/><span class="koboSpan" id="kobo.1230.1" xmlns="http://www.w3.org/1999/xhtml"> service using minimal APIs from scratch so that you properly understand it. </span><span class="koboSpan" id="kobo.1230.2" xmlns="http://www.w3.org/1999/xhtml">But once you know how to do it manually, the process can be automated and the boilerplate code can be written for you, especially if you are building a web API that wraps an EF Core entity model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1231.1" xmlns="http://www.w3.org/1999/xhtml">For example, Visual Studio </span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.1232.1" xmlns="http://www.w3.org/1999/xhtml">2022 has a project item template named </span><strong class="screenText"><span class="koboSpan" id="kobo.1233.1" xmlns="http://www.w3.org/1999/xhtml">API with read/write endpoints, using Entity Framework</span></strong><span class="koboSpan" id="kobo.1234.1" xmlns="http://www.w3.org/1999/xhtml"> that allows you to select:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1235.1" xmlns="http://www.w3.org/1999/xhtml">An entity model class like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1236.1" xmlns="http://www.w3.org/1999/xhtml">Customer</span></code><span class="koboSpan" id="kobo.1237.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1238.1" xmlns="http://www.w3.org/1999/xhtml">An endpoints class that will contain all the mapping methods.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1239.1" xmlns="http://www.w3.org/1999/xhtml">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1240.1" xmlns="http://www.w3.org/1999/xhtml">DbContext</span></code><span class="koboSpan" id="kobo.1241.1" xmlns="http://www.w3.org/1999/xhtml">-derived class like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1242.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindContext</span></code><span class="koboSpan" id="kobo.1243.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1244.1" xmlns="http://www.w3.org/1999/xhtml">A database provider like SQLite or SQL Server.</span></li>
</ul>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1245.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.1246.1" xmlns="http://www.w3.org/1999/xhtml">: You can learn more about this project item template at the following link: </span><a href="https://devblogs.microsoft.com/visualstudio/web-api-development-in-visual-studio-2022/#scaffolding-in-visual-studio/"><span class="url"><span class="koboSpan" id="kobo.1247.1" xmlns="http://www.w3.org/1999/xhtml">https://devblogs.microsoft.com/visualstudio/web-api-development-in-visual-studio-2022/#scaffolding-in-visual-studio/</span></span></a><span class="koboSpan" id="kobo.1248.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-312"><span class="koboSpan" id="kobo.1249.1" xmlns="http://www.w3.org/1999/xhtml">Relaxing the same origin security policy using CORS</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1250.1" xmlns="http://www.w3.org/1999/xhtml">Modern web browsers support multiple tabs so users can visit multiple websites at the same time efficiently. </span><span class="koboSpan" id="kobo.1250.2" xmlns="http://www.w3.org/1999/xhtml">If code </span><a id="_idIndexMarker770"/><span class="koboSpan" id="kobo.1251.1" xmlns="http://www.w3.org/1999/xhtml">executing in one tab could access resources in another tab, then that could be a vector of attack.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1252.1" xmlns="http://www.w3.org/1999/xhtml">All web browsers implement a </span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.1253.1" xmlns="http://www.w3.org/1999/xhtml">security feature called the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1254.1" xmlns="http://www.w3.org/1999/xhtml">same origin policy</span></strong><span class="koboSpan" id="kobo.1255.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1255.2" xmlns="http://www.w3.org/1999/xhtml">This means that only requests that come from the same origin are allowed. </span><span class="koboSpan" id="kobo.1255.3" xmlns="http://www.w3.org/1999/xhtml">For example, if a block of JavaScript is served from the </span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.1256.1" xmlns="http://www.w3.org/1999/xhtml">same origin that hosts a web service or served an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1257.1" xmlns="http://www.w3.org/1999/xhtml">&lt;iframe&gt;</span></code><span class="koboSpan" id="kobo.1258.1" xmlns="http://www.w3.org/1999/xhtml">, then that JavaScript can call the service and access the data in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1259.1" xmlns="http://www.w3.org/1999/xhtml">&lt;iframe&gt;</span></code><span class="koboSpan" id="kobo.1260.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1260.2" xmlns="http://www.w3.org/1999/xhtml">If a request is made from a different origin, then the request fails. </span><span class="koboSpan" id="kobo.1260.3" xmlns="http://www.w3.org/1999/xhtml">But what counts as the “same origin?”</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1261.1" xmlns="http://www.w3.org/1999/xhtml">An origin is defined by:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1262.1" xmlns="http://www.w3.org/1999/xhtml">Scheme</span></strong><span class="koboSpan" id="kobo.1263.1" xmlns="http://www.w3.org/1999/xhtml"> aka protocol, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1264.1" xmlns="http://www.w3.org/1999/xhtml">http</span></code><span class="koboSpan" id="kobo.1265.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1266.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.1267.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1268.1" xmlns="http://www.w3.org/1999/xhtml">Port</span></strong><span class="koboSpan" id="kobo.1269.1" xmlns="http://www.w3.org/1999/xhtml">, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1270.1" xmlns="http://www.w3.org/1999/xhtml">801</span></code><span class="koboSpan" id="kobo.1271.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1272.1" xmlns="http://www.w3.org/1999/xhtml">5081</span></code><span class="koboSpan" id="kobo.1273.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1273.2" xmlns="http://www.w3.org/1999/xhtml">The default port for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1274.1" xmlns="http://www.w3.org/1999/xhtml">http</span></code><span class="koboSpan" id="kobo.1275.1" xmlns="http://www.w3.org/1999/xhtml"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1276.1" xmlns="http://www.w3.org/1999/xhtml">80</span></code><span class="koboSpan" id="kobo.1277.1" xmlns="http://www.w3.org/1999/xhtml"> and for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1278.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.1279.1" xmlns="http://www.w3.org/1999/xhtml"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1280.1" xmlns="http://www.w3.org/1999/xhtml">443</span></code><span class="koboSpan" id="kobo.1281.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1282.1" xmlns="http://www.w3.org/1999/xhtml">Host/domain/subdomain</span></strong><span class="koboSpan" id="kobo.1283.1" xmlns="http://www.w3.org/1999/xhtml">, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1284.1" xmlns="http://www.w3.org/1999/xhtml">www.example.com</span></code><span class="koboSpan" id="kobo.1285.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1286.1" xmlns="http://www.w3.org/1999/xhtml">www.example.net</span></code><span class="koboSpan" id="kobo.1287.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1288.1" xmlns="http://www.w3.org/1999/xhtml">example.com</span></code><span class="koboSpan" id="kobo.1289.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1290.1" xmlns="http://www.w3.org/1999/xhtml">If the origin is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1291.1" xmlns="http://www.w3.org/1999/xhtml">https://www.example.com/about-us/</span></code><span class="koboSpan" id="kobo.1292.1" xmlns="http://www.w3.org/1999/xhtml">, then the following are </span><em class="italic"><span class="koboSpan" id="kobo.1293.1" xmlns="http://www.w3.org/1999/xhtml">not</span></em><span class="koboSpan" id="kobo.1294.1" xmlns="http://www.w3.org/1999/xhtml"> the same origin:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1295.1" xmlns="http://www.w3.org/1999/xhtml">Different scheme: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1" xmlns="http://www.w3.org/1999/xhtml">http://www.example.com/about-us/</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1297.1" xmlns="http://www.w3.org/1999/xhtml">Different host/domain: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1" xmlns="http://www.w3.org/1999/xhtml">https://www.example.co.uk/about-us/</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1299.1" xmlns="http://www.w3.org/1999/xhtml">Different subdomain: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1300.1" xmlns="http://www.w3.org/1999/xhtml">https://careers.example.com/about-us/</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1301.1" xmlns="http://www.w3.org/1999/xhtml">Different port: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1302.1" xmlns="http://www.w3.org/1999/xhtml">https://www.example.com:444/about-us/</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1303.1" xmlns="http://www.w3.org/1999/xhtml">It is the web browser that sets the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1304.1" xmlns="http://www.w3.org/1999/xhtml">Origin</span></code><span class="koboSpan" id="kobo.1305.1" xmlns="http://www.w3.org/1999/xhtml"> header automatically when making a request. </span><span class="koboSpan" id="kobo.1305.2" xmlns="http://www.w3.org/1999/xhtml">This cannot be overridden. </span></p>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1306.1" xmlns="http://www.w3.org/1999/xhtml">Warning!</span></strong><span class="koboSpan" id="kobo.1307.1" xmlns="http://www.w3.org/1999/xhtml"> The same origin policy does </span><em class="italic"><span class="koboSpan" id="kobo.1308.1" xmlns="http://www.w3.org/1999/xhtml">not</span></em><span class="koboSpan" id="kobo.1309.1" xmlns="http://www.w3.org/1999/xhtml"> apply to any requests that come from a non-web browser because, in those cases, the programmer could change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1310.1" xmlns="http://www.w3.org/1999/xhtml">Origin</span></code><span class="koboSpan" id="kobo.1311.1" xmlns="http://www.w3.org/1999/xhtml"> header anyway. </span><span class="koboSpan" id="kobo.1311.2" xmlns="http://www.w3.org/1999/xhtml">If you create a console app or even an ASP.NET Core project that uses .NET classes like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1312.1" xmlns="http://www.w3.org/1999/xhtml">HttpClient</span></code><span class="koboSpan" id="kobo.1313.1" xmlns="http://www.w3.org/1999/xhtml"> to make a request, the same origin policy does not apply unless you explicitly set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1314.1" xmlns="http://www.w3.org/1999/xhtml">Origin</span></code><span class="koboSpan" id="kobo.1315.1" xmlns="http://www.w3.org/1999/xhtml"> header.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1316.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see some </span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.1317.1" xmlns="http://www.w3.org/1999/xhtml">examples of calling the web </span><a id="_idIndexMarker774"/><span class="koboSpan" id="kobo.1318.1" xmlns="http://www.w3.org/1999/xhtml">service from a</span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.1319.1" xmlns="http://www.w3.org/1999/xhtml"> web page with a different origin and from a .NET app.</span></p>
<h2 class="heading-2" id="_idParaDest-313"><span class="koboSpan" id="kobo.1320.1" xmlns="http://www.w3.org/1999/xhtml">Configuring HTTP logging for the web service</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1321.1" xmlns="http://www.w3.org/1999/xhtml">First, let’s enable HTTP logging for the web</span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.1322.1" xmlns="http://www.w3.org/1999/xhtml"> service and configure it to show the</span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.1323.1" xmlns="http://www.w3.org/1999/xhtml"> origin of </span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.1324.1" xmlns="http://www.w3.org/1999/xhtml">requests:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1325.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1326.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.1327.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1328.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection.Extensions.cs</span></code><span class="koboSpan" id="kobo.1329.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1330.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1331.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection.Extensions.cs</span></code><span class="koboSpan" id="kobo.1332.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for controlling which HTTP fields are logged, and then define an extension method for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1333.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection</span></code><span class="koboSpan" id="kobo.1334.1" xmlns="http://www.w3.org/1999/xhtml"> interface to add HTTP logging, including the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1335.1" xmlns="http://www.w3.org/1999/xhtml">Origin</span></code><span class="koboSpan" id="kobo.1336.1" xmlns="http://www.w3.org/1999/xhtml"> header and all fields including the response body, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1337.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1338.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.AspNetCore.HttpLogging; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1339.1" xmlns="http://www.w3.org/1999/xhtml">// To use HttpLoggingFields.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1340.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1341.1" xmlns="http://www.w3.org/1999/xhtml">Packt.Extensions</span></span><span class="koboSpan" id="kobo.1342.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1343.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1344.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1345.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1346.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollectionExtensions</span></span><span class="koboSpan" id="kobo.1347.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1348.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1349.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1350.1" xmlns="http://www.w3.org/1999/xhtml"> IServiceCollection </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1351.1" xmlns="http://www.w3.org/1999/xhtml">AddCustomHttpLogging</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1352.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1353.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1354.1" xmlns="http://www.w3.org/1999/xhtml"> IServiceCollection services</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1355.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1356.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    services.AddHttpLogging(options =&gt;
    {
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1357.1" xmlns="http://www.w3.org/1999/xhtml">// Add the Origin header so it will not be redacted.</span></span><span class="koboSpan" id="kobo.1358.1" xmlns="http://www.w3.org/1999/xhtml">
      options.RequestHeaders.Add(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1359.1" xmlns="http://www.w3.org/1999/xhtml">"Origin"</span></span><span class="koboSpan" id="kobo.1360.1" xmlns="http://www.w3.org/1999/xhtml">);
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1361.1" xmlns="http://www.w3.org/1999/xhtml">// By default, the response body is not included.</span></span><span class="koboSpan" id="kobo.1362.1" xmlns="http://www.w3.org/1999/xhtml">
      options.LoggingFields = HttpLoggingFields.All;
    });
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1363.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1364.1" xmlns="http://www.w3.org/1999/xhtml"> services;
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1365.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1366.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1367.1" xmlns="http://www.w3.org/1999/xhtml">, before the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1368.1" xmlns="http://www.w3.org/1999/xhtml">builder.Build()</span></code><span class="koboSpan" id="kobo.1369.1" xmlns="http://www.w3.org/1999/xhtml">, add a statement to add custom HTTP logging, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1370.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddCustomHttpLogging();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1371.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1372.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1373.1" xmlns="http://www.w3.org/1999/xhtml">, after the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1374.1" xmlns="http://www.w3.org/1999/xhtml">UseHttpsRedirection()</span></code><span class="koboSpan" id="kobo.1375.1" xmlns="http://www.w3.org/1999/xhtml">, add a statement to use HTTP logging, as</span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.1376.1" xmlns="http://www.w3.org/1999/xhtml"> shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1377.1" xmlns="http://www.w3.org/1999/xhtml">app.UseHttpLogging();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1378.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1379.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Development.json</span></code><span class="koboSpan" id="kobo.1380.1" xmlns="http://www.w3.org/1999/xhtml">, add </span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.1381.1" xmlns="http://www.w3.org/1999/xhtml">an entry to set the level for HTTP logging to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1382.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></code><span class="koboSpan" id="kobo.1383.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in</span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.1384.1" xmlns="http://www.w3.org/1999/xhtml"> the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1385.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1386.1" xmlns="http://www.w3.org/1999/xhtml">"Logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1387.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1388.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1389.1" xmlns="http://www.w3.org/1999/xhtml">"LogLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1390.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1391.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1392.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1393.1" xmlns="http://www.w3.org/1999/xhtml">Default"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1394.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1395.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1396.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1397.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1398.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1399.1" xmlns="http://www.w3.org/1999/xhtml">"Warning"</span></span><span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1400.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1401.1" xmlns="http://www.w3.org/1999/xhtml">// To enable logging HTTP requests, this must be</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1402.1" xmlns="http://www.w3.org/1999/xhtml">// set to Information (3) or higher.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1403.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore.HttpLogging"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1404.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1405.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1406.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1407.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1408.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
</ol>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1409.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.1410.1" xmlns="http://www.w3.org/1999/xhtml">: The JSON specification does not allow comments but the JSON with Comments format does. </span><span class="koboSpan" id="kobo.1410.2" xmlns="http://www.w3.org/1999/xhtml">You can use JavaScript-style comments using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1411.1" xmlns="http://www.w3.org/1999/xhtml">//</span></code><span class="koboSpan" id="kobo.1412.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1413.1" xmlns="http://www.w3.org/1999/xhtml">/* */</span></code><span class="koboSpan" id="kobo.1414.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1414.2" xmlns="http://www.w3.org/1999/xhtml">You can read more at the following link: </span><a href="https://code.visualstudio.com/docs/languages/json#_json-with-comments"><span class="url"><span class="koboSpan" id="kobo.1415.1" xmlns="http://www.w3.org/1999/xhtml">https://code.visualstudio.com/docs/languages/json#_json-with-comments</span></span></a><span class="koboSpan" id="kobo.1416.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1416.2" xmlns="http://www.w3.org/1999/xhtml">If you are using a fussy code editor, just delete the comment I added above.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-314"><span class="koboSpan" id="kobo.1417.1" xmlns="http://www.w3.org/1999/xhtml">Creating a web page JavaScript client</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1418.1" xmlns="http://www.w3.org/1999/xhtml">Next, let’s create a web </span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.1419.1" xmlns="http://www.w3.org/1999/xhtml">page client that will attempt to use JavaScript on a different port to call the web service:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1420.1" xmlns="http://www.w3.org/1999/xhtml">Use your preferred code editor to </span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.1421.1" xmlns="http://www.w3.org/1999/xhtml">add a new project, as defined in the following list:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1422.1" xmlns="http://www.w3.org/1999/xhtml">Project template: </span><strong class="screenText"><span class="koboSpan" id="kobo.1423.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core Web App (Model-View-Controller) </span></strong><span class="koboSpan" id="kobo.1424.1" xmlns="http://www.w3.org/1999/xhtml">/ </span><code class="inlineCode"><span class="koboSpan" id="kobo.1425.1" xmlns="http://www.w3.org/1999/xhtml">mvc</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1426.1" xmlns="http://www.w3.org/1999/xhtml">Solution file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1427.1" xmlns="http://www.w3.org/1999/xhtml">Chapter08</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1428.1" xmlns="http://www.w3.org/1999/xhtml">Project file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1429.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1430.1" xmlns="http://www.w3.org/1999/xhtml">Other Visual Studio 2022 options:</span><ul>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1431.1" xmlns="http://www.w3.org/1999/xhtml">Authentication Type</span></strong><span class="koboSpan" id="kobo.1432.1" xmlns="http://www.w3.org/1999/xhtml">: </span><strong class="screenText"><span class="koboSpan" id="kobo.1433.1" xmlns="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1434.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1435.1" xmlns="http://www.w3.org/1999/xhtml">Configure for HTTPS</span></strong><span class="koboSpan" id="kobo.1436.1" xmlns="http://www.w3.org/1999/xhtml">: Selected.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1437.1" xmlns="http://www.w3.org/1999/xhtml">Enable Docker</span></strong><span class="koboSpan" id="kobo.1438.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.1439.1" xmlns="http://www.w3.org/1999/xhtml">Do not use top-level statements</span></strong><span class="koboSpan" id="kobo.1440.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1441.1" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio 2022, configure the startup project to be the current selection.</span></li>
</ul>
</li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1442.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1443.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.1444.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1445.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></code><span class="koboSpan" id="kobo.1446.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1447.1" xmlns="http://www.w3.org/1999/xhtml">launchSettings.json</span></code><span class="koboSpan" id="kobo.1448.1" xmlns="http://www.w3.org/1999/xhtml">, change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1449.1" xmlns="http://www.w3.org/1999/xhtml">applicationUrl</span></code><span class="koboSpan" id="kobo.1450.1" xmlns="http://www.w3.org/1999/xhtml"> for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1451.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.1452.1" xmlns="http://www.w3.org/1999/xhtml"> profile to use port </span><code class="inlineCode"><span class="koboSpan" id="kobo.1453.1" xmlns="http://www.w3.org/1999/xhtml">5082</span></code><span class="koboSpan" id="kobo.1454.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1455.1" xmlns="http://www.w3.org/1999/xhtml">"applicationUrl"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1456.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1457.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5082"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1458.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1459.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1460.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.1461.1" xmlns="http://www.w3.org/1999/xhtml"> project file, treat warnings as errors.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1462.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1463.1" xmlns="http://www.w3.org/1999/xhtml">Views/Home</span></code><span class="koboSpan" id="kobo.1464.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1465.1" xmlns="http://www.w3.org/1999/xhtml">Index.cshtml</span></code><span class="koboSpan" id="kobo.1466.1" xmlns="http://www.w3.org/1999/xhtml">, replace the existing markup with the markup below, which has a link to a route that has not been defined yet to define a text box and button, and a JavaScript block that makes a call to the web service to get products that contain a partial name, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1467.1" xmlns="http://www.w3.org/1999/xhtml">@{
  ViewData[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1468.1" xmlns="http://www.w3.org/1999/xhtml">"Title"</span></span><span class="koboSpan" id="kobo.1469.1" xmlns="http://www.w3.org/1999/xhtml">] = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1470.1" xmlns="http://www.w3.org/1999/xhtml">"Products using JavaScript"</span></span><span class="koboSpan" id="kobo.1471.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1472.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1473.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1474.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1475.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1476.1" xmlns="http://www.w3.org/1999/xhtml">"text-center"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1477.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1478.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1479.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1480.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1481.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1482.1" xmlns="http://www.w3.org/1999/xhtml">"display-4"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1483.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1484.1" xmlns="http://www.w3.org/1999/xhtml">@ViewData["Title"]</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1485.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1486.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1487.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1488.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1489.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1490.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1491.1" xmlns="http://www.w3.org/1999/xhtml">
      Go to </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1492.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1493.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1494.1" xmlns="http://www.w3.org/1999/xhtml">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1495.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1496.1" xmlns="http://www.w3.org/1999/xhtml">"/home/products"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1497.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1498.1" xmlns="http://www.w3.org/1999/xhtml">Products using .NET</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1499.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1500.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1501.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1502.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1503.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1504.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1505.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1506.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1507.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1508.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1509.1" xmlns="http://www.w3.org/1999/xhtml">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1510.1" xmlns="http://www.w3.org/1999/xhtml">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1511.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1512.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1513.1" xmlns="http://www.w3.org/1999/xhtml">placeholder</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1514.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1515.1" xmlns="http://www.w3.org/1999/xhtml">"Enter part of a product name"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1516.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1517.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1518.1" xmlns="http://www.w3.org/1999/xhtml">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1519.1" xmlns="http://www.w3.org/1999/xhtml">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1520.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1521.1" xmlns="http://www.w3.org/1999/xhtml">"getProductsButton"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1522.1" xmlns="http://www.w3.org/1999/xhtml">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1523.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1524.1" xmlns="http://www.w3.org/1999/xhtml">"button"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1525.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1526.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1527.1" xmlns="http://www.w3.org/1999/xhtml">"Get Products"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1528.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1529.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1530.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1531.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1532.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1533.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1534.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1535.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1536.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1537.1" xmlns="http://www.w3.org/1999/xhtml">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1538.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1539.1" xmlns="http://www.w3.org/1999/xhtml">"productsTable"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1540.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1541.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1542.1" xmlns="http://www.w3.org/1999/xhtml">"table"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1543.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1544.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1545.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1546.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1547.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1548.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1549.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1550.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1551.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1552.1" xmlns="http://www.w3.org/1999/xhtml">scope</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1553.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1554.1" xmlns="http://www.w3.org/1999/xhtml">"col"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1555.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1556.1" xmlns="http://www.w3.org/1999/xhtml">Product Name</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1557.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1558.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1559.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1560.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1561.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1562.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1563.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1564.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1565.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1566.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1567.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1568.1" xmlns="http://www.w3.org/1999/xhtml">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1569.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1570.1" xmlns="http://www.w3.org/1999/xhtml">"tableBody"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1571.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1572.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1573.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1574.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1575.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1576.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1577.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1578.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1579.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1580.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1581.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1582.1" xmlns="http://www.w3.org/1999/xhtml">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1583.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1584.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.1585.1" xmlns="http://www.w3.org/1999/xhtml"> baseaddress = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1586.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5081/"</span></span><span class="koboSpan" id="kobo.1587.1" xmlns="http://www.w3.org/1999/xhtml">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1588.1" xmlns="http://www.w3.org/1999/xhtml">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1589.1" xmlns="http://www.w3.org/1999/xhtml">xhr_load</span></span><span class="koboSpan" id="kobo.1590.1" xmlns="http://www.w3.org/1999/xhtml">() {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1591.1" xmlns="http://www.w3.org/1999/xhtml">console</span></span><span class="koboSpan" id="kobo.1592.1" xmlns="http://www.w3.org/1999/xhtml">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1593.1" xmlns="http://www.w3.org/1999/xhtml">log</span></span><span class="koboSpan" id="kobo.1594.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1595.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="koboSpan" id="kobo.1596.1" xmlns="http://www.w3.org/1999/xhtml">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1597.1" xmlns="http://www.w3.org/1999/xhtml">responseText</span></span><span class="koboSpan" id="kobo.1598.1" xmlns="http://www.w3.org/1999/xhtml">);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1599.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.1600.1" xmlns="http://www.w3.org/1999/xhtml"> products = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1601.1" xmlns="http://www.w3.org/1999/xhtml">JSON</span></span><span class="koboSpan" id="kobo.1602.1" xmlns="http://www.w3.org/1999/xhtml">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1603.1" xmlns="http://www.w3.org/1999/xhtml">parse</span></span><span class="koboSpan" id="kobo.1604.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1605.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="koboSpan" id="kobo.1606.1" xmlns="http://www.w3.org/1999/xhtml">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1607.1" xmlns="http://www.w3.org/1999/xhtml">responseText</span></span><span class="koboSpan" id="kobo.1608.1" xmlns="http://www.w3.org/1999/xhtml">);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1609.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.1610.1" xmlns="http://www.w3.org/1999/xhtml"> out = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1611.1" xmlns="http://www.w3.org/1999/xhtml">""</span></span><span class="koboSpan" id="kobo.1612.1" xmlns="http://www.w3.org/1999/xhtml">;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1613.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.1614.1" xmlns="http://www.w3.org/1999/xhtml"> i;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1615.1" xmlns="http://www.w3.org/1999/xhtml">for</span></span><span class="koboSpan" id="kobo.1616.1" xmlns="http://www.w3.org/1999/xhtml"> (i = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1617.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.1618.1" xmlns="http://www.w3.org/1999/xhtml">; i &lt; products.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1619.1" xmlns="http://www.w3.org/1999/xhtml">length</span></span><span class="koboSpan" id="kobo.1620.1" xmlns="http://www.w3.org/1999/xhtml">; i++) {
            out += </span><span class="hljs-string"><span class="koboSpan" id="kobo.1621.1" xmlns="http://www.w3.org/1999/xhtml">'&lt;tr&gt;&lt;td&gt;&lt;a href="'</span></span><span class="koboSpan" id="kobo.1622.1" xmlns="http://www.w3.org/1999/xhtml"> + baseaddress + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1623.1" xmlns="http://www.w3.org/1999/xhtml">'api/products/'</span></span><span class="koboSpan" id="kobo.1624.1" xmlns="http://www.w3.org/1999/xhtml"> + 
                products[i].</span><span class="hljs-property"><span class="koboSpan" id="kobo.1625.1" xmlns="http://www.w3.org/1999/xhtml">productId</span></span><span class="koboSpan" id="kobo.1626.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1627.1" xmlns="http://www.w3.org/1999/xhtml">'"&gt;'</span></span><span class="koboSpan" id="kobo.1628.1" xmlns="http://www.w3.org/1999/xhtml"> +
                products[i].</span><span class="hljs-property"><span class="koboSpan" id="kobo.1629.1" xmlns="http://www.w3.org/1999/xhtml">productName</span></span><span class="koboSpan" id="kobo.1630.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1631.1" xmlns="http://www.w3.org/1999/xhtml">'&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;'</span></span><span class="koboSpan" id="kobo.1632.1" xmlns="http://www.w3.org/1999/xhtml">;
        }
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1633.1" xmlns="http://www.w3.org/1999/xhtml">document</span></span><span class="koboSpan" id="kobo.1634.1" xmlns="http://www.w3.org/1999/xhtml">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1635.1" xmlns="http://www.w3.org/1999/xhtml">getElementById</span></span><span class="koboSpan" id="kobo.1636.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1637.1" xmlns="http://www.w3.org/1999/xhtml">"tableBody"</span></span><span class="koboSpan" id="kobo.1638.1" xmlns="http://www.w3.org/1999/xhtml">).</span><span class="hljs-property"><span class="koboSpan" id="kobo.1639.1" xmlns="http://www.w3.org/1999/xhtml">innerHTML</span></span><span class="koboSpan" id="kobo.1640.1" xmlns="http://www.w3.org/1999/xhtml"> = out;
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1641.1" xmlns="http://www.w3.org/1999/xhtml">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1642.1" xmlns="http://www.w3.org/1999/xhtml">getProductsButton_click</span></span><span class="koboSpan" id="kobo.1643.1" xmlns="http://www.w3.org/1999/xhtml">() {
        xhr.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1644.1" xmlns="http://www.w3.org/1999/xhtml">open</span></span><span class="koboSpan" id="kobo.1645.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1646.1" xmlns="http://www.w3.org/1999/xhtml">"GET"</span></span><span class="koboSpan" id="kobo.1647.1" xmlns="http://www.w3.org/1999/xhtml">, baseaddress + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1648.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/"</span></span><span class="koboSpan" id="kobo.1649.1" xmlns="http://www.w3.org/1999/xhtml"> + 
          </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1650.1" xmlns="http://www.w3.org/1999/xhtml">document</span></span><span class="koboSpan" id="kobo.1651.1" xmlns="http://www.w3.org/1999/xhtml">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1652.1" xmlns="http://www.w3.org/1999/xhtml">getElementById</span></span><span class="koboSpan" id="kobo.1653.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1654.1" xmlns="http://www.w3.org/1999/xhtml">"productName"</span></span><span class="koboSpan" id="kobo.1655.1" xmlns="http://www.w3.org/1999/xhtml">).</span><span class="hljs-property"><span class="koboSpan" id="kobo.1656.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="koboSpan" id="kobo.1657.1" xmlns="http://www.w3.org/1999/xhtml">);
        xhr.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1658.1" xmlns="http://www.w3.org/1999/xhtml">send</span></span><span class="koboSpan" id="kobo.1659.1" xmlns="http://www.w3.org/1999/xhtml">();
    }
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1660.1" xmlns="http://www.w3.org/1999/xhtml">document</span></span><span class="koboSpan" id="kobo.1661.1" xmlns="http://www.w3.org/1999/xhtml">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1662.1" xmlns="http://www.w3.org/1999/xhtml">getElementById</span></span><span class="koboSpan" id="kobo.1663.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1664.1" xmlns="http://www.w3.org/1999/xhtml">"getProductsButton"</span></span><span class="koboSpan" id="kobo.1665.1" xmlns="http://www.w3.org/1999/xhtml">)
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1666.1" xmlns="http://www.w3.org/1999/xhtml">addEventListener</span></span><span class="koboSpan" id="kobo.1667.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1668.1" xmlns="http://www.w3.org/1999/xhtml">"click"</span></span><span class="koboSpan" id="kobo.1669.1" xmlns="http://www.w3.org/1999/xhtml">, getProductsButton_click);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1670.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.1671.1" xmlns="http://www.w3.org/1999/xhtml"> xhr = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1672.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1673.1" xmlns="http://www.w3.org/1999/xhtml">XMLHttpRequest</span></span><span class="koboSpan" id="kobo.1674.1" xmlns="http://www.w3.org/1999/xhtml">();
    xhr.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1675.1" xmlns="http://www.w3.org/1999/xhtml">addEventListener</span></span><span class="koboSpan" id="kobo.1676.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1677.1" xmlns="http://www.w3.org/1999/xhtml">"load"</span></span><span class="koboSpan" id="kobo.1678.1" xmlns="http://www.w3.org/1999/xhtml">, xhr_load);
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1679.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1680.1" xmlns="http://www.w3.org/1999/xhtml">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1681.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1682.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1683.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1684.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1685.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1686.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.1687.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1688.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.1689.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1690.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1691.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.1692.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1693.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.1694.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.
    </span><div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1695.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, then the web browser will not start automatically. </span><span class="koboSpan" id="kobo.1695.2" xmlns="http://www.w3.org/1999/xhtml">Start </span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.1696.1" xmlns="http://www.w3.org/1999/xhtml">Chrome, and then navigate to </span><a href="https://localhost:5082"><span class="url"><span class="koboSpan" id="kobo.1697.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5082</span></span></a><span class="koboSpan" id="kobo.1698.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.1699.1" xmlns="http://www.w3.org/1999/xhtml">In Chrome, show </span><strong class="screenText"><span class="koboSpan" id="kobo.1700.1" xmlns="http://www.w3.org/1999/xhtml">Developer Tools</span></strong><span class="koboSpan" id="kobo.1701.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.1702.1" xmlns="http://www.w3.org/1999/xhtml">Console</span></strong><span class="koboSpan" id="kobo.1703.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1704.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.1705.1" xmlns="http://www.w3.org/1999/xhtml">Products using JavaScript</span></strong><span class="koboSpan" id="kobo.1706.1" xmlns="http://www.w3.org/1999/xhtml"> web page, in the text box, enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.1707.1" xmlns="http://www.w3.org/1999/xhtml">man</span></code><span class="koboSpan" id="kobo.1708.1" xmlns="http://www.w3.org/1999/xhtml">, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1709.1" xmlns="http://www.w3.org/1999/xhtml">Get Products</span></strong><span class="koboSpan" id="kobo.1710.1" xmlns="http://www.w3.org/1999/xhtml"> button, and note the</span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.1711.1" xmlns="http://www.w3.org/1999/xhtml"> error, as shown in the following output and in </span><em class="italic"><span class="koboSpan" id="kobo.1712.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.6</span></em><span class="koboSpan" id="kobo.1713.1" xmlns="http://www.w3.org/1999/xhtml">:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1714.1" xmlns="http://www.w3.org/1999/xhtml">Access to XMLHttpRequest at 'https://localhost:5081/api/products/man' from origin 'https://localhost:5082' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
</span><span class="koboSpan" id="kobo.1714.2" xmlns="http://www.w3.org/1999/xhtml">GET https://localhost:5081/api/products/man net::ERR_FAILED 200
</span></code></pre>
</li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1715.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1716.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.6: CORS error in the Chrome Developer Tools console</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.1717.1" xmlns="http://www.w3.org/1999/xhtml">At the command prompt or terminal for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1718.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.1719.1" xmlns="http://www.w3.org/1999/xhtml"> project, note the HTTP log</span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.1720.1" xmlns="http://www.w3.org/1999/xhtml"> for the request and that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1721.1" xmlns="http://www.w3.org/1999/xhtml">Host</span></code><span class="koboSpan" id="kobo.1722.1" xmlns="http://www.w3.org/1999/xhtml"> is on a different port number to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1723.1" xmlns="http://www.w3.org/1999/xhtml">Origin</span></code><span class="koboSpan" id="kobo.1724.1" xmlns="http://www.w3.org/1999/xhtml"> so they are not the same origin, as</span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.1725.1" xmlns="http://www.w3.org/1999/xhtml"> shown highlighted in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1726.1" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware[1]
      Request:
      Protocol: HTTP/2
      Method: GET
      Scheme: https
      PathBase:
      Path: /api/products/man
      Accept: */*
</span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.1727.1" xmlns="http://www.w3.org/1999/xhtml">      Host: localhost:5081</span></strong></span><span class="koboSpan" id="kobo.1728.1" xmlns="http://www.w3.org/1999/xhtml">
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36
      Accept-Encoding: gzip, deflate, br
      Accept-Language: en-US,en;q=0.9,sv;q=0.8
</span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.1729.1" xmlns="http://www.w3.org/1999/xhtml">      Origin: https://localhost:5082</span></strong></span><span class="koboSpan" id="kobo.1730.1" xmlns="http://www.w3.org/1999/xhtml">
      Referer: [Redacted]
      sec-ch-ua: [Redacted]
      sec-ch-ua-mobile: [Redacted]
      sec-ch-ua-platform: [Redacted]
      sec-fetch-site: [Redacted]
      sec-fetch-mode: [Redacted]
      sec-fetch-dest: [Redacted]
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1731.1" xmlns="http://www.w3.org/1999/xhtml">Also note the output shows that the web service did execute the database query and return the products in a JSON document response to the browser, as shown in </span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.1732.1" xmlns="http://www.w3.org/1999/xhtml">the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1733.1" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware[2]
      Response:
      StatusCode: 200
      Content-Type: application/json; charset=utf-8
info: Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware[4]
      ResponseBody: [{"productId":12,"productName":
      "Queso Manchego La Pastora","supplierId":5,"categoryId":4,
      "quantityPerUnit":"10 - 500 g pkgs.","unitPrice":38.0000,
      "unitsInStock":86,"unitsOnOrder":0,"reorderLevel":0,
      "discontinued":false,"category":null,"supplier":null,
      "orderDetails":[]},
      {"productId":51,"productName":"Manjimup Dried Apples",
      "supplierId":24,"categoryId":7,
      "quantityPerUnit":"50 - 300 g pkgs.","unitPrice":53.0000,
      "unitsInStock":20,"unitsOnOrder":0,"reorderLevel":10,
      "discontinued":false,"category":null,"supplier":null,
      "orderDetails":[]}]
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1734.1" xmlns="http://www.w3.org/1999/xhtml">Although the browser</span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.1735.1" xmlns="http://www.w3.org/1999/xhtml"> receives a response containing the data requested, it is the browser that enforces the same origin policy by refusing to reveal the HTTP response to the JavaScript. </span><span class="koboSpan" id="kobo.1735.2" xmlns="http://www.w3.org/1999/xhtml">The web service is not “secured” by CORS.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="11"><span class="koboSpan" id="kobo.1736.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser(s) and shut down the web servers.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-315"><span class="koboSpan" id="kobo.1737.1" xmlns="http://www.w3.org/1999/xhtml">Creating a .NET client</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1738.1" xmlns="http://www.w3.org/1999/xhtml">Next, let’s create a .NET client</span><a id="_idIndexMarker790"/><span class="koboSpan" id="kobo.1739.1" xmlns="http://www.w3.org/1999/xhtml"> to the web service to see that the same origin policy does not apply to non-web</span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.1740.1" xmlns="http://www.w3.org/1999/xhtml"> browsers:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1741.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1742.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.1743.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a reference to the entity models project so that we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1744.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.1745.1" xmlns="http://www.w3.org/1999/xhtml"> class, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1746.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1747.1" xmlns="http://www.w3.org/1999/xhtml">"..\..\Chapter03\Northwind.Common.EntityModels .SqlServer\Northwind.Common.EntityModels.SqlServer.csproj"</span></span><span class="koboSpan" id="kobo.1748.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1749.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1750.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.1751.1" xmlns="http://www.w3.org/1999/xhtml"> project at the command prompt or terminal by entering the following command: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1752.1" xmlns="http://www.w3.org/1999/xhtml">dotnet build</span></code><span class="koboSpan" id="kobo.1753.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1754.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1755.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.1756.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1757.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1758.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for working with HTTP headers, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1759.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1760.1" xmlns="http://www.w3.org/1999/xhtml"> System.Net.Http.Headers; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1761.1" xmlns="http://www.w3.org/1999/xhtml">// To use MediaTypeWithQualityHeaderValue.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1762.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1763.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1764.1" xmlns="http://www.w3.org/1999/xhtml">, before the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1765.1" xmlns="http://www.w3.org/1999/xhtml">builder.Build()</span></code><span class="koboSpan" id="kobo.1766.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to configure an HTTP client factory to call the web service, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1767.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddHttpClient(name: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1768.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.WebApi.Service"</span></span><span class="koboSpan" id="kobo.1769.1" xmlns="http://www.w3.org/1999/xhtml">,
  configureClient: options =&gt;
  {
    options.BaseAddress = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1770.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1771.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1772.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5081/"</span></span><span class="koboSpan" id="kobo.1773.1" xmlns="http://www.w3.org/1999/xhtml">);
    options.DefaultRequestHeaders.Accept.Add(
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1774.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1775.1" xmlns="http://www.w3.org/1999/xhtml"> MediaTypeWithQualityHeaderValue(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1776.1" xmlns="http://www.w3.org/1999/xhtml">"application/json"</span></span><span class="koboSpan" id="kobo.1777.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1778.1" xmlns="http://www.w3.org/1999/xhtml">1.0</span></span><span class="koboSpan" id="kobo.1779.1" xmlns="http://www.w3.org/1999/xhtml">));
  });
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1780.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1781.1" xmlns="http://www.w3.org/1999/xhtml">Controllers</span></code><span class="koboSpan" id="kobo.1782.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1783.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1784.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for the entity models, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1785.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1786.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.EntityModels; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1787.1" xmlns="http://www.w3.org/1999/xhtml">// To use Product.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1788.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1789.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1790.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to store the registered HTTP client factory in a private </span><code class="inlineCode"><span class="koboSpan" id="kobo.1791.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></code><span class="koboSpan" id="kobo.1792.1" xmlns="http://www.w3.org/1999/xhtml"> field, as </span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.1793.1" xmlns="http://www.w3.org/1999/xhtml">shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1794.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1795.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1796.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger&lt;HomeController&gt; _logger;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1797.1" xmlns="http://www.w3.org/1999/xhtml">private</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1798.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1799.1" xmlns="http://www.w3.org/1999/xhtml"> IHttpClientFactory _httpClientFactory;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1800.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1801.1" xmlns="http://www.w3.org/1999/xhtml">HomeController</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1802.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1803.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;HomeController&gt; logger,</span></span>
<span class="hljs-params"> </span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1804.1" xmlns="http://www.w3.org/1999/xhtml">IHttpClientFactory httpClientFactory</span></strong></span><span class="hljs-function"><span class="koboSpan" id="kobo.1805.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1806.1" xmlns="http://www.w3.org/1999/xhtml">
{
  _logger = logger;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1807.1" xmlns="http://www.w3.org/1999/xhtml">  _httpClientFactory = httpClientFactory;</span></strong></span><span class="koboSpan" id="kobo.1808.1" xmlns="http://www.w3.org/1999/xhtml">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1809.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1810.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1811.1" xmlns="http://www.w3.org/1999/xhtml">, add an asynchronous action method named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1812.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></code><span class="koboSpan" id="kobo.1813.1" xmlns="http://www.w3.org/1999/xhtml"> that will use the HTTP factory to request products whose name contains a value entered as </span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.1814.1" xmlns="http://www.w3.org/1999/xhtml">an optional </span><code class="inlineCode"><span class="koboSpan" id="kobo.1815.1" xmlns="http://www.w3.org/1999/xhtml">name</span></code><span class="koboSpan" id="kobo.1816.1" xmlns="http://www.w3.org/1999/xhtml"> parameter in a custom MVC route, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1817.1" xmlns="http://www.w3.org/1999/xhtml">[</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1818.1" xmlns="http://www.w3.org/1999/xhtml">Route(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1819.1" xmlns="http://www.w3.org/1999/xhtml">"home/products/{name?}"</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1820.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1821.1" xmlns="http://www.w3.org/1999/xhtml">]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1822.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1823.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1824.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;IActionResult&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1825.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1826.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1827.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1828.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.1828.2" xmlns="http://www.w3.org/1999/xhtml">name</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1829.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1830.1" xmlns="http://www.w3.org/1999/xhtml">
{
  HttpClient client = _httpClientFactory.CreateClient(
    name: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1831.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.WebApi.Service"</span></span><span class="koboSpan" id="kobo.1832.1" xmlns="http://www.w3.org/1999/xhtml">);
  HttpRequestMessage request = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1833.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1834.1" xmlns="http://www.w3.org/1999/xhtml">(
    method: HttpMethod.Get, requestUri: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1835.1" xmlns="http://www.w3.org/1999/xhtml">$"api/products/</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1836.1" xmlns="http://www.w3.org/1999/xhtml">{name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1837.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1838.1" xmlns="http://www.w3.org/1999/xhtml">);
  HttpResponseMessage response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1839.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.1840.1" xmlns="http://www.w3.org/1999/xhtml"> client.SendAsync(request);
  IEnumerable&lt;Product&gt;? </span><span class="koboSpan" id="kobo.1840.2" xmlns="http://www.w3.org/1999/xhtml">model = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1841.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.1842.1" xmlns="http://www.w3.org/1999/xhtml"> response.Content
    .ReadFromJsonAsync&lt;IEnumerable&lt;Product&gt;&gt;();
  ViewData[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1843.1" xmlns="http://www.w3.org/1999/xhtml">"baseaddress"</span></span><span class="koboSpan" id="kobo.1844.1" xmlns="http://www.w3.org/1999/xhtml">] = client.BaseAddress;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1845.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1846.1" xmlns="http://www.w3.org/1999/xhtml"> View(model);
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1847.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1848.1" xmlns="http://www.w3.org/1999/xhtml">Views/Home</span></code><span class="koboSpan" id="kobo.1849.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1850.1" xmlns="http://www.w3.org/1999/xhtml">Products.cshtml</span></code><span class="koboSpan" id="kobo.1851.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1851.2" xmlns="http://www.w3.org/1999/xhtml">(The Visual Studio 2022 project item template is named </span><strong class="screenText"><span class="koboSpan" id="kobo.1852.1" xmlns="http://www.w3.org/1999/xhtml">Razor View - Empty</span></strong><span class="koboSpan" id="kobo.1853.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1853.2" xmlns="http://www.w3.org/1999/xhtml">The JetBrains Rider project item template is named </span><strong class="screenText"><span class="koboSpan" id="kobo.1854.1" xmlns="http://www.w3.org/1999/xhtml">Razor MVC View</span></strong><span class="koboSpan" id="kobo.1855.1" xmlns="http://www.w3.org/1999/xhtml">.)</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1856.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1857.1" xmlns="http://www.w3.org/1999/xhtml">Products.cshtml</span></code><span class="koboSpan" id="kobo.1858.1" xmlns="http://www.w3.org/1999/xhtml">, modify its contents to output a table of products that match part of a </span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.1859.1" xmlns="http://www.w3.org/1999/xhtml">product name entered in a text box, as shown in the</span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.1860.1" xmlns="http://www.w3.org/1999/xhtml"> following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1861.1" xmlns="http://www.w3.org/1999/xhtml">@using Northwind.EntityModels
@model IEnumerable&lt;Product&gt;?
</span><span class="koboSpan" id="kobo.1861.2" xmlns="http://www.w3.org/1999/xhtml">@{
  ViewData[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1862.1" xmlns="http://www.w3.org/1999/xhtml">"Title"</span></span><span class="koboSpan" id="kobo.1863.1" xmlns="http://www.w3.org/1999/xhtml">] = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1864.1" xmlns="http://www.w3.org/1999/xhtml">"Products using .NET"</span></span><span class="koboSpan" id="kobo.1865.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1866.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1867.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1868.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1869.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1870.1" xmlns="http://www.w3.org/1999/xhtml">"text-center"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1871.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1872.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1873.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1874.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1875.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1876.1" xmlns="http://www.w3.org/1999/xhtml">"display-4"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1877.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1878.1" xmlns="http://www.w3.org/1999/xhtml">@ViewData["Title"]</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1879.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1880.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1881.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1882.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1883.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1884.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1885.1" xmlns="http://www.w3.org/1999/xhtml">
    Go to </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1886.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1887.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1888.1" xmlns="http://www.w3.org/1999/xhtml">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1889.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1890.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1891.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1892.1" xmlns="http://www.w3.org/1999/xhtml">Products using JavaScript</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1893.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1894.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1895.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1896.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1897.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1898.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1899.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1900.1" xmlns="http://www.w3.org/1999/xhtml">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1901.1" xmlns="http://www.w3.org/1999/xhtml">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1902.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1903.1" xmlns="http://www.w3.org/1999/xhtml">"/home/products"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1904.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1905.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1906.1" xmlns="http://www.w3.org/1999/xhtml">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1907.1" xmlns="http://www.w3.org/1999/xhtml">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1908.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1909.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1910.1" xmlns="http://www.w3.org/1999/xhtml">placeholder</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1911.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1912.1" xmlns="http://www.w3.org/1999/xhtml">"Enter part of a product name"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1913.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1914.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1915.1" xmlns="http://www.w3.org/1999/xhtml">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1916.1" xmlns="http://www.w3.org/1999/xhtml">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1917.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1918.1" xmlns="http://www.w3.org/1999/xhtml">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1919.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1920.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1921.1" xmlns="http://www.w3.org/1999/xhtml">"Get Products"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1922.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1923.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1924.1" xmlns="http://www.w3.org/1999/xhtml">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1925.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1926.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1927.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1928.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1929.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1930.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1931.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1932.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1933.1" xmlns="http://www.w3.org/1999/xhtml">"table"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1934.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1935.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1936.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1937.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1938.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1939.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1940.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1941.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1942.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1943.1" xmlns="http://www.w3.org/1999/xhtml">scope</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1944.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1945.1" xmlns="http://www.w3.org/1999/xhtml">"col"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1946.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1947.1" xmlns="http://www.w3.org/1999/xhtml">Product Name</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1948.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1949.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1950.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1951.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1952.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1953.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1954.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1955.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1956.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1957.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1958.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1959.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1960.1" xmlns="http://www.w3.org/1999/xhtml">
        @if (Model is not null)
        {
          @foreach (Product p in Model)
          {
            </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1961.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1962.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1963.1" xmlns="http://www.w3.org/1999/xhtml">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1964.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1965.1" xmlns="http://www.w3.org/1999/xhtml">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1966.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1967.1" xmlns="http://www.w3.org/1999/xhtml">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1968.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1969.1" xmlns="http://www.w3.org/1999/xhtml">"@(ViewData["</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1970.1" xmlns="http://www.w3.org/1999/xhtml">baseaddress</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1971.1" xmlns="http://www.w3.org/1999/xhtml">"])</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1972.1" xmlns="http://www.w3.org/1999/xhtml">api</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1973.1" xmlns="http://www.w3.org/1999/xhtml">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1974.1" xmlns="http://www.w3.org/1999/xhtml">products</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1975.1" xmlns="http://www.w3.org/1999/xhtml">/</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1976.1" xmlns="http://www.w3.org/1999/xhtml">@</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1977.1" xmlns="http://www.w3.org/1999/xhtml">p.ProductId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1978.1" xmlns="http://www.w3.org/1999/xhtml">"&gt;</span></span><span class="koboSpan" id="kobo.1979.1" xmlns="http://www.w3.org/1999/xhtml">@p.ProductName</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1980.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1981.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1982.1" xmlns="http://www.w3.org/1999/xhtml">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1983.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1984.1" xmlns="http://www.w3.org/1999/xhtml">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1985.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1986.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1987.1" xmlns="http://www.w3.org/1999/xhtml">
          }
        }
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1988.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1989.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1990.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1991.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1992.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1993.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1994.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1995.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1996.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1997.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1998.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1999.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2000.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2001.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2002.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2003.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2004.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2005.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2006.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.2007.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2008.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2009.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2010.1" xmlns="http://www.w3.org/1999/xhtml">On the home page, click the link to go to </span><strong class="screenText"><span class="koboSpan" id="kobo.2011.1" xmlns="http://www.w3.org/1999/xhtml">Products using .NET</span></strong><span class="koboSpan" id="kobo.2012.1" xmlns="http://www.w3.org/1999/xhtml">, and note the first ten in-stock, not discontinued products are shown in the table, from </span><strong class="screenText"><span class="koboSpan" id="kobo.2013.1" xmlns="http://www.w3.org/1999/xhtml">Chai</span></strong><span class="koboSpan" id="kobo.2014.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><strong class="screenText"><span class="koboSpan" id="kobo.2015.1" xmlns="http://www.w3.org/1999/xhtml">Queso Manchego La Pastora</span></strong><span class="koboSpan" id="kobo.2016.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2017.1" xmlns="http://www.w3.org/1999/xhtml">In the text box, enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.2018.1" xmlns="http://www.w3.org/1999/xhtml">man</span></code><span class="koboSpan" id="kobo.2019.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.2020.1" xmlns="http://www.w3.org/1999/xhtml">Get Products</span></strong><span class="koboSpan" id="kobo.2021.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.2022.1" xmlns="http://www.w3.org/1999/xhtml">note that two products are shown in the </span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.2023.1" xmlns="http://www.w3.org/1999/xhtml">table, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2024.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.7</span></em><span class="koboSpan" id="kobo.2025.1" xmlns="http://www.w3.org/1999/xhtml">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.2026.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2027.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.7: Getting two products from a web service using .NET</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2028.1" xmlns="http://www.w3.org/1999/xhtml">It is the .NET HTTP client that is calling the web service, so the same origin policy does not apply. </span><span class="koboSpan" id="kobo.2028.2" xmlns="http://www.w3.org/1999/xhtml">If you were to check the logs at the command line or terminal as you did before, you would see the ports are different, but it does not matter.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="14"><span class="koboSpan" id="kobo.2029.1" xmlns="http://www.w3.org/1999/xhtml">Click one of the product names to make a direct request to the web service for an individual product and note the response, as shown in the following document:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2030.1" xmlns="http://www.w3.org/1999/xhtml">{"productId":12,"productName":"Queso Manchego La Pastora",
"supplierId":5,"categoryId":4,
"quantityPerUnit":"10 - 500 g pkgs.","unitPrice":38.0000,
"unitsInStock":86,"unitsOnOrder":0,"reorderLevel":0,
"discontinued":false,"category":null,"supplier":null,"orderDetails":[]}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2031.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-316"><span class="koboSpan" id="kobo.2032.1" xmlns="http://www.w3.org/1999/xhtml">Understanding CORS</span></h2>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2033.1" xmlns="http://www.w3.org/1999/xhtml">Cross-Origin Resource Sharing</span></strong><span class="koboSpan" id="kobo.2034.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2035.1" xmlns="http://www.w3.org/1999/xhtml">CORS</span></strong><span class="koboSpan" id="kobo.2036.1" xmlns="http://www.w3.org/1999/xhtml">) is an HTTP-header-based feature that asks the browser to disable its same-origin security policy in specific scenarios. </span><span class="koboSpan" id="kobo.2036.2" xmlns="http://www.w3.org/1999/xhtml">The HTTP headers indicate which origins should be allowed in</span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.2037.1" xmlns="http://www.w3.org/1999/xhtml"> addition to the same origin.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2038.1" xmlns="http://www.w3.org/1999/xhtml">Let’s enable CORS in the web service so that it can send extra headers to indicate to the browser that it is allowed to access resources from a different origin:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2039.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2040.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2041.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2042.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.2043.1" xmlns="http://www.w3.org/1999/xhtml">, add an extension method to add CORS support to the web service, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2044.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2045.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2046.1" xmlns="http://www.w3.org/1999/xhtml"> IServiceCollection </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2047.1" xmlns="http://www.w3.org/1999/xhtml">AddCustomCors</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2048.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2049.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2050.1" xmlns="http://www.w3.org/1999/xhtml"> IServiceCollection services</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2051.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2052.1" xmlns="http://www.w3.org/1999/xhtml">
{
  services.AddCors(options =&gt;
  {
    options.AddPolicy(name: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2053.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Mvc.Policy"</span></span><span class="koboSpan" id="kobo.2054.1" xmlns="http://www.w3.org/1999/xhtml">,
      policy =&gt;
      {
        policy.WithOrigins(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2055.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5082"</span></span><span class="koboSpan" id="kobo.2056.1" xmlns="http://www.w3.org/1999/xhtml">);
      });
  });
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2057.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.2058.1" xmlns="http://www.w3.org/1999/xhtml"> services;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2059.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2060.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2061.1" xmlns="http://www.w3.org/1999/xhtml">, after creating the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2062.1" xmlns="http://www.w3.org/1999/xhtml">builder</span></code><span class="koboSpan" id="kobo.2063.1" xmlns="http://www.w3.org/1999/xhtml">, call the custom extension method to add CORS support, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2064.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddCustomCors();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2065.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2066.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2067.1" xmlns="http://www.w3.org/1999/xhtml">, after the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2068.1" xmlns="http://www.w3.org/1999/xhtml">UseHttpLogging</span></code><span class="koboSpan" id="kobo.2069.1" xmlns="http://www.w3.org/1999/xhtml">, and before mapping the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2070.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.2071.1" xmlns="http://www.w3.org/1999/xhtml"> requests, add a statement to use the CORS policy, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2072.1" xmlns="http://www.w3.org/1999/xhtml">app.UseCors(policyName: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2073.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Mvc.Policy"</span></span><span class="koboSpan" id="kobo.2074.1" xmlns="http://www.w3.org/1999/xhtml">);
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2075.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2076.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2077.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2078.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2079.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2080.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2081.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.2082.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2083.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2084.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2085.1" xmlns="http://www.w3.org/1999/xhtml">Show </span><strong class="screenText"><span class="koboSpan" id="kobo.2086.1" xmlns="http://www.w3.org/1999/xhtml">Developer Tools</span></strong><span class="koboSpan" id="kobo.2087.1" xmlns="http://www.w3.org/1999/xhtml"> and the </span><strong class="screenText"><span class="koboSpan" id="kobo.2088.1" xmlns="http://www.w3.org/1999/xhtml">Console</span></strong><span class="koboSpan" id="kobo.2089.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2090.1" xmlns="http://www.w3.org/1999/xhtml">On the home page, in the text box, enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.2091.1" xmlns="http://www.w3.org/1999/xhtml">man</span></code><span class="koboSpan" id="kobo.2092.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.2093.1" xmlns="http://www.w3.org/1999/xhtml">Get Products</span></strong><span class="koboSpan" id="kobo.2094.1" xmlns="http://www.w3.org/1999/xhtml">, and note that the console shows the JSON document returned from the web service, and the table is</span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.2095.1" xmlns="http://www.w3.org/1999/xhtml"> filled with the two products, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2096.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.8</span></em><span class="koboSpan" id="kobo.2097.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2098.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2099.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.8: A successful cross-origin request to the web service using JavaScript</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.2100.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-317"><span class="koboSpan" id="kobo.2101.1" xmlns="http://www.w3.org/1999/xhtml">Enabling CORS for specific endpoints</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2102.1" xmlns="http://www.w3.org/1999/xhtml">In the previous example, we</span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.2103.1" xmlns="http://www.w3.org/1999/xhtml"> enabled the same CORS policy for the whole web service. </span><span class="koboSpan" id="kobo.2103.2" xmlns="http://www.w3.org/1999/xhtml">You might need finer control at the endpoint level:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2104.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2105.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2106.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2107.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2108.1" xmlns="http://www.w3.org/1999/xhtml">, change the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2109.1" xmlns="http://www.w3.org/1999/xhtml">UseCors</span></code><span class="koboSpan" id="kobo.2110.1" xmlns="http://www.w3.org/1999/xhtml"> to not specify the policy name, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2111.1" xmlns="http://www.w3.org/1999/xhtml">// </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2112.1" xmlns="http://www.w3.org/1999/xhtml">app.UseCors(policyName: "Northwind.Mvc.Policy");</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2113.1" xmlns="http://www.w3.org/1999/xhtml">// Without a named policy the middleware is added but not active.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2114.1" xmlns="http://www.w3.org/1999/xhtml">app.UseCors();</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2115.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2116.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.2117.1" xmlns="http://www.w3.org/1999/xhtml">, at the end of the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2118.1" xmlns="http://www.w3.org/1999/xhtml">MapGet</span></code><span class="koboSpan" id="kobo.2119.1" xmlns="http://www.w3.org/1999/xhtml"> that gets products that contain part of a product name, add a call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2120.1" xmlns="http://www.w3.org/1999/xhtml">RequiresCors</span></code><span class="koboSpan" id="kobo.2121.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2122.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2123.1" xmlns="http://www.w3.org/1999/xhtml">"api/products/{name}"</span></span><span class="koboSpan" id="kobo.2124.1" xmlns="http://www.w3.org/1999/xhtml">, (
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2125.1" xmlns="http://www.w3.org/1999/xhtml">FromServices</span></span><span class="koboSpan" id="kobo.2126.1" xmlns="http://www.w3.org/1999/xhtml">] NorthwindContext db,
  [</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2127.1" xmlns="http://www.w3.org/1999/xhtml">FromRoute</span></span><span class="koboSpan" id="kobo.2128.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2129.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2130.1" xmlns="http://www.w3.org/1999/xhtml"> name) =&gt;
    db.Products.Where(p =&gt; p.ProductName.Contains(name)))
  .WithName(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2131.1" xmlns="http://www.w3.org/1999/xhtml">"GetProductsByName"</span></span><span class="koboSpan" id="kobo.2132.1" xmlns="http://www.w3.org/1999/xhtml">)
  .WithOpenApi()
  .Produces&lt;Product[]&gt;(StatusCodes.Status200OK)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2133.1" xmlns="http://www.w3.org/1999/xhtml">  .RequireCors(policyName: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2134.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Mvc.Policy"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2135.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2136.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2137.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2138.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2139.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2140.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2141.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2142.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Mvc</span></code><span class="koboSpan" id="kobo.2143.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2144.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2145.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2146.1" xmlns="http://www.w3.org/1999/xhtml">Show </span><strong class="screenText"><span class="koboSpan" id="kobo.2147.1" xmlns="http://www.w3.org/1999/xhtml">Developer Tools</span></strong><span class="koboSpan" id="kobo.2148.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.2149.1" xmlns="http://www.w3.org/1999/xhtml">Console</span></strong><span class="koboSpan" id="kobo.2150.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2151.1" xmlns="http://www.w3.org/1999/xhtml">On the home page, in the text box, enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.2152.1" xmlns="http://www.w3.org/1999/xhtml">cha</span></code><span class="koboSpan" id="kobo.2153.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.2154.1" xmlns="http://www.w3.org/1999/xhtml">Get Products</span></strong><span class="koboSpan" id="kobo.2155.1" xmlns="http://www.w3.org/1999/xhtml">, and note that the console shows the JSON document returned from the web service and the table is filled with three products.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2156.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-318"><span class="koboSpan" id="kobo.2157.1" xmlns="http://www.w3.org/1999/xhtml">Understanding other CORS policy options</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2158.1" xmlns="http://www.w3.org/1999/xhtml">You can control the:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2159.1" xmlns="http://www.w3.org/1999/xhtml">Allowed origins, for</span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.2160.1" xmlns="http://www.w3.org/1999/xhtml"> example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2161.1" xmlns="http://www.w3.org/1999/xhtml">https://*.example.com/</span></code><span class="koboSpan" id="kobo.2162.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2163.1" xmlns="http://www.w3.org/1999/xhtml">Allowed HTTP methods, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2164.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.2165.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2166.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.2167.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2168.1" xmlns="http://www.w3.org/1999/xhtml">DELETE</span></code><span class="koboSpan" id="kobo.2169.1" xmlns="http://www.w3.org/1999/xhtml">, and so on.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2170.1" xmlns="http://www.w3.org/1999/xhtml">Allowed HTTP request headers, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2171.1" xmlns="http://www.w3.org/1999/xhtml">Content-Type</span></code><span class="koboSpan" id="kobo.2172.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2173.1" xmlns="http://www.w3.org/1999/xhtml">Content-Language</span></code><span class="koboSpan" id="kobo.2174.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2175.1" xmlns="http://www.w3.org/1999/xhtml">x-custom-header</span></code><span class="koboSpan" id="kobo.2176.1" xmlns="http://www.w3.org/1999/xhtml">, and so</span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.2177.1" xmlns="http://www.w3.org/1999/xhtml"> on.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2178.1" xmlns="http://www.w3.org/1999/xhtml">Exposed HTTP response headers, meaning which headers to include unredacted in a response (because, by default, response headers are redacted), for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2179.1" xmlns="http://www.w3.org/1999/xhtml">x-custom-header</span></code><span class="koboSpan" id="kobo.2180.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2181.1" xmlns="http://www.w3.org/1999/xhtml">You can learn more about options for CORS policies at the following link: </span><a href="https://learn.microsoft.com/en-us/aspnet/core/security/cors#cors-policy-options"><span class="url"><span class="koboSpan" id="kobo.2182.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/security/cors#cors-policy-options</span></span></a></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2183.1" xmlns="http://www.w3.org/1999/xhtml">Now that you know that CORS does not secure a web service, let’s look at a useful technique that can prevent a common form of attack.</span></p>
<h1 class="heading-1" id="_idParaDest-319"><span class="koboSpan" id="kobo.2184.1" xmlns="http://www.w3.org/1999/xhtml">Preventing denial of service attacks using rate limiting</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2185.1" xmlns="http://www.w3.org/1999/xhtml">A </span><strong class="keyWord"><span class="koboSpan" id="kobo.2186.1" xmlns="http://www.w3.org/1999/xhtml">denial of service </span></strong><span class="koboSpan" id="kobo.2187.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.2188.1" xmlns="http://www.w3.org/1999/xhtml">DoS</span></strong><span class="koboSpan" id="kobo.2189.1" xmlns="http://www.w3.org/1999/xhtml">) attack is a malicious attempt to disrupt a web service by overwhelming it with requests. </span><span class="koboSpan" id="kobo.2189.2" xmlns="http://www.w3.org/1999/xhtml">If the </span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.2190.1" xmlns="http://www.w3.org/1999/xhtml">requests all came from </span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.2191.1" xmlns="http://www.w3.org/1999/xhtml">the same place, for example, the same IP address, then it would be relatively easy to cut them off as soon as the attack is detected. </span><span class="koboSpan" id="kobo.2191.2" xmlns="http://www.w3.org/1999/xhtml">But these attacks are often implemented as </span><strong class="keyWord"><span class="koboSpan" id="kobo.2192.1" xmlns="http://www.w3.org/1999/xhtml">distributed DoS</span></strong><span class="koboSpan" id="kobo.2193.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2194.1" xmlns="http://www.w3.org/1999/xhtml">DDoS</span></strong><span class="koboSpan" id="kobo.2195.1" xmlns="http://www.w3.org/1999/xhtml">) attacks from </span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.2196.1" xmlns="http://www.w3.org/1999/xhtml">many locations so you cannot separate attackers from genuine clients.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2197.1" xmlns="http://www.w3.org/1999/xhtml">A different approach is to apply rate limiting to everyone but let through more requests for genuine identified clients.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2198.1" xmlns="http://www.w3.org/1999/xhtml">Genuine clients should only make the minimum requests they need. </span><span class="koboSpan" id="kobo.2198.2" xmlns="http://www.w3.org/1999/xhtml">How many is reasonable will depend on your service. </span><span class="koboSpan" id="kobo.2198.3" xmlns="http://www.w3.org/1999/xhtml">One way to prevent DDoS attacks would be to limit how many requests are allowed from any client per minute. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.2199.1" xmlns="http://www.w3.org/1999/xhtml">This technique is not just useful to prevent attacks. </span><span class="koboSpan" id="kobo.2199.2" xmlns="http://www.w3.org/1999/xhtml">Even genuine clients might accidentally make too many requests, or for a commercial web service, you might want to charge different amounts for different rates, like when controlling a subscription. </span><span class="koboSpan" id="kobo.2199.3" xmlns="http://www.w3.org/1999/xhtml">Commercial web services</span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.2200.1" xmlns="http://www.w3.org/1999/xhtml"> from Twitter/X to Reddit now charge a </span><em class="italic"><span class="koboSpan" id="kobo.2201.1" xmlns="http://www.w3.org/1999/xhtml">lot</span></em><span class="koboSpan" id="kobo.2202.1" xmlns="http://www.w3.org/1999/xhtml"> of money for access to their web APIs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2203.1" xmlns="http://www.w3.org/1999/xhtml">When a client makes</span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.2204.1" xmlns="http://www.w3.org/1999/xhtml"> requests over a set rate limit, the client should receive either </span><code class="inlineCode"><span class="koboSpan" id="kobo.2205.1" xmlns="http://www.w3.org/1999/xhtml">429 Too Many Requests</span></code><span class="koboSpan" id="kobo.2206.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2207.1" xmlns="http://www.w3.org/1999/xhtml">503 Service Unavailable</span></code><span class="koboSpan" id="kobo.2208.1" xmlns="http://www.w3.org/1999/xhtml"> HTTP responses.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2209.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.2210.1" xmlns="http://www.w3.org/1999/xhtml">: If you need to build a massively scalable web service and protect its APIs, you should use a cloud service like Azure API Management instead of trying to implement your own rate limiting. </span><span class="koboSpan" id="kobo.2210.2" xmlns="http://www.w3.org/1999/xhtml">You can learn more about this at the following link: </span><a href="https://learn.microsoft.com/en-us/azure/api-management/"><span class="url"><span class="koboSpan" id="kobo.2211.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/azure/api-management/</span></span></a><span class="koboSpan" id="kobo.2212.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-320"><span class="koboSpan" id="kobo.2213.1" xmlns="http://www.w3.org/1999/xhtml">Rate limiting using the AspNetCoreRateLimit package</span></h2>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2214.1" xmlns="http://www.w3.org/1999/xhtml">AspNetCoreRateLimit</span></code><span class="koboSpan" id="kobo.2215.1" xmlns="http://www.w3.org/1999/xhtml">, a third-party package</span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.2216.1" xmlns="http://www.w3.org/1999/xhtml"> that targets .NET 6 or later, provides flexible rate-limiting middleware based on the IP address or client ID:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2217.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2218.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2219.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a reference to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2220.1" xmlns="http://www.w3.org/1999/xhtml">AspNetCoreRateLimit</span></code><span class="koboSpan" id="kobo.2221.1" xmlns="http://www.w3.org/1999/xhtml"> package, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2222.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2223.1" xmlns="http://www.w3.org/1999/xhtml">"AspNetCoreRateLimit"</span></span><span class="koboSpan" id="kobo.2224.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2225.1" xmlns="http://www.w3.org/1999/xhtml">"5.0.0"</span></span><span class="koboSpan" id="kobo.2226.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2227.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2228.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2229.1" xmlns="http://www.w3.org/1999/xhtml"> project to restore packages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2230.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2231.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Development.json</span></code><span class="koboSpan" id="kobo.2232.1" xmlns="http://www.w3.org/1999/xhtml">, add configuration for default rate limit options and client-specific policies, as shown highlighted in the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2233.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2234.1" xmlns="http://www.w3.org/1999/xhtml">"Logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2235.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2236.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2237.1" xmlns="http://www.w3.org/1999/xhtml">"LogLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2238.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2239.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2240.1" xmlns="http://www.w3.org/1999/xhtml">"Default"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2241.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2242.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2243.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2244.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2245.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2246.1" xmlns="http://www.w3.org/1999/xhtml">"Warning"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2247.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2248.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore.HttpLogging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2249.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2250.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2251.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2252.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span><span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2253.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2254.1" xmlns="http://www.w3.org/1999/xhtml">"ClientRateLimiting"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2255.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2256.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2257.1" xmlns="http://www.w3.org/1999/xhtml">"EnableEndpointRateLimiting"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2258.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2259.1" xmlns="http://www.w3.org/1999/xhtml">false</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2260.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2261.1" xmlns="http://www.w3.org/1999/xhtml">"StackBlockedRequests"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2262.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2263.1" xmlns="http://www.w3.org/1999/xhtml">false</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2264.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2265.1" xmlns="http://www.w3.org/1999/xhtml">"ClientIdHeader"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2266.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2267.1" xmlns="http://www.w3.org/1999/xhtml">"X-Client-Id"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2268.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2269.1" xmlns="http://www.w3.org/1999/xhtml">"HttpStatusCode"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2270.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2271.1" xmlns="http://www.w3.org/1999/xhtml">429</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2272.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2273.1" xmlns="http://www.w3.org/1999/xhtml">"EndpointWhitelist"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2274.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2275.1" xmlns="http://www.w3.org/1999/xhtml">[</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2276.1" xmlns="http://www.w3.org/1999/xhtml">"get:/api/license"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2277.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2278.1" xmlns="http://www.w3.org/1999/xhtml">"*:/api/status"</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2279.1" xmlns="http://www.w3.org/1999/xhtml">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2280.1" xmlns="http://www.w3.org/1999/xhtml">"ClientWhitelist"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2281.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2282.1" xmlns="http://www.w3.org/1999/xhtml">[</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2283.1" xmlns="http://www.w3.org/1999/xhtml">"dev-id-1"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2284.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2285.1" xmlns="http://www.w3.org/1999/xhtml">"dev-id-2"</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2286.1" xmlns="http://www.w3.org/1999/xhtml">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2287.1" xmlns="http://www.w3.org/1999/xhtml">"GeneralRules"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2288.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2289.1" xmlns="http://www.w3.org/1999/xhtml">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2290.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2291.1" xmlns="http://www.w3.org/1999/xhtml">"Endpoint"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2292.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2293.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2294.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2295.1" xmlns="http://www.w3.org/1999/xhtml">"Period"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2296.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2297.1" xmlns="http://www.w3.org/1999/xhtml">"10s"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2298.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2299.1" xmlns="http://www.w3.org/1999/xhtml">"Limit"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2300.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2301.1" xmlns="http://www.w3.org/1999/xhtml">2</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2302.1" xmlns="http://www.w3.org/1999/xhtml">},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2303.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2304.1" xmlns="http://www.w3.org/1999/xhtml">"Endpoint"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2305.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2306.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2307.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2308.1" xmlns="http://www.w3.org/1999/xhtml">"Period"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2309.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2310.1" xmlns="http://www.w3.org/1999/xhtml">"12h"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2311.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2312.1" xmlns="http://www.w3.org/1999/xhtml">"Limit"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2313.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2314.1" xmlns="http://www.w3.org/1999/xhtml">100</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2315.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2316.1" xmlns="http://www.w3.org/1999/xhtml">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2317.1" xmlns="http://www.w3.org/1999/xhtml">},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2318.1" xmlns="http://www.w3.org/1999/xhtml">"ClientRateLimitPolicies"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2319.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2320.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2321.1" xmlns="http://www.w3.org/1999/xhtml">"ClientRules"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2322.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2323.1" xmlns="http://www.w3.org/1999/xhtml">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2324.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2325.1" xmlns="http://www.w3.org/1999/xhtml">"ClientId"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2326.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2327.1" xmlns="http://www.w3.org/1999/xhtml">"console-client-abc123"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2328.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2329.1" xmlns="http://www.w3.org/1999/xhtml">"Rules"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2330.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2331.1" xmlns="http://www.w3.org/1999/xhtml">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2332.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2333.1" xmlns="http://www.w3.org/1999/xhtml">"Endpoint"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2334.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2335.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2336.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2337.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2338.1" xmlns="http://www.w3.org/1999/xhtml">Period"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2339.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2340.1" xmlns="http://www.w3.org/1999/xhtml">"10s"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2341.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2342.1" xmlns="http://www.w3.org/1999/xhtml">"Limit"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2343.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2344.1" xmlns="http://www.w3.org/1999/xhtml">5</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2345.1" xmlns="http://www.w3.org/1999/xhtml">},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2346.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2347.1" xmlns="http://www.w3.org/1999/xhtml">"Endpoint"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2348.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2349.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2350.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2351.1" xmlns="http://www.w3.org/1999/xhtml">"Period"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2352.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2353.1" xmlns="http://www.w3.org/1999/xhtml">"12h"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2354.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2355.1" xmlns="http://www.w3.org/1999/xhtml">"Limit"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2356.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2357.1" xmlns="http://www.w3.org/1999/xhtml">250</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2358.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2359.1" xmlns="http://www.w3.org/1999/xhtml">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2360.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2361.1" xmlns="http://www.w3.org/1999/xhtml">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.2362.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2363.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2364.1" xmlns="http://www.w3.org/1999/xhtml">Note:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2365.1" xmlns="http://www.w3.org/1999/xhtml">EnableEndpointRateLimiting</span></code><span class="koboSpan" id="kobo.2366.1" xmlns="http://www.w3.org/1999/xhtml"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.2367.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.2368.1" xmlns="http://www.w3.org/1999/xhtml">, meaning all endpoints will share the same rules.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2369.1" xmlns="http://www.w3.org/1999/xhtml">If a client needs to identify itself, it can set a header named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2370.1" xmlns="http://www.w3.org/1999/xhtml">X-Client-Id</span></code><span class="koboSpan" id="kobo.2371.1" xmlns="http://www.w3.org/1999/xhtml"> to a unique </span><code class="inlineCode"><span class="koboSpan" id="kobo.2372.1" xmlns="http://www.w3.org/1999/xhtml">string</span></code><span class="koboSpan" id="kobo.2373.1" xmlns="http://www.w3.org/1999/xhtml"> value.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2374.1" xmlns="http://www.w3.org/1999/xhtml">If a rate limit is reached for a client, the service will start returning </span><code class="inlineCode"><span class="koboSpan" id="kobo.2375.1" xmlns="http://www.w3.org/1999/xhtml">429</span></code><span class="koboSpan" id="kobo.2376.1" xmlns="http://www.w3.org/1999/xhtml"> status code responses to that client.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2377.1" xmlns="http://www.w3.org/1999/xhtml">Two endpoints will be excluded from the global rate limits because they are on the endpoint whitelist. </span><span class="koboSpan" id="kobo.2377.2" xmlns="http://www.w3.org/1999/xhtml">One endpoint is for getting a license, and the other endpoint is for checking the status of the service. </span><span class="koboSpan" id="kobo.2377.3" xmlns="http://www.w3.org/1999/xhtml">We will not actually implement these features and you would want to</span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.2378.1" xmlns="http://www.w3.org/1999/xhtml"> apply different rate limits to these endpoints; otherwise, someone could call them to bring down your server instead.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2379.1" xmlns="http://www.w3.org/1999/xhtml">Two client IDs, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2380.1" xmlns="http://www.w3.org/1999/xhtml">dev-id-1</span></code><span class="koboSpan" id="kobo.2381.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2382.1" xmlns="http://www.w3.org/1999/xhtml">dev-id-2</span></code><span class="koboSpan" id="kobo.2383.1" xmlns="http://www.w3.org/1999/xhtml">, will be excluded from the rate limits because they are on the client whitelist. </span><span class="koboSpan" id="kobo.2383.2" xmlns="http://www.w3.org/1999/xhtml">These could be special client accounts for internal developers that are not shared outside the organization.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2384.1" xmlns="http://www.w3.org/1999/xhtml">Two general (default) rules are configured: the first sets a rate limit of 2 requests every 10 seconds, and the second sets a rate limit of 100 requests every 12 hours.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2385.1" xmlns="http://www.w3.org/1999/xhtml">Two client-specific rules are configured that are looser than the default rules: for the client ID named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2386.1" xmlns="http://www.w3.org/1999/xhtml">console-client-abc123</span></code><span class="koboSpan" id="kobo.2387.1" xmlns="http://www.w3.org/1999/xhtml">, it is allowed to make up to 5 requests every 10 seconds, and up to 250 requests every 12 hours.</span></li>
</ul></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.2388.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2389.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection.Extensions.cs</span></code><span class="koboSpan" id="kobo.2390.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for working with rate-limiting options, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2391.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2392.1" xmlns="http://www.w3.org/1999/xhtml"> AspNetCoreRateLimit; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2393.1" xmlns="http://www.w3.org/1999/xhtml">// To use ClientRateLimitOptions and so on.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2394.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2395.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection.Extensions.cs</span></code><span class="koboSpan" id="kobo.2396.1" xmlns="http://www.w3.org/1999/xhtml">, define an extension method to load rate-limiting configuration from app settings and set rate-limiting options, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2397.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2398.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2399.1" xmlns="http://www.w3.org/1999/xhtml"> IServiceCollection </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2400.1" xmlns="http://www.w3.org/1999/xhtml">AddCustomRateLimiting</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2401.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2402.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2403.1" xmlns="http://www.w3.org/1999/xhtml"> IServiceCollection services, ConfigurationManager configuration</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2404.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2405.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2406.1" xmlns="http://www.w3.org/1999/xhtml">// Add services to store rate limit counters and rules in memory.</span></span><span class="koboSpan" id="kobo.2407.1" xmlns="http://www.w3.org/1999/xhtml">
  services.AddMemoryCache();
  services.AddInMemoryRateLimiting();
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2408.1" xmlns="http://www.w3.org/1999/xhtml">// Load default rate limit options from appsettings.json.</span></span><span class="koboSpan" id="kobo.2409.1" xmlns="http://www.w3.org/1999/xhtml">
  services.Configure&lt;ClientRateLimitOptions&gt;(
    configuration.GetSection(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2410.1" xmlns="http://www.w3.org/1999/xhtml">"ClientRateLimiting"</span></span><span class="koboSpan" id="kobo.2411.1" xmlns="http://www.w3.org/1999/xhtml">));
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2412.1" xmlns="http://www.w3.org/1999/xhtml">// Load client-specific policies from appsettings.json.</span></span><span class="koboSpan" id="kobo.2413.1" xmlns="http://www.w3.org/1999/xhtml">
  services.Configure&lt;ClientRateLimitPolicies&gt;(
    configuration.GetSection(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2414.1" xmlns="http://www.w3.org/1999/xhtml">"ClientRateLimitPolicies"</span></span><span class="koboSpan" id="kobo.2415.1" xmlns="http://www.w3.org/1999/xhtml">));
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2416.1" xmlns="http://www.w3.org/1999/xhtml">// Register the configuration.</span></span><span class="koboSpan" id="kobo.2417.1" xmlns="http://www.w3.org/1999/xhtml">
  services.AddSingleton
    &lt;IRateLimitConfiguration, RateLimitConfiguration&gt;();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2418.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.2419.1" xmlns="http://www.w3.org/1999/xhtml"> services;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2420.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2421.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2422.1" xmlns="http://www.w3.org/1999/xhtml">, after creating the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2423.1" xmlns="http://www.w3.org/1999/xhtml">builder</span></code><span class="koboSpan" id="kobo.2424.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to load rate-limiting configuration </span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.2425.1" xmlns="http://www.w3.org/1999/xhtml">from app settings and set rate-limiting options, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2426.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddCustomRateLimiting(builder.Configuration);
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2427.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2428.1" xmlns="http://www.w3.org/1999/xhtml">IServiceCollection.Extensions.cs</span></code><span class="koboSpan" id="kobo.2429.1" xmlns="http://www.w3.org/1999/xhtml">, in the call to configure HTTP logging, add a statement to allow two rate-limiting headers to not be redacted, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2430.1" xmlns="http://www.w3.org/1999/xhtml">services.AddHttpLogging(options =&gt;
{
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2431.1" xmlns="http://www.w3.org/1999/xhtml">// Add the Origin header so it will not be redacted.</span></span><span class="koboSpan" id="kobo.2432.1" xmlns="http://www.w3.org/1999/xhtml">
  options.RequestHeaders.Add(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2433.1" xmlns="http://www.w3.org/1999/xhtml">"Origin"</span></span><span class="koboSpan" id="kobo.2434.1" xmlns="http://www.w3.org/1999/xhtml">);
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2435.1" xmlns="http://www.w3.org/1999/xhtml">// Add the rate limiting headers so they will not be redacted.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2436.1" xmlns="http://www.w3.org/1999/xhtml">  options.RequestHeaders.Add(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2437.1" xmlns="http://www.w3.org/1999/xhtml">"X-Client-Id"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2438.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2439.1" xmlns="http://www.w3.org/1999/xhtml">  options.ResponseHeaders.Add(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2440.1" xmlns="http://www.w3.org/1999/xhtml">"Retry-After"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2441.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2442.1" xmlns="http://www.w3.org/1999/xhtml">// By default, the response body is not included.</span></span><span class="koboSpan" id="kobo.2443.1" xmlns="http://www.w3.org/1999/xhtml">
  options.LoggingFields = HttpLoggingFields.All;
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2444.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2445.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.2446.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for working with rate-limiting policy stores, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2447.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2448.1" xmlns="http://www.w3.org/1999/xhtml"> AspNetCoreRateLimit; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2449.1" xmlns="http://www.w3.org/1999/xhtml">// To use IClientPolicyStore and so on.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2450.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2451.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.2452.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to define an extension method to seed the client </span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.2453.1" xmlns="http://www.w3.org/1999/xhtml">policy store, which just means loading the policies from the configuration, and then use client rate limits, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2454.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2455.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2456.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2457.1" xmlns="http://www.w3.org/1999/xhtml"> Task </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2458.1" xmlns="http://www.w3.org/1999/xhtml">UseCustomClientRateLimiting</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2459.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2460.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2461.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication app</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2462.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2463.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2464.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2465.1" xmlns="http://www.w3.org/1999/xhtml"> (IServiceScope scope = app.Services.CreateScope())
  {
    IClientPolicyStore clientPolicyStore = scope.ServiceProvider
      .GetRequiredService&lt;IClientPolicyStore&gt;();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2466.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2467.1" xmlns="http://www.w3.org/1999/xhtml"> clientPolicyStore.SeedAsync();
  }
  app.UseClientRateLimiting();
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2468.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2469.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2470.1" xmlns="http://www.w3.org/1999/xhtml">, after calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.2471.1" xmlns="http://www.w3.org/1999/xhtml">UseHttpLogging</span></code><span class="koboSpan" id="kobo.2472.1" xmlns="http://www.w3.org/1999/xhtml">, add a call to use client rate limiting, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2473.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2474.1" xmlns="http://www.w3.org/1999/xhtml"> app.UseCustomClientRateLimiting();
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-321"><span class="koboSpan" id="kobo.2475.1" xmlns="http://www.w3.org/1999/xhtml">Creating a rate-limited console client</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2476.1" xmlns="http://www.w3.org/1999/xhtml">Now we can create a</span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.2477.1" xmlns="http://www.w3.org/1999/xhtml"> console app that will be a client to the web service:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2478.1" xmlns="http://www.w3.org/1999/xhtml">Use your preferred code editor to add a new console app to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2479.1" xmlns="http://www.w3.org/1999/xhtml">Chapter08</span></code><span class="koboSpan" id="kobo.2480.1" xmlns="http://www.w3.org/1999/xhtml"> solution named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2481.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2482.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2483.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2484.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2485.1" xmlns="http://www.w3.org/1999/xhtml"> project, treat warnings as errors, globally and statically import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2486.1" xmlns="http://www.w3.org/1999/xhtml">System.Console</span></code><span class="koboSpan" id="kobo.2487.1" xmlns="http://www.w3.org/1999/xhtml"> class, and add a reference to the entity models project, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2488.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2489.1" xmlns="http://www.w3.org/1999/xhtml">"..\..\Chapter03\Northwind.Common.EntityModels</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2490.1" xmlns="http://www.w3.org/1999/xhtml">.SqlServer\Northwind.Common.EntityModels.SqlServer.csproj"</span></span><span class="koboSpan" id="kobo.2491.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2492.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2493.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2494.1" xmlns="http://www.w3.org/1999/xhtml"> project at the command prompt or terminal to compile the referenced project and copy its assembly to the appropriate </span><code class="inlineCode"><span class="koboSpan" id="kobo.2495.1" xmlns="http://www.w3.org/1999/xhtml">bin</span></code><span class="koboSpan" id="kobo.2496.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2497.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2498.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2499.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2500.1" xmlns="http://www.w3.org/1999/xhtml">Program.Helpers.cs</span></code><span class="koboSpan" id="kobo.2501.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2502.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2503.1" xmlns="http://www.w3.org/1999/xhtml">Program.Helpers.cs</span></code><span class="koboSpan" id="kobo.2504.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to define a method for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2505.1" xmlns="http://www.w3.org/1999/xhtml">partial Program</span></code><span class="koboSpan" id="kobo.2506.1" xmlns="http://www.w3.org/1999/xhtml"> class to write </span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.2507.1" xmlns="http://www.w3.org/1999/xhtml">some text in a foreground color, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2508.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2509.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2510.1" xmlns="http://www.w3.org/1999/xhtml">Program</span></span><span class="koboSpan" id="kobo.2511.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2512.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2513.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2514.1" xmlns="http://www.w3.org/1999/xhtml">void</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2515.1" xmlns="http://www.w3.org/1999/xhtml">WriteInColor</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2516.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2517.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2518.1" xmlns="http://www.w3.org/1999/xhtml"> text, ConsoleColor foregroundColor</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2519.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2520.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    ConsoleColor previousColor = ForegroundColor;
    ForegroundColor = foregroundColor;
    Write(text);
    ForegroundColor = previousColor;
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2521.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2522.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2523.1" xmlns="http://www.w3.org/1999/xhtml">, delete the existing statements. </span><span class="koboSpan" id="kobo.2523.2" xmlns="http://www.w3.org/1999/xhtml">Add statements to prompt the user for a client name to identify it, and then create an HTTP client to make a request to get the first page of products from the web service once per second until the user presses </span><em class="keystroke"><span class="koboSpan" id="kobo.2524.1" xmlns="http://www.w3.org/1999/xhtml">Ctrl</span></em><span class="koboSpan" id="kobo.2525.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.2526.1" xmlns="http://www.w3.org/1999/xhtml">C</span></em><span class="koboSpan" id="kobo.2527.1" xmlns="http://www.w3.org/1999/xhtml"> to stop the console app, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2528.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2529.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.EntityModels; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2530.1" xmlns="http://www.w3.org/1999/xhtml">// To use Product.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2531.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2532.1" xmlns="http://www.w3.org/1999/xhtml"> System.Net.Http.Json; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2533.1" xmlns="http://www.w3.org/1999/xhtml">// To use ReadFromJsonAsync&lt;T&gt; method.</span></span><span class="koboSpan" id="kobo.2534.1" xmlns="http://www.w3.org/1999/xhtml">
Write(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2535.1" xmlns="http://www.w3.org/1999/xhtml">"Enter a client name or press Enter: "</span></span><span class="koboSpan" id="kobo.2536.1" xmlns="http://www.w3.org/1999/xhtml">);
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2537.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2538.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.2538.2" xmlns="http://www.w3.org/1999/xhtml">clientName = ReadLine();
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2539.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.2540.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2541.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2542.1" xmlns="http://www.w3.org/1999/xhtml">.IsNullOrEmpty(clientName))
{
  clientName = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2543.1" xmlns="http://www.w3.org/1999/xhtml">$"console-client-</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2544.1" xmlns="http://www.w3.org/1999/xhtml">{Guid.NewGuid()}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2545.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.2546.1" xmlns="http://www.w3.org/1999/xhtml">;
}
WriteLine(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2547.1" xmlns="http://www.w3.org/1999/xhtml">$"X-Client-Id will be: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2548.1" xmlns="http://www.w3.org/1999/xhtml">{clientName}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2549.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.2550.1" xmlns="http://www.w3.org/1999/xhtml">);
HttpClient client = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2551.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2552.1" xmlns="http://www.w3.org/1999/xhtml">();
client.BaseAddress = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2553.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2554.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2555.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5081"</span></span><span class="koboSpan" id="kobo.2556.1" xmlns="http://www.w3.org/1999/xhtml">);
client.DefaultRequestHeaders.Accept.Add(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2557.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2558.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2559.1" xmlns="http://www.w3.org/1999/xhtml">"application/json"</span></span><span class="koboSpan" id="kobo.2560.1" xmlns="http://www.w3.org/1999/xhtml">));
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2561.1" xmlns="http://www.w3.org/1999/xhtml">// Specify the rate limiting client id for this console app.</span></span><span class="koboSpan" id="kobo.2562.1" xmlns="http://www.w3.org/1999/xhtml">
client.DefaultRequestHeaders.Add(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2563.1" xmlns="http://www.w3.org/1999/xhtml">"X-Client-Id"</span></span><span class="koboSpan" id="kobo.2564.1" xmlns="http://www.w3.org/1999/xhtml">, clientName);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2565.1" xmlns="http://www.w3.org/1999/xhtml">while</span></span><span class="koboSpan" id="kobo.2566.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2567.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.2568.1" xmlns="http://www.w3.org/1999/xhtml">)
{
  WriteInColor(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2569.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2570.1" xmlns="http://www.w3.org/1999/xhtml">.Format(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2571.1" xmlns="http://www.w3.org/1999/xhtml">"{0:hh:mm:ss}: "</span></span><span class="koboSpan" id="kobo.2572.1" xmlns="http://www.w3.org/1999/xhtml">, 
    DateTime.UtcNow), ConsoleColor.DarkGreen);
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2573.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.2574.1" xmlns="http://www.w3.org/1999/xhtml"> waitFor = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2575.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2576.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2577.1" xmlns="http://www.w3.org/1999/xhtml">// Second.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2578.1" xmlns="http://www.w3.org/1999/xhtml">try</span></span><span class="koboSpan" id="kobo.2579.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    HttpResponseMessage response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2580.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2581.1" xmlns="http://www.w3.org/1999/xhtml"> client.GetAsync(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2582.1" xmlns="http://www.w3.org/1999/xhtml">"api/products"</span></span><span class="koboSpan" id="kobo.2583.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2584.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.2585.1" xmlns="http://www.w3.org/1999/xhtml"> (response.IsSuccessStatusCode)
    {
      Product[]? </span><span class="koboSpan" id="kobo.2585.2" xmlns="http://www.w3.org/1999/xhtml">products = 
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2586.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2587.1" xmlns="http://www.w3.org/1999/xhtml"> response.Content.ReadFromJsonAsync&lt;Product[]&gt;();
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2588.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.2589.1" xmlns="http://www.w3.org/1999/xhtml"> (products != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2590.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="koboSpan" id="kobo.2591.1" xmlns="http://www.w3.org/1999/xhtml">)
      {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2592.1" xmlns="http://www.w3.org/1999/xhtml">foreach</span></span><span class="koboSpan" id="kobo.2593.1" xmlns="http://www.w3.org/1999/xhtml"> (Product product </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2594.1" xmlns="http://www.w3.org/1999/xhtml">in</span></span><span class="koboSpan" id="kobo.2595.1" xmlns="http://www.w3.org/1999/xhtml"> products)
        {
          Write(product.ProductName);
          Write(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2596.1" xmlns="http://www.w3.org/1999/xhtml">", "</span></span><span class="koboSpan" id="kobo.2597.1" xmlns="http://www.w3.org/1999/xhtml">);
        }
        WriteLine();
      }
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2598.1" xmlns="http://www.w3.org/1999/xhtml">else</span></span><span class="koboSpan" id="kobo.2599.1" xmlns="http://www.w3.org/1999/xhtml">
    {
      WriteInColor(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2600.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2601.1" xmlns="http://www.w3.org/1999/xhtml">.Format(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2602.1" xmlns="http://www.w3.org/1999/xhtml">"{0}: {1}"</span></span><span class="koboSpan" id="kobo.2603.1" xmlns="http://www.w3.org/1999/xhtml">, (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2604.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.2605.1" xmlns="http://www.w3.org/1999/xhtml">)response.StatusCode,
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2606.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2607.1" xmlns="http://www.w3.org/1999/xhtml"> response.Content.ReadAsStringAsync()),
        ConsoleColor.DarkRed);
      WriteLine();
    }
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2608.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></span><span class="koboSpan" id="kobo.2609.1" xmlns="http://www.w3.org/1999/xhtml"> (Exception ex)
  {
    WriteLine(ex.Message);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2610.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2611.1" xmlns="http://www.w3.org/1999/xhtml"> Task.Delay(TimeSpan.FromSeconds(waitFor));
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2612.1" xmlns="http://www.w3.org/1999/xhtml">If your database server is not running (for example, because you are hosting it in Docker, a virtual machine, or in the cloud), then make sure to start it.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2613.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2614.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.2615.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2616.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2617.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2618.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2619.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2620.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2621.1" xmlns="http://www.w3.org/1999/xhtml">In the console</span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.2622.1" xmlns="http://www.w3.org/1999/xhtml"> app, press </span><em class="keystroke"><span class="koboSpan" id="kobo.2623.1" xmlns="http://www.w3.org/1999/xhtml">Enter</span></em><span class="koboSpan" id="kobo.2624.1" xmlns="http://www.w3.org/1999/xhtml"> to generate a GUID-based client ID.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2625.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2626.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2627.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2628.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.2629.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging again so we have two clients.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2630.1" xmlns="http://www.w3.org/1999/xhtml">In the console app, press </span><em class="keystroke"><span class="koboSpan" id="kobo.2631.1" xmlns="http://www.w3.org/1999/xhtml">Enter</span></em><span class="koboSpan" id="kobo.2632.1" xmlns="http://www.w3.org/1999/xhtml"> to generate a GUID-based client ID.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2633.1" xmlns="http://www.w3.org/1999/xhtml">Note that each client can make two requests before it starts to receive </span><code class="inlineCode"><span class="koboSpan" id="kobo.2634.1" xmlns="http://www.w3.org/1999/xhtml">429</span></code><span class="koboSpan" id="kobo.2635.1" xmlns="http://www.w3.org/1999/xhtml"> status codes, as shown in the following output and in </span><em class="italic"><span class="koboSpan" id="kobo.2636.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.9</span></em><span class="koboSpan" id="kobo.2637.1" xmlns="http://www.w3.org/1999/xhtml">:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2638.1" xmlns="http://www.w3.org/1999/xhtml">Enter a client name or press Enter:
X-Client-Id will be: console-client-d54c61ba-66bb-4e39-9c1a-7af6e2bf647e
07:32:18: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:32:20: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:32:21: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.2" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.3" xmlns="http://www.w3.org/1999/xhtml">07:32:22: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.4" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.5" xmlns="http://www.w3.org/1999/xhtml">07:32:23: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.6" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.7" xmlns="http://www.w3.org/1999/xhtml">07:32:24: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.8" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.9" xmlns="http://www.w3.org/1999/xhtml">07:32:25: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.10" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.11" xmlns="http://www.w3.org/1999/xhtml">07:32:26: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.12" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.13" xmlns="http://www.w3.org/1999/xhtml">07:32:27: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.14" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.15" xmlns="http://www.w3.org/1999/xhtml">07:32:28: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:32:29: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:32:30: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.16" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.17" xmlns="http://www.w3.org/1999/xhtml">07:32:31: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.18" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span><span class="koboSpan" id="kobo.2638.19" xmlns="http://www.w3.org/1999/xhtml">07:32:32: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2638.20" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span></code></pre>
</li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2639.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2640.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.9: A console app exceeding its web service rate limit</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="14"><span class="koboSpan" id="kobo.2641.1" xmlns="http://www.w3.org/1999/xhtml">Stop the two console apps. </span><span class="koboSpan" id="kobo.2641.2" xmlns="http://www.w3.org/1999/xhtml">Leave the web service running.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2642.1" xmlns="http://www.w3.org/1999/xhtml">In the command line for the web service, note the HTTP logs that show each request from</span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.2643.1" xmlns="http://www.w3.org/1999/xhtml"> the console client with its client ID sent as a header named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2644.1" xmlns="http://www.w3.org/1999/xhtml">X-Client-Id</span></code><span class="koboSpan" id="kobo.2645.1" xmlns="http://www.w3.org/1999/xhtml">, the request being blocked because that client has exceeded its quota, and a response that contains a header named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2646.1" xmlns="http://www.w3.org/1999/xhtml">Retry-After</span></code><span class="koboSpan" id="kobo.2647.1" xmlns="http://www.w3.org/1999/xhtml"> containing the number of seconds the client should wait before retrying, as shown highlighted in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2648.1" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware[1]
      Request:
      Protocol: HTTP/1.1
      Method: GET
      Scheme: https
      PathBase:
      Path: /api/products
      Accept: application/json
      Host: localhost:5081
</span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.2649.1" xmlns="http://www.w3.org/1999/xhtml">      X-Client-Id: console-client-d54c61ba-66bb-4e39-9c1a-7af6e2bf647e</span></strong></span><span class="koboSpan" id="kobo.2650.1" xmlns="http://www.w3.org/1999/xhtml">
info: AspNetCoreRateLimit.ClientRateLimitMiddleware[0]
</span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.2651.1" xmlns="http://www.w3.org/1999/xhtml">      Request get:/api/products from ClientId console-client-d54c61ba-66bb-4e39-9c1a-7af6e2bf647e has been blocked, quota 2/10s exceeded by 3. </span><span class="koboSpan" id="kobo.2651.2" xmlns="http://www.w3.org/1999/xhtml">Blocked by rule *, TraceIdentifier 0HMIKGNJQEK5P:0000000E. </span><span class="koboSpan" id="kobo.2651.3" xmlns="http://www.w3.org/1999/xhtml">MonitorMode: False</span></strong></span><span class="koboSpan" id="kobo.2652.1" xmlns="http://www.w3.org/1999/xhtml">
info: Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware[2]
      Response:
      StatusCode: 429
      Content-Type: text/plain
      </span><span class="code-highlight"><strong class="hljs-con-slc"><span class="koboSpan" id="kobo.2653.1" xmlns="http://www.w3.org/1999/xhtml">Retry-After: 6</span></strong></span><span class="koboSpan" id="kobo.2654.1" xmlns="http://www.w3.org/1999/xhtml">
info: Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware[4]
      ResponseBody: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2654.2" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2655.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2656.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2657.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2658.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2659.1" xmlns="http://www.w3.org/1999/xhtml">, before writing the error message to the console in dark red, add statements to read the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2660.1" xmlns="http://www.w3.org/1999/xhtml">Retry-After</span></code><span class="koboSpan" id="kobo.2661.1" xmlns="http://www.w3.org/1999/xhtml"> header to get the number of seconds to wait for, as shown highlighted</span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.2662.1" xmlns="http://www.w3.org/1999/xhtml"> in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2663.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2664.1" xmlns="http://www.w3.org/1999/xhtml"> retryAfter = response.Headers</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2665.1" xmlns="http://www.w3.org/1999/xhtml">  .GetValues(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2666.1" xmlns="http://www.w3.org/1999/xhtml">"Retry-After"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2667.1" xmlns="http://www.w3.org/1999/xhtml">).ToArray()[</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2668.1" xmlns="http://www.w3.org/1999/xhtml">0</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2669.1" xmlns="http://www.w3.org/1999/xhtml">];</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2670.1" xmlns="http://www.w3.org/1999/xhtml">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2671.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2672.1" xmlns="http://www.w3.org/1999/xhtml">int</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2673.1" xmlns="http://www.w3.org/1999/xhtml">.TryParse(retryAfter, </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2674.1" xmlns="http://www.w3.org/1999/xhtml">out</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2675.1" xmlns="http://www.w3.org/1999/xhtml"> waitFor))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2676.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2677.1" xmlns="http://www.w3.org/1999/xhtml">  retryAfter = </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2678.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2679.1" xmlns="http://www.w3.org/1999/xhtml">.Format(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2680.1" xmlns="http://www.w3.org/1999/xhtml">"I will retry after {0} seconds."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2681.1" xmlns="http://www.w3.org/1999/xhtml">, waitFor);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2682.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span><span class="koboSpan" id="kobo.2683.1" xmlns="http://www.w3.org/1999/xhtml">
WriteInColor(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2684.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2685.1" xmlns="http://www.w3.org/1999/xhtml">.Format(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2686.1" xmlns="http://www.w3.org/1999/xhtml">"{0}: {1} {2}"</span></span><span class="koboSpan" id="kobo.2687.1" xmlns="http://www.w3.org/1999/xhtml">, (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2688.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.2689.1" xmlns="http://www.w3.org/1999/xhtml">)response.StatusCode,
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2690.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2691.1" xmlns="http://www.w3.org/1999/xhtml"> response.Content.ReadAsStringAsync(), retryAfter),
  ConsoleColor.DarkRed);
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2692.1" xmlns="http://www.w3.org/1999/xhtml">Note the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2693.1" xmlns="http://www.w3.org/1999/xhtml">waitFor</span></code><span class="koboSpan" id="kobo.2694.1" xmlns="http://www.w3.org/1999/xhtml"> variable is set from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2695.1" xmlns="http://www.w3.org/1999/xhtml">Retry-After</span></code><span class="koboSpan" id="kobo.2696.1" xmlns="http://www.w3.org/1999/xhtml"> header value. </span><span class="koboSpan" id="kobo.2696.2" xmlns="http://www.w3.org/1999/xhtml">This is later used to pause the console app using an asynchronous delay, as shown in the following code:</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2697.1" xmlns="http://www.w3.org/1999/xhtml">await Task.Delay(TimeSpan.FromSeconds(waitFor));</span></code></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="17"><span class="koboSpan" id="kobo.2698.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2699.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2700.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2701.1" xmlns="http://www.w3.org/1999/xhtml">In the console app, press </span><em class="keystroke"><span class="koboSpan" id="kobo.2702.1" xmlns="http://www.w3.org/1999/xhtml">Enter</span></em><span class="koboSpan" id="kobo.2703.1" xmlns="http://www.w3.org/1999/xhtml"> to generate a GUID-based client ID.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2704.1" xmlns="http://www.w3.org/1999/xhtml">Note the console app will now sensibly wait for the suggested number of seconds before making its next call to the service, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2705.1" xmlns="http://www.w3.org/1999/xhtml">Enter a client name:
X-Client-Id will be: console-client-add7613f-51a9-4c4a-8ec7-0244203d2e19
07:45:01: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:45:02: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:45:03: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2705.2" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s. </span><span class="koboSpan" id="kobo.2705.3" xmlns="http://www.w3.org/1999/xhtml">I will retry after 8 seconds.
</span><span class="koboSpan" id="kobo.2705.4" xmlns="http://www.w3.org/1999/xhtml">07:45:11: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:45:12: Chai, Chang, Aniseed Syrup, Chef Anton's Cajun Seasoning, Grandma's Boysenberry Spread, Uncle Bob's Organic Dried Pears, Northwoods Cranberry Sauce, Ikura, Queso Cabrales, Queso Manchego La Pastora,
07:45:13: 429: API calls quota exceeded! </span><span class="koboSpan" id="kobo.2705.5" xmlns="http://www.w3.org/1999/xhtml">maximum admitted 2 per 10s. </span><span class="koboSpan" id="kobo.2705.6" xmlns="http://www.w3.org/1999/xhtml">I will retry after 8 seconds.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2706.1" xmlns="http://www.w3.org/1999/xhtml">Stop and restart the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2707.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2708.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2709.1" xmlns="http://www.w3.org/1999/xhtml">In the console app, enter the name </span><code class="inlineCode"><span class="koboSpan" id="kobo.2710.1" xmlns="http://www.w3.org/1999/xhtml">dev-id-1</span></code><span class="koboSpan" id="kobo.2711.1" xmlns="http://www.w3.org/1999/xhtml">, and note that the rate limit does not apply to this console app client. </span><span class="koboSpan" id="kobo.2711.2" xmlns="http://www.w3.org/1999/xhtml">This could be a special account for internal developers.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2712.1" xmlns="http://www.w3.org/1999/xhtml">Stop and restart </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.2713.1" xmlns="http://www.w3.org/1999/xhtml">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2714.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Client.Console</span></code><span class="koboSpan" id="kobo.2715.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2716.1" xmlns="http://www.w3.org/1999/xhtml">In the console app, enter the name </span><code class="inlineCode"><span class="koboSpan" id="kobo.2717.1" xmlns="http://www.w3.org/1999/xhtml">console-client-abc123</span></code><span class="koboSpan" id="kobo.2718.1" xmlns="http://www.w3.org/1999/xhtml">, and note that the rate limit is different for this console app client ID, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2719.1" xmlns="http://www.w3.org/1999/xhtml">info: AspNetCoreRateLimit.ClientRateLimitMiddleware[0]
      Request get:/api/products from ClientId console-client-abc123 has been blocked, quota 5/10s exceeded by 1. </span><span class="koboSpan" id="kobo.2719.2" xmlns="http://www.w3.org/1999/xhtml">Blocked by rule *, TraceIdentifier 0HMIKGS1TPSHJ:00000006. </span><span class="koboSpan" id="kobo.2719.3" xmlns="http://www.w3.org/1999/xhtml">MonitorMode: False
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-322"><span class="koboSpan" id="kobo.2720.1" xmlns="http://www.w3.org/1999/xhtml">Rate limiting using ASP.NET Core middleware</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2721.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core 7 introduced its own basic</span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.2722.1" xmlns="http://www.w3.org/1999/xhtml"> rate-limiting middleware, initially distributed as a separate NuGet package but now included with </span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.2723.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core. </span><span class="koboSpan" id="kobo.2723.2" xmlns="http://www.w3.org/1999/xhtml">It has a dependency on another Microsoft package, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2724.1" xmlns="http://www.w3.org/1999/xhtml">System.Threading.RateLimiting</span></code><span class="koboSpan" id="kobo.2725.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2725.2" xmlns="http://www.w3.org/1999/xhtml">It is not as feature-rich as the third-party package and we will not cover it in this book, although I have written an online-only section at the following link:</span></p>
<p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/ch08-rate-limiting.md"><span class="url"><span class="koboSpan" id="kobo.2726.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/ch08-rate-limiting.md</span></span></a></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2727.1" xmlns="http://www.w3.org/1999/xhtml">You can learn about the ASP.NET Core rate limiter at the following link: </span><a href="https://learn.microsoft.com/en-us/aspnet/core/performance/rate-limit"><span class="url"><span class="koboSpan" id="kobo.2728.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/performance/rate-limit</span></span></a><span class="koboSpan" id="kobo.2729.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2730.1" xmlns="http://www.w3.org/1999/xhtml">Protecting your web services from attacks is important. </span><span class="koboSpan" id="kobo.2730.2" xmlns="http://www.w3.org/1999/xhtml">What about improving the performance of your web service? </span><span class="koboSpan" id="kobo.2730.3" xmlns="http://www.w3.org/1999/xhtml">Is there anything we can do about that? </span></p>
<h1 class="heading-1" id="_idParaDest-323"><span class="koboSpan" id="kobo.2731.1" xmlns="http://www.w3.org/1999/xhtml">Improving startup time and resources using native AOT</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2732.1" xmlns="http://www.w3.org/1999/xhtml">Native AOT produces apps and </span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.2733.1" xmlns="http://www.w3.org/1999/xhtml">services that are:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.2734.1" xmlns="http://www.w3.org/1999/xhtml">Self-contained</span></strong><span class="koboSpan" id="kobo.2735.1" xmlns="http://www.w3.org/1999/xhtml">, meaning they can </span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.2736.1" xmlns="http://www.w3.org/1999/xhtml">run on systems that do not have the .NET runtime installed.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.2737.1" xmlns="http://www.w3.org/1999/xhtml">Ahead-of-time (AOT) compiled to native code</span></strong><span class="koboSpan" id="kobo.2738.1" xmlns="http://www.w3.org/1999/xhtml">, meaning a faster startup time and a potentially smaller </span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.2739.1" xmlns="http://www.w3.org/1999/xhtml">memory footprint. </span><span class="koboSpan" id="kobo.2739.2" xmlns="http://www.w3.org/1999/xhtml">This can have a positive impact when you have lots of instances (for example, when deploying massively scalable microservices) that are frequently stopped and restarted.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2740.1" xmlns="http://www.w3.org/1999/xhtml">Native AOT compiles </span><strong class="keyWord"><span class="koboSpan" id="kobo.2741.1" xmlns="http://www.w3.org/1999/xhtml">intermediate code</span></strong><span class="koboSpan" id="kobo.2742.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2743.1" xmlns="http://www.w3.org/1999/xhtml">IL</span></strong><span class="koboSpan" id="kobo.2744.1" xmlns="http://www.w3.org/1999/xhtml">) to native code at the time of publishing, rather than at runtime </span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.2745.1" xmlns="http://www.w3.org/1999/xhtml">using the </span><strong class="keyWord"><span class="koboSpan" id="kobo.2746.1" xmlns="http://www.w3.org/1999/xhtml">Just-In-Time</span></strong><span class="koboSpan" id="kobo.2747.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2748.1" xmlns="http://www.w3.org/1999/xhtml">JIT</span></strong><span class="koboSpan" id="kobo.2749.1" xmlns="http://www.w3.org/1999/xhtml">) compiler. </span><span class="koboSpan" id="kobo.2749.2" xmlns="http://www.w3.org/1999/xhtml">But native AOT apps and services must target </span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.2750.1" xmlns="http://www.w3.org/1999/xhtml">a specific runtime environment like Windows x64 or Linux ARM.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2751.1" xmlns="http://www.w3.org/1999/xhtml">Since native AOT happens at publish time, while debugging and working live on a project in your code editor, it uses the runtime JIT compiler, not native AOT, even if you have AOT enabled in the project! </span><span class="koboSpan" id="kobo.2751.2" xmlns="http://www.w3.org/1999/xhtml">But </span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.2752.1" xmlns="http://www.w3.org/1999/xhtml">some features that are incompatible with native AOT will be disabled or throw exceptions, and a source analyzer is enabled to show warnings about potential code incompatibilities.</span></p>
<h2 class="heading-2" id="_idParaDest-324"><span class="koboSpan" id="kobo.2753.1" xmlns="http://www.w3.org/1999/xhtml">Limitations of native AOT</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2754.1" xmlns="http://www.w3.org/1999/xhtml">Native AOT has limitations, some </span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.2755.1" xmlns="http://www.w3.org/1999/xhtml">of which are shown in the following list:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2756.1" xmlns="http://www.w3.org/1999/xhtml">No dynamic loading of assemblies.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2757.1" xmlns="http://www.w3.org/1999/xhtml">No runtime code generation, for example, using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2758.1" xmlns="http://www.w3.org/1999/xhtml">System.Reflection.Emit</span></code><span class="koboSpan" id="kobo.2759.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2760.1" xmlns="http://www.w3.org/1999/xhtml">It requires trimming, which has its own limitations.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2761.1" xmlns="http://www.w3.org/1999/xhtml">The assembly must be self-contained, so they must embed any libraries they call, which increases their size.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2762.1" xmlns="http://www.w3.org/1999/xhtml">Although your own apps and services might not use the features listed above, major parts of .NET itself do. </span><span class="koboSpan" id="kobo.2762.2" xmlns="http://www.w3.org/1999/xhtml">For example, ASP.NET Core MVC (including Web API services that use controllers) and EF Core do runtime code generation to implement their functionality.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2763.1" xmlns="http://www.w3.org/1999/xhtml">The .NET teams are hard at work making as much of .NET compatible with native AOT as possible, as soon as possible. </span><span class="koboSpan" id="kobo.2763.2" xmlns="http://www.w3.org/1999/xhtml">But .NET 8 only includes basic support for ASP.NET Core if you use minimal APIs, and no support for EF Core.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2764.1" xmlns="http://www.w3.org/1999/xhtml">My guess is that .NET 9 will include support for ASP.NET Core MVC and some parts of EF Core, but it could take until .NET 10 before we can all confidently use most of .NET and know we can build our apps and services with native AOT to gain the benefits.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2765.1" xmlns="http://www.w3.org/1999/xhtml">The native AOT publishing process includes code analyzers to warn you if you use any features that are not supported, but not all packages have been annotated to work well with this yet.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2766.1" xmlns="http://www.w3.org/1999/xhtml">The most common annotation used to indicate that a type or member does not support AOT is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2767.1" xmlns="http://www.w3.org/1999/xhtml">[RequiresDynamicCode]</span></code><span class="koboSpan" id="kobo.2768.1" xmlns="http://www.w3.org/1999/xhtml"> attribute.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2769.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.2770.1" xmlns="http://www.w3.org/1999/xhtml">: You can learn more about AOT warnings at the following link: </span><a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/fixing-warnings"><span class="url"><span class="koboSpan" id="kobo.2771.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/fixing-warnings</span></span></a><span class="koboSpan" id="kobo.2772.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-325"><span class="koboSpan" id="kobo.2773.1" xmlns="http://www.w3.org/1999/xhtml">Reflection and native AOT</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2774.1" xmlns="http://www.w3.org/1999/xhtml">Reflection is frequently used </span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.2775.1" xmlns="http://www.w3.org/1999/xhtml">for runtime inspection of type metadata, dynamic invocation of members, and code generation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2776.1" xmlns="http://www.w3.org/1999/xhtml">Native AOT does allow some reflection features, but the trimming performed during the native AOT compilation process cannot statically determine when a type has members that might be only accessed via reflection. </span><span class="koboSpan" id="kobo.2776.2" xmlns="http://www.w3.org/1999/xhtml">These members would be removed by AOT, which would then cause a runtime exception. </span></p>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2777.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.2778.1" xmlns="http://www.w3.org/1999/xhtml">: Developers must annotate their types with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2779.1" xmlns="http://www.w3.org/1999/xhtml">[DynamicallyAccessedMembers]</span></code><span class="koboSpan" id="kobo.2780.1" xmlns="http://www.w3.org/1999/xhtml"> to indicate a member that is only dynamically accessed via reflection and should therefore be left untrimmed.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-326"><span class="koboSpan" id="kobo.2781.1" xmlns="http://www.w3.org/1999/xhtml">Native AOT for ASP.NET Core</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2782.1" xmlns="http://www.w3.org/1999/xhtml">.NET 7 only supported native AOT </span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.2783.1" xmlns="http://www.w3.org/1999/xhtml">with console apps and class libraries on Windows or Linux. </span><span class="koboSpan" id="kobo.2783.2" xmlns="http://www.w3.org/1999/xhtml">It did not support macOS or ASP.NET Core. </span><span class="koboSpan" id="kobo.2783.3" xmlns="http://www.w3.org/1999/xhtml">.NET 8 is the first version to support</span><a id="_idIndexMarker829"/><span class="koboSpan" id="kobo.2784.1" xmlns="http://www.w3.org/1999/xhtml"> macOS and parts of ASP.NET Core.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2785.1" xmlns="http://www.w3.org/1999/xhtml">The following ASP.NET Core features are fully supported: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2786.1" xmlns="http://www.w3.org/1999/xhtml">gRPC</span></code><span class="koboSpan" id="kobo.2787.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2788.1" xmlns="http://www.w3.org/1999/xhtml">CORS</span></code><span class="koboSpan" id="kobo.2789.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2790.1" xmlns="http://www.w3.org/1999/xhtml">HealthChecks</span></code><span class="koboSpan" id="kobo.2791.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2792.1" xmlns="http://www.w3.org/1999/xhtml">HttpLogging</span></code><span class="koboSpan" id="kobo.2793.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2794.1" xmlns="http://www.w3.org/1999/xhtml">Localization</span></code><span class="koboSpan" id="kobo.2795.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2796.1" xmlns="http://www.w3.org/1999/xhtml">OutputCaching</span></code><span class="koboSpan" id="kobo.2797.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2798.1" xmlns="http://www.w3.org/1999/xhtml">RateLimiting</span></code><span class="koboSpan" id="kobo.2799.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2800.1" xmlns="http://www.w3.org/1999/xhtml">RequestDecompression</span></code><span class="koboSpan" id="kobo.2801.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2802.1" xmlns="http://www.w3.org/1999/xhtml">ResponseCaching</span></code><span class="koboSpan" id="kobo.2803.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2804.1" xmlns="http://www.w3.org/1999/xhtml">ResponseCompression</span></code><span class="koboSpan" id="kobo.2805.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2806.1" xmlns="http://www.w3.org/1999/xhtml">Rewrite</span></code><span class="koboSpan" id="kobo.2807.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2808.1" xmlns="http://www.w3.org/1999/xhtml">StaticFiles</span></code><span class="koboSpan" id="kobo.2809.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2810.1" xmlns="http://www.w3.org/1999/xhtml">WebSockets</span></code><span class="koboSpan" id="kobo.2811.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2812.1" xmlns="http://www.w3.org/1999/xhtml">The following ASP.NET Core features are partially supported: minimal APIs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2813.1" xmlns="http://www.w3.org/1999/xhtml">The following ASP.NET Core features are not supported (yet): MVC, Blazor Server, SignalR, Authentication (except JWT), Session, and SPA.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2814.1" xmlns="http://www.w3.org/1999/xhtml">As you have previously seen, you implement an ASP.NET Core Minimal APIs web service by mapping an HTTP request to a lambda expression, for example, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2815.1" xmlns="http://www.w3.org/1999/xhtml">    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2816.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.2817.1" xmlns="http://www.w3.org/1999/xhtml">, () =&gt; </span><span class="hljs-string"><span class="koboSpan" id="kobo.2818.1" xmlns="http://www.w3.org/1999/xhtml">"Hello World!"</span></span><span class="koboSpan" id="kobo.2819.1" xmlns="http://www.w3.org/1999/xhtml">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2820.1" xmlns="http://www.w3.org/1999/xhtml">At runtime, ASP.NET Core uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2821.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegateFactory</span></code><span class="koboSpan" id="kobo.2822.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2823.1" xmlns="http://www.w3.org/1999/xhtml">RDF</span></strong><span class="koboSpan" id="kobo.2824.1" xmlns="http://www.w3.org/1999/xhtml">) class to convert your </span><code class="inlineCode"><span class="koboSpan" id="kobo.2825.1" xmlns="http://www.w3.org/1999/xhtml">MapX</span></code><span class="koboSpan" id="kobo.2826.1" xmlns="http://www.w3.org/1999/xhtml"> calls into </span><code class="inlineCode"><span class="koboSpan" id="kobo.2827.1" xmlns="http://www.w3.org/1999/xhtml">RequestDelegate</span></code><span class="koboSpan" id="kobo.2828.1" xmlns="http://www.w3.org/1999/xhtml"> instances. </span><span class="koboSpan" id="kobo.2828.2" xmlns="http://www.w3.org/1999/xhtml">But this is dynamic code so is not compatible with native AOT.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2829.1" xmlns="http://www.w3.org/1999/xhtml">In ASP.NET Core 8, when native AOT is enabled, the runtime use of RDF is replaced with a source generator</span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.2830.1" xmlns="http://www.w3.org/1999/xhtml"> named </span><strong class="keyWord"><span class="koboSpan" id="kobo.2831.1" xmlns="http://www.w3.org/1999/xhtml">Request Delegate Generator </span></strong><span class="koboSpan" id="kobo.2832.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.2833.1" xmlns="http://www.w3.org/1999/xhtml">RDG</span></strong><span class="koboSpan" id="kobo.2834.1" xmlns="http://www.w3.org/1999/xhtml">) that performs similar work but at compile</span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.2835.1" xmlns="http://www.w3.org/1999/xhtml"> time. </span><span class="koboSpan" id="kobo.2835.2" xmlns="http://www.w3.org/1999/xhtml">This makes sure the code generated is statically analyzable by the native AOT publish </span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.2836.1" xmlns="http://www.w3.org/1999/xhtml">process.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2837.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.2838.1" xmlns="http://www.w3.org/1999/xhtml">: You can learn how to create your own source generator at the following link: </span><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/ch01-dynamic-code.md#creating-source-generators"><span class="url"><span class="koboSpan" id="kobo.2839.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/ch01-dynamic-code.md#creating-source-generators</span></span></a><span class="koboSpan" id="kobo.2840.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-327"><span class="koboSpan" id="kobo.2841.1" xmlns="http://www.w3.org/1999/xhtml">Requirements for native AOT</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2842.1" xmlns="http://www.w3.org/1999/xhtml">There are additional requirements</span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.2843.1" xmlns="http://www.w3.org/1999/xhtml"> for different operating systems:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2844.1" xmlns="http://www.w3.org/1999/xhtml">On Windows, you must install the Visual Studio 2022 </span><strong class="screenText"><span class="koboSpan" id="kobo.2845.1" xmlns="http://www.w3.org/1999/xhtml">Desktop development with C++</span></strong><span class="koboSpan" id="kobo.2846.1" xmlns="http://www.w3.org/1999/xhtml"> workload with all default components.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2847.1" xmlns="http://www.w3.org/1999/xhtml">On Linux, you must install the compiler toolchain and developer packages for libraries that the .NET runtime depends on. </span><span class="koboSpan" id="kobo.2847.2" xmlns="http://www.w3.org/1999/xhtml">For example, for Ubuntu 18.04 or later: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2848.1" xmlns="http://www.w3.org/1999/xhtml">sudo apt-get install clang zlib1g-dev</span></code><span class="koboSpan" id="kobo.2849.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2850.1" xmlns="http://www.w3.org/1999/xhtml">Warning!</span></strong><span class="koboSpan" id="kobo.2851.1" xmlns="http://www.w3.org/1999/xhtml"> Cross-platform native AOT publishing is not supported. </span><span class="koboSpan" id="kobo.2851.2" xmlns="http://www.w3.org/1999/xhtml">This means that you must run the publish on the operating system that you will deploy to. </span><span class="koboSpan" id="kobo.2851.3" xmlns="http://www.w3.org/1999/xhtml">For example, you cannot publish a native AOT project on Linux to later run on Windows.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-328"><span class="koboSpan" id="kobo.2852.1" xmlns="http://www.w3.org/1999/xhtml">Enabling native AOT for a project</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2853.1" xmlns="http://www.w3.org/1999/xhtml">To enable native AOT</span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.2854.1" xmlns="http://www.w3.org/1999/xhtml"> publishing in a project, add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2855.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PublishAot&gt;</span></code><span class="koboSpan" id="kobo.2856.1" xmlns="http://www.w3.org/1999/xhtml"> element to the project file, as shown highlighted in the following markup:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2857.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.2858.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.2859.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2860.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;PublishAot&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2861.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2862.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/PublishAot&gt;</span></strong></span>
</code></pre>
<h2 class="heading-2" id="_idParaDest-329"><span class="koboSpan" id="kobo.2863.1" xmlns="http://www.w3.org/1999/xhtml">Enabling JSON serialization with native AOT</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2864.1" xmlns="http://www.w3.org/1999/xhtml">JSON serialization with native AOT requires</span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.2865.1" xmlns="http://www.w3.org/1999/xhtml"> the use of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2866.1" xmlns="http://www.w3.org/1999/xhtml">System.Text.Json</span></code><span class="koboSpan" id="kobo.2867.1" xmlns="http://www.w3.org/1999/xhtml"> source generator. </span><span class="koboSpan" id="kobo.2867.2" xmlns="http://www.w3.org/1999/xhtml">All model types passed as parameters or return values must be registered </span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.2868.1" xmlns="http://www.w3.org/1999/xhtml">with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2869.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerContext</span></code><span class="koboSpan" id="kobo.2870.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2871.1" xmlns="http://www.w3.org/1999/xhtml">[</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2872.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializable(typeof(Product)</span></span><span class="koboSpan" id="kobo.2873.1" xmlns="http://www.w3.org/1999/xhtml">] </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2874.1" xmlns="http://www.w3.org/1999/xhtml">// A single Product.</span></span><span class="koboSpan" id="kobo.2875.1" xmlns="http://www.w3.org/1999/xhtml">
[</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2876.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializable(typeof(Product[</span></span><span class="koboSpan" id="kobo.2877.1" xmlns="http://www.w3.org/1999/xhtml">]))] </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2878.1" xmlns="http://www.w3.org/1999/xhtml">// An array of Products.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2879.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2880.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2881.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2882.1" xmlns="http://www.w3.org/1999/xhtml">MyJsonSerializerContext</span></span><span class="koboSpan" id="kobo.2883.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.2884.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerContext</span></span><span class="koboSpan" id="kobo.2885.1" xmlns="http://www.w3.org/1999/xhtml"> { }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2886.1" xmlns="http://www.w3.org/1999/xhtml">Your custom JSON serializer context must be added to the service dependencies, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2887.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.ConfigureHttpJsonOptions(options =&gt;
{
  options.SerializerOptions.AddContext&lt;MyJsonSerializerContext&gt;();
});
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-330"><span class="koboSpan" id="kobo.2888.1" xmlns="http://www.w3.org/1999/xhtml">Building a native AOT project</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2889.1" xmlns="http://www.w3.org/1999/xhtml">Now let’s see a practical example</span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.2890.1" xmlns="http://www.w3.org/1999/xhtml"> using the new project template:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2891.1" xmlns="http://www.w3.org/1999/xhtml">In the solution named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2892.1" xmlns="http://www.w3.org/1999/xhtml">Chapter08</span></code><span class="koboSpan" id="kobo.2893.1" xmlns="http://www.w3.org/1999/xhtml">, add a native AOT-compatible web service project, as defined in the following list:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2894.1" xmlns="http://www.w3.org/1999/xhtml">Project template: </span><strong class="screenText"><span class="koboSpan" id="kobo.2895.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core Web API (native AOT)</span></strong><span class="koboSpan" id="kobo.2896.1" xmlns="http://www.w3.org/1999/xhtml"> / </span><code class="inlineCode"><span class="koboSpan" id="kobo.2897.1" xmlns="http://www.w3.org/1999/xhtml">webapiaot</span></code>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2898.1" xmlns="http://www.w3.org/1999/xhtml">This is a new project template introduced with .NET 8. </span><span class="koboSpan" id="kobo.2898.2" xmlns="http://www.w3.org/1999/xhtml">It is different from the </span><strong class="screenText"><span class="koboSpan" id="kobo.2899.1" xmlns="http://www.w3.org/1999/xhtml">Web API</span></strong><span class="koboSpan" id="kobo.2900.1" xmlns="http://www.w3.org/1999/xhtml"> / </span><code class="inlineCode"><span class="koboSpan" id="kobo.2901.1" xmlns="http://www.w3.org/1999/xhtml">webapi</span></code><span class="koboSpan" id="kobo.2902.1" xmlns="http://www.w3.org/1999/xhtml"> project template. </span><span class="koboSpan" id="kobo.2902.2" xmlns="http://www.w3.org/1999/xhtml">It does not have an option to use controllers since native AOT support is currently minimal APIs-only. </span><span class="koboSpan" id="kobo.2902.3" xmlns="http://www.w3.org/1999/xhtml">It also does not have an option for HTTPS because HTTPS is often handled by a reverse-proxy in cloud-native deployments. </span><span class="koboSpan" id="kobo.2902.4" xmlns="http://www.w3.org/1999/xhtml">In JetBrains Rider, select </span><strong class="screenText"><span class="koboSpan" id="kobo.2903.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core Web Application</span></strong><span class="koboSpan" id="kobo.2904.1" xmlns="http://www.w3.org/1999/xhtml"> and then select the </span><strong class="screenText"><span class="koboSpan" id="kobo.2905.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></strong><span class="koboSpan" id="kobo.2906.1" xmlns="http://www.w3.org/1999/xhtml"> of </span><strong class="screenText"><span class="koboSpan" id="kobo.2907.1" xmlns="http://www.w3.org/1999/xhtml">Web API (native AOT)</span></strong><span class="koboSpan" id="kobo.2908.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ul>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2909.1" xmlns="http://www.w3.org/1999/xhtml">Solution file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2910.1" xmlns="http://www.w3.org/1999/xhtml">Chapter08</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2911.1" xmlns="http://www.w3.org/1999/xhtml">Project file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2912.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.MinimalAot.Service</span></code></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.2913.1" xmlns="http://www.w3.org/1999/xhtml">Enable Docker</span></strong><span class="koboSpan" id="kobo.2914.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.2915.1" xmlns="http://www.w3.org/1999/xhtml">Do not use top-level statements</span></strong><span class="koboSpan" id="kobo.2916.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2917.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2918.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></code><span class="koboSpan" id="kobo.2919.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2920.1" xmlns="http://www.w3.org/1999/xhtml">launchSettings.json</span></code><span class="koboSpan" id="kobo.2921.1" xmlns="http://www.w3.org/1999/xhtml">, note only </span><code class="inlineCode"><span class="koboSpan" id="kobo.2922.1" xmlns="http://www.w3.org/1999/xhtml">http</span></code><span class="koboSpan" id="kobo.2923.1" xmlns="http://www.w3.org/1999/xhtml"> is configured; delete the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2924.1" xmlns="http://www.w3.org/1999/xhtml">launchUrl</span></code><span class="koboSpan" id="kobo.2925.1" xmlns="http://www.w3.org/1999/xhtml"> and modify the port to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2926.1" xmlns="http://www.w3.org/1999/xhtml">5083</span></code><span class="koboSpan" id="kobo.2927.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following configuration:
            </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2928.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2929.1" xmlns="http://www.w3.org/1999/xhtml">"$schema"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2930.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2931.1" xmlns="http://www.w3.org/1999/xhtml">"http://json.schemastore.org/launchsettings.json"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2932.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2933.1" xmlns="http://www.w3.org/1999/xhtml">"profiles"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2934.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2935.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2936.1" xmlns="http://www.w3.org/1999/xhtml">"http"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2937.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2938.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2939.1" xmlns="http://www.w3.org/1999/xhtml">"commandName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2940.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2941.1" xmlns="http://www.w3.org/1999/xhtml">"Project"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2942.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2943.1" xmlns="http://www.w3.org/1999/xhtml">"dotnetRunMessages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2944.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2945.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2946.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2947.1" xmlns="http://www.w3.org/1999/xhtml">"launchBrowser"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2948.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2949.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2950.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2951.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2952.1" xmlns="http://www.w3.org/1999/xhtml">launchUrl"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2953.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2954.1" xmlns="http://www.w3.org/1999/xhtml">""</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2955.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2956.1" xmlns="http://www.w3.org/1999/xhtml">"applicationUrl"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2957.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2958.1" xmlns="http://www.w3.org/1999/xhtml">"http://localhost:</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2959.1" xmlns="http://www.w3.org/1999/xhtml">5083</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.2960.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2961.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2962.1" xmlns="http://www.w3.org/1999/xhtml">"environmentVariables"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2963.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2964.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2965.1" xmlns="http://www.w3.org/1999/xhtml">"ASPNETCORE_ENVIRONMENT"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2966.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2967.1" xmlns="http://www.w3.org/1999/xhtml">"Development"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2968.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2969.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2970.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2971.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2972.1" xmlns="http://www.w3.org/1999/xhtml">In the project file, change invariant globalization to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2973.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.2974.1" xmlns="http://www.w3.org/1999/xhtml">, treat warnings as errors, note that native AOT publishing is enabled, and add a package reference for SQL </span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.2975.1" xmlns="http://www.w3.org/1999/xhtml">Server for ADO.NET, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2976.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2977.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.NET.Sdk.Web"</span></span><span class="koboSpan" id="kobo.2978.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.2979.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.2980.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;InvariantGlobalization&gt;</span><span class="code-highlight"><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2981.1" xmlns="http://www.w3.org/1999/xhtml">false</span></strong></span><span class="koboSpan" id="kobo.2982.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/InvariantGlobalization&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2983.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;TreatWarningsAsErrors&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2984.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2985.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TreatWarningsAsErrors&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2986.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;PublishAot&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2987.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2988.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/PublishAot&gt;</span></strong></span><span class="koboSpan" id="kobo.2989.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;/PropertyGroup&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2990.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;ItemGroup&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2991.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;PackageReference Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2992.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Data.SqlClient"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2993.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2994.1" xmlns="http://www.w3.org/1999/xhtml">"5.1.2"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2995.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2996.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;/ItemGroup&gt;</span></strong></span><span class="koboSpan" id="kobo.2997.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/Project&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2998.1" xmlns="http://www.w3.org/1999/xhtml">Add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2999.1" xmlns="http://www.w3.org/1999/xhtml">Product.cs</span></code><span class="koboSpan" id="kobo.3000.1" xmlns="http://www.w3.org/1999/xhtml">, and modify its contents to define a class to represent just the three columns we want from each row in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3001.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></code><span class="koboSpan" id="kobo.3002.1" xmlns="http://www.w3.org/1999/xhtml"> table, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3003.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3004.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Models</span></span><span class="koboSpan" id="kobo.3005.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3006.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3007.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3008.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></span><span class="koboSpan" id="kobo.3009.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3010.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.3011.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.3012.1" xmlns="http://www.w3.org/1999/xhtml"> ProductId { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3013.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.3014.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3015.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.3016.1" xmlns="http://www.w3.org/1999/xhtml">; }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3017.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.3018.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.3019.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.3019.2" xmlns="http://www.w3.org/1999/xhtml">ProductName { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3020.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.3021.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3022.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.3023.1" xmlns="http://www.w3.org/1999/xhtml">; }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3024.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.3025.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.3026.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.3026.2" xmlns="http://www.w3.org/1999/xhtml">UnitPrice { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3027.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.3028.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3029.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.3030.1" xmlns="http://www.w3.org/1999/xhtml">; }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3031.1" xmlns="http://www.w3.org/1999/xhtml">Add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3032.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindJsonSerializerContext.cs</span></code><span class="koboSpan" id="kobo.3033.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3034.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3035.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindJsonSerializerContext.cs</span></code><span class="koboSpan" id="kobo.3036.1" xmlns="http://www.w3.org/1999/xhtml">, define a class that enables a </span><code class="inlineCode"><span class="koboSpan" id="kobo.3037.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.3038.1" xmlns="http://www.w3.org/1999/xhtml"> and a list </span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.3039.1" xmlns="http://www.w3.org/1999/xhtml">of </span><code class="inlineCode"><span class="koboSpan" id="kobo.3040.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.3041.1" xmlns="http://www.w3.org/1999/xhtml"> objects to be serialized as JSON, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3042.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.3043.1" xmlns="http://www.w3.org/1999/xhtml"> System.Text.Json.Serialization; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3044.1" xmlns="http://www.w3.org/1999/xhtml">// To use JsonSerializerContext.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3045.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.3046.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.Models; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3047.1" xmlns="http://www.w3.org/1999/xhtml">// To use Product.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3048.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3049.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Serialization</span></span><span class="koboSpan" id="kobo.3050.1" xmlns="http://www.w3.org/1999/xhtml">;
[</span><span class="hljs-meta"><span class="koboSpan" id="kobo.3051.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializable(typeof(Product))</span></span><span class="koboSpan" id="kobo.3052.1" xmlns="http://www.w3.org/1999/xhtml">]
[</span><span class="hljs-meta"><span class="koboSpan" id="kobo.3053.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializable(typeof(List&lt;Product&gt;))</span></span><span class="koboSpan" id="kobo.3054.1" xmlns="http://www.w3.org/1999/xhtml">]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3055.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3056.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3057.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3058.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindJsonSerializerContext</span></span><span class="koboSpan" id="kobo.3059.1" xmlns="http://www.w3.org/1999/xhtml">
  : </span><span class="hljs-title"><span class="koboSpan" id="kobo.3060.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerContext</span></span><span class="koboSpan" id="kobo.3061.1" xmlns="http://www.w3.org/1999/xhtml"> { }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3062.1" xmlns="http://www.w3.org/1999/xhtml">Delete the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3063.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.MinimalAot.Service.http</span></code><span class="koboSpan" id="kobo.3064.1" xmlns="http://www.w3.org/1999/xhtml"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3065.1" xmlns="http://www.w3.org/1999/xhtml">Add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3066.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.3067.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3068.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3069.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.3070.1" xmlns="http://www.w3.org/1999/xhtml">, define an extension method for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3071.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication</span></code><span class="koboSpan" id="kobo.3072.1" xmlns="http://www.w3.org/1999/xhtml"> class that maps some HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.3073.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.3074.1" xmlns="http://www.w3.org/1999/xhtml"> requests to return a plain text response, and a list of either all products or products with a minimum price from the Northwind database using ADO.NET, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3075.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.3076.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Data.SqlClient; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3077.1" xmlns="http://www.w3.org/1999/xhtml">// To use SqlConnection and so on.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3078.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.3079.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.Models; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3080.1" xmlns="http://www.w3.org/1999/xhtml">// To use Product.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3081.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.3082.1" xmlns="http://www.w3.org/1999/xhtml"> System.Data; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3083.1" xmlns="http://www.w3.org/1999/xhtml">// To use CommandType.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3084.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3085.1" xmlns="http://www.w3.org/1999/xhtml">Packt.Extensions</span></span><span class="koboSpan" id="kobo.3086.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3087.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3088.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3089.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3090.1" xmlns="http://www.w3.org/1999/xhtml">WebApplicationExtensions</span></span><span class="koboSpan" id="kobo.3091.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3092.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3093.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3094.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.3095.1" xmlns="http://www.w3.org/1999/xhtml">MapGets</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3096.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3097.1" xmlns="http://www.w3.org/1999/xhtml">this</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3098.1" xmlns="http://www.w3.org/1999/xhtml"> WebApplication app</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3099.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.3100.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3101.1" xmlns="http://www.w3.org/1999/xhtml">// app.MapGet(pattern, handler);</span></span><span class="koboSpan" id="kobo.3102.1" xmlns="http://www.w3.org/1999/xhtml">
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3103.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.3104.1" xmlns="http://www.w3.org/1999/xhtml">, () =&gt; </span><span class="hljs-string"><span class="koboSpan" id="kobo.3105.1" xmlns="http://www.w3.org/1999/xhtml">"Hello from a native AOT minimal API web service."</span></span><span class="koboSpan" id="kobo.3106.1" xmlns="http://www.w3.org/1999/xhtml">);
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3107.1" xmlns="http://www.w3.org/1999/xhtml">"/products"</span></span><span class="koboSpan" id="kobo.3108.1" xmlns="http://www.w3.org/1999/xhtml">, GetProducts);
    app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3109.1" xmlns="http://www.w3.org/1999/xhtml">"/products/{minimumUnitPrice:decimal?}"</span></span><span class="koboSpan" id="kobo.3110.1" xmlns="http://www.w3.org/1999/xhtml">, GetProducts);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3111.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.3112.1" xmlns="http://www.w3.org/1999/xhtml"> app;
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3113.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3114.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3115.1" xmlns="http://www.w3.org/1999/xhtml"> List&lt;Product&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.3116.1" xmlns="http://www.w3.org/1999/xhtml">GetProducts</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3117.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3118.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3119.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.3119.2" xmlns="http://www.w3.org/1999/xhtml">minimumUnitPrice = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.3120.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3121.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.3122.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    SqlConnectionStringBuilder builder = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3123.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3124.1" xmlns="http://www.w3.org/1999/xhtml">();
    builder.InitialCatalog = </span><span class="hljs-string"><span class="koboSpan" id="kobo.3125.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind"</span></span><span class="koboSpan" id="kobo.3126.1" xmlns="http://www.w3.org/1999/xhtml">;
    builder.MultipleActiveResultSets = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.3127.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.3128.1" xmlns="http://www.w3.org/1999/xhtml">;
    builder.Encrypt = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.3129.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.3130.1" xmlns="http://www.w3.org/1999/xhtml">;
    builder.TrustServerCertificate = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.3131.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.3132.1" xmlns="http://www.w3.org/1999/xhtml">;
    builder.ConnectTimeout = </span><span class="hljs-number"><span class="koboSpan" id="kobo.3133.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span><span class="koboSpan" id="kobo.3134.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3135.1" xmlns="http://www.w3.org/1999/xhtml">// Default is 30 seconds.</span></span><span class="koboSpan" id="kobo.3136.1" xmlns="http://www.w3.org/1999/xhtml">
    builder.DataSource = </span><span class="hljs-string"><span class="koboSpan" id="kobo.3137.1" xmlns="http://www.w3.org/1999/xhtml">"."</span></span><span class="koboSpan" id="kobo.3138.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3139.1" xmlns="http://www.w3.org/1999/xhtml">// Local SQL Server</span></span><span class="koboSpan" id="kobo.3140.1" xmlns="http://www.w3.org/1999/xhtml">
    builder.IntegratedSecurity = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.3141.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.3142.1" xmlns="http://www.w3.org/1999/xhtml">;
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3143.1" xmlns="http://www.w3.org/1999/xhtml">/*</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.3144.1" xmlns="http://www.w3.org/1999/xhtml">    // To use SQL Server Authentication:</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.3145.1" xmlns="http://www.w3.org/1999/xhtml">    builder.UserID = Environment.GetEnvironmentVariable("MY_SQL_USR");</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.3146.1" xmlns="http://www.w3.org/1999/xhtml">    builder.Password = Environment.GetEnvironmentVariable("MY_SQL_PWD");</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.3147.1" xmlns="http://www.w3.org/1999/xhtml">    builder.PersistSecurityInfo = false;</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.3148.1" xmlns="http://www.w3.org/1999/xhtml">    */</span></span><span class="koboSpan" id="kobo.3149.1" xmlns="http://www.w3.org/1999/xhtml">
    SqlConnection connection = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3150.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3151.1" xmlns="http://www.w3.org/1999/xhtml">(builder.ConnectionString);
    connection.Open();
    SqlCommand cmd = connection.CreateCommand();
    cmd.CommandType = CommandType.Text;
    cmd.CommandText =
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.3152.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3153.1" xmlns="http://www.w3.org/1999/xhtml">SELECT ProductId, ProductName, UnitPrice FROM Products"</span></span><span class="koboSpan" id="kobo.3154.1" xmlns="http://www.w3.org/1999/xhtml">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3155.1" xmlns="http://www.w3.org/1999/xhtml">if</span></span><span class="koboSpan" id="kobo.3156.1" xmlns="http://www.w3.org/1999/xhtml"> (minimumUnitPrice.HasValue)
    {
      cmd.CommandText += </span><span class="hljs-string"><span class="koboSpan" id="kobo.3157.1" xmlns="http://www.w3.org/1999/xhtml">" WHERE UnitPrice &gt;= @minimumUnitPrice"</span></span><span class="koboSpan" id="kobo.3158.1" xmlns="http://www.w3.org/1999/xhtml">;
      cmd.Parameters.AddWithValue(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3159.1" xmlns="http://www.w3.org/1999/xhtml">"minimumUnitPrice"</span></span><span class="koboSpan" id="kobo.3160.1" xmlns="http://www.w3.org/1999/xhtml">, minimumUnitPrice);
    }
    SqlDataReader r = cmd.ExecuteReader();
    List&lt;Product&gt; products = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3161.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3162.1" xmlns="http://www.w3.org/1999/xhtml">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3163.1" xmlns="http://www.w3.org/1999/xhtml">while</span></span><span class="koboSpan" id="kobo.3164.1" xmlns="http://www.w3.org/1999/xhtml"> (r.Read())
    {
      Product p = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3165.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3166.1" xmlns="http://www.w3.org/1999/xhtml">()
      {
        ProductId = r.GetInt32(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3167.1" xmlns="http://www.w3.org/1999/xhtml">"ProductId"</span></span><span class="koboSpan" id="kobo.3168.1" xmlns="http://www.w3.org/1999/xhtml">),
        ProductName = r.GetString(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3169.1" xmlns="http://www.w3.org/1999/xhtml">"ProductName"</span></span><span class="koboSpan" id="kobo.3170.1" xmlns="http://www.w3.org/1999/xhtml">),
        UnitPrice = r.GetDecimal(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3171.1" xmlns="http://www.w3.org/1999/xhtml">"UnitPrice"</span></span><span class="koboSpan" id="kobo.3172.1" xmlns="http://www.w3.org/1999/xhtml">)
      };
      products.Add(p);
    }
    r.Close();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3173.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.3174.1" xmlns="http://www.w3.org/1999/xhtml"> products;
  }
}
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3175.1" xmlns="http://www.w3.org/1999/xhtml">With native AOT, we cannot use EF Core, so we are using the lower-level ADO.NET SqlClient API. </span><span class="koboSpan" id="kobo.3175.2" xmlns="http://www.w3.org/1999/xhtml">This is faster and more efficient anyway. </span><span class="koboSpan" id="kobo.3175.3" xmlns="http://www.w3.org/1999/xhtml">In the future, perhaps with .NET 9 or .NET 10, we will be able to use our EF Core model for Northwind instead.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.3176.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3177.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3178.1" xmlns="http://www.w3.org/1999/xhtml">, note the call to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3179.1" xmlns="http://www.w3.org/1999/xhtml">CreateSlimBuilder</span></code><span class="koboSpan" id="kobo.3180.1" xmlns="http://www.w3.org/1999/xhtml"> method, which ensures that only the essential features of ASP.NET Core are enabled by default, so it minimizes</span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.3181.1" xmlns="http://www.w3.org/1999/xhtml"> the deployed web service size, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3182.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.3183.1" xmlns="http://www.w3.org/1999/xhtml"> builder = WebApplication.CreateSlimBuilder(args);
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3184.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3185.1" xmlns="http://www.w3.org/1999/xhtml">CreateSlimBuilder</span></code><span class="koboSpan" id="kobo.3186.1" xmlns="http://www.w3.org/1999/xhtml"> method does not include support for HTTPS or HTTP/3, although you can add those back in yourself if you need them. </span><span class="koboSpan" id="kobo.3186.2" xmlns="http://www.w3.org/1999/xhtml">It does support JSON file configuration for </span><code class="inlineCode"><span class="koboSpan" id="kobo.3187.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.json</span></code><span class="koboSpan" id="kobo.3188.1" xmlns="http://www.w3.org/1999/xhtml"> and logging.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.3189.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3190.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3191.1" xmlns="http://www.w3.org/1999/xhtml">, after the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3192.1" xmlns="http://www.w3.org/1999/xhtml">builder.Build()</span></code><span class="koboSpan" id="kobo.3193.1" xmlns="http://www.w3.org/1999/xhtml">, delete the statements that generated some sample todos and map some endpoints, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3194.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.3195.1" xmlns="http://www.w3.org/1999/xhtml"> sampleTodos = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3196.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3197.1" xmlns="http://www.w3.org/1999/xhtml"> Todo[]
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3198.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3199.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3200.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.3201.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3202.1" xmlns="http://www.w3.org/1999/xhtml">"Walk the dog"</span></span><span class="koboSpan" id="kobo.3203.1" xmlns="http://www.w3.org/1999/xhtml">),
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3204.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3205.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3206.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.3207.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3208.1" xmlns="http://www.w3.org/1999/xhtml">"Do the dishes"</span></span><span class="koboSpan" id="kobo.3209.1" xmlns="http://www.w3.org/1999/xhtml">, DateOnly.FromDateTime(DateTime.Now)),
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3210.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3211.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3212.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.3213.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3214.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3215.1" xmlns="http://www.w3.org/1999/xhtml">Do the laundry"</span></span><span class="koboSpan" id="kobo.3216.1" xmlns="http://www.w3.org/1999/xhtml">, DateOnly.FromDateTime(DateTime.Now.AddDays(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3217.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.3218.1" xmlns="http://www.w3.org/1999/xhtml">))),
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3219.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3220.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3221.1" xmlns="http://www.w3.org/1999/xhtml">4</span></span><span class="koboSpan" id="kobo.3222.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3223.1" xmlns="http://www.w3.org/1999/xhtml">"Clean the bathroom"</span></span><span class="koboSpan" id="kobo.3224.1" xmlns="http://www.w3.org/1999/xhtml">),
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3225.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3226.1" xmlns="http://www.w3.org/1999/xhtml">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3227.1" xmlns="http://www.w3.org/1999/xhtml">5</span></span><span class="koboSpan" id="kobo.3228.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3229.1" xmlns="http://www.w3.org/1999/xhtml">"Clean the car"</span></span><span class="koboSpan" id="kobo.3230.1" xmlns="http://www.w3.org/1999/xhtml">, DateOnly.FromDateTime(DateTime.Now.AddDays(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3231.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.3232.1" xmlns="http://www.w3.org/1999/xhtml">)))
};
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3233.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.3234.1" xmlns="http://www.w3.org/1999/xhtml"> todosApi = app.MapGroup(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3235.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3236.1" xmlns="http://www.w3.org/1999/xhtml">/todos"</span></span><span class="koboSpan" id="kobo.3237.1" xmlns="http://www.w3.org/1999/xhtml">);
todosApi.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3238.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.3239.1" xmlns="http://www.w3.org/1999/xhtml">, () =&gt; sampleTodos);
todosApi.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3240.1" xmlns="http://www.w3.org/1999/xhtml">"/{id}"</span></span><span class="koboSpan" id="kobo.3241.1" xmlns="http://www.w3.org/1999/xhtml">, (</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3242.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.3243.1" xmlns="http://www.w3.org/1999/xhtml"> id) =&gt;
    sampleTodos.FirstOrDefault(a =&gt; a.Id == id) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3244.1" xmlns="http://www.w3.org/1999/xhtml">is</span></span><span class="koboSpan" id="kobo.3245.1" xmlns="http://www.w3.org/1999/xhtml"> { } todo
        ? </span><span class="koboSpan" id="kobo.3245.2" xmlns="http://www.w3.org/1999/xhtml">Results.Ok(todo)
        : Results.NotFound());
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3246.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3247.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3248.1" xmlns="http://www.w3.org/1999/xhtml">, at the bottom of the file, delete the statements that define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3249.1" xmlns="http://www.w3.org/1999/xhtml">Todo</span></code><span class="koboSpan" id="kobo.3250.1" xmlns="http://www.w3.org/1999/xhtml"> record and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3251.1" xmlns="http://www.w3.org/1999/xhtml">AppJsonSerializerContext</span></code><span class="koboSpan" id="kobo.3252.1" xmlns="http://www.w3.org/1999/xhtml"> class, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3253.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3254.1" xmlns="http://www.w3.org/1999/xhtml">record</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.3255.1" xmlns="http://www.w3.org/1999/xhtml">Todo</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3256.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3257.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3258.1" xmlns="http://www.w3.org/1999/xhtml"> Id, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3259.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3260.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.3260.2" xmlns="http://www.w3.org/1999/xhtml">Title, DateOnly? </span><span class="koboSpan" id="kobo.3260.3" xmlns="http://www.w3.org/1999/xhtml">DueBy = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.3261.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3262.1" xmlns="http://www.w3.org/1999/xhtml">, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3263.1" xmlns="http://www.w3.org/1999/xhtml">bool</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3264.1" xmlns="http://www.w3.org/1999/xhtml"> IsComplete = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.3265.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3266.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.3267.1" xmlns="http://www.w3.org/1999/xhtml">;
[</span><span class="hljs-meta"><span class="koboSpan" id="kobo.3268.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializable(typeof(Todo[</span></span><span class="koboSpan" id="kobo.3269.1" xmlns="http://www.w3.org/1999/xhtml">]))]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3270.1" xmlns="http://www.w3.org/1999/xhtml">internal</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3271.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3272.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3273.1" xmlns="http://www.w3.org/1999/xhtml">AppJsonSerializerContext</span></span><span class="koboSpan" id="kobo.3274.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.3275.1" xmlns="http://www.w3.org/1999/xhtml">JsonSerializerContext</span></span><span class="koboSpan" id="kobo.3276.1" xmlns="http://www.w3.org/1999/xhtml">
{
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3277.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3278.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3279.1" xmlns="http://www.w3.org/1999/xhtml">, delete the namespace imports, import the namespaces for our JSON serializer context and extension methods, modify the statement that inserts the JSON serialization context to use the Northwind one, and then before running</span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.3280.1" xmlns="http://www.w3.org/1999/xhtml"> the web </span><code class="inlineCode"><span class="koboSpan" id="kobo.3281.1" xmlns="http://www.w3.org/1999/xhtml">app</span></code><span class="koboSpan" id="kobo.3282.1" xmlns="http://www.w3.org/1999/xhtml">, call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3283.1" xmlns="http://www.w3.org/1999/xhtml">MapGets</span></code><span class="koboSpan" id="kobo.3284.1" xmlns="http://www.w3.org/1999/xhtml"> method, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3285.1" xmlns="http://www.w3.org/1999/xhtml">using</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3286.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.Serialization;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3287.1" xmlns="http://www.w3.org/1999/xhtml">using</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3288.1" xmlns="http://www.w3.org/1999/xhtml"> Packt.Extensions; </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.3289.1" xmlns="http://www.w3.org/1999/xhtml">// To use MapGets().</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3290.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.3291.1" xmlns="http://www.w3.org/1999/xhtml"> builder = WebApplication.CreateSlimBuilder(args);
builder.Services.ConfigureHttpJsonOptions(options =&gt;
{
  options.SerializerOptions.TypeInfoResolverChain
    .Insert(</span><span class="hljs-number"><span class="koboSpan" id="kobo.3292.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.3293.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3294.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindJsonSerializerContext</span></strong></span><span class="koboSpan" id="kobo.3295.1" xmlns="http://www.w3.org/1999/xhtml">.Default);
});
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3296.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.3297.1" xmlns="http://www.w3.org/1999/xhtml"> app = builder.Build();
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3298.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGets();</span></strong></span><span class="koboSpan" id="kobo.3299.1" xmlns="http://www.w3.org/1999/xhtml">
app.Run();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3300.1" xmlns="http://www.w3.org/1999/xhtml">If your database server is not running (for example, because you are hosting it in Docker, a virtual machine, or in the cloud), then make sure to start it.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3301.1" xmlns="http://www.w3.org/1999/xhtml">Start the web service project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3302.1" xmlns="http://www.w3.org/1999/xhtml">http</span></code><span class="koboSpan" id="kobo.3303.1" xmlns="http://www.w3.org/1999/xhtml"> profile:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3304.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, then select the </span><strong class="screenText"><span class="koboSpan" id="kobo.3305.1" xmlns="http://www.w3.org/1999/xhtml">http</span></strong><span class="koboSpan" id="kobo.3306.1" xmlns="http://www.w3.org/1999/xhtml"> profile in the drop-down list and then navigate to </span><strong class="screenText"><span class="koboSpan" id="kobo.3307.1" xmlns="http://www.w3.org/1999/xhtml">Debug</span></strong><span class="koboSpan" id="kobo.3308.1" xmlns="http://www.w3.org/1999/xhtml"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.3309.1" xmlns="http://www.w3.org/1999/xhtml">Start Without Debugging</span></strong><span class="koboSpan" id="kobo.3310.1" xmlns="http://www.w3.org/1999/xhtml"> or press </span><em class="keystroke"><span class="koboSpan" id="kobo.3311.1" xmlns="http://www.w3.org/1999/xhtml">Ctrl</span></em><span class="koboSpan" id="kobo.3312.1" xmlns="http://www.w3.org/1999/xhtml"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.3313.1" xmlns="http://www.w3.org/1999/xhtml">F5</span></em><span class="koboSpan" id="kobo.3314.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3315.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio Code, then enter the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.3316.1" xmlns="http://www.w3.org/1999/xhtml">dotnet run --launch-profile http</span></code><span class="koboSpan" id="kobo.3317.1" xmlns="http://www.w3.org/1999/xhtml">, manually start a web browser, and navigate to the web service: </span><code class="inlineCode"><span class="koboSpan" id="kobo.3318.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5083/</span></code><span class="koboSpan" id="kobo.3319.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3320.1" xmlns="http://www.w3.org/1999/xhtml">In the web browser, note</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.3321.1" xmlns="http://www.w3.org/1999/xhtml"> the plain text response: </span><code class="inlineCode"><span class="koboSpan" id="kobo.3322.1" xmlns="http://www.w3.org/1999/xhtml">Hello from a native AOT minimal API web service.</span></code></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3323.1" xmlns="http://www.w3.org/1999/xhtml">In the address bar, append </span><code class="inlineCode"><span class="koboSpan" id="kobo.3324.1" xmlns="http://www.w3.org/1999/xhtml">/products</span></code><span class="koboSpan" id="kobo.3325.1" xmlns="http://www.w3.org/1999/xhtml">, and note the array of products in the response, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3326.1" xmlns="http://www.w3.org/1999/xhtml">[{"productId":1,"productName":"Chai","unitPrice":18.0000},
 {"productId":2,"productName":"Chang","unitPrice":19.0000},
 {"productId":3,"productName":"Aniseed Syrup","unitPrice":10.0000},
 {"productId":4,"productName":"Chef Anton's Cajun Seasoning",
  "unitPrice":22.0000},
 {"productId":5,"productName":"Chef Anton's Gumbo Mix",
  "unitPrice":21.3500},
 {"productId":6,"productName":"Grandma's Boysenberry Spread",
  "unitPrice":25.0000},
 {"productId":7,"productName":"Uncle Bob's Organic Dried Pears",
  "unitPrice":30.0000},
 {"productId":8,"productName":"Northwoods Cranberry Sauce",
  "unitPrice":40.0000},
 {"productId":9,"productName":"Mishi Kobe Niku","unitPrice":97.0000},
 {"productId":10,"productName":"Ikura","unitPrice":31.0000},
 {"productId":11,"productName":"Queso Cabrales","unitPrice":21.0000},
 {"productId":12,"productName":"Queso Manchego La Pastora",
  "unitPrice":38.0000},
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3327.1" xmlns="http://www.w3.org/1999/xhtml">In the address bar, append </span><code class="inlineCode"><span class="koboSpan" id="kobo.3328.1" xmlns="http://www.w3.org/1999/xhtml">/products/100</span></code><span class="koboSpan" id="kobo.3329.1" xmlns="http://www.w3.org/1999/xhtml">, and note the array of two products in the response, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3330.1" xmlns="http://www.w3.org/1999/xhtml">[{"productId":29,"productName":"Thüringer Rostbratwurst","unitPrice":123.7900},{"productId":38,"productName":"Côte de Blaye","unitPrice":263.5000}]
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3331.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web server.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-331"><span class="koboSpan" id="kobo.3332.1" xmlns="http://www.w3.org/1999/xhtml">Publishing a native AOT project</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3333.1" xmlns="http://www.w3.org/1999/xhtml">A service that functions correctly during development when the service is untrimmed and JIT-compiled could still fail once you publish it using native AOT. </span><span class="koboSpan" id="kobo.3333.2" xmlns="http://www.w3.org/1999/xhtml">You should therefore perform a</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.3334.1" xmlns="http://www.w3.org/1999/xhtml"> publish before assuming your project will work.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3335.1" xmlns="http://www.w3.org/1999/xhtml">If your project does not produce any AOT warnings at publish time, you can then be confident that your service will work after publishing for AOT.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3336.1" xmlns="http://www.w3.org/1999/xhtml">Let’s review the source-generated code and publish our web service:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3337.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3338.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.MinimalAot.Service</span></code><span class="koboSpan" id="kobo.3339.1" xmlns="http://www.w3.org/1999/xhtml"> project file, add an element to emit compiler-generated files, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3340.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PropertyGroup&gt;
  &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.3341.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.3342.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
  ...
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3343.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;EmitCompilerGeneratedFiles&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.3344.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3345.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/EmitCompilerGeneratedFiles&gt;</span></strong></span><span class="koboSpan" id="kobo.3346.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/PropertyGroup&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3347.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3348.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.MinimalAot.Service</span></code><span class="koboSpan" id="kobo.3349.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3350.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, toggle </span><strong class="screenText"><span class="koboSpan" id="kobo.3351.1" xmlns="http://www.w3.org/1999/xhtml">Show All Files</span></strong><span class="koboSpan" id="kobo.3352.1" xmlns="http://www.w3.org/1999/xhtml"> in </span><strong class="screenText"><span class="koboSpan" id="kobo.3353.1" xmlns="http://www.w3.org/1999/xhtml">Solution Explorer</span></strong><span class="koboSpan" id="kobo.3354.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3355.1" xmlns="http://www.w3.org/1999/xhtml">Expand the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3356.1" xmlns="http://www.w3.org/1999/xhtml">obj\Debug\net8.0\generated</span></code><span class="koboSpan" id="kobo.3357.1" xmlns="http://www.w3.org/1999/xhtml"> folder, and note the folders and files that have been created by the source generators for AOT and JSON serialization, and note that you will be opening some of these files in the next few steps, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.3358.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.10</span></em><span class="koboSpan" id="kobo.3359.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3360.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3361.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.10: Folders and files created by source generators in an AOT web service project</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.3362.1" xmlns="http://www.w3.org/1999/xhtml">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3363.1" xmlns="http://www.w3.org/1999/xhtml">GeneratedRouteBuilderExtensions.g.cs</span></code><span class="koboSpan" id="kobo.3364.1" xmlns="http://www.w3.org/1999/xhtml"> file, and note it contains code to define the mapped routes for the minimal API web service.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3365.1" xmlns="http://www.w3.org/1999/xhtml">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3366.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindJsonSerializerContext.Decimal.g.cs</span></code><span class="koboSpan" id="kobo.3367.1" xmlns="http://www.w3.org/1999/xhtml"> file, and note it contains code to serialize a </span><code class="inlineCode"><span class="koboSpan" id="kobo.3368.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.3369.1" xmlns="http://www.w3.org/1999/xhtml"> value passed as the minimum unit price parameter to one of the routes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3370.1" xmlns="http://www.w3.org/1999/xhtml">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3371.1" xmlns="http://www.w3.org/1999/xhtml">NorthwindJsonSerializerContext.ListProduct.g.cs</span></code><span class="koboSpan" id="kobo.3372.1" xmlns="http://www.w3.org/1999/xhtml"> file, and note it contains</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.3373.1" xmlns="http://www.w3.org/1999/xhtml"> code to serialize a list of </span><code class="inlineCode"><span class="koboSpan" id="kobo.3374.1" xmlns="http://www.w3.org/1999/xhtml">Product</span></code><span class="koboSpan" id="kobo.3375.1" xmlns="http://www.w3.org/1999/xhtml"> objects returned as a response for two of the routes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3376.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3377.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.MinimalAot.Service</span></code><span class="koboSpan" id="kobo.3378.1" xmlns="http://www.w3.org/1999/xhtml"> folder, at the command prompt or terminal, publish the web service using native AOT, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3379.1" xmlns="http://www.w3.org/1999/xhtml">dotnet publish
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3380.1" xmlns="http://www.w3.org/1999/xhtml">Note the message about generating native code and trim warnings for packages like </span><code class="inlineCode"><span class="koboSpan" id="kobo.3381.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient</span></code><span class="koboSpan" id="kobo.3382.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3383.1" xmlns="http://www.w3.org/1999/xhtml">Generating native code
C:\Users\markj\.nuget\packages\microsoft.data.sqlclient\5.1.1\runtimes\win\lib\net6.0\Microsoft.Data.SqlClient.dll : warning IL2104: Assembly 'Microsoft.Data.SqlClient' produced trim warnings. </span><span class="koboSpan" id="kobo.3383.2" xmlns="http://www.w3.org/1999/xhtml">For more information see https://aka.ms/dotnet-illink/libraries [C:\apps-services-net8\Chapter08\Northwind.MinimalAot.Service\Northwind.MinimalAot.Service.csproj]
/_/src/libraries/System.Data.Common/src/System/Data/DataTable.cs(6704): Trim analysis warning IL2026: System.Data.DataTable.System.Xml.Serialization.IXmlSerializable.ReadXml(XmlReader): Using member 'System.Data.DataTable.ReadXmlSerializableInternal(XmlReader)' which has 'RequiresUnreferencedCodeAttribute' can break functionality when trimming application code. </span><span class="koboSpan" id="kobo.3383.3" xmlns="http://www.w3.org/1999/xhtml">DataTable.ReadXml uses XmlSerialization underneath which is not trimming safe. </span><span class="koboSpan" id="kobo.3383.4" xmlns="http://www.w3.org/1999/xhtml">Members from serialized types may be trimmed if not referenced directly. </span><span class="koboSpan" id="kobo.3383.5" xmlns="http://www.w3.org/1999/xhtml">[C:\apps-services-net8\Chapter08\Northwind.MinimalAot.Service\Northwind.MinimalAot.Service.csproj]
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3384.1" xmlns="http://www.w3.org/1999/xhtml">We did not use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3385.1" xmlns="http://www.w3.org/1999/xhtml">DataTable.ReadXml</span></code><span class="koboSpan" id="kobo.3386.1" xmlns="http://www.w3.org/1999/xhtml"> method, which is calling a potentially trimmed member, so we can ignore the preceding warning.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.3387.1" xmlns="http://www.w3.org/1999/xhtml">Start </span><strong class="screenText"><span class="koboSpan" id="kobo.3388.1" xmlns="http://www.w3.org/1999/xhtml">File Explorer</span></strong><span class="koboSpan" id="kobo.3389.1" xmlns="http://www.w3.org/1999/xhtml"> and open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3390.1" xmlns="http://www.w3.org/1999/xhtml">bin\Release\net8.0\win-x64\publish</span></code><span class="koboSpan" id="kobo.3391.1" xmlns="http://www.w3.org/1999/xhtml"> folder and note the EXE file is about 30 MB. </span><span class="koboSpan" id="kobo.3391.2" xmlns="http://www.w3.org/1999/xhtml">This and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3392.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient.SNI.dll</span></code><span class="koboSpan" id="kobo.3393.1" xmlns="http://www.w3.org/1999/xhtml"> file are the only files that need to be deployed onto another </span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.3394.1" xmlns="http://www.w3.org/1999/xhtml">Windows computer for the web service to work. </span><span class="koboSpan" id="kobo.3394.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3395.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.json</span></code><span class="koboSpan" id="kobo.3396.1" xmlns="http://www.w3.org/1999/xhtml"> files are only needed to override configuration if needed. </span><span class="koboSpan" id="kobo.3396.2" xmlns="http://www.w3.org/1999/xhtml">The PDB file is only needed if debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3397.1" xmlns="http://www.w3.org/1999/xhtml">Run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3398.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.MinimalAot.Service.exe</span></code><span class="koboSpan" id="kobo.3399.1" xmlns="http://www.w3.org/1999/xhtml">, and note the web service starts up very fast and it will use port </span><code class="inlineCode"><span class="koboSpan" id="kobo.3400.1" xmlns="http://www.w3.org/1999/xhtml">5000</span></code><span class="koboSpan" id="kobo.3401.1" xmlns="http://www.w3.org/1999/xhtml"> by default, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.3402.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.11</span></em><span class="koboSpan" id="kobo.3403.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3404.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_08_11.png"/></span></figure>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3405.1" xmlns="http://www.w3.org/1999/xhtml">Figure 8.11: File Explorer showing published executable and running the AOT web service</span></figure>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="12"><span class="koboSpan" id="kobo.3406.1" xmlns="http://www.w3.org/1999/xhtml">Start a web browser, navigate </span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.3407.1" xmlns="http://www.w3.org/1999/xhtml">to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3408.1" xmlns="http://www.w3.org/1999/xhtml">http://localhost:5000/</span></code><span class="koboSpan" id="kobo.3409.1" xmlns="http://www.w3.org/1999/xhtml">, and note the web service works correctly by returning the plain text response.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3410.1" xmlns="http://www.w3.org/1999/xhtml">Navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3411.1" xmlns="http://www.w3.org/1999/xhtml">http://localhost:5000/products/100</span></code><span class="koboSpan" id="kobo.3412.1" xmlns="http://www.w3.org/1999/xhtml">, and note the web service responds with the two products that have a minimum unit price of 100.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3413.1" xmlns="http://www.w3.org/1999/xhtml">Close the web browser and shut down the web service.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3414.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3415.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.3416.1" xmlns="http://www.w3.org/1999/xhtml"> project file, at the command prompt or terminal, publish the web service, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3417.1" xmlns="http://www.w3.org/1999/xhtml">dotnet publish
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3418.1" xmlns="http://www.w3.org/1999/xhtml">Start </span><strong class="screenText"><span class="koboSpan" id="kobo.3419.1" xmlns="http://www.w3.org/1999/xhtml">File Explorer</span></strong><span class="koboSpan" id="kobo.3420.1" xmlns="http://www.w3.org/1999/xhtml">, open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3421.1" xmlns="http://www.w3.org/1999/xhtml">bin\Release\net8.0\win-x64\publish</span></code><span class="koboSpan" id="kobo.3422.1" xmlns="http://www.w3.org/1999/xhtml"> folder, and note the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3423.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service.exe</span></code><span class="koboSpan" id="kobo.3424.1" xmlns="http://www.w3.org/1999/xhtml"> file is less than 154 KB. </span><span class="koboSpan" id="kobo.3424.2" xmlns="http://www.w3.org/1999/xhtml">That is because it is framework-dependent, meaning it needs .NET installed on the computer to work. </span><span class="koboSpan" id="kobo.3424.3" xmlns="http://www.w3.org/1999/xhtml">Also, there are many files that must be deployed along with the EXE file that add up to about 14 MB.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3425.1" xmlns="http://www.w3.org/1999/xhtml">Run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3426.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.MinimalAot.Service.exe</span></code><span class="koboSpan" id="kobo.3427.1" xmlns="http://www.w3.org/1999/xhtml"> and note the web service starts up slower than the AOT version and it will use port </span><code class="inlineCode"><span class="koboSpan" id="kobo.3428.1" xmlns="http://www.w3.org/1999/xhtml">5000</span></code><span class="koboSpan" id="kobo.3429.1" xmlns="http://www.w3.org/1999/xhtml"> by default.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3430.1" xmlns="http://www.w3.org/1999/xhtml">Start a web browser, navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3431.1" xmlns="http://www.w3.org/1999/xhtml">http://localhost:5000/</span></code><span class="koboSpan" id="kobo.3432.1" xmlns="http://www.w3.org/1999/xhtml">, and note the web service works correctly by returning the plain text response.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3433.1" xmlns="http://www.w3.org/1999/xhtml">Navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3434.1" xmlns="http://www.w3.org/1999/xhtml">http://localhost:5000/products/100</span></code><span class="koboSpan" id="kobo.3435.1" xmlns="http://www.w3.org/1999/xhtml">, and note the web service responds with the two products that have a minimum unit price of 100 but the response is slower than the AOT version.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3436.1" xmlns="http://www.w3.org/1999/xhtml">Close the web browser and shut down the web service.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.3437.1" xmlns="http://www.w3.org/1999/xhtml">Many .NET developers have</span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.3438.1" xmlns="http://www.w3.org/1999/xhtml"> been waiting for AOT compilation for a long time. </span><span class="koboSpan" id="kobo.3438.2" xmlns="http://www.w3.org/1999/xhtml">Microsoft is finally delivering on the promise, and it will expand to cover more project types over the next few major versions, so it’s a technology to keep an eye on.</span></p>
<h1 class="heading-1" id="_idParaDest-332"><span class="koboSpan" id="kobo.3439.1" xmlns="http://www.w3.org/1999/xhtml">Understanding identity services</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3440.1" xmlns="http://www.w3.org/1999/xhtml">Identity services are used to authenticate and authorize users. </span><span class="koboSpan" id="kobo.3440.2" xmlns="http://www.w3.org/1999/xhtml">It is important for these services to implement open standards so that you can integrate disparate systems. </span><span class="koboSpan" id="kobo.3440.3" xmlns="http://www.w3.org/1999/xhtml">Common standards include </span><strong class="keyWord"><span class="koboSpan" id="kobo.3441.1" xmlns="http://www.w3.org/1999/xhtml">OpenID Connect</span></strong><span class="koboSpan" id="kobo.3442.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.3443.1" xmlns="http://www.w3.org/1999/xhtml">OAuth 2.0</span></strong><span class="koboSpan" id="kobo.3444.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3445.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft has no plans to officially</span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.3446.1" xmlns="http://www.w3.org/1999/xhtml"> support third-party authentication servers </span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.3447.1" xmlns="http://www.w3.org/1999/xhtml">like </span><strong class="keyWord"><span class="koboSpan" id="kobo.3448.1" xmlns="http://www.w3.org/1999/xhtml">IdentityServer4</span></strong><span class="koboSpan" id="kobo.3449.1" xmlns="http://www.w3.org/1999/xhtml"> because “creating and sustaining an authentication server is a full-time endeavor, and Microsoft already has a team and a product in that area, Azure Active Directory, which allows 500,000 objects for free.”</span></p>
<h2 class="heading-2" id="_idParaDest-333"><span class="koboSpan" id="kobo.3450.1" xmlns="http://www.w3.org/1999/xhtml">JWT bearer authorization</span></h2>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.3451.1" xmlns="http://www.w3.org/1999/xhtml">JSON Web Token</span></strong><span class="koboSpan" id="kobo.3452.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.3453.1" xmlns="http://www.w3.org/1999/xhtml">JWT</span></strong><span class="koboSpan" id="kobo.3454.1" xmlns="http://www.w3.org/1999/xhtml">) is</span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.3455.1" xmlns="http://www.w3.org/1999/xhtml"> a standard that</span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.3456.1" xmlns="http://www.w3.org/1999/xhtml"> defines a compact and secure method to transmit information as a JSON object. </span><span class="koboSpan" id="kobo.3456.2" xmlns="http://www.w3.org/1999/xhtml">The JSON object is digitally </span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.3457.1" xmlns="http://www.w3.org/1999/xhtml">signed so it can be trusted. </span><span class="koboSpan" id="kobo.3457.2" xmlns="http://www.w3.org/1999/xhtml">The most common scenario for using JWT is authorization.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3458.1" xmlns="http://www.w3.org/1999/xhtml">A user logs in to a trusted party using credentials like a username and password or biometric scan or two-factor authentication, and the trusted party issues a JWT. </span><span class="koboSpan" id="kobo.3458.2" xmlns="http://www.w3.org/1999/xhtml">This is then sent with every request to the secure web service.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3459.1" xmlns="http://www.w3.org/1999/xhtml">In their compact form, JWTs consist of three parts separated by dots. </span><span class="koboSpan" id="kobo.3459.2" xmlns="http://www.w3.org/1999/xhtml">These parts are the </span><em class="italic"><span class="koboSpan" id="kobo.3460.1" xmlns="http://www.w3.org/1999/xhtml">header</span></em><span class="koboSpan" id="kobo.3461.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.3462.1" xmlns="http://www.w3.org/1999/xhtml">payload</span></em><span class="koboSpan" id="kobo.3463.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><em class="italic"><span class="koboSpan" id="kobo.3464.1" xmlns="http://www.w3.org/1999/xhtml">signature</span></em><span class="koboSpan" id="kobo.3465.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following format: </span><code class="inlineCode"><span class="koboSpan" id="kobo.3466.1" xmlns="http://www.w3.org/1999/xhtml">aaa.bbb.ccc</span></code><span class="koboSpan" id="kobo.3467.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.3467.2" xmlns="http://www.w3.org/1999/xhtml">The header and payload are Base64 </span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.3468.1" xmlns="http://www.w3.org/1999/xhtml">encoded.</span></p>
<h2 class="heading-2" id="_idParaDest-334"><span class="koboSpan" id="kobo.3469.1" xmlns="http://www.w3.org/1999/xhtml">Authenticating service clients using JWT bearer authentication</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3470.1" xmlns="http://www.w3.org/1999/xhtml">During local development, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3471.1" xmlns="http://www.w3.org/1999/xhtml">dotnet user-jwts</span></code><span class="koboSpan" id="kobo.3472.1" xmlns="http://www.w3.org/1999/xhtml"> command-line tool is used to create and manage local JWTs. </span><span class="koboSpan" id="kobo.3472.2" xmlns="http://www.w3.org/1999/xhtml">The values are</span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.3473.1" xmlns="http://www.w3.org/1999/xhtml"> stored in a JSON file in the local machine’s user profile folder.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3474.1" xmlns="http://www.w3.org/1999/xhtml">Let’s secure the web service using JWT bearer authentication and test it with a local token:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3475.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3476.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.3477.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a reference to the package for JWT bearer authentication, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3478.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.3479.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore.Authentication.JwtBearer"</span></span><span class="koboSpan" id="kobo.3480.1" xmlns="http://www.w3.org/1999/xhtml">
                  Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.3481.1" xmlns="http://www.w3.org/1999/xhtml">"8.0.0"</span></span><span class="koboSpan" id="kobo.3482.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3483.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3484.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.3485.1" xmlns="http://www.w3.org/1999/xhtml"> project to restore packages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3486.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3487.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3488.1" xmlns="http://www.w3.org/1999/xhtml">, after creating the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3489.1" xmlns="http://www.w3.org/1999/xhtml">builder</span></code><span class="koboSpan" id="kobo.3490.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to add authorization and authentication using JWT, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3491.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.3492.1" xmlns="http://www.w3.org/1999/xhtml"> builder = WebApplication.CreateBuilder(args);
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3493.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddAuthorization();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3494.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddAuthentication(defaultScheme: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3495.1" xmlns="http://www.w3.org/1999/xhtml">"Bearer"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3496.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3497.1" xmlns="http://www.w3.org/1999/xhtml">  .AddJwtBearer();</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3498.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3499.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3500.1" xmlns="http://www.w3.org/1999/xhtml">, after building the app, add a statement to use authorization, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3501.1" xmlns="http://www.w3.org/1999/xhtml">var</span></span><span class="koboSpan" id="kobo.3502.1" xmlns="http://www.w3.org/1999/xhtml"> app = builder.Build();
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3503.1" xmlns="http://www.w3.org/1999/xhtml">app.UseAuthorization();</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3504.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3505.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.3506.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for security claims, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3507.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.3508.1" xmlns="http://www.w3.org/1999/xhtml"> System.Security.Claims; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3509.1" xmlns="http://www.w3.org/1999/xhtml">// To use ClaimsPrincipal.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3510.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3511.1" xmlns="http://www.w3.org/1999/xhtml">WebApplication.Extensions.cs</span></code><span class="koboSpan" id="kobo.3512.1" xmlns="http://www.w3.org/1999/xhtml">, after mapping an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.3513.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.3514.1" xmlns="http://www.w3.org/1999/xhtml"> request for the root path to return a plain text </span><code class="inlineCode"><span class="koboSpan" id="kobo.3515.1" xmlns="http://www.w3.org/1999/xhtml">Hello World </span></code><span class="koboSpan" id="kobo.3516.1" xmlns="http://www.w3.org/1999/xhtml">response, add a statement to map an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.3517.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.3518.1" xmlns="http://www.w3.org/1999/xhtml"> request </span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.3519.1" xmlns="http://www.w3.org/1999/xhtml">for the secret path to return the authenticated user’s name if they are authorized, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3520.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3521.1" xmlns="http://www.w3.org/1999/xhtml">"/"</span></span><span class="koboSpan" id="kobo.3522.1" xmlns="http://www.w3.org/1999/xhtml">, () =&gt; </span><span class="hljs-string"><span class="koboSpan" id="kobo.3523.1" xmlns="http://www.w3.org/1999/xhtml">"Hello World!"</span></span><span class="koboSpan" id="kobo.3524.1" xmlns="http://www.w3.org/1999/xhtml">)
  .ExcludeFromDescription();
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3525.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGet(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3526.1" xmlns="http://www.w3.org/1999/xhtml">"/secret"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3527.1" xmlns="http://www.w3.org/1999/xhtml">, (ClaimsPrincipal user) =&gt; </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.3528.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3529.1" xmlns="http://www.w3.org/1999/xhtml">.Format(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3530.1" xmlns="http://www.w3.org/1999/xhtml">"Welcome, {0}. </span><span class="koboSpan" id="kobo.3530.2" xmlns="http://www.w3.org/1999/xhtml">The secret ingredient is love."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3531.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3532.1" xmlns="http://www.w3.org/1999/xhtml">    user.Identity?.Name ?? </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3533.1" xmlns="http://www.w3.org/1999/xhtml">"secure user"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3534.1" xmlns="http://www.w3.org/1999/xhtml">))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3535.1" xmlns="http://www.w3.org/1999/xhtml">  .RequireAuthorization();</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3536.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3537.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.3538.1" xmlns="http://www.w3.org/1999/xhtml"> project folder, at the command prompt or terminal, create a local JWT, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3539.1" xmlns="http://www.w3.org/1999/xhtml">dotnet user-jwts create
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3540.1" xmlns="http://www.w3.org/1999/xhtml">Note the automatically assigned </span><code class="inlineCode"><span class="koboSpan" id="kobo.3541.1" xmlns="http://www.w3.org/1999/xhtml">ID</span></code><span class="koboSpan" id="kobo.3542.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.3543.1" xmlns="http://www.w3.org/1999/xhtml">Name</span></code><span class="koboSpan" id="kobo.3544.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3545.1" xmlns="http://www.w3.org/1999/xhtml">Token</span></code><span class="koboSpan" id="kobo.3546.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3547.1" xmlns="http://www.w3.org/1999/xhtml">New JWT saved with ID 'd7e22000'.
</span><span class="koboSpan" id="kobo.3547.2" xmlns="http://www.w3.org/1999/xhtml">Name: markjprice
Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6Im1hcmtqcHJpY2UiLCJzdWIiOiJtYXJran...lci1qd3RzIn0.pGEbYKRjU98dEjxLSx7GAEm41LXMS0J80iIjuZbqrj4
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3548.1" xmlns="http://www.w3.org/1999/xhtml">At the command prompt or terminal, print all the information for the ID that was assigned, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3549.1" xmlns="http://www.w3.org/1999/xhtml">dotnet user-jwts print d7e22000 --show-all
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3550.1" xmlns="http://www.w3.org/1999/xhtml">Note the scheme is </span><code class="inlineCode"><span class="koboSpan" id="kobo.3551.1" xmlns="http://www.w3.org/1999/xhtml">Bearer</span></code><span class="koboSpan" id="kobo.3552.1" xmlns="http://www.w3.org/1999/xhtml"> so the token must be sent with every request, the audience(s) lists the authorized client domains and port numbers, the token expires after three months, the JSON objects represent the header and payload, and finally, there’s the compact token with its Base64-encoded three parts separated by </span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.3553.1" xmlns="http://www.w3.org/1999/xhtml">dots, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3554.1" xmlns="http://www.w3.org/1999/xhtml">Found JWT with ID 'd7e22000'.
</span><span class="koboSpan" id="kobo.3554.2" xmlns="http://www.w3.org/1999/xhtml">ID: d7e22000
Name: markjprice
Scheme: Bearer
Audience(s): http://localhost:30225, https://localhost:44344, http://localhost:5080, https://localhost:5081
Not Before: 2023-09-26T10:58:18.0000000+00:00
Expires On: 2023-12-26T10:58:18.0000000+00:00
Issued On: 2023-09-26T10:58:19.0000000+00:00
Scopes: none
Roles: [none]
Custom Claims: [none]
Token Header: {"alg":"HS256","typ":"JWT"}
Token Payload: {"unique_name":"markjprice","sub":"markjprice","jti":"d7e22000","aud":["http://localhost:30225","https://localhost:44344","http://localhost:5080","https://localhost:5081"],"nbf":1664189898,"exp":1672052298,"iat":1664189899,"iss":"dotnet-user-jwts"}
Compact Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6Im1hcmtqcHJpY2UiLCJzdWIiOiJtYXJranByaWNl...uZXQtdXNlci1qd3RzIn0.pGEbYKRjU98dEjxLSx7GAEm41LXMS0J80iIjuZbqrj4
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3555.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3556.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.3557.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.3558.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Development.json</span></code><span class="koboSpan" id="kobo.3559.1" xmlns="http://www.w3.org/1999/xhtml">, note the new section named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3560.1" xmlns="http://www.w3.org/1999/xhtml">Authentication</span></code><span class="koboSpan" id="kobo.3561.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3562.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3563.1" xmlns="http://www.w3.org/1999/xhtml">"Logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3564.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.3565.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3566.1" xmlns="http://www.w3.org/1999/xhtml">"LogLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3567.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.3568.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3569.1" xmlns="http://www.w3.org/1999/xhtml">"Default"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3570.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3571.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3572.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3573.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3574.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3575.1" xmlns="http://www.w3.org/1999/xhtml">"Warning"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3576.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3577.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore.HttpLogging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3578.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3579.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3580.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3581.1" xmlns="http://www.w3.org/1999/xhtml">},</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3582.1" xmlns="http://www.w3.org/1999/xhtml">"Authentication"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3583.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3584.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3585.1" xmlns="http://www.w3.org/1999/xhtml">"Schemes"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3586.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3587.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3588.1" xmlns="http://www.w3.org/1999/xhtml">"Bearer"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3589.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3590.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3591.1" xmlns="http://www.w3.org/1999/xhtml">"ValidAudiences"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3592.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3593.1" xmlns="http://www.w3.org/1999/xhtml">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3594.1" xmlns="http://www.w3.org/1999/xhtml">"http://localhost:30225"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3595.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3596.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:44344"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3597.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3598.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3599.1" xmlns="http://www.w3.org/1999/xhtml">http://localhost:5080"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3600.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5081"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3601.1" xmlns="http://www.w3.org/1999/xhtml">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3602.1" xmlns="http://www.w3.org/1999/xhtml">"ValidIssuer"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3603.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3604.1" xmlns="http://www.w3.org/1999/xhtml">"dotnet-user-jwts"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3605.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3606.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.3607.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3608.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3609.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3610.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.WebApi.Service</span></code><span class="koboSpan" id="kobo.3611.1" xmlns="http://www.w3.org/1999/xhtml"> project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3612.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.3613.1" xmlns="http://www.w3.org/1999/xhtml"> profile without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3614.1" xmlns="http://www.w3.org/1999/xhtml">In the browser, change the relative path to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3615.1" xmlns="http://www.w3.org/1999/xhtml">/secret</span></code><span class="koboSpan" id="kobo.3616.1" xmlns="http://www.w3.org/1999/xhtml"> and note the response is rejected with</span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.3617.1" xmlns="http://www.w3.org/1999/xhtml"> a 401 status code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3618.1" xmlns="http://www.w3.org/1999/xhtml">Start Visual Studio Code and open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3619.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.3620.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3621.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3622.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.3623.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3624.1" xmlns="http://www.w3.org/1999/xhtml">webapi-secure-request.http</span></code><span class="koboSpan" id="kobo.3625.1" xmlns="http://www.w3.org/1999/xhtml"> and modify its contents to contain a request to get the secret ingredient, as shown in the following code (but use your </span><code class="inlineCode"><span class="koboSpan" id="kobo.3626.1" xmlns="http://www.w3.org/1999/xhtml">Bearer</span></code><span class="koboSpan" id="kobo.3627.1" xmlns="http://www.w3.org/1999/xhtml"> token, of course):
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3628.1" xmlns="http://www.w3.org/1999/xhtml">### Get the secret ingredient.
</span><span class="koboSpan" id="kobo.3628.2" xmlns="http://www.w3.org/1999/xhtml">GET https://localhost:5081/secret/
</span><span class="hljs-attribute"><span class="koboSpan" id="kobo.3629.1" xmlns="http://www.w3.org/1999/xhtml">Authorization</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3630.1" xmlns="http://www.w3.org/1999/xhtml">: </span></span><span class="koboSpan" id="kobo.3631.1" xmlns="http://www.w3.org/1999/xhtml">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6Im1hcmtqcHJpY2UiLCJzdWIiOiJtYXJranByaWNl...uZXQtdXNlci1qd3RzIn0.pGEbYKRjU98dEjxLSx7GAEm41LXMS0J80iIjuZbqrj4
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3632.1" xmlns="http://www.w3.org/1999/xhtml">Click </span><strong class="screenText"><span class="koboSpan" id="kobo.3633.1" xmlns="http://www.w3.org/1999/xhtml">Send Request</span></strong><span class="koboSpan" id="kobo.3634.1" xmlns="http://www.w3.org/1999/xhtml">, and note the response, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3635.1" xmlns="http://www.w3.org/1999/xhtml">Welcome, secure user. </span><span class="koboSpan" id="kobo.3635.2" xmlns="http://www.w3.org/1999/xhtml">The secret ingredient is love.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3636.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web service.</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-335"><span class="koboSpan" id="kobo.3637.1" xmlns="http://www.w3.org/1999/xhtml">Practicing and exploring</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3638.1" xmlns="http://www.w3.org/1999/xhtml">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring this chapter’s topics with deeper research.</span></p>
<h2 class="heading-2" id="_idParaDest-336"><span class="koboSpan" id="kobo.3639.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 8.1 – Test your knowledge</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3640.1" xmlns="http://www.w3.org/1999/xhtml">Answer the following questions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3641.1" xmlns="http://www.w3.org/1999/xhtml">List six method names that can be specified in an HTTP request.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3642.1" xmlns="http://www.w3.org/1999/xhtml">List six status codes and their descriptions that can be returned in an HTTP response.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3643.1" xmlns="http://www.w3.org/1999/xhtml">How is the ASP.NET Core Minimal APIs service technology different from the ASP.NET Core Web APIs service technology?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3644.1" xmlns="http://www.w3.org/1999/xhtml">With the ASP.NET Core Minimal APIs service technology, how do you map an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.3645.1" xmlns="http://www.w3.org/1999/xhtml">PUT</span></code><span class="koboSpan" id="kobo.3646.1" xmlns="http://www.w3.org/1999/xhtml"> request to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3647.1" xmlns="http://www.w3.org/1999/xhtml">api/customers</span></code><span class="koboSpan" id="kobo.3648.1" xmlns="http://www.w3.org/1999/xhtml"> to a lambda statement block?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3649.1" xmlns="http://www.w3.org/1999/xhtml">With the ASP.NET Core Minimal APIs service technology, how do you map a method or lambda parameter to a value in a route, query string, or the body of the request?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3650.1" xmlns="http://www.w3.org/1999/xhtml">Does enabling CORS increase security for a web service?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3651.1" xmlns="http://www.w3.org/1999/xhtml">You have added statements to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3652.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3653.1" xmlns="http://www.w3.org/1999/xhtml"> to enable HTTP logging but HTTP requests and responses are not being logged. </span><span class="koboSpan" id="kobo.3653.2" xmlns="http://www.w3.org/1999/xhtml">What is the most likely reason and how can you fix it?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3654.1" xmlns="http://www.w3.org/1999/xhtml">How do you limit the rate of requests for a specific client using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3655.1" xmlns="http://www.w3.org/1999/xhtml">AspNetCoreRateLimit</span></code><span class="koboSpan" id="kobo.3656.1" xmlns="http://www.w3.org/1999/xhtml"> package?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3657.1" xmlns="http://www.w3.org/1999/xhtml">How do you limit the rate of requests for a specific endpoint using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3658.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.AspNetCore.RateLimiting</span></code><span class="koboSpan" id="kobo.3659.1" xmlns="http://www.w3.org/1999/xhtml"> package?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3660.1" xmlns="http://www.w3.org/1999/xhtml">What does JWT mean?</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-337"><span class="koboSpan" id="kobo.3661.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 8.2 – Review Microsoft HTTP API design policy</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3662.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft has internal HTTP/REST API design guidelines. </span><span class="koboSpan" id="kobo.3662.2" xmlns="http://www.w3.org/1999/xhtml">Microsoft teams reference this document when designing their HTTP APIs. </span><span class="koboSpan" id="kobo.3662.3" xmlns="http://www.w3.org/1999/xhtml">They are a great starting point for your own standards for HTTP APIs. </span><span class="koboSpan" id="kobo.3662.4" xmlns="http://www.w3.org/1999/xhtml">You can review them at the following link:</span></p>
<p class="normal"><a href="https://github.com/microsoft/api-guidelines"><span class="url"><span class="koboSpan" id="kobo.3663.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/microsoft/api-guidelines</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.3664.1" xmlns="http://www.w3.org/1999/xhtml">The guidelines have a section specific to CORS and you can review them at the following link:</span></p>
<p class="normal"><a href="https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#8-cors"><span class="url"><span class="koboSpan" id="kobo.3665.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#8-cors</span></span></a></p>
<h2 class="heading-2" id="_idParaDest-338"><span class="koboSpan" id="kobo.3666.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 8.3 – Explore topics</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3667.1" xmlns="http://www.w3.org/1999/xhtml">Use the links on the following page to learn more details about the topics covered in this chapter:</span></p>
<p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-8---building-and-securing-web-services-using-minimal-apis"><span class="url"><span class="koboSpan" id="kobo.3668.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-8---building-and-securing-web-services-using-minimal-apis</span></span></a></p>
<h2 class="heading-2" id="_idParaDest-339"><span class="koboSpan" id="kobo.3669.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 8.4 – Exposing data via the web using OData services</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3670.1" xmlns="http://www.w3.org/1999/xhtml">Learn how to quickly implement a Web API service that can wrap an EF Core entity model using OData in this online-only chapter:</span></p>
<p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/ch08-odata.md"><span class="url"><span class="koboSpan" id="kobo.3671.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/ch08-odata.md</span></span></a></p>
<h2 class="heading-2" id="_idParaDest-340"><span class="koboSpan" id="kobo.3672.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 8.5 – Auth0 project templates</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3673.1" xmlns="http://www.w3.org/1999/xhtml">If you need to implement Auth0 for authentication and authorization, then you can use project templates to scaffold your code. </span><span class="koboSpan" id="kobo.3673.2" xmlns="http://www.w3.org/1999/xhtml">An article describing these project templates and how to use them is found at the following link:</span></p>
<p class="normal"><a href="https://auth0.com/blog/introducing-auth0-templates-for-dotnet/"><span class="url"><span class="koboSpan" id="kobo.3674.1" xmlns="http://www.w3.org/1999/xhtml">https://auth0.com/blog/introducing-auth0-templates-for-dotnet/</span></span></a></p>
<h1 class="heading-1" id="_idParaDest-341"><span class="koboSpan" id="kobo.3675.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3676.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, you learned how to: </span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3677.1" xmlns="http://www.w3.org/1999/xhtml">Build a web service that implements the REST architectural style using minimal APIs.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3678.1" xmlns="http://www.w3.org/1999/xhtml">Relax the same-origin security policy for specified domains and ports using CORS.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3679.1" xmlns="http://www.w3.org/1999/xhtml">Implement two different rate-limiting packages to prevent denial of service attacks.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3680.1" xmlns="http://www.w3.org/1999/xhtml">Secure services using JWT bearer authorization.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.3681.1" xmlns="http://www.w3.org/1999/xhtml">In the next chapter, you will learn how to build reliable and scalable services by adding features like caching, queues, and automatic handling of transient faults using libraries like Polly.</span></p>
</div>
</body>
</html>
