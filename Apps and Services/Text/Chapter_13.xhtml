<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>Chapter_13</title>
<link href="../Styles/syntax-highlighting.css" rel="stylesheet" type="text/css"/>
<link href="../Styles/epub.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body id="Chapter_13" lang="en-US" xml:lang="en-US">
<div class="Basic-Text-Frame" id="_idContainer439">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">13</span></h1>
<h1 class="chapterTitle" id="_idParaDest-474"><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Building Efficient Microservices Using gRPC</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, you will be introduced to gRPC, which enables a developer to build services that can communicate highly efficiently across most platforms.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">However, web browsers do not have full support for programmatic access to all features of HTTP/2, which is required by gRPC. </span><span class="koboSpan" id="kobo.4.2" xmlns="http://www.w3.org/1999/xhtml">This makes gRPC most useful for implementing intermediate tier-to-tier services and microservices because they must perform a lot of communication between multiple microservices to achieve a complete task. </span><span class="koboSpan" id="kobo.4.3" xmlns="http://www.w3.org/1999/xhtml">Improving the efficiency of that communication is vital to the success of the scalability and performance of microservices. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">A modular monolithic, two-tier, client-to-service style service is inherently more efficient because the communication between modules is in-process and there is only one layer of network communication between the whole service and the clients.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">Microservice architecture has more tiers, and therefore more layers of network communication between the many microservices. </span><span class="koboSpan" id="kobo.6.2" xmlns="http://www.w3.org/1999/xhtml">It becomes more important to have highly efficient communication between those layers, and gRPC is designed to be ultra-efficient for network communication, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.1</span></em><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.1: Comparing a two-tier modular monolithic service with multi-tier microservices</span></p>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">: It has been fashionable in the past decade or so to assume that microservices are best for all scenarios, and so for a new system to immediately be implemented using cool microservices rather than as a traditional monolith. </span><span class="koboSpan" id="kobo.12.2" xmlns="http://www.w3.org/1999/xhtml">More recently, there has been a pushback against this assumption. </span><span class="koboSpan" id="kobo.12.3" xmlns="http://www.w3.org/1999/xhtml">The industry seems to be settling on the recommendation to start by implementing a system as a modular monolith. </span><span class="koboSpan" id="kobo.12.4" xmlns="http://www.w3.org/1999/xhtml">Only later, if necessary, should you break the modules apart into actual microservices. </span><span class="koboSpan" id="kobo.12.5" xmlns="http://www.w3.org/1999/xhtml">As well as being inherently slower due to the extra network communication between microservices, you also need to consider whether the extra coordination and complexity of deployments and orchestration of microservices is worth it.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">This chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Understanding gRPC</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">Building a gRPC service and client</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">Implementing gRPC for an EF Core model</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">Taking gRPC further</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">Handling dates, times, and decimal numbers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">Implementing interceptors and handling faults</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">Implementing gRPC JSON transcoding</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-475"><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">Understanding gRPC</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">gRPC is a modern, open-source, high-performance </span><strong class="keyWord"><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">Remote Procedure Call</span></strong><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">RPC</span></strong><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">) framework that can run in any </span><a id="_idIndexMarker1404"/><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">environment. </span><span class="koboSpan" id="kobo.27.2" xmlns="http://www.w3.org/1999/xhtml">An </span><a id="_idIndexMarker1405"/><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">RPC is when one computer calls a procedure in another process or on another computer over a network as if it were calling a local procedure. </span><span class="koboSpan" id="kobo.28.2" xmlns="http://www.w3.org/1999/xhtml">It is an example of a client-server architecture.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">You can learn more about RPCs at the following link: </span><a href="https://en.wikipedia.org/wiki/Remote_procedure_call"><span class="url"><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">https://en.wikipedia.org/wiki/Remote_procedure_call</span></span></a><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-476"><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">How gRPC works</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">A gRPC service developer defines a service interface for the methods that can be called remotely, including defining the</span><a id="_idIndexMarker1406"/><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml"> method parameters and return types. </span><span class="koboSpan" id="kobo.34.2" xmlns="http://www.w3.org/1999/xhtml">The service implements this interface and runs a gRPC server to handle client calls.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">On the client, a strongly typed gRPC client provides the same methods as on the server.</span></p>
<h2 class="heading-2" id="_idParaDest-477"><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">Defining gRPC contracts with .proto files</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">gRPC uses contract-first API development that supports language-agnostic implementations. </span><span class="koboSpan" id="kobo.37.2" xmlns="http://www.w3.org/1999/xhtml">A </span><strong class="keyWord"><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">contract</span></strong><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml"> in this case is </span><a id="_idIndexMarker1407"/><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">an agreement that a service will expose a defined list of methods with specified parameters and return types</span><a id="_idIndexMarker1408"/><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml"> that implement a prescribed behavior. </span><span class="koboSpan" id="kobo.41.2" xmlns="http://www.w3.org/1999/xhtml">A client that wishes to call the service can be certain that the service will continue to conform to the contract over time. </span><span class="koboSpan" id="kobo.41.3" xmlns="http://www.w3.org/1999/xhtml">For example, although new methods might be added, existing ones will never change or be removed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">You write the contracts using </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml"> files that have their own language syntax and then use tools to convert them into various languages like C#. </span><span class="koboSpan" id="kobo.44.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml"> files are used by both the server and client to exchange messages in the correct format.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">Here’s an example </span><code class="inlineCode"><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml"> file using </span><code class="inlineCode"><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">proto3</span></code><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml"> syntax to define a message request that uses a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">enum</span></code><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">// Setting the syntax must be first non-comment line.</span></span><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">
syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">"proto3"</span></span><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">// proto2 is the default.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">/* When this .proto file is used in a .NET project, it will use the</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">   following C# namespace for the auto-generated code files. </span><span class="koboSpan" id="kobo.60.2" xmlns="http://www.w3.org/1999/xhtml">*/</span></span><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">
option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Service"</span></span><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">enum</span></span><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml"> SearchType {
  SEARCHTYPE_UNSPECIFIED = </span><span class="hljs-number"><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">;
  SEARCHTYPE_STARTSWITH = </span><span class="hljs-number"><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">;
  SEARCHTYPE_CONTAINS = </span><span class="hljs-number"><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">;
  SEARCHTYPE_ENDSWITH = </span><span class="hljs-number"><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message SearchRequest {
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml"> query = </span><span class="hljs-number"><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">// Fields must have order numbers.</span></span><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">
  SearchType search_type = </span><span class="hljs-number"><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 page = </span><span class="hljs-number"><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 page_size = </span><span class="hljs-number"><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">4</span></span><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message SearchResponse {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">/* Message types can be nested and/or repeated to create the </span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">     equivalent of collections or arrays. </span><span class="koboSpan" id="kobo.87.2" xmlns="http://www.w3.org/1999/xhtml">*/</span></span><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">
  repeated SearchResult results = </span><span class="hljs-number"><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message SearchResult {
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml"> url = </span><span class="hljs-number"><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml"> title = </span><span class="hljs-number"><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">;
  repeated </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml"> authors = </span><span class="hljs-number"><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">;
}
service Searcher {
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">PerformSearch</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">SearchRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">SearchResponse</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span></code></pre>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">: The Protobuf style</span><a id="_idIndexMarker1409"/><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml"> guide recommends using </span><a id="_idIndexMarker1410"/><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">all lowercase with underscores for field names, all uppercase with underscores for </span><code class="inlineCode"><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">enum</span></code><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml"> values, and so on. </span><span class="koboSpan" id="kobo.118.2" xmlns="http://www.w3.org/1999/xhtml">The C# tooling will automatically convert to .NET styles in the auto-generated types it creates for you. </span><span class="koboSpan" id="kobo.118.3" xmlns="http://www.w3.org/1999/xhtml">You can read more recommendations at the following link: </span><a href="https://protobuf.dev/programming-guides/style/"><span class="url"><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">https://protobuf.dev/programming-guides/style/</span></span></a><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml">Fields must be given a unique number between 1 and 536,870,911. </span><span class="koboSpan" id="kobo.121.2" xmlns="http://www.w3.org/1999/xhtml">You cannot use the range 19,000 to 19,999 because</span><a id="_idIndexMarker1411"/><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml"> they are reserved for the Protocol Buffers implementation. </span><span class="koboSpan" id="kobo.122.2" xmlns="http://www.w3.org/1999/xhtml">These </span><a id="_idIndexMarker1412"/><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">numbers are used instead of the field name during serialization to save space in the binary format.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">: Field numbers cannot be changed once you start using a message because they are tightly bound to the very efficient wire format used by gRPC. </span><span class="koboSpan" id="kobo.125.2" xmlns="http://www.w3.org/1999/xhtml">Changing a field number is the equivalent of deleting and creating a new field. </span><span class="koboSpan" id="kobo.125.3" xmlns="http://www.w3.org/1999/xhtml">You should also never reuse a field number. </span><span class="koboSpan" id="kobo.125.4" xmlns="http://www.w3.org/1999/xhtml">You can read about the consequences of misusing field numbers at the following link: </span><a href="https://protobuf.dev/programming-guides/proto3/#consequences"><span class="url"><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">https://protobuf.dev/programming-guides/proto3/#consequences</span></span></a><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">Field data types cannot be null, so all number types default to zero (</span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">0</span></code><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.130.2" xmlns="http://www.w3.org/1999/xhtml">Number and other field data types are shown in </span><em class="italic"><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">Table 13.1</span></em><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">:</span></p>
<table class="table-container" id="table001-9">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">Type</span></strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">string</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">Text values. </span><span class="koboSpan" id="kobo.136.2" xmlns="http://www.w3.org/1999/xhtml">Defaults to an empty string.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">bool</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">Boolean values. </span><span class="koboSpan" id="kobo.138.2" xmlns="http://www.w3.org/1999/xhtml">Defaults to </span><code class="inlineCode"><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">int32</span></code><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">int64</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml">Variable length encoded 32- and 64-bit integer values. </span><span class="koboSpan" id="kobo.144.2" xmlns="http://www.w3.org/1999/xhtml">Although they can be used for negative values, it is more efficient to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">sint32</span></code><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">sint64</span></code><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.148.2" xmlns="http://www.w3.org/1999/xhtml">The C# equivalents to </span><code class="inlineCode"><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">long</span></code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">sint32</span></code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">sint64</span></code><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">uint32</span></code><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">uint64</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">Variable length encoded 32- and 64-bit signed and unsigned integer values. </span><span class="koboSpan" id="kobo.160.2" xmlns="http://www.w3.org/1999/xhtml">The C# equivalent to </span><code class="inlineCode"><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">long</span></code><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">uint</span></code><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">ulong</span></code><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml">fixed32</span></code><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">fixed64</span></code><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">sfixed32</span></code><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">sfixed64</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">Always four bytes for 32, or eight bytes for 64. </span><span class="koboSpan" id="kobo.176.2" xmlns="http://www.w3.org/1999/xhtml">The C# equivalent to </span><code class="inlineCode"><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">uint</span></code><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">ulong</span></code><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">long</span></code><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">double</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">Floating point real numbers.</span></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">bytes</span></code></p>
</td>
<td class="table-cell">
<p class="normal"><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">Maximum 2</span><sup class="superscript"><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">32</span></sup><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml"> bytes (4,294,967,296). </span><span class="koboSpan" id="kobo.192.2" xmlns="http://www.w3.org/1999/xhtml">Use </span><code class="inlineCode"><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">ByteString.CopyFrom(byte[] data)</span></code><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml"> to create a new instance. </span><span class="koboSpan" id="kobo.194.2" xmlns="http://www.w3.org/1999/xhtml">Use </span><code class="inlineCode"><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">ToByteArray()</span></code><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml"> to get the byte array. </span><span class="koboSpan" id="kobo.196.2" xmlns="http://www.w3.org/1999/xhtml">Defaults to an empty </span><code class="inlineCode"><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">ByteString</span></code><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml"> value.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref"><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">Table 13.1: Number and other field data types in Protobuf</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">: The official guide is found at the following link: </span><a href="https://protobuf.dev/programming-guides/proto3/"><span class="url"><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">https://protobuf.dev/programming-guides/proto3/</span></span></a><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-478"><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml">gRPC benefits</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">gRPC minimizes network usage by using </span><strong class="keyWord"><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">Protobuf</span></strong><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml"> binary serialization that is not human-readable, unlike JSON or XML used by</span><a id="_idIndexMarker1413"/><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml"> web services.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">gRPC requires HTTP/2, which provides significant performance benefits over earlier versions, like binary framing and compression, and multiplexing of HTTP/2 calls over a single connection.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">Binary framing means how the HTTP messages are transferred between the client and server. </span><span class="koboSpan" id="kobo.210.2" xmlns="http://www.w3.org/1999/xhtml">HTTP/1.x uses newline delimited plaintext. </span><span class="koboSpan" id="kobo.210.3" xmlns="http://www.w3.org/1999/xhtml">HTTP/2 splits communication into smaller messages (frames) that are encoded in binary format. </span><span class="koboSpan" id="kobo.210.4" xmlns="http://www.w3.org/1999/xhtml">Multiplexing means combining multiple messages from different sources into a single message to more efficiently use a shared resource like a network transport.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">: If you are interested in more details about HTTP/2 and how it makes gRPC more efficient, you can read about it at the following link: </span><a href="https://grpc.io/blog/grpc-on-http2/"><span class="url"><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">https://grpc.io/blog/grpc-on-http2/</span></span></a><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-479"><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">gRPC limitations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">The main limitation of gRPC is that it cannot be used in web browsers because no browser provides the level of control required to support a gRPC client. </span><span class="koboSpan" id="kobo.216.2" xmlns="http://www.w3.org/1999/xhtml">For example, browsers do not allow a caller</span><a id="_idIndexMarker1414"/><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml"> to require that HTTP/2 be used.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml">Another limitation for developers is that due to the binary format of the messages, it is harder to diagnose and monitor issues. </span><span class="koboSpan" id="kobo.218.2" xmlns="http://www.w3.org/1999/xhtml">Many tools do not understand the format and cannot show messages in a human-readable format.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">There is an initiative called </span><strong class="keyWord"><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">gRPC-Web</span></strong><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml"> that </span><a id="_idIndexMarker1415"/><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">adds an extra proxy layer, and the proxy forwards requests to the gRPC server. </span><span class="koboSpan" id="kobo.222.2" xmlns="http://www.w3.org/1999/xhtml">However, it only supports a subset of gRPC due to the listed limitations.</span></p>
<h2 class="heading-2" id="_idParaDest-480"><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">Types of gRPC methods</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">gRPC has four types of method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">The first method is the most common:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">Unary</span></strong><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml"> methods have structured request and response messages. </span><span class="koboSpan" id="kobo.227.2" xmlns="http://www.w3.org/1999/xhtml">A unary method completes </span><a id="_idIndexMarker1416"/><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">when the response message is returned. </span><span class="koboSpan" id="kobo.228.2" xmlns="http://www.w3.org/1999/xhtml">Unary methods should be chosen in all scenarios that do not require a stream.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">Streaming methods are used when a large amount of data must be exchanged, and they do so</span><a id="_idIndexMarker1417"/><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml"> by using a stream of bytes. </span><span class="koboSpan" id="kobo.230.2" xmlns="http://www.w3.org/1999/xhtml">They have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">stream</span></code><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml"> keyword prefix for either an input parameter, an output parameter, or both.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">The three streaming methods are as follows:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">Server streaming</span></strong><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml"> methods receive a request message from the client and return a stream. </span><span class="koboSpan" id="kobo.235.2" xmlns="http://www.w3.org/1999/xhtml">Multiple messages can be returned over the stream. </span><span class="koboSpan" id="kobo.235.3" xmlns="http://www.w3.org/1999/xhtml">A server </span><a id="_idIndexMarker1418"/><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">streaming call ends when the server side method returns, but the server side method could run until it receives a cancellation token from the client. </span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">Client streaming</span></strong><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml"> methods only receive a stream from the client without any message. </span><span class="koboSpan" id="kobo.238.2" xmlns="http://www.w3.org/1999/xhtml">The</span><a id="_idIndexMarker1419"/><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml"> server side method processes the stream until it is ready to return a response message. </span><span class="koboSpan" id="kobo.239.2" xmlns="http://www.w3.org/1999/xhtml">Once the server side method returns its message, the client streaming call is done.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">Bi-directional streaming</span></strong><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml"> methods only receive a stream from the client without any</span><a id="_idIndexMarker1420"/><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml"> message and only return data via a second stream. </span><span class="koboSpan" id="kobo.242.2" xmlns="http://www.w3.org/1999/xhtml">The call is done when the server side method returns. </span><span class="koboSpan" id="kobo.242.3" xmlns="http://www.w3.org/1999/xhtml">Once a bi-directional streaming method is called, the client and service can send messages to each other at any time.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">In this book, we will only look at the details of unary methods. </span><span class="koboSpan" id="kobo.243.2" xmlns="http://www.w3.org/1999/xhtml">If you would like the next edition to cover streaming methods, please let me know.</span></p>
<h2 class="heading-2" id="_idParaDest-481"><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft’s gRPC packages</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft has invested in building a set of packages for .NET to work with gRPC and, since May 2021, it is Microsoft’s </span><a id="_idIndexMarker1421"/><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">recommended implementation of gRPC for .NET.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft’s gRPC for .NET includes:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.AspNetCore</span></code><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml"> for hosting a gRPC service in ASP.NET Core.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Net.Client</span></code><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml"> for adding gRPC client support to any .NET project by building on </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">HttpClient</span></code><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Net.ClientFactory</span></code><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml"> for adding gRPC client support to any .NET code base by building on </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">HttpClientFactory</span></code><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">You can learn more </span><a id="_idIndexMarker1422"/><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">at the following link: </span><a href="https://github.com/grpc/grpc-dotnet"><span class="url"><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/grpc/grpc-dotnet</span></span></a><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-482"><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">Building a gRPC service and client</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see an example service</span><a id="_idIndexMarker1423"/><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml"> and client for sending and receiving simple messages.</span></p>
<h2 class="heading-2" id="_idParaDest-483"><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">Building a Hello World gRPC service</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">We will start by building the gRPC service </span><a id="_idIndexMarker1424"/><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">using one of the project templates provided as standard:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">Use your preferred code editor to create a new project, as defined in the following list:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">Project template: </span><strong class="screenText"><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core gRPC Service </span></strong><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">/ </span><code class="inlineCode"><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">grpc</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">Solution file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">Chapter13</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">Project file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">Enable Docker</span></strong><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">Do not use top-level statements</span></strong><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">Enable native AOT publish</span></strong><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">: Selected.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">: Make sure to select </span><strong class="screenText"><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">Enable native AOT publish</span></strong><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.286.2" xmlns="http://www.w3.org/1999/xhtml">With .NET 8 and later, gRPC projects can be </span><strong class="keyWord"><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">ahead-of-time</span></strong><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">AOT</span></strong><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">) compiled for native platforms. </span><span class="koboSpan" id="kobo.290.2" xmlns="http://www.w3.org/1999/xhtml">This gives improved performance and a reduced start time, which is important for microservices that are frequently redeployed and spun up and down during scaling.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">greet.proto</span></code><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">, note that it defines a service named </span><code class="inlineCode"><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">Greeter</span></code><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml"> with a method named </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">SayHello</span></code><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml"> that exchanges messages named </span><code class="inlineCode"><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">HelloRequest</span></code><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">HelloReply</span></code><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">"proto3"</span></span><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">;
option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Service"</span></span><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">;
package greet;
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">// The greeting service definition.</span></span><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">
service Greeter {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">// Sends a greeting</span></span>
<span class="hljs-function"><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">SayHello</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">HelloRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">HelloReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">// The request message containing the user's name.</span></span><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">
message HelloRequest {
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml"> name = </span><span class="hljs-number"><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml">// The response message containing the greetings.</span></span><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">
message HelloReply {
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml"> message = </span><span class="hljs-number"><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">For working with </span><code class="inlineCode"><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml"> files in Visual Studio Code, you can install the extension </span><strong class="screenText"><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">vscode-proto3</span></strong><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml"> (</span><code class="inlineCode"><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml">zxh404.vscode-proto3</span></code><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.340.2" xmlns="http://www.w3.org/1999/xhtml">For Rider, you can install the Protocol Buffers plugin from JetBrains, as shown at the following link: </span><a href="https://plugins.jetbrains.com/plugin/14004-protocol-buffers"><span class="url"><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml">https://plugins.jetbrains.com/plugin/14004-protocol-buffers</span></span></a><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service.csproj</span></code><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">, note that this project has native AOT publish enabled, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml"> file is</span><a id="_idIndexMarker1425"/><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml"> registered for use on the server side, and the package reference for implementing a gRPC service hosted in ASP.NET Core, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Project Sdk=</span><span class="hljs-string"><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.NET.Sdk.Web"</span></span><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;InvariantGlobalization&gt;</span><span class="hljs-literal"><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/InvariantGlobalization&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;PublishAot&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/PublishAot&gt;</span></strong></span><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\greet.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;PackageReference Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">"Grpc.AspNetCore"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml">"2.59.0"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml">
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml">For JetBrains Rider, manually add </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PublishAot&gt;true&lt;/PublishAot&gt;</span></code><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml"> if it is missing.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">Set invariant globalization to </span><code class="inlineCode"><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">false</span></code><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">&lt;InvariantGlobalization&gt;</span><span class="hljs-literal"><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/InvariantGlobalization&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">GreeterService.cs</span></code><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">, note that it inherits from a class named </span><code class="inlineCode"><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">GreeterBase</span></code><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml"> and it asynchronously implements the </span><code class="inlineCode"><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml">Greeter</span></code><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml"> service contract by</span><a id="_idIndexMarker1426"/><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml"> having a </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml">SayHello</span></code><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml"> method that accepts a </span><code class="inlineCode"><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml">HelloRequest</span></code><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml"> input parameter and returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">HelloReply</span></code><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml"> Grpc.Core;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.Grpc.Service
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service.Services</span></span><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">GreeterService</span></span><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">Greeter.GreeterBase</span></span><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger&lt;GreeterService&gt; _logger;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">GreeterService</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;GreeterService&gt; logger</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">
    {
      _logger = logger;
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">override</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;HelloReply&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">SayHello</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml">      HelloRequest request, ServerCallContext context</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">
    {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml"> Task.FromResult(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml"> HelloReply
      {
        Message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">"Hello "</span></span><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml"> + request.Name
      });
    }
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, in </span><strong class="screenText"><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">Solution Explorer</span></strong><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml">Show All Files</span></strong><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.437.2" xmlns="http://www.w3.org/1999/xhtml">If you are using JetBrains Rider, then hover over the </span><strong class="screenText"><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">Solution</span></strong><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml"> pane and click the eyeball icon.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml">obj\Debug\net8.0\Protos</span></code><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml"> folder, note the two class files named </span><code class="inlineCode"><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml">Greet.cs</span></code><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">GreetGrpc.cs</span></code><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml"> that are </span><a id="_idIndexMarker1427"/><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml">automatically generated from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">greet.proto</span></code><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml"> file, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.2</span></em><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.2: The autogenerated class files from a .proto file for a gRPC service</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">GreetGrpc.cs</span></code><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">, note the </span><code class="inlineCode"><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml">Greeter.GreeterBase</span></code><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml"> class that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">GreeterService</span></code><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml"> class inherited from. </span><span class="koboSpan" id="kobo.460.2" xmlns="http://www.w3.org/1999/xhtml">You do not need to understand how this base class is implemented, but you should know it is what handles all the details of gRPC’s efficient communication.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, in </span><strong class="screenText"><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">Solution Explorer</span></strong><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">, expand </span><strong class="screenText"><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml">Dependencies</span></strong><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">, expand </span><strong class="screenText"><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">Packages</span></strong><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">, expand </span><strong class="screenText"><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.AspNetCore</span></strong><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">, and note that it has dependencies on Google’s </span><strong class="screenText"><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml">Google.Protobuf</span></strong><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml"> package, and Microsoft’s </span><strong class="screenText"><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.AspNetCore.Server.ClientFactory</span></strong><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Tools</span></strong><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml"> packages, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.3</span></em><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.3: The Grpc.AspNetCore package references the Grpc.Tools and Google.Protobuf packages</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Tools</span></code><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml"> package</span><a id="_idIndexMarker1428"/><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml"> generates the C# class files from the registered </span><code class="inlineCode"><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml"> files, and those class files use types defined in Google’s package to implement the serialization to the Protobuf serialization format. </span><span class="koboSpan" id="kobo.485.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.AspNetCore.Server.ClientFactory</span></code><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml"> package includes both server side and client-side support for gRPC in a .NET project.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml">, in the section that configures services, note the call to add gRPC to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml"> collection, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddGrpc();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml">, in the section for configuring the HTTP pipeline, note the call to map the </span><code class="inlineCode"><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">Greeter</span></code><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml"> service, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGrpcService&lt;GreeterService&gt;();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></code><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml"> folder, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">launchSettings.json</span></code><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml"> and modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">applicationUrl</span></code><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml"> setting to use port </span><code class="inlineCode"><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml">5131</span></code><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml"> and port </span><code class="inlineCode"><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">5132</span></code><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">http</span></code><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in</span><a id="_idIndexMarker1429"/><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml"> the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">"$schema"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">"http://json.schemastore.org/launchsettings.json"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">"profiles"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">"http"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">"commandName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">"Project"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml">"dotnetRunMessages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">"launchBrowser"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml">applicationUrl"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">"http://localhost:5132"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml">"environmentVariables"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml">"ASPNETCORE_ENVIRONMENT"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">"Development"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml">"https"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">"commandName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml">"Project"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">"dotnetRunMessages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">"launchBrowser"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">false</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">"applicationUrl"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5131;http://localhost:5132"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">"environmentVariables"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml">"ASPNETCORE_ENVIRONMENT"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml">Development"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-484"><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">Project file item configuration</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">Before we continue, let’s quickly</span><a id="_idIndexMarker1430"/><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml"> review common project file item configuration syntax.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml">Item configuration generated by Visual Studio 2022 commonly uses attributes for the item properties, as shown in the following markup:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\greet.proto"</span></span><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml">"Client"</span></span><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">Properties not explicitly set will have their default values.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml">Item configuration generated by other tools like JetBrains Rider commonly uses child elements for the item properties, as shown in the following markup:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">&lt;Protobuf&gt;
  &lt;Include&gt;Protos\greet.proto&lt;/Include&gt;
  &lt;GrpcServices&gt;Client&lt;/&gt;
  &lt;Access&gt;Public&lt;/Access&gt;
  &lt;ProtoCompile&gt;True&lt;/ProtoCompile&gt;
  &lt;CompileOutputs&gt;True&lt;/CompileOutputs&gt;
  &lt;OutputDir&gt;obj\Debug\net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">\&lt;/OutputDir&gt;
  &lt;Generator&gt;MSBuild:Compile&lt;/Generator&gt;
&lt;Protobuf&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml">They both usually </span><a id="_idIndexMarker1431"/><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">achieve the same ends. </span><span class="koboSpan" id="kobo.600.2" xmlns="http://www.w3.org/1999/xhtml">The first is more concise and recommended for use.</span></p>
<h2 class="heading-2" id="_idParaDest-485"><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml">Building a Hello World gRPC client</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml">We will add an</span><a id="_idIndexMarker1432"/><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml"> ASP.NET Core MVC website project and then add the gRPC client packages to enable it to call the gRPC service:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml">Use your preferred code editor to add a new project, as defined in the following list:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml">Project template: </span><strong class="screenText"><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml">ASP.NET Core Web App (Model-View-Controller) </span></strong><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">/ </span><code class="inlineCode"><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">mvc</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml">Solution file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml">Chapter13</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml">Project file and folder: </span><code class="inlineCode"><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml">Authentication type</span></strong><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml">: None.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">Configure for HTTPS</span></strong><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml">: Selected.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">Enable Docker</span></strong><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
<li class="bulletList"><strong class="screenText"><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">Do not use top-level statements</span></strong><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">: Cleared.</span></li>
</ul>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml"> project, treat warnings as errors, add package references for Microsoft’s gRPC client factory and tools, and Google’s .NET library for Protocol Buffers, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">"Google.Protobuf"</span></span><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml">"3.24.4"</span></span><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml">"Grpc.Net.ClientFactory"</span></span><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">"2.57.0"</span></span><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml">"Grpc.Tools"</span></span><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml">"2.58.0"</span></span><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
    &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;
    &lt;IncludeAssets&gt;runtime; build; native; contentfiles; 
      analyzers; buildtransitive&lt;/IncludeAssets&gt;
  &lt;/PackageReference&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml">: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Net.ClientFactory</span></code><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml"> package references the </span><code class="inlineCode"><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Net.Client</span></code><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml"> package that implements client-side support for gRPC in a .NET project, but it does not reference other packages like </span><code class="inlineCode"><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Tools</span></code><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">Google.Protobuf</span></code><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.646.2" xmlns="http://www.w3.org/1999/xhtml">We must reference those packages explicitly. </span><span class="koboSpan" id="kobo.646.3" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml">Grpc.Tools</span></code><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml"> package is only used during development, so it is marked as </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">PrivateAssets=all</span></code><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml"> to ensure that the tools are not published with the production website.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml">Properties</span></code><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml"> folder, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml">launchSettings.json</span></code><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml">, and for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml"> profile, modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml">applicationUrl</span></code><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml"> setting to use ports </span><code class="inlineCode"><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml">5133</span></code><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml">https</span></code><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml">5134</span></code><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml">http</span></code><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">, as </span><a id="_idIndexMarker1433"/><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml">shown highlighted in the following partial markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">"profiles"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml">
  ...
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml">"https"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">"commandName"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">"Project"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml">"dotnetRunMessages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml">"launchBrowser"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml">"applicationUrl"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5133;http://localhost:5134"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">"environmentVariables"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml">"ASPNETCORE_ENVIRONMENT"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml">"Development"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml"> folder from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml"> project/folder to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml"> project/folder.
    </span><div class="note">
<p class="normal"><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio 2022, you can drag and drop to copy. </span><span class="koboSpan" id="kobo.706.2" xmlns="http://www.w3.org/1999/xhtml">In Visual Studio Code or JetBrains Rider, drag and drop while holding the </span><em class="keystroke"><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml">Ctrl</span></em><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><em class="keystroke"><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">Cmd</span></em><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml"> key.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">greet.proto</span></code><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml">, modify the namespace to match the namespace for the current project so that the automatically generated classes will be in the same namespace, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Client.Mvc"</span></span><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml"> project file, add or modify the item group that registers</span><a id="_idIndexMarker1434"/><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml"> file to indicate that it is being used on the client side, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\greet.proto"</span></span><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">Visual Studio 2022 will have created the item group for you, but it will set </span><code class="inlineCode"><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">GrpcServices</span></code><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">Server</span></code><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml"> by default, so you must manually change that to </span><code class="inlineCode"><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></code><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.740.2" xmlns="http://www.w3.org/1999/xhtml">For other code editors, you might have to create the whole </span><code class="inlineCode"><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;</span></code><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml"> manually. </span><span class="koboSpan" id="kobo.742.2" xmlns="http://www.w3.org/1999/xhtml">JetBrains Rider has more configuration but you can ignore it.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml"> project to ensure that the automatically generated classes are created.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">obj\Debug\net8.0\Protos</span></code><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">GreetGrpc.cs</span></code><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">, note the </span><code class="inlineCode"><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">Greeter.GreeterClient</span></code><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml"> class, as partially shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml">Greeter</span></span><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml">
{ 
  ...
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml">GreeterClient</span></span><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml">grpc</span></span><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">::</span><span class="hljs-title"><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml">ClientBase</span></span><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml">GreeterClient</span></span><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace for </span><code class="inlineCode"><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">Greeter.GreeterClient</span></code><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.Grpc.Client.Mvc; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">// To use Greeter.GreeterClient.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">, in the section for configuring services, write a statement to add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml">GreeterClient</span></code><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml"> as a named gRPC client that will be communicating with a service that is</span><a id="_idIndexMarker1435"/><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml"> listening on port </span><code class="inlineCode"><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">5131</span></code><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddGrpcClient&lt;Greeter.GreeterClient&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml">"Greeter"</span></span><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml">,
  options =&gt;
  {
    options.Address = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml"> Uri(</span><span class="hljs-string"><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5131"</span></span><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml">);
  });
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml">Models</span></code><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new class named </span><code class="inlineCode"><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml">HomeIndexViewModel.cs</span></code><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">HomeIndexViewModel.cs</span></code><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">, define a class to store a greeting and an error message, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc.Models</span></span><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">HomeIndexViewModel</span></span><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.812.2" xmlns="http://www.w3.org/1999/xhtml">Greeting { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">; }  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.819.2" xmlns="http://www.w3.org/1999/xhtml">ErrorMessage { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">; }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">Controllers</span></code><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace to work with the gRPC client factory, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml"> Grpc.Net.ClientFactory; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml">// To use GrpcClientFactory.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml">Controller</span></code><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml"> class, declare a field to store a </span><code class="inlineCode"><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml">Greeter Client</span></code><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml"> instance and set it by using the client factory in the constructor, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">HomeController</span></span><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">Controller</span></span><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger&lt;HomeController&gt; _logger;
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">private</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml"> Greeter.GreeterClient _greeterClient;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">HomeController</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;HomeController&gt; logger</span></span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml">    GrpcClientFactory factory</span></strong></span><span class="hljs-function"><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger = logger;
    _</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">greeterClient = factory.CreateClient&lt;Greeter.GreeterClient&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml">"Greeter"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml">Index</span></code><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml"> action method, make the method asynchronous, add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml">string</span></code><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml"> parameter named </span><code class="inlineCode"><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml">name</span></code><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml"> with a default value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml">Henrietta</span></code><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml">, and then add statements to use the gRPC client to call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">SayHelloAsync</span></code><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml"> method, passing a </span><code class="inlineCode"><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">HelloRequest</span></code><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml"> object and storing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">HelloReply</span></code><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml"> response in </span><code class="inlineCode"><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">ViewData</span></code><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml">, while catching </span><a id="_idIndexMarker1436"/><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">any exceptions, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml">async</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;</span></strong></span><span class="hljs-function"><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">IActionResult</span></span><span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">Index</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="code-highlight"><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml">string</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml"> name = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml">"Henrietta"</span></strong></span><span class="hljs-function"><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">
{
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">  HomeIndexViewModel model = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">try</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">    HelloReply reply = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml"> _greeterClient.SayHelloAsync(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml"> HelloRequest { Name = name });</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml">    model.Greeting = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml">"Greeting from gRPC service: "</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml"> + reply.Message;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml"> (Exception ex)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">    _logger.LogWarning(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml">$"Northwind.Grpc.Service is not responding."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml">    model.ErrorMessage = ex.Message;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml"> View(model);
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml">Views/Home</span></code><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml">, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">Index.cshtml</span></code><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml">, after the </span><strong class="screenText"><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml">Welcome</span></strong><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml"> heading, remove the existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml">&lt;p&gt;</span></code><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml"> element and then add markup to render a form for the visitor to enter their name, and then if they submit and the gRPC service responds, to output the greeting, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml">@using Northwind.Grpc.Client.Mvc.Models</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml">@model HomeIndexViewModel</span></strong></span><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml">
@{
  ViewData[</span><span class="hljs-string"><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml">"Title"</span></span><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">] = </span><span class="hljs-string"><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml">"Home Page"</span></span><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml">;
}
&lt;div </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml">"text-center"</span></span><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml">&gt;
  &lt;h1 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml">"display-4"</span></span><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml">&gt;Welcome&lt;/h1&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;div </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml">"alert alert-secondary"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;form&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml">      &lt;input name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml"> placeholder=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">"Enter your name"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml">      &lt;input type=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">"submit"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;/form&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;/div&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml">  @if (Model.Greeting </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml">is</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml">not</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;p </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">"alert alert-primary"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml">&gt;@Model.Greeting&lt;/p&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml">  @if (Model.ErrorMessage </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml">is</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">not</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml">    &lt;p </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml">"alert alert-danger"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">&gt;@Model.ErrorMessage&lt;/p&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.978.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span><span class="koboSpan" id="kobo.979.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/div&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.980.1" xmlns="http://www.w3.org/1999/xhtml">If you clean a gRPC project, then</span><a id="_idIndexMarker1437"/><span class="koboSpan" id="kobo.981.1" xmlns="http://www.w3.org/1999/xhtml"> you will lose the automatically generated types and see compile errors. </span><span class="koboSpan" id="kobo.981.2" xmlns="http://www.w3.org/1999/xhtml">To recreate them, simply make any change to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.982.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.983.1" xmlns="http://www.w3.org/1999/xhtml"> file or close and reopen the project/solution.</span></p>
</div>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-486"><span class="koboSpan" id="kobo.984.1" xmlns="http://www.w3.org/1999/xhtml">Testing a gRPC service and client</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.985.1" xmlns="http://www.w3.org/1999/xhtml">Now we can start the</span><a id="_idIndexMarker1438"/><span class="koboSpan" id="kobo.986.1" xmlns="http://www.w3.org/1999/xhtml"> gRPC service and see if the MVC website can call it successfully:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.987.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.988.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.989.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.990.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.991.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.992.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.993.1" xmlns="http://www.w3.org/1999/xhtml">If necessary, start a browser and navigate to the home page: </span><code class="inlineCode"><span class="koboSpan" id="kobo.994.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5133/</span></code><span class="koboSpan" id="kobo.995.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.996.1" xmlns="http://www.w3.org/1999/xhtml">Note the greeting on the home page, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.997.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.4</span></em><span class="koboSpan" id="kobo.998.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.999.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1000.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.4: Home page after calling the gRPC service to get a greeting</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1001.1" xmlns="http://www.w3.org/1999/xhtml">View the</span><a id="_idIndexMarker1439"/><span class="koboSpan" id="kobo.1002.1" xmlns="http://www.w3.org/1999/xhtml"> command prompt or terminal for the ASP.NET Core MVC project and note the info messages that indicate an HTTP/2 </span><code class="inlineCode"><span class="koboSpan" id="kobo.1003.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.1004.1" xmlns="http://www.w3.org/1999/xhtml"> was processed by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1005.1" xmlns="http://www.w3.org/1999/xhtml">greet.Greeter/SayHello</span></code><span class="koboSpan" id="kobo.1006.1" xmlns="http://www.w3.org/1999/xhtml"> endpoint in about 41ms, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1007.1" xmlns="http://www.w3.org/1999/xhtml">info: System.Net.Http.HttpClient.Greeter.LogicalHandler[100]
      Start processing HTTP request POST https://localhost:5131/greet.Greeter/SayHello
info: System.Net.Http.HttpClient.Greeter.ClientHandler[100]
      Sending HTTP request POST https://localhost:5131/greet.Greeter/SayHello
info: System.Net.Http.HttpClient.Greeter.ClientHandler[101]
      Received HTTP response headers after 60.5352ms - 200
info: System.Net.Http.HttpClient.Greeter.LogicalHandler[101]
      End processing HTTP request after 69.1623ms - 200
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1008.1" xmlns="http://www.w3.org/1999/xhtml">Enter and submit your own name on the page.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1009.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-487"><span class="koboSpan" id="kobo.1010.1" xmlns="http://www.w3.org/1999/xhtml">Implementing gRPC for an EF Core model</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1011.1" xmlns="http://www.w3.org/1999/xhtml">Now we will add a service for</span><a id="_idIndexMarker1440"/><span class="koboSpan" id="kobo.1012.1" xmlns="http://www.w3.org/1999/xhtml"> working with the Northwind database to the gRPC project.</span></p>
<h2 class="heading-2" id="_idParaDest-488"><span class="koboSpan" id="kobo.1013.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the gRPC service</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1014.1" xmlns="http://www.w3.org/1999/xhtml">We will reference the EF Core model that you created in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1015.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 3</span></em><span class="koboSpan" id="kobo.1016.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.1017.1" xmlns="http://www.w3.org/1999/xhtml">Building Entity Models for SQL Server Using EF Core</span></em><span class="koboSpan" id="kobo.1018.1" xmlns="http://www.w3.org/1999/xhtml">, then define a contract for the gRPC service using a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1019.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.1020.1" xmlns="http://www.w3.org/1999/xhtml"> file, and finally implement the service.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1021.1" xmlns="http://www.w3.org/1999/xhtml">We will start with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1022.1" xmlns="http://www.w3.org/1999/xhtml">Shippers</span></code><span class="koboSpan" id="kobo.1023.1" xmlns="http://www.w3.org/1999/xhtml"> table</span><a id="_idIndexMarker1441"/><span class="koboSpan" id="kobo.1024.1" xmlns="http://www.w3.org/1999/xhtml"> because it is simple. </span><span class="koboSpan" id="kobo.1024.2" xmlns="http://www.w3.org/1999/xhtml">Each shipper only has three properties, an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1025.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.1026.1" xmlns="http://www.w3.org/1999/xhtml"> and two </span><code class="inlineCode"><span class="koboSpan" id="kobo.1027.1" xmlns="http://www.w3.org/1999/xhtml">string</span></code><span class="koboSpan" id="kobo.1028.1" xmlns="http://www.w3.org/1999/xhtml"> values, and there are only three records in the table. </span><span class="koboSpan" id="kobo.1028.2" xmlns="http://www.w3.org/1999/xhtml">Let’s go:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1029.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1030.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1031.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a project reference to the Northwind database context project, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1032.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;ProjectReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1033.1" xmlns="http://www.w3.org/1999/xhtml">"..\..\Chapter03\Northwind.Common.DataContext</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1034.1" xmlns="http://www.w3.org/1999/xhtml">.SqlServer\Northwind.Common.DataContext.SqlServer.csproj"</span></span><span class="koboSpan" id="kobo.1035.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1036.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1037.1" xmlns="http://www.w3.org/1999/xhtml">Include</span></code><span class="koboSpan" id="kobo.1038.1" xmlns="http://www.w3.org/1999/xhtml"> path must not have a line break.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1039.1" xmlns="http://www.w3.org/1999/xhtml">At the command prompt or terminal, build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1040.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1041.1" xmlns="http://www.w3.org/1999/xhtml"> project, as shown in the following command: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1042.1" xmlns="http://www.w3.org/1999/xhtml">dotnet build</span></code><span class="koboSpan" id="kobo.1043.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1044.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1045.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1046.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1047.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.1048.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new file (the item template is named </span><strong class="screenText"><span class="koboSpan" id="kobo.1049.1" xmlns="http://www.w3.org/1999/xhtml">Protocol Buffer File</span></strong><span class="koboSpan" id="kobo.1050.1" xmlns="http://www.w3.org/1999/xhtml"> in Visual Studio 2022) named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1051.1" xmlns="http://www.w3.org/1999/xhtml">shipper.proto</span></code><span class="koboSpan" id="kobo.1052.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1053.1" xmlns="http://www.w3.org/1999/xhtml">syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1054.1" xmlns="http://www.w3.org/1999/xhtml">"proto3"</span></span><span class="koboSpan" id="kobo.1055.1" xmlns="http://www.w3.org/1999/xhtml">;
option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1056.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1057.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service"</span></span><span class="koboSpan" id="kobo.1058.1" xmlns="http://www.w3.org/1999/xhtml">;
package shipper;
service Shipper {
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.1059.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1060.1" xmlns="http://www.w3.org/1999/xhtml">GetShipper</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1061.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1062.1" xmlns="http://www.w3.org/1999/xhtml">ShipperRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1063.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1064.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1065.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1066.1" xmlns="http://www.w3.org/1999/xhtml">ShipperReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1067.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1068.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message ShipperRequest {
  int32 shipper_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1069.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.1070.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message ShipperReply {
  int32 shipper_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1071.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.1072.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1073.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1074.1" xmlns="http://www.w3.org/1999/xhtml"> company_name = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1075.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.1076.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1077.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1078.1" xmlns="http://www.w3.org/1999/xhtml"> phone = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1079.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.1080.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1081.1" xmlns="http://www.w3.org/1999/xhtml">Open the project file and add an entry to include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1082.1" xmlns="http://www.w3.org/1999/xhtml">shipper.proto</span></code><span class="koboSpan" id="kobo.1083.1" xmlns="http://www.w3.org/1999/xhtml"> file, as shown highlighted</span><a id="_idIndexMarker1442"/><span class="koboSpan" id="kobo.1084.1" xmlns="http://www.w3.org/1999/xhtml"> in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1085.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1086.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\greet.proto"</span></span><span class="koboSpan" id="kobo.1087.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1088.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></span><span class="koboSpan" id="kobo.1089.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1090.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1091.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\shipper.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1092.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1093.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1094.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.1095.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/ItemGroup&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1096.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1097.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1098.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1099.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1100.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.1101.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1102.1" xmlns="http://www.w3.org/1999/xhtml">ShipperService.cs</span></code><span class="koboSpan" id="kobo.1103.1" xmlns="http://www.w3.org/1999/xhtml">, and modify its contents to define a shipper service that uses the Northwind database context to return shippers, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1104.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1105.1" xmlns="http://www.w3.org/1999/xhtml"> Grpc.Core; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1106.1" xmlns="http://www.w3.org/1999/xhtml">// To use ServerCallContext.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1107.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1108.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.EntityModels; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1109.1" xmlns="http://www.w3.org/1999/xhtml">// To use NorthwindContext.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1110.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1111.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperEntity = Northwind.EntityModels.Shipper;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1112.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1113.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service.Services</span></span><span class="koboSpan" id="kobo.1114.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1115.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1116.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1117.1" xmlns="http://www.w3.org/1999/xhtml">ShipperService</span></span><span class="koboSpan" id="kobo.1118.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.1119.1" xmlns="http://www.w3.org/1999/xhtml">Shipper.ShipperBase</span></span><span class="koboSpan" id="kobo.1120.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1121.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1122.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1123.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger&lt;ShipperService&gt; _logger;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1124.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1125.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1126.1" xmlns="http://www.w3.org/1999/xhtml"> NorthwindContext _db;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1127.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1128.1" xmlns="http://www.w3.org/1999/xhtml">ShipperService</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1129.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1130.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;ShipperService&gt; logger,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1131.1" xmlns="http://www.w3.org/1999/xhtml">    NorthwindContext context</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1132.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1133.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger = logger;
    _db = context;
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1134.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1135.1" xmlns="http://www.w3.org/1999/xhtml">override</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1136.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="koboSpan" id="kobo.1137.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;ShipperReply?&gt; GetShipper(
    ShipperRequest request, ServerCallContext context)
  {
    ShipperEntity? </span><span class="koboSpan" id="kobo.1137.2" xmlns="http://www.w3.org/1999/xhtml">shipper = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1138.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.1139.1" xmlns="http://www.w3.org/1999/xhtml"> _db.Shippers
      .FindAsync(request.ShipperId);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1140.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1141.1" xmlns="http://www.w3.org/1999/xhtml"> shipper </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1142.1" xmlns="http://www.w3.org/1999/xhtml">is</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1143.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="koboSpan" id="kobo.1144.1" xmlns="http://www.w3.org/1999/xhtml"> ? </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1145.1" xmlns="http://www.w3.org/1999/xhtml">null</span></span><span class="koboSpan" id="kobo.1146.1" xmlns="http://www.w3.org/1999/xhtml"> : ToShipperReply(shipper);
  }
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1147.1" xmlns="http://www.w3.org/1999/xhtml">// A mapping method to convert from a Shipper in the</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1148.1" xmlns="http://www.w3.org/1999/xhtml">// entity model to a gRPC ShipperReply.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1149.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1150.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperReply </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1151.1" xmlns="http://www.w3.org/1999/xhtml">ToShipperReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1152.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1153.1" xmlns="http://www.w3.org/1999/xhtml">ShipperEntity shipper</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1154.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1155.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1156.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1157.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1158.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperReply
    {
      ShipperId = shipper.ShipperId,
      CompanyName = shipper.CompanyName,
      Phone = shipper.Phone
    };
  }
}
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1159.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1160.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.1161.1" xmlns="http://www.w3.org/1999/xhtml"> file generates classes that represent the messages sent to and from a gRPC service. </span><span class="koboSpan" id="kobo.1161.2" xmlns="http://www.w3.org/1999/xhtml">We therefore cannot use the entity classes defined for the EF Core model. </span><span class="koboSpan" id="kobo.1161.3" xmlns="http://www.w3.org/1999/xhtml">We need a helper method like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1162.1" xmlns="http://www.w3.org/1999/xhtml">ToShipperReply</span></code><span class="koboSpan" id="kobo.1163.1" xmlns="http://www.w3.org/1999/xhtml"> that can map an instance of an entity class to an instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1164.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.1165.1" xmlns="http://www.w3.org/1999/xhtml">-generated classes like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1166.1" xmlns="http://www.w3.org/1999/xhtml">ShipperReply</span></code><span class="koboSpan" id="kobo.1167.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1167.2" xmlns="http://www.w3.org/1999/xhtml">This could be a good use for AutoMapper, although in this case, the mapping is simple enough to hand-code.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.1168.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1170.1" xmlns="http://www.w3.org/1999/xhtml">, import </span><a id="_idIndexMarker1443"/><span class="koboSpan" id="kobo.1171.1" xmlns="http://www.w3.org/1999/xhtml">the namespace for the Northwind database context, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1172.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1173.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind.EntityModels; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1174.1" xmlns="http://www.w3.org/1999/xhtml">// To use AddNorthwindContext method.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1175.1" xmlns="http://www.w3.org/1999/xhtml">In the section that configures services, add a call to register the Northwind database context, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1176.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddNorthwindContext();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1177.1" xmlns="http://www.w3.org/1999/xhtml">In the section that configures the HTTP pipeline, after the call to register </span><code class="inlineCode"><span class="koboSpan" id="kobo.1178.1" xmlns="http://www.w3.org/1999/xhtml">GreeterService</span></code><span class="koboSpan" id="kobo.1179.1" xmlns="http://www.w3.org/1999/xhtml">, add a statement to register </span><code class="inlineCode"><span class="koboSpan" id="kobo.1180.1" xmlns="http://www.w3.org/1999/xhtml">ShipperService</span></code><span class="koboSpan" id="kobo.1181.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1182.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGrpcService&lt;ShipperService&gt;();
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-489"><span class="koboSpan" id="kobo.1183.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the gRPC client</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1184.1" xmlns="http://www.w3.org/1999/xhtml">Now we can add client capabilities to the</span><a id="_idIndexMarker1444"/><span class="koboSpan" id="kobo.1185.1" xmlns="http://www.w3.org/1999/xhtml"> Northwind MVC website:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1186.1" xmlns="http://www.w3.org/1999/xhtml">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1187.1" xmlns="http://www.w3.org/1999/xhtml">shipper.proto</span></code><span class="koboSpan" id="kobo.1188.1" xmlns="http://www.w3.org/1999/xhtml"> file from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1189.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.1190.1" xmlns="http://www.w3.org/1999/xhtml"> folder in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1191.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1192.1" xmlns="http://www.w3.org/1999/xhtml"> project to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1193.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.1194.1" xmlns="http://www.w3.org/1999/xhtml"> folder in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1195.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1196.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1197.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1198.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1199.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1200.1" xmlns="http://www.w3.org/1999/xhtml">shipper.proto</span></code><span class="koboSpan" id="kobo.1201.1" xmlns="http://www.w3.org/1999/xhtml">, modify the namespace to match the namespace for the current project so that the automatically generated classes will be in the same namespace, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1202.1" xmlns="http://www.w3.org/1999/xhtml">option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1203.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1204.1" xmlns="http://www.w3.org/1999/xhtml">Client.Mvc</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1205.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1206.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1207.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1208.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1209.1" xmlns="http://www.w3.org/1999/xhtml"> project file, modify or add the entry to register the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1210.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.1211.1" xmlns="http://www.w3.org/1999/xhtml"> file as being used on the client side, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1212.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1213.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\greet.proto"</span></span><span class="koboSpan" id="kobo.1214.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1215.1" xmlns="http://www.w3.org/1999/xhtml">"Client"</span></span><span class="koboSpan" id="kobo.1216.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1217.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\shipper.proto"</span></span><span class="koboSpan" id="kobo.1218.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1219.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1220.1" xmlns="http://www.w3.org/1999/xhtml">Client</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1221.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="koboSpan" id="kobo.1222.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1223.1" xmlns="http://www.w3.org/1999/xhtml">If you are using a code editor like JetBrains Rider that adds extra configuration, I recommend that you simplify the elements as shown in the preceding markup. </span><span class="koboSpan" id="kobo.1223.2" xmlns="http://www.w3.org/1999/xhtml">If you do not, then you might get errors later in this coding task.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1224.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1225.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1226.1" xmlns="http://www.w3.org/1999/xhtml"> project file, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1227.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1228.1" xmlns="http://www.w3.org/1999/xhtml">, add a statement to register the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1229.1" xmlns="http://www.w3.org/1999/xhtml">ShipperClient</span></code><span class="koboSpan" id="kobo.1230.1" xmlns="http://www.w3.org/1999/xhtml"> class to connect to the gRPC service listening on port </span><code class="inlineCode"><span class="koboSpan" id="kobo.1231.1" xmlns="http://www.w3.org/1999/xhtml">5131</span></code><span class="koboSpan" id="kobo.1232.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1233.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddGrpcClient&lt;Shipper.ShipperClient&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1234.1" xmlns="http://www.w3.org/1999/xhtml">"Shipper"</span></span><span class="koboSpan" id="kobo.1235.1" xmlns="http://www.w3.org/1999/xhtml">,
  options =&gt;
  {
    options.Address = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1236.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1237.1" xmlns="http://www.w3.org/1999/xhtml"> Uri(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1238.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5131"</span></span><span class="koboSpan" id="kobo.1239.1" xmlns="http://www.w3.org/1999/xhtml">);
  });
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1240.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1241.1" xmlns="http://www.w3.org/1999/xhtml">Models</span></code><span class="koboSpan" id="kobo.1242.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1243.1" xmlns="http://www.w3.org/1999/xhtml">HomeIndexViewModel.cs</span></code><span class="koboSpan" id="kobo.1244.1" xmlns="http://www.w3.org/1999/xhtml">, add a property to store a summary of a shipper, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1245.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1246.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.1247.1" xmlns="http://www.w3.org/1999/xhtml">? </span><span class="koboSpan" id="kobo.1247.2" xmlns="http://www.w3.org/1999/xhtml">ShipperSummary { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1248.1" xmlns="http://www.w3.org/1999/xhtml">get</span></span><span class="koboSpan" id="kobo.1249.1" xmlns="http://www.w3.org/1999/xhtml">; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1250.1" xmlns="http://www.w3.org/1999/xhtml">set</span></span><span class="koboSpan" id="kobo.1251.1" xmlns="http://www.w3.org/1999/xhtml">; }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1252.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1253.1" xmlns="http://www.w3.org/1999/xhtml">Controllers</span></code><span class="koboSpan" id="kobo.1254.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1255.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1256.1" xmlns="http://www.w3.org/1999/xhtml">, declare a field to store a shipper client instance and set it by using the client factory in the constructor, as </span><a id="_idIndexMarker1445"/><span class="koboSpan" id="kobo.1257.1" xmlns="http://www.w3.org/1999/xhtml">shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1258.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1259.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1260.1" xmlns="http://www.w3.org/1999/xhtml">HomeController</span></span><span class="koboSpan" id="kobo.1261.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.1262.1" xmlns="http://www.w3.org/1999/xhtml">Controller</span></span><span class="koboSpan" id="kobo.1263.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1264.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1265.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1266.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger&lt;HomeController&gt; _logger;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1267.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1268.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.1269.1" xmlns="http://www.w3.org/1999/xhtml"> Greeter.GreeterClient _greeterClient;
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1270.1" xmlns="http://www.w3.org/1999/xhtml">private</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1271.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1272.1" xmlns="http://www.w3.org/1999/xhtml"> Shipper.ShipperClient _shipperClient;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1273.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1274.1" xmlns="http://www.w3.org/1999/xhtml">HomeController</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1275.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1276.1" xmlns="http://www.w3.org/1999/xhtml">ILogger&lt;HomeController&gt; logger,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1277.1" xmlns="http://www.w3.org/1999/xhtml">    GrpcClientFactory factory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1278.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1279.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger = logger;
    _greeterClient = factory.CreateClient&lt;Greeter.GreeterClient&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1280.1" xmlns="http://www.w3.org/1999/xhtml">"Greeter"</span></span><span class="koboSpan" id="kobo.1281.1" xmlns="http://www.w3.org/1999/xhtml">);
    _</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1282.1" xmlns="http://www.w3.org/1999/xhtml">shipperClient = factory.CreateClient&lt;Shipper.ShipperClient&gt;(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1283.1" xmlns="http://www.w3.org/1999/xhtml">"Shipper"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1284.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span><span class="koboSpan" id="kobo.1285.1" xmlns="http://www.w3.org/1999/xhtml">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1286.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1287.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1288.1" xmlns="http://www.w3.org/1999/xhtml">, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1289.1" xmlns="http://www.w3.org/1999/xhtml">Index</span></code><span class="koboSpan" id="kobo.1290.1" xmlns="http://www.w3.org/1999/xhtml"> action method, add a parameter named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1291.1" xmlns="http://www.w3.org/1999/xhtml">id</span></code><span class="koboSpan" id="kobo.1292.1" xmlns="http://www.w3.org/1999/xhtml"> and statements to call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1293.1" xmlns="http://www.w3.org/1999/xhtml">Shipper</span></code><span class="koboSpan" id="kobo.1294.1" xmlns="http://www.w3.org/1999/xhtml"> gRPC service to get a shipper with the matching </span><code class="inlineCode"><span class="koboSpan" id="kobo.1295.1" xmlns="http://www.w3.org/1999/xhtml">ShipperId</span></code><span class="koboSpan" id="kobo.1296.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1297.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1298.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1299.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;IActionResult&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1300.1" xmlns="http://www.w3.org/1999/xhtml">Index</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1301.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"> </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1302.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1303.1" xmlns="http://www.w3.org/1999/xhtml"> name = </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1304.1" xmlns="http://www.w3.org/1999/xhtml">"Henrietta"</span></span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1305.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1306.1" xmlns="http://www.w3.org/1999/xhtml">int</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1307.1" xmlns="http://www.w3.org/1999/xhtml"> id = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1308.1" xmlns="http://www.w3.org/1999/xhtml">1</span></strong></span><span class="hljs-function"><span class="koboSpan" id="kobo.1309.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1310.1" xmlns="http://www.w3.org/1999/xhtml">
{
  HomeIndexViewModel model = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1311.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1312.1" xmlns="http://www.w3.org/1999/xhtml">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1313.1" xmlns="http://www.w3.org/1999/xhtml">try</span></span><span class="koboSpan" id="kobo.1314.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    HelloReply reply = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1315.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.1316.1" xmlns="http://www.w3.org/1999/xhtml"> greeterClient.SayHelloAsync(
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1317.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1318.1" xmlns="http://www.w3.org/1999/xhtml"> HelloRequest { Name = name });
    model.Greeting = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1319.1" xmlns="http://www.w3.org/1999/xhtml">"Greeting from gRPC service: "</span></span><span class="koboSpan" id="kobo.1320.1" xmlns="http://www.w3.org/1999/xhtml"> + reply.Message;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1321.1" xmlns="http://www.w3.org/1999/xhtml">    ShipperReply shipperReply = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1322.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1323.1" xmlns="http://www.w3.org/1999/xhtml"> _shipperClient.GetShipperAsync(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1324.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1325.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperRequest { ShipperId = id });</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1326.1" xmlns="http://www.w3.org/1999/xhtml">    model.ShipperSummary = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1327.1" xmlns="http://www.w3.org/1999/xhtml">"Shipper from gRPC service: "</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1328.1" xmlns="http://www.w3.org/1999/xhtml"> + </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1329.1" xmlns="http://www.w3.org/1999/xhtml">$"ID: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1330.1" xmlns="http://www.w3.org/1999/xhtml">{shipperReply.ShipperId}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1331.1" xmlns="http://www.w3.org/1999/xhtml">, Name: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1332.1" xmlns="http://www.w3.org/1999/xhtml">{shipperReply.CompanyName}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1333.1" xmlns="http://www.w3.org/1999/xhtml">,"</span></strong><strong class="hljs-slc"> </strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1334.1" xmlns="http://www.w3.org/1999/xhtml">      + </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1335.1" xmlns="http://www.w3.org/1999/xhtml">$" Phone: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1336.1" xmlns="http://www.w3.org/1999/xhtml">{shipperReply.Phone}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1337.1" xmlns="http://www.w3.org/1999/xhtml">."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1338.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span><span class="koboSpan" id="kobo.1339.1" xmlns="http://www.w3.org/1999/xhtml">
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1340.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></span><span class="koboSpan" id="kobo.1341.1" xmlns="http://www.w3.org/1999/xhtml"> (Exception ex)
  {
    _logger.LogWarning(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1342.1" xmlns="http://www.w3.org/1999/xhtml">$"Northwind.Grpc.Service is not responding."</span></span><span class="koboSpan" id="kobo.1343.1" xmlns="http://www.w3.org/1999/xhtml">);
    model.ErrorMessage = ex.Message;
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1344.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.1345.1" xmlns="http://www.w3.org/1999/xhtml"> View();
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1346.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1347.1" xmlns="http://www.w3.org/1999/xhtml">Views/Home</span></code><span class="koboSpan" id="kobo.1348.1" xmlns="http://www.w3.org/1999/xhtml">, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1349.1" xmlns="http://www.w3.org/1999/xhtml">Index.cshtml</span></code><span class="koboSpan" id="kobo.1350.1" xmlns="http://www.w3.org/1999/xhtml">, add code to render a form for the visitor to enter a shipper ID, and render</span><a id="_idIndexMarker1446"/><span class="koboSpan" id="kobo.1351.1" xmlns="http://www.w3.org/1999/xhtml"> the shipper details after the greeting, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1352.1" xmlns="http://www.w3.org/1999/xhtml">@using Northwind.Grpc.Client.Mvc.Models
@model HomeIndexViewModel
@{
  ViewData["Title"] = "Home Page";
}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1353.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1354.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1355.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1356.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1357.1" xmlns="http://www.w3.org/1999/xhtml">"text-center"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1358.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1359.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1360.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1361.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1362.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1363.1" xmlns="http://www.w3.org/1999/xhtml">"display-4"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1364.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1365.1" xmlns="http://www.w3.org/1999/xhtml">Welcome</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1366.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1367.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1368.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1369.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1370.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1371.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1372.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1373.1" xmlns="http://www.w3.org/1999/xhtml">"alert alert-secondary"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1374.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1375.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1376.1" xmlns="http://www.w3.org/1999/xhtml">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1377.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1378.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1379.1" xmlns="http://www.w3.org/1999/xhtml">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1380.1" xmlns="http://www.w3.org/1999/xhtml">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1381.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1382.1" xmlns="http://www.w3.org/1999/xhtml">"name"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1383.1" xmlns="http://www.w3.org/1999/xhtml">placeholder</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1384.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1385.1" xmlns="http://www.w3.org/1999/xhtml">"Enter your name"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1386.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1387.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1388.1" xmlns="http://www.w3.org/1999/xhtml">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1389.1" xmlns="http://www.w3.org/1999/xhtml">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1390.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1391.1" xmlns="http://www.w3.org/1999/xhtml">"submit"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1392.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1393.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1394.1" xmlns="http://www.w3.org/1999/xhtml">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1395.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1396.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1397.1" xmlns="http://www.w3.org/1999/xhtml">form</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1398.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1399.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1400.1" xmlns="http://www.w3.org/1999/xhtml">input</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1401.1" xmlns="http://www.w3.org/1999/xhtml">name</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1402.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1403.1" xmlns="http://www.w3.org/1999/xhtml">"id"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1404.1" xmlns="http://www.w3.org/1999/xhtml">placeholder</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1405.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1406.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1407.1" xmlns="http://www.w3.org/1999/xhtml">Enter a shipper id"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1408.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1409.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1410.1" xmlns="http://www.w3.org/1999/xhtml">input</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1411.1" xmlns="http://www.w3.org/1999/xhtml">type</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1412.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1413.1" xmlns="http://www.w3.org/1999/xhtml">"submit"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1414.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1415.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1416.1" xmlns="http://www.w3.org/1999/xhtml">form</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1417.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1418.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1419.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1420.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1421.1" xmlns="http://www.w3.org/1999/xhtml">
  @if (Model.Greeting is not null)
  {
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1422.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1423.1" xmlns="http://www.w3.org/1999/xhtml">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1424.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1425.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1426.1" xmlns="http://www.w3.org/1999/xhtml">"alert alert-primary"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1427.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1428.1" xmlns="http://www.w3.org/1999/xhtml">@Model.Greeting</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1429.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1430.1" xmlns="http://www.w3.org/1999/xhtml">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1431.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1432.1" xmlns="http://www.w3.org/1999/xhtml">
  }
  @if (Model.ErrorMessage is not null)
  {
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1433.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1434.1" xmlns="http://www.w3.org/1999/xhtml">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1435.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1436.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1437.1" xmlns="http://www.w3.org/1999/xhtml">"alert alert-danger"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1438.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1439.1" xmlns="http://www.w3.org/1999/xhtml">@Model.ErrorMessage</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1440.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1441.1" xmlns="http://www.w3.org/1999/xhtml">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1442.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.1443.1" xmlns="http://www.w3.org/1999/xhtml">
  }
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1444.1" xmlns="http://www.w3.org/1999/xhtml">  @if (Model.ShipperSummary is not null)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1445.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1446.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1447.1" xmlns="http://www.w3.org/1999/xhtml">p</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1448.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1449.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1450.1" xmlns="http://www.w3.org/1999/xhtml">"alert alert-primary"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1451.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1452.1" xmlns="http://www.w3.org/1999/xhtml">@Model.ShipperSummary</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1453.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1454.1" xmlns="http://www.w3.org/1999/xhtml">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1455.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1456.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1457.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1458.1" xmlns="http://www.w3.org/1999/xhtml">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1459.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1460.1" xmlns="http://www.w3.org/1999/xhtml">If your database server is </span><a id="_idIndexMarker1447"/><span class="koboSpan" id="kobo.1461.1" xmlns="http://www.w3.org/1999/xhtml">not running, for example, because you are hosting it in Docker, a virtual machine, or in the cloud, then make sure to start it.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1462.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1463.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1464.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1465.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1466.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1467.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1468.1" xmlns="http://www.w3.org/1999/xhtml">If necessary, start a browser and navigate to the MVC website home page: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1469.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5133/</span></code><span class="koboSpan" id="kobo.1470.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1471.1" xmlns="http://www.w3.org/1999/xhtml">Note that an exception is thrown in the gRPC service because the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1472.1" xmlns="http://www.w3.org/1999/xhtml">GetShipper</span></code><span class="koboSpan" id="kobo.1473.1" xmlns="http://www.w3.org/1999/xhtml"> method uses EF Core, which is attempting to dynamically compile a LINQ query, and that is not supported with native AOT compilation, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1474.1" xmlns="http://www.w3.org/1999/xhtml">fail: Grpc.AspNetCore.Server.ServerCallHandler[6]
      Error when executing service method 'GetShipper'.
      </span><span class="koboSpan" id="kobo.1474.2" xmlns="http://www.w3.org/1999/xhtml">System.PlatformNotSupportedException: Dynamic code generation is not supported on this platform.
         </span><span class="koboSpan" id="kobo.1474.3" xmlns="http://www.w3.org/1999/xhtml">at System.Reflection.Emit.AssemblyBuilder.ThrowDynamicCodeNotSupported()
...
         </span><span class="koboSpan" id="kobo.1474.4" xmlns="http://www.w3.org/1999/xhtml">at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)
...
         </span><span class="koboSpan" id="kobo.1474.5" xmlns="http://www.w3.org/1999/xhtml">at Northwind.Grpc.Service.Services.ShipperService.GetShipper(ShipperRequest request, ServerCallContext context) in C:\apps-services-net8\Chapter13\Northwind.Grpc.Service\Services\ShipperService.cs:line 22
...
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1475.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1476.1" xmlns="http://www.w3.org/1999/xhtml">In the project file, comment </span><a id="_idIndexMarker1448"/><span class="koboSpan" id="kobo.1477.1" xmlns="http://www.w3.org/1999/xhtml">out the publish AOT option, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1478.1" xmlns="http://www.w3.org/1999/xhtml">&lt;!--&lt;PublishAot&gt;</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1479.1" xmlns="http://www.w3.org/1999/xhtml">true</span></span><span class="koboSpan" id="kobo.1480.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/PublishAot&gt;--&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1481.1" xmlns="http://www.w3.org/1999/xhtml">You might be wondering what the point was of enabling AOT when we created the project and chose to implement parts of the service using EF Core, if we were just going to have to disable AOT later. </span><span class="koboSpan" id="kobo.1481.2" xmlns="http://www.w3.org/1999/xhtml">Two reasons: I want you to see the error so you recognize it if you try to do similar with your own gRPC projects, and we </span><em class="italic"><span class="koboSpan" id="kobo.1482.1" xmlns="http://www.w3.org/1999/xhtml">will</span></em><span class="koboSpan" id="kobo.1483.1" xmlns="http://www.w3.org/1999/xhtml"> be able to use EF Core in the future with .NET 9 or .NET 10.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="16"><span class="koboSpan" id="kobo.1484.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1485.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1486.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1487.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1488.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1489.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1490.1" xmlns="http://www.w3.org/1999/xhtml">Note the shipper information on the services page, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1491.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.5</span></em><span class="koboSpan" id="kobo.1492.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1493.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1494.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.5: Home page after calling the gRPC service to get a shipper</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="19"><span class="koboSpan" id="kobo.1495.1" xmlns="http://www.w3.org/1999/xhtml">There are three shippers in the Northwind database with IDs of 1, 2, and 3. </span><span class="koboSpan" id="kobo.1495.2" xmlns="http://www.w3.org/1999/xhtml">Try entering their IDs to</span><a id="_idIndexMarker1449"/><span class="koboSpan" id="kobo.1496.1" xmlns="http://www.w3.org/1999/xhtml"> ensure they can all be retrieved, and try entering an ID that does not exist, like 4.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1497.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-490"><span class="koboSpan" id="kobo.1498.1" xmlns="http://www.w3.org/1999/xhtml">Taking gRPC further</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1499.1" xmlns="http://www.w3.org/1999/xhtml">Now let’s look at some more advanced topics like native AOT compilation support, getting metadata, adding deadlines, handling dates, times, and decimal types, adding interceptors, and handling exceptions and transient faults.</span></p>
<h2 class="heading-2" id="_idParaDest-491"><span class="koboSpan" id="kobo.1500.1" xmlns="http://www.w3.org/1999/xhtml">Improving a gRPC service with native AOT publish</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1501.1" xmlns="http://www.w3.org/1999/xhtml">.NET 8 introduces gRPC support for </span><a id="_idIndexMarker1450"/><span class="koboSpan" id="kobo.1502.1" xmlns="http://www.w3.org/1999/xhtml">native AOT. </span><span class="koboSpan" id="kobo.1502.2" xmlns="http://www.w3.org/1999/xhtml">But as you have just seen, it is not (yet) compatible with some parts of .NET like EF Core.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1503.1" xmlns="http://www.w3.org/1999/xhtml">Let’s change our gRPC service to</span><a id="_idIndexMarker1451"/><span class="koboSpan" id="kobo.1504.1" xmlns="http://www.w3.org/1999/xhtml"> use the SQL client instead of EF Core. </span><span class="koboSpan" id="kobo.1504.2" xmlns="http://www.w3.org/1999/xhtml">We will leave most of the EF Core code in the project so you can switch back if you want in the future, for example, if you upgrade to EF Core 9 and it supports native AOT:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1505.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1506.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1507.1" xmlns="http://www.w3.org/1999/xhtml"> project, uncomment out the option to publish AOT and add a package reference for the SQL client, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1508.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1509.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Data.SqlClient"</span></span><span class="koboSpan" id="kobo.1510.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1511.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1512.1" xmlns="http://www.w3.org/1999/xhtml">5.1.2"</span></span><span class="koboSpan" id="kobo.1513.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1514.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1515.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.1516.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1517.1" xmlns="http://www.w3.org/1999/xhtml">ShipperService.cs</span></code><span class="koboSpan" id="kobo.1518.1" xmlns="http://www.w3.org/1999/xhtml">, import namespaces for working with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1519.1" xmlns="http://www.w3.org/1999/xhtml">SqlClient</span></code><span class="koboSpan" id="kobo.1520.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1521.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1522.1" xmlns="http://www.w3.org/1999/xhtml"> Microsoft.Data.SqlClient; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1523.1" xmlns="http://www.w3.org/1999/xhtml">// To use SqlConnection and so on.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1524.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1525.1" xmlns="http://www.w3.org/1999/xhtml"> System.Data; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1526.1" xmlns="http://www.w3.org/1999/xhtml">// To use CommandType.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1527.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1528.1" xmlns="http://www.w3.org/1999/xhtml">GetShipper</span></code><span class="koboSpan" id="kobo.1529.1" xmlns="http://www.w3.org/1999/xhtml"> method, comment out the statements to get the shipper from the Northwind data context, and replace it with code to get the shipper using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1530.1" xmlns="http://www.w3.org/1999/xhtml">SqlClient</span></code><span class="koboSpan" id="kobo.1531.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1532.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1533.1" xmlns="http://www.w3.org/1999/xhtml">override</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1534.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="koboSpan" id="kobo.1535.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;ShipperReply?&gt; GetShipper(
  ShipperRequest request, ServerCallContext context)
{
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1536.1" xmlns="http://www.w3.org/1999/xhtml">// We cannot use EF Core in a native AOT compiled project.</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1537.1" xmlns="http://www.w3.org/1999/xhtml">//</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1538.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperEntity? </span><span class="koboSpan" id="kobo.1538.2" xmlns="http://www.w3.org/1999/xhtml">shipper = await _db.Shippers</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1539.1" xmlns="http://www.w3.org/1999/xhtml">//</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1540.1" xmlns="http://www.w3.org/1999/xhtml">   .FindAsync(request.ShipperId);</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1541.1" xmlns="http://www.w3.org/1999/xhtml">  SqlConnectionStringBuilder builder = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1542.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1543.1" xmlns="http://www.w3.org/1999/xhtml">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1544.1" xmlns="http://www.w3.org/1999/xhtml">  builder.InitialCatalog = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1545.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1546.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1547.1" xmlns="http://www.w3.org/1999/xhtml">  builder.MultipleActiveResultSets = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1548.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1549.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1550.1" xmlns="http://www.w3.org/1999/xhtml">  builder.Encrypt = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1551.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1552.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1553.1" xmlns="http://www.w3.org/1999/xhtml">  builder.TrustServerCertificate = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1554.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1555.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1556.1" xmlns="http://www.w3.org/1999/xhtml">  builder.ConnectTimeout = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1557.1" xmlns="http://www.w3.org/1999/xhtml">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1558.1" xmlns="http://www.w3.org/1999/xhtml">; </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1559.1" xmlns="http://www.w3.org/1999/xhtml">// Default is 30 seconds.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1560.1" xmlns="http://www.w3.org/1999/xhtml">  builder.DataSource = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1561.1" xmlns="http://www.w3.org/1999/xhtml">"."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1562.1" xmlns="http://www.w3.org/1999/xhtml">; </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1563.1" xmlns="http://www.w3.org/1999/xhtml">// To use local SQL Server.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1564.1" xmlns="http://www.w3.org/1999/xhtml">  builder.IntegratedSecurity = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1565.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1566.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1567.1" xmlns="http://www.w3.org/1999/xhtml">/*</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1568.1" xmlns="http://www.w3.org/1999/xhtml">  // To use SQL Server Authentication:</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1569.1" xmlns="http://www.w3.org/1999/xhtml">  builder.UserID = Environment.GetEnvironmentVariable("MY_SQL_USR");</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1570.1" xmlns="http://www.w3.org/1999/xhtml">  builder.Password = Environment.GetEnvironmentVariable("MY_SQL_PWD");</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1571.1" xmlns="http://www.w3.org/1999/xhtml">  builder.PersistSecurityInfo = false;</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1572.1" xmlns="http://www.w3.org/1999/xhtml">  */</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1573.1" xmlns="http://www.w3.org/1999/xhtml">  SqlConnection connection = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1574.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1575.1" xmlns="http://www.w3.org/1999/xhtml">(builder.ConnectionString);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1576.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1577.1" xmlns="http://www.w3.org/1999/xhtml"> connection.OpenAsync();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1578.1" xmlns="http://www.w3.org/1999/xhtml">  SqlCommand cmd = connection.CreateCommand();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1579.1" xmlns="http://www.w3.org/1999/xhtml">  cmd.CommandType = CommandType.Text;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1580.1" xmlns="http://www.w3.org/1999/xhtml">  cmd.CommandText = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1581.1" xmlns="http://www.w3.org/1999/xhtml">"SELECT ShipperId, CompanyName, Phone"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1582.1" xmlns="http://www.w3.org/1999/xhtml">    + </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1583.1" xmlns="http://www.w3.org/1999/xhtml">" FROM Shippers WHERE ShipperId = @id"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1584.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1585.1" xmlns="http://www.w3.org/1999/xhtml">  cmd.Parameters.AddWithValue(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1586.1" xmlns="http://www.w3.org/1999/xhtml">"id"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1587.1" xmlns="http://www.w3.org/1999/xhtml">, request.ShipperId);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1588.1" xmlns="http://www.w3.org/1999/xhtml">  SqlDataReader r = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1589.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1590.1" xmlns="http://www.w3.org/1999/xhtml"> cmd.ExecuteReaderAsync(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1591.1" xmlns="http://www.w3.org/1999/xhtml">    CommandBehavior.SingleRow);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1592.1" xmlns="http://www.w3.org/1999/xhtml">  ShipperReply? </span><span class="koboSpan" id="kobo.1592.2" xmlns="http://www.w3.org/1999/xhtml">shipper = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1593.1" xmlns="http://www.w3.org/1999/xhtml">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1594.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1595.1" xmlns="http://www.w3.org/1999/xhtml">// Read the expected single row.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1596.1" xmlns="http://www.w3.org/1999/xhtml">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1597.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1598.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1599.1" xmlns="http://www.w3.org/1999/xhtml"> r.ReadAsync())</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1600.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1601.1" xmlns="http://www.w3.org/1999/xhtml">    shipper = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1602.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1603.1" xmlns="http://www.w3.org/1999/xhtml">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1604.1" xmlns="http://www.w3.org/1999/xhtml">    {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1605.1" xmlns="http://www.w3.org/1999/xhtml">      ShipperId = r.GetInt32(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1606.1" xmlns="http://www.w3.org/1999/xhtml">"ShipperId"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1607.1" xmlns="http://www.w3.org/1999/xhtml">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1608.1" xmlns="http://www.w3.org/1999/xhtml">      CompanyName = r.GetString(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1609.1" xmlns="http://www.w3.org/1999/xhtml">"CompanyName"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1610.1" xmlns="http://www.w3.org/1999/xhtml">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1611.1" xmlns="http://www.w3.org/1999/xhtml">      Phone = r.GetString(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1612.1" xmlns="http://www.w3.org/1999/xhtml">"Phone"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1613.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1614.1" xmlns="http://www.w3.org/1999/xhtml">    };</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1615.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1616.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1617.1" xmlns="http://www.w3.org/1999/xhtml"> r.CloseAsync();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1618.1" xmlns="http://www.w3.org/1999/xhtml">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1619.1" xmlns="http://www.w3.org/1999/xhtml"> shipper;</span></strong></span><span class="koboSpan" id="kobo.1620.1" xmlns="http://www.w3.org/1999/xhtml">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1621.1" xmlns="http://www.w3.org/1999/xhtml">Double-check that you have re-enabled the publish AOT option.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1622.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1623.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.1624.1" xmlns="http://www.w3.org/1999/xhtml">, we could alter a statement to use the slim builder for the web application, as </span><a id="_idIndexMarker1452"/><span class="koboSpan" id="kobo.1625.1" xmlns="http://www.w3.org/1999/xhtml">shown in </span><a id="_idIndexMarker1453"/><span class="koboSpan" id="kobo.1626.1" xmlns="http://www.w3.org/1999/xhtml">the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1627.1" xmlns="http://www.w3.org/1999/xhtml">// Use the slim builder to reduce the size of the application</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1628.1" xmlns="http://www.w3.org/1999/xhtml">// when using the publish AOT project option.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1629.1" xmlns="http://www.w3.org/1999/xhtml">// var builder = WebApplication.CreateSlimBuilder(args);</span></span>
</code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1630.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1631.1" xmlns="http://www.w3.org/1999/xhtml">CreateSlimBuilder</span></code><span class="koboSpan" id="kobo.1632.1" xmlns="http://www.w3.org/1999/xhtml"> method does not include support for HTTPS or HTTP/3, although you can add those back in yourself if you need them. </span><span class="koboSpan" id="kobo.1632.2" xmlns="http://www.w3.org/1999/xhtml">If we switch to the slim builder, then we must also switch from using HTTPS to HTTP to communicate with the gRPC service. </span><span class="koboSpan" id="kobo.1632.3" xmlns="http://www.w3.org/1999/xhtml">In this task, we will continue to use the “full fat” builder so we can continue to use HTTPS.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.1633.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1634.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1635.1" xmlns="http://www.w3.org/1999/xhtml"> project file, add an element to emit compiler-generated files, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1636.1" xmlns="http://www.w3.org/1999/xhtml">&lt;PropertyGroup&gt;
  &lt;TargetFramework&gt;net8</span><span class="hljs-number"><span class="koboSpan" id="kobo.1637.1" xmlns="http://www.w3.org/1999/xhtml">.0</span></span><span class="koboSpan" id="kobo.1638.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/TargetFramework&gt;
  ...
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1639.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;EmitCompilerGeneratedFiles&gt;</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1640.1" xmlns="http://www.w3.org/1999/xhtml">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1641.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/EmitCompilerGeneratedFiles&gt;</span></strong></span><span class="koboSpan" id="kobo.1642.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/PropertyGroup&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1643.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1644.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1645.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1646.1" xmlns="http://www.w3.org/1999/xhtml">If you are using Visual Studio 2022, toggle </span><strong class="screenText"><span class="koboSpan" id="kobo.1647.1" xmlns="http://www.w3.org/1999/xhtml">Show All Files</span></strong><span class="koboSpan" id="kobo.1648.1" xmlns="http://www.w3.org/1999/xhtml"> in </span><strong class="screenText"><span class="koboSpan" id="kobo.1649.1" xmlns="http://www.w3.org/1999/xhtml">Solution Explorer</span></strong><span class="koboSpan" id="kobo.1650.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1650.2" xmlns="http://www.w3.org/1999/xhtml">If you are using JetBrains Rider, hover over and then click the eyeball icon.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1651.1" xmlns="http://www.w3.org/1999/xhtml">Expand the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1652.1" xmlns="http://www.w3.org/1999/xhtml">obj\Debug\net8.0\generated</span></code><span class="koboSpan" id="kobo.1653.1" xmlns="http://www.w3.org/1999/xhtml"> folder, and then note the folders and files that have been</span><a id="_idIndexMarker1454"/><span class="koboSpan" id="kobo.1654.1" xmlns="http://www.w3.org/1999/xhtml"> created by the source generators for AOT and JSON serialization, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1655.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.6</span></em><span class="koboSpan" id="kobo.1656.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1657.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1658.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.6: Folders and files created by source generators in an AOT gRPC project</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.1659.1" xmlns="http://www.w3.org/1999/xhtml">At the command</span><a id="_idIndexMarker1455"/><span class="koboSpan" id="kobo.1660.1" xmlns="http://www.w3.org/1999/xhtml"> prompt or terminal, publish the gRPC service using native AOT, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1661.1" xmlns="http://www.w3.org/1999/xhtml">dotnet publish
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1662.1" xmlns="http://www.w3.org/1999/xhtml">Note the message about generating native code and trim warnings for packages like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1663.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient</span></code><span class="koboSpan" id="kobo.1664.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following partial output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1665.1" xmlns="http://www.w3.org/1999/xhtml">Generating native code
...
</span><span class="koboSpan" id="kobo.1665.2" xmlns="http://www.w3.org/1999/xhtml">C:\Users\markj\.nuget\packages\microsoft.data.sqlclient\5.1.1\runtimes\win\lib\net6.0\Microsoft.Data.SqlClient.dll : warning IL2104: Assembly 'Microsoft
.Data.SqlClient' produced trim warnings. </span><span class="koboSpan" id="kobo.1665.3" xmlns="http://www.w3.org/1999/xhtml">For more information see https://aka.ms/dotnet-illink/libraries [C:\apps-services-net8\Chapter13\Northwind.Grpc.Service\Northwind.Grpc.Service.csproj]
...
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1666.1" xmlns="http://www.w3.org/1999/xhtml">Start </span><strong class="screenText"><span class="koboSpan" id="kobo.1667.1" xmlns="http://www.w3.org/1999/xhtml">File Explorer</span></strong><span class="koboSpan" id="kobo.1668.1" xmlns="http://www.w3.org/1999/xhtml"> and open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1669.1" xmlns="http://www.w3.org/1999/xhtml">bin\Release\net8.0\win-x64\publish</span></code><span class="koboSpan" id="kobo.1670.1" xmlns="http://www.w3.org/1999/xhtml"> folder and note the EXE file is about 45 MB. </span><span class="koboSpan" id="kobo.1670.2" xmlns="http://www.w3.org/1999/xhtml">This and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1671.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft.Data.SqlClient.SNI.dll</span></code><span class="koboSpan" id="kobo.1672.1" xmlns="http://www.w3.org/1999/xhtml"> file are the only files that need to be deployed onto another Windows computer for the web service to work. </span><span class="koboSpan" id="kobo.1672.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1673.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.json</span></code><span class="koboSpan" id="kobo.1674.1" xmlns="http://www.w3.org/1999/xhtml"> files are only needed to override configuration if needed. </span><span class="koboSpan" id="kobo.1674.2" xmlns="http://www.w3.org/1999/xhtml">The PDB files are only needed if debugging and, anyway, two of them are only because we left the EF Core code in the project for reference to make it easier to switch back to</span><a id="_idIndexMarker1456"/><span class="koboSpan" id="kobo.1675.1" xmlns="http://www.w3.org/1999/xhtml"> non-AOT publishing.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1676.1" xmlns="http://www.w3.org/1999/xhtml">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1677.1" xmlns="http://www.w3.org/1999/xhtml">bin\Release\net8.0\win-x64\publish</span></code><span class="koboSpan" id="kobo.1678.1" xmlns="http://www.w3.org/1999/xhtml"> folder at the command prompt or </span><a id="_idIndexMarker1457"/><span class="koboSpan" id="kobo.1679.1" xmlns="http://www.w3.org/1999/xhtml">terminal.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1680.1" xmlns="http://www.w3.org/1999/xhtml">At the command prompt or terminal, run </span><code class="inlineCode"><span class="koboSpan" id="kobo.1681.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service.exe</span></code><span class="koboSpan" id="kobo.1682.1" xmlns="http://www.w3.org/1999/xhtml"> and explicitly specify the URL with the port number to use, as shown in the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1683.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service.exe --urls "https://localhost:5131"
</span></code></pre>
</li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1684.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1685.1" xmlns="http://www.w3.org/1999/xhtml">launchSettings.json</span></code><span class="koboSpan" id="kobo.1686.1" xmlns="http://www.w3.org/1999/xhtml"> file is only used by code editors like Visual Studio 2022 so the ports specified there are ignored and not deployed with the service in production.</span></p>
</div>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="15"><span class="koboSpan" id="kobo.1687.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1688.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1689.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1690.1" xmlns="http://www.w3.org/1999/xhtml">Note the web page shows the shipper with an ID of 1 and that you can search for the other shippers.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1691.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1692.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.1693.1" xmlns="http://www.w3.org/1999/xhtml">: You can learn more about gRPC and native AOT at the following link: </span><a href="https://learn.microsoft.com/en-us/aspnet/core/grpc/native-aot"><span class="url"><span class="koboSpan" id="kobo.1694.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/grpc/native-aot</span></span></a><span class="koboSpan" id="kobo.1695.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-492"><span class="koboSpan" id="kobo.1696.1" xmlns="http://www.w3.org/1999/xhtml">Getting request and response metadata</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1697.1" xmlns="http://www.w3.org/1999/xhtml">Formally defined request and response messages as part of a contract are not the only mechanisms to pass data between a client and service using gRPC. </span><span class="koboSpan" id="kobo.1697.2" xmlns="http://www.w3.org/1999/xhtml">You can also use metadata sent as headers and trailers. </span><span class="koboSpan" id="kobo.1697.3" xmlns="http://www.w3.org/1999/xhtml">Both are simple dictionaries that are passed along with the messages.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1698.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see how you can </span><a id="_idIndexMarker1458"/><span class="koboSpan" id="kobo.1699.1" xmlns="http://www.w3.org/1999/xhtml">get metadata about a gRPC call:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1700.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1701.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1702.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1703.1" xmlns="http://www.w3.org/1999/xhtml">Controllers</span></code><span class="koboSpan" id="kobo.1704.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1705.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1706.1" xmlns="http://www.w3.org/1999/xhtml">, import the namespace to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1707.1" xmlns="http://www.w3.org/1999/xhtml">AsyncUnaryCall&lt;T&gt;</span></code><span class="koboSpan" id="kobo.1708.1" xmlns="http://www.w3.org/1999/xhtml"> class, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1709.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.1710.1" xmlns="http://www.w3.org/1999/xhtml"> Grpc.Core; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1711.1" xmlns="http://www.w3.org/1999/xhtml">// To use AsyncUnaryCall&lt;T&gt;.</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1712.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1713.1" xmlns="http://www.w3.org/1999/xhtml">Index</span></code><span class="koboSpan" id="kobo.1714.1" xmlns="http://www.w3.org/1999/xhtml"> method, comment out the statement that makes the call to the gRPC shipper service. </span><span class="koboSpan" id="kobo.1714.2" xmlns="http://www.w3.org/1999/xhtml">Add statements that get the underlying </span><code class="inlineCode"><span class="koboSpan" id="kobo.1715.1" xmlns="http://www.w3.org/1999/xhtml">AsyncUnaryCall&lt;T&gt;</span></code><span class="koboSpan" id="kobo.1716.1" xmlns="http://www.w3.org/1999/xhtml"> object, then use it to get the headers, output them to the log, and then get the response, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1717.1" xmlns="http://www.w3.org/1999/xhtml">//</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1718.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperReply shipperReply = await _shipperClient.GetShipperAsync(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1719.1" xmlns="http://www.w3.org/1999/xhtml">//</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1720.1" xmlns="http://www.w3.org/1999/xhtml">   new ShipperRequest { ShipperId = id });</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1721.1" xmlns="http://www.w3.org/1999/xhtml">// The same call as above but not awaited.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1722.1" xmlns="http://www.w3.org/1999/xhtml">AsyncUnaryCall&lt;ShipperReply&gt; shipperCall = _shipperClient.GetShipperAsync(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1723.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1724.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperRequest { ShipperId = id });</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1725.1" xmlns="http://www.w3.org/1999/xhtml">Metadata metadata = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1726.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1727.1" xmlns="http://www.w3.org/1999/xhtml"> shipperCall.ResponseHeadersAsync;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1728.1" xmlns="http://www.w3.org/1999/xhtml">foreach</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1729.1" xmlns="http://www.w3.org/1999/xhtml"> (Metadata.Entry entry </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1730.1" xmlns="http://www.w3.org/1999/xhtml">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1731.1" xmlns="http://www.w3.org/1999/xhtml"> metadata)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1732.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1733.1" xmlns="http://www.w3.org/1999/xhtml">// Not really critical, just doing this to make it easier to see.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1734.1" xmlns="http://www.w3.org/1999/xhtml">  _logger.LogCritical(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1735.1" xmlns="http://www.w3.org/1999/xhtml">$"Key: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1736.1" xmlns="http://www.w3.org/1999/xhtml">{entry.Key}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1737.1" xmlns="http://www.w3.org/1999/xhtml">, Value: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1738.1" xmlns="http://www.w3.org/1999/xhtml">{entry.Value}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1739.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1740.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1741.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1742.1" xmlns="http://www.w3.org/1999/xhtml">ShipperReply shipperReply = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1743.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1744.1" xmlns="http://www.w3.org/1999/xhtml"> shipperCall.ResponseAsync;</span></strong></span><span class="koboSpan" id="kobo.1745.1" xmlns="http://www.w3.org/1999/xhtml">
ViewData[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1746.1" xmlns="http://www.w3.org/1999/xhtml">"shipper"</span></span><span class="koboSpan" id="kobo.1747.1" xmlns="http://www.w3.org/1999/xhtml">] = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1748.1" xmlns="http://www.w3.org/1999/xhtml">"Shipper from gRPC service: "</span></span><span class="koboSpan" id="kobo.1749.1" xmlns="http://www.w3.org/1999/xhtml"> + 
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.1750.1" xmlns="http://www.w3.org/1999/xhtml">$"ID: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1751.1" xmlns="http://www.w3.org/1999/xhtml">{shipperReply.ShipperId}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1752.1" xmlns="http://www.w3.org/1999/xhtml">, Name: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1753.1" xmlns="http://www.w3.org/1999/xhtml">{shipperReply.CompanyName}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1754.1" xmlns="http://www.w3.org/1999/xhtml">,"</span></span><span class="koboSpan" id="kobo.1755.1" xmlns="http://www.w3.org/1999/xhtml">
  + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1756.1" xmlns="http://www.w3.org/1999/xhtml">$" Phone: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1757.1" xmlns="http://www.w3.org/1999/xhtml">{shipperReply.Phone}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1758.1" xmlns="http://www.w3.org/1999/xhtml">."</span></span><span class="koboSpan" id="kobo.1759.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1760.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1761.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1762.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1763.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1764.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1765.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1766.1" xmlns="http://www.w3.org/1999/xhtml">If necessary, start a browser and navigate to the home page: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1767.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5133/</span></code><span class="koboSpan" id="kobo.1768.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1769.1" xmlns="http://www.w3.org/1999/xhtml">Note the client successfully making </span><code class="inlineCode"><span class="koboSpan" id="kobo.1770.1" xmlns="http://www.w3.org/1999/xhtml">POST</span></code><span class="koboSpan" id="kobo.1771.1" xmlns="http://www.w3.org/1999/xhtml"> requests to the gRPC </span><code class="inlineCode"><span class="koboSpan" id="kobo.1772.1" xmlns="http://www.w3.org/1999/xhtml">Greeter</span></code><span class="koboSpan" id="kobo.1773.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1774.1" xmlns="http://www.w3.org/1999/xhtml">Shipper</span></code><span class="koboSpan" id="kobo.1775.1" xmlns="http://www.w3.org/1999/xhtml"> services</span><a id="_idIndexMarker1459"/><span class="koboSpan" id="kobo.1776.1" xmlns="http://www.w3.org/1999/xhtml"> and the red critical messages outputting the two entries in the gRPC metadata for the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1777.1" xmlns="http://www.w3.org/1999/xhtml">GetShipper</span></code><span class="koboSpan" id="kobo.1778.1" xmlns="http://www.w3.org/1999/xhtml">, with keys of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1779.1" xmlns="http://www.w3.org/1999/xhtml">date</span></code><span class="koboSpan" id="kobo.1780.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1781.1" xmlns="http://www.w3.org/1999/xhtml">server</span></code><span class="koboSpan" id="kobo.1782.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1783.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.7</span></em><span class="koboSpan" id="kobo.1784.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1785.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1786.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.7: Logging metadata from a gRPC call</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.1787.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1788.1" xmlns="http://www.w3.org/1999/xhtml">The trailers equivalent of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1789.1" xmlns="http://www.w3.org/1999/xhtml">ResponseHeadersAsync</span></code><span class="koboSpan" id="kobo.1790.1" xmlns="http://www.w3.org/1999/xhtml"> property is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1791.1" xmlns="http://www.w3.org/1999/xhtml">GetTrailers</span></code><span class="koboSpan" id="kobo.1792.1" xmlns="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.1792.2" xmlns="http://www.w3.org/1999/xhtml">It has a return value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1793.1" xmlns="http://www.w3.org/1999/xhtml">Metadata</span></code><span class="koboSpan" id="kobo.1794.1" xmlns="http://www.w3.org/1999/xhtml"> that contains the dictionary of trailers. </span><span class="koboSpan" id="kobo.1794.2" xmlns="http://www.w3.org/1999/xhtml">Trailers are accessible at the end of a call.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-493"><span class="koboSpan" id="kobo.1795.1" xmlns="http://www.w3.org/1999/xhtml">Adding a deadline for higher reliability</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1796.1" xmlns="http://www.w3.org/1999/xhtml">Setting a deadline for a gRPC call is</span><a id="_idIndexMarker1460"/><span class="koboSpan" id="kobo.1797.1" xmlns="http://www.w3.org/1999/xhtml"> recommended practice because it controls the upper limit of how long a gRPC call can run. </span><span class="koboSpan" id="kobo.1797.2" xmlns="http://www.w3.org/1999/xhtml">It prevents gRPC services from potentially consuming too many server resources.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1798.1" xmlns="http://www.w3.org/1999/xhtml">The deadline information is sent to the service, so the service has an opportunity to give up its work once the deadline has passed instead of continuing forever. </span><span class="koboSpan" id="kobo.1798.2" xmlns="http://www.w3.org/1999/xhtml">Even if the server completes its work within the deadline, the client may give up before the response arrives at the client because the deadline has passed due to the overhead of communication.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1799.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see an example:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1800.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1801.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1802.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1803.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.1804.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1805.1" xmlns="http://www.w3.org/1999/xhtml">ShipperService.cs</span></code><span class="koboSpan" id="kobo.1806.1" xmlns="http://www.w3.org/1999/xhtml">, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1807.1" xmlns="http://www.w3.org/1999/xhtml">GetShipper</span></code><span class="koboSpan" id="kobo.1808.1" xmlns="http://www.w3.org/1999/xhtml"> method, add statements to log the deadline and to pause for five seconds, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1809.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1810.1" xmlns="http://www.w3.org/1999/xhtml">override</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1811.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1812.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;ShipperReply&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1813.1" xmlns="http://www.w3.org/1999/xhtml">GetShipper</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1814.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1815.1" xmlns="http://www.w3.org/1999/xhtml">  ShipperRequest request, ServerCallContext context</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1816.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.1817.1" xmlns="http://www.w3.org/1999/xhtml">
{
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1818.1" xmlns="http://www.w3.org/1999/xhtml">  _logger.LogCritical(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1819.1" xmlns="http://www.w3.org/1999/xhtml">$"This request has a deadline of </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1820.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1821.1" xmlns="http://www.w3.org/1999/xhtml">    context.Deadline:T}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1822.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1822.2" xmlns="http://www.w3.org/1999/xhtml">It is now </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1823.1" xmlns="http://www.w3.org/1999/xhtml">{DateTime.UtcNow:T}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1824.1" xmlns="http://www.w3.org/1999/xhtml">."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1825.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1826.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1827.1" xmlns="http://www.w3.org/1999/xhtml"> Task.Delay(TimeSpan.FromSeconds(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1828.1" xmlns="http://www.w3.org/1999/xhtml">5</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1829.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span><span class="koboSpan" id="kobo.1830.1" xmlns="http://www.w3.org/1999/xhtml">
  ...
</span><span class="koboSpan" id="kobo.1830.2" xmlns="http://www.w3.org/1999/xhtml">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1831.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1832.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1833.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1834.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Development.json</span></code><span class="koboSpan" id="kobo.1835.1" xmlns="http://www.w3.org/1999/xhtml">, modify the logging level for ASP.NET Core from the default of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1836.1" xmlns="http://www.w3.org/1999/xhtml">Warning</span></code><span class="koboSpan" id="kobo.1837.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1838.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></code><span class="koboSpan" id="kobo.1839.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1840.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1841.1" xmlns="http://www.w3.org/1999/xhtml">"Logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1842.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1843.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1844.1" xmlns="http://www.w3.org/1999/xhtml">"LogLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1845.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1846.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1847.1" xmlns="http://www.w3.org/1999/xhtml">"Default"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1848.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1849.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1850.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1851.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1852.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1853.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1854.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1855.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1856.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1857.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1858.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1859.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1860.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1861.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1862.1" xmlns="http://www.w3.org/1999/xhtml">Controllers</span></code><span class="koboSpan" id="kobo.1863.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1864.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1865.1" xmlns="http://www.w3.org/1999/xhtml">, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1866.1" xmlns="http://www.w3.org/1999/xhtml">Index</span></code><span class="koboSpan" id="kobo.1867.1" xmlns="http://www.w3.org/1999/xhtml"> method, set a deadline of three seconds when calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1868.1" xmlns="http://www.w3.org/1999/xhtml">GetShipperAsync</span></code><span class="koboSpan" id="kobo.1869.1" xmlns="http://www.w3.org/1999/xhtml"> method, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1870.1" xmlns="http://www.w3.org/1999/xhtml">AsyncUnaryCall&lt;ShipperReply&gt; shipperCall = shipperClient.GetShipperAsync(
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1871.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.1872.1" xmlns="http://www.w3.org/1999/xhtml"> ShipperRequest { ShipperId = id }</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1873.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1874.1" xmlns="http://www.w3.org/1999/xhtml">// Deadline must be a UTC DateTime.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1875.1" xmlns="http://www.w3.org/1999/xhtml">deadline: DateTime.UtcNow.AddSeconds(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1876.1" xmlns="http://www.w3.org/1999/xhtml">3</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1877.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong></span><span class="koboSpan" id="kobo.1878.1" xmlns="http://www.w3.org/1999/xhtml">);
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1879.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1880.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.1881.1" xmlns="http://www.w3.org/1999/xhtml">, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1882.1" xmlns="http://www.w3.org/1999/xhtml">Index</span></code><span class="koboSpan" id="kobo.1883.1" xmlns="http://www.w3.org/1999/xhtml"> method, before the existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.1884.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></code><span class="koboSpan" id="kobo.1885.1" xmlns="http://www.w3.org/1999/xhtml"> block, add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1886.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></code><span class="koboSpan" id="kobo.1887.1" xmlns="http://www.w3.org/1999/xhtml"> block</span><a id="_idIndexMarker1461"/><span class="koboSpan" id="kobo.1888.1" xmlns="http://www.w3.org/1999/xhtml"> for an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1889.1" xmlns="http://www.w3.org/1999/xhtml">RpcException</span></code><span class="koboSpan" id="kobo.1890.1" xmlns="http://www.w3.org/1999/xhtml"> when the exception’s status code matches the code for deadline exceeded, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1891.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1892.1" xmlns="http://www.w3.org/1999/xhtml"> (RpcException rpcex) </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1893.1" xmlns="http://www.w3.org/1999/xhtml">when</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1894.1" xmlns="http://www.w3.org/1999/xhtml"> (rpcex.StatusCode == </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1895.1" xmlns="http://www.w3.org/1999/xhtml">global</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1896.1" xmlns="http://www.w3.org/1999/xhtml">::Grpc.Core.StatusCode.DeadlineExceeded)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1897.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1898.1" xmlns="http://www.w3.org/1999/xhtml">  _logger.LogWarning(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1899.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Service deadline exceeded."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1900.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1901.1" xmlns="http://www.w3.org/1999/xhtml">  model.ErrorMessage = rpcex.Message;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1902.1" xmlns="http://www.w3.org/1999/xhtml">}</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1903.1" xmlns="http://www.w3.org/1999/xhtml">catch</span></span><span class="koboSpan" id="kobo.1904.1" xmlns="http://www.w3.org/1999/xhtml"> (Exception ex)
{
  _logger.LogWarning(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1905.1" xmlns="http://www.w3.org/1999/xhtml">$"Northwind.Grpc.Service is not responding."</span></span><span class="koboSpan" id="kobo.1906.1" xmlns="http://www.w3.org/1999/xhtml">);
  model.ErrorMessage = ex.Message;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1907.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1908.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1909.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1910.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.Development.json</span></code><span class="koboSpan" id="kobo.1911.1" xmlns="http://www.w3.org/1999/xhtml">, modify the logging level for ASP.NET Core from the default of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1912.1" xmlns="http://www.w3.org/1999/xhtml">Warning</span></code><span class="koboSpan" id="kobo.1913.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1914.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></code><span class="koboSpan" id="kobo.1915.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following configuration:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1916.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1917.1" xmlns="http://www.w3.org/1999/xhtml">"Logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1918.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1919.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1920.1" xmlns="http://www.w3.org/1999/xhtml">"LogLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1921.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1922.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1923.1" xmlns="http://www.w3.org/1999/xhtml">"Default"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1924.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1925.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1926.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1927.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1928.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1929.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1930.1" xmlns="http://www.w3.org/1999/xhtml">Information</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1931.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1932.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1933.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1934.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1935.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1936.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.1937.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1938.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1939.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.1940.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1941.1" xmlns="http://www.w3.org/1999/xhtml">If necessary, start a browser and navigate to the home page: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1942.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5133/</span></code><span class="koboSpan" id="kobo.1943.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1944.1" xmlns="http://www.w3.org/1999/xhtml">At the command </span><a id="_idIndexMarker1462"/><span class="koboSpan" id="kobo.1945.1" xmlns="http://www.w3.org/1999/xhtml">prompt or terminal for the gRPC service, note the request has a three-second deadline, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1946.1" xmlns="http://www.w3.org/1999/xhtml">crit: Northwind.Grpc.Service.Services.ShipperService[0]
      This request has a deadline of 14:56:30. </span><span class="koboSpan" id="kobo.1946.2" xmlns="http://www.w3.org/1999/xhtml">It is now 14:56:27.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1947.1" xmlns="http://www.w3.org/1999/xhtml">In the browser, note that after three seconds, the home page shows a deadline exceeded exception, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1948.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.8</span></em><span class="koboSpan" id="kobo.1949.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1950.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1951.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.8: A deadline has been exceeded</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="11"><span class="koboSpan" id="kobo.1952.1" xmlns="http://www.w3.org/1999/xhtml">At the command prompt or terminal for the ASP.NET Core MVC client, note the logs that start at the</span><a id="_idIndexMarker1463"/><span class="koboSpan" id="kobo.1953.1" xmlns="http://www.w3.org/1999/xhtml"> point where a request is made to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1954.1" xmlns="http://www.w3.org/1999/xhtml">GetShipper</span></code><span class="koboSpan" id="kobo.1955.1" xmlns="http://www.w3.org/1999/xhtml"> method on the gRPC service, but the deadline is exceeded, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1956.1" xmlns="http://www.w3.org/1999/xhtml">info: System.Net.Http.HttpClient.Shipper.LogicalHandler[100]
      Start processing HTTP request POST https://localhost:5131/shipper.Shipper/GetShipper
info: System.Net.Http.HttpClient.Shipper.ClientHandler[100]
      Sending HTTP request POST https://localhost:5131/shipper.Shipper/GetShipper
warn: Grpc.Net.Client.Internal.GrpcCall[7]
      gRPC call deadline exceeded.
</span><span class="koboSpan" id="kobo.1956.2" xmlns="http://www.w3.org/1999/xhtml">info: Grpc.Net.Client.Internal.GrpcCall[3]
      Call failed with gRPC error status. </span><span class="koboSpan" id="kobo.1956.3" xmlns="http://www.w3.org/1999/xhtml">Status code: 'DeadlineExceeded', Message: ''.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1957.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1958.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.1959.1" xmlns="http://www.w3.org/1999/xhtml">ShipperService.cs</span></code><span class="koboSpan" id="kobo.1960.1" xmlns="http://www.w3.org/1999/xhtml">, comment out the statement that causes a five-second delay, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1961.1" xmlns="http://www.w3.org/1999/xhtml">//</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1962.1" xmlns="http://www.w3.org/1999/xhtml"> await Task.Delay(TimeSpan.FromSeconds(5));</span></span>
</code></pre>
</li>
</ol>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1963.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.1964.1" xmlns="http://www.w3.org/1999/xhtml">: The default is no deadline. </span><span class="koboSpan" id="kobo.1964.2" xmlns="http://www.w3.org/1999/xhtml">Always set a deadline in the client call. </span><span class="koboSpan" id="kobo.1964.3" xmlns="http://www.w3.org/1999/xhtml">In your service implementation, get the deadline and use it to automatically abandon the work if it is exceeded. </span><span class="koboSpan" id="kobo.1964.4" xmlns="http://www.w3.org/1999/xhtml">Pass the cancellation token to any asynchronous calls so that work completes quickly on the server and frees up resources.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-494"><span class="koboSpan" id="kobo.1965.1" xmlns="http://www.w3.org/1999/xhtml">Handling dates, times, and decimal numbers</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1966.1" xmlns="http://www.w3.org/1999/xhtml">You might have noted that there</span><a id="_idIndexMarker1464"/><span class="koboSpan" id="kobo.1967.1" xmlns="http://www.w3.org/1999/xhtml"> are no date/time types built into gRPC. </span><span class="koboSpan" id="kobo.1967.2" xmlns="http://www.w3.org/1999/xhtml">To store these values, you must use well-known type extensions, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1968.1" xmlns="http://www.w3.org/1999/xhtml">google.protobuf.Timestamp</span></code><span class="koboSpan" id="kobo.1969.1" xmlns="http://www.w3.org/1999/xhtml"> (equivalent to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1970.1" xmlns="http://www.w3.org/1999/xhtml">DateTimeOffset</span></code><span class="koboSpan" id="kobo.1971.1" xmlns="http://www.w3.org/1999/xhtml">) and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1972.1" xmlns="http://www.w3.org/1999/xhtml">google.protobuf.Duration</span></code><span class="koboSpan" id="kobo.1973.1" xmlns="http://www.w3.org/1999/xhtml"> (equivalent to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1974.1" xmlns="http://www.w3.org/1999/xhtml">TimeSpan</span></code><span class="koboSpan" id="kobo.1975.1" xmlns="http://www.w3.org/1999/xhtml">).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1976.1" xmlns="http://www.w3.org/1999/xhtml">To use them as field types in a message, they must be imported, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1977.1" xmlns="http://www.w3.org/1999/xhtml">syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1978.1" xmlns="http://www.w3.org/1999/xhtml">"proto3"</span></span><span class="koboSpan" id="kobo.1979.1" xmlns="http://www.w3.org/1999/xhtml">;
import </span><span class="hljs-string"><span class="koboSpan" id="kobo.1980.1" xmlns="http://www.w3.org/1999/xhtml">"google/protobuf/duration.proto"</span></span><span class="koboSpan" id="kobo.1981.1" xmlns="http://www.w3.org/1999/xhtml">;  
import </span><span class="hljs-string"><span class="koboSpan" id="kobo.1982.1" xmlns="http://www.w3.org/1999/xhtml">"google/protobuf/timestamp.proto"</span></span><span class="koboSpan" id="kobo.1983.1" xmlns="http://www.w3.org/1999/xhtml">;
message Employee {
  int32 employeeId = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1984.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.1985.1" xmlns="http://www.w3.org/1999/xhtml">;
  google.protobuf.Timestamp birth_date = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1986.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.1987.1" xmlns="http://www.w3.org/1999/xhtml">;
  google.protobuf.Duration earned_vacation_time = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1988.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.1989.1" xmlns="http://www.w3.org/1999/xhtml">;
  ...
</span><span class="koboSpan" id="kobo.1989.2" xmlns="http://www.w3.org/1999/xhtml">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1990.1" xmlns="http://www.w3.org/1999/xhtml">The class generated will not use .NET types directly. </span><span class="koboSpan" id="kobo.1990.2" xmlns="http://www.w3.org/1999/xhtml">Instead, there are intermediate types, as shown in the </span><a id="_idIndexMarker1465"/><span class="koboSpan" id="kobo.1991.1" xmlns="http://www.w3.org/1999/xhtml">following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1992.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1993.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1994.1" xmlns="http://www.w3.org/1999/xhtml">Employee</span></span><span class="koboSpan" id="kobo.1995.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1996.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1997.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.1998.1" xmlns="http://www.w3.org/1999/xhtml"> EmployeeId;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1999.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="koboSpan" id="kobo.2000.1" xmlns="http://www.w3.org/1999/xhtml"> Timestamp BirthDate;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2001.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="koboSpan" id="kobo.2002.1" xmlns="http://www.w3.org/1999/xhtml"> Duration EarnedVacationTime;
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2003.1" xmlns="http://www.w3.org/1999/xhtml">There are conversion methods on the types </span><code class="inlineCode"><span class="koboSpan" id="kobo.2004.1" xmlns="http://www.w3.org/1999/xhtml">FromDateTimeOffset</span></code><span class="koboSpan" id="kobo.2005.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2006.1" xmlns="http://www.w3.org/1999/xhtml">ToDateTimeOffset</span></code><span class="koboSpan" id="kobo.2007.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2008.1" xmlns="http://www.w3.org/1999/xhtml">FromTimeSpan</span></code><span class="koboSpan" id="kobo.2009.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2010.1" xmlns="http://www.w3.org/1999/xhtml">ToTimeSpan</span></code><span class="koboSpan" id="kobo.2011.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2012.1" xmlns="http://www.w3.org/1999/xhtml">Employee employee = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2013.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2014.1" xmlns="http://www.w3.org/1999/xhtml">()
{
  EmployeeId = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2015.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2016.1" xmlns="http://www.w3.org/1999/xhtml">,
  BirthDate = Timestamp.FromDateTimeOffset(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2017.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2018.1" xmlns="http://www.w3.org/1999/xhtml"> DateTimeOffset(
    year: </span><span class="hljs-number"><span class="koboSpan" id="kobo.2019.1" xmlns="http://www.w3.org/1999/xhtml">1998</span></span><span class="koboSpan" id="kobo.2020.1" xmlns="http://www.w3.org/1999/xhtml">, month: </span><span class="hljs-number"><span class="koboSpan" id="kobo.2021.1" xmlns="http://www.w3.org/1999/xhtml">11</span></span><span class="koboSpan" id="kobo.2022.1" xmlns="http://www.w3.org/1999/xhtml">, day: </span><span class="hljs-number"><span class="koboSpan" id="kobo.2023.1" xmlns="http://www.w3.org/1999/xhtml">30</span></span><span class="koboSpan" id="kobo.2024.1" xmlns="http://www.w3.org/1999/xhtml">, hour: </span><span class="hljs-number"><span class="koboSpan" id="kobo.2025.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.2026.1" xmlns="http://www.w3.org/1999/xhtml">, minute: </span><span class="hljs-number"><span class="koboSpan" id="kobo.2027.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.2028.1" xmlns="http://www.w3.org/1999/xhtml">, second: </span><span class="hljs-number"><span class="koboSpan" id="kobo.2029.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="koboSpan" id="kobo.2030.1" xmlns="http://www.w3.org/1999/xhtml">,
    offset: TimeSpan.FromHours(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2031.1" xmlns="http://www.w3.org/1999/xhtml">-5</span></span><span class="koboSpan" id="kobo.2032.1" xmlns="http://www.w3.org/1999/xhtml">)),
  EarnedVacationTime = Duration.FromTimeSpan(TimeSpan.FromDays(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2033.1" xmlns="http://www.w3.org/1999/xhtml">15</span></span><span class="koboSpan" id="kobo.2034.1" xmlns="http://www.w3.org/1999/xhtml">))
};
DateTimeOffset </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2035.1" xmlns="http://www.w3.org/1999/xhtml">when</span></span><span class="koboSpan" id="kobo.2036.1" xmlns="http://www.w3.org/1999/xhtml"> = employee.BirthDate.ToDateTimeOffset();
TimeSpan daysoff = employee.EarnedVacationTime.ToTimeSpan();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2037.1" xmlns="http://www.w3.org/1999/xhtml">gRPC also does not natively support </span><code class="inlineCode"><span class="koboSpan" id="kobo.2038.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.2039.1" xmlns="http://www.w3.org/1999/xhtml"> values. </span><span class="koboSpan" id="kobo.2039.2" xmlns="http://www.w3.org/1999/xhtml">In the future, that support might be added, but for now, you must create a custom message to represent it. </span><span class="koboSpan" id="kobo.2039.3" xmlns="http://www.w3.org/1999/xhtml">If you choose to do this, then keep in mind that developers on other platforms will have to understand your custom format and implement their own handling for it.</span></p>
<h2 class="heading-2" id="_idParaDest-495"><span class="koboSpan" id="kobo.2040.1" xmlns="http://www.w3.org/1999/xhtml">Defining a custom decimal type and using date/time types</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2041.1" xmlns="http://www.w3.org/1999/xhtml">Let’s add gRPC services for working with </span><a id="_idIndexMarker1466"/><span class="koboSpan" id="kobo.2042.1" xmlns="http://www.w3.org/1999/xhtml">products (which have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2043.1" xmlns="http://www.w3.org/1999/xhtml">UnitPrice</span></code><span class="koboSpan" id="kobo.2044.1" xmlns="http://www.w3.org/1999/xhtml"> property</span><a id="_idIndexMarker1467"/><span class="koboSpan" id="kobo.2045.1" xmlns="http://www.w3.org/1999/xhtml"> that is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2046.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.2047.1" xmlns="http://www.w3.org/1999/xhtml">) and employees (which have </span><code class="inlineCode"><span class="koboSpan" id="kobo.2048.1" xmlns="http://www.w3.org/1999/xhtml">HireDate</span></code><span class="koboSpan" id="kobo.2049.1" xmlns="http://www.w3.org/1999/xhtml"> properties that are </span><code class="inlineCode"><span class="koboSpan" id="kobo.2050.1" xmlns="http://www.w3.org/1999/xhtml">DateTime</span></code><span class="koboSpan" id="kobo.2051.1" xmlns="http://www.w3.org/1999/xhtml"> values):</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2052.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2053.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.2054.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2055.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.2056.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2057.1" xmlns="http://www.w3.org/1999/xhtml">decimal.proto</span></code><span class="koboSpan" id="kobo.2058.1" xmlns="http://www.w3.org/1999/xhtml">, and add statements to define a message format for safely storing a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2059.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.2060.1" xmlns="http://www.w3.org/1999/xhtml"> value, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2061.1" xmlns="http://www.w3.org/1999/xhtml">syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2062.1" xmlns="http://www.w3.org/1999/xhtml">"proto3"</span></span><span class="koboSpan" id="kobo.2063.1" xmlns="http://www.w3.org/1999/xhtml">;
option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2064.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Service"</span></span><span class="koboSpan" id="kobo.2065.1" xmlns="http://www.w3.org/1999/xhtml">;
package </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2066.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2067.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2068.1" xmlns="http://www.w3.org/1999/xhtml">// Example: 12345.6789 -&gt; { units = 12345, nanos = 678900000 }</span></span><span class="koboSpan" id="kobo.2069.1" xmlns="http://www.w3.org/1999/xhtml">
message DecimalValue {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2070.1" xmlns="http://www.w3.org/1999/xhtml">// To store the whole units part of the amount.</span></span><span class="koboSpan" id="kobo.2071.1" xmlns="http://www.w3.org/1999/xhtml">
    int64 units = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2072.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2073.1" xmlns="http://www.w3.org/1999/xhtml">;
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2074.1" xmlns="http://www.w3.org/1999/xhtml">// To store the nano units of the amount (10^-9).</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2075.1" xmlns="http://www.w3.org/1999/xhtml">// Must be same sign as units.</span></span><span class="koboSpan" id="kobo.2076.1" xmlns="http://www.w3.org/1999/xhtml">
    sfixed32 nanos = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2077.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.2078.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2079.1" xmlns="http://www.w3.org/1999/xhtml">Add a new file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2080.1" xmlns="http://www.w3.org/1999/xhtml">product.proto</span></code><span class="koboSpan" id="kobo.2081.1" xmlns="http://www.w3.org/1999/xhtml">, and add statements to define messages and service methods to get one product, all products, or products that cost a minimum price, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2082.1" xmlns="http://www.w3.org/1999/xhtml">syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2083.1" xmlns="http://www.w3.org/1999/xhtml">"proto3"</span></span><span class="koboSpan" id="kobo.2084.1" xmlns="http://www.w3.org/1999/xhtml">;
option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2085.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Service"</span></span><span class="koboSpan" id="kobo.2086.1" xmlns="http://www.w3.org/1999/xhtml">;
import </span><span class="hljs-string"><span class="koboSpan" id="kobo.2087.1" xmlns="http://www.w3.org/1999/xhtml">"Protos/decimal.proto"</span></span><span class="koboSpan" id="kobo.2088.1" xmlns="http://www.w3.org/1999/xhtml">;
package product;
service Product {
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.2089.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2090.1" xmlns="http://www.w3.org/1999/xhtml">GetProduct</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2091.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2092.1" xmlns="http://www.w3.org/1999/xhtml">ProductRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2093.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2094.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2095.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2096.1" xmlns="http://www.w3.org/1999/xhtml">ProductReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2097.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2098.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.2099.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2100.1" xmlns="http://www.w3.org/1999/xhtml">GetProducts</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2101.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2102.1" xmlns="http://www.w3.org/1999/xhtml">ProductsRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2103.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2104.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2105.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2106.1" xmlns="http://www.w3.org/1999/xhtml">ProductsReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2107.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2108.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.2109.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2110.1" xmlns="http://www.w3.org/1999/xhtml">GetProductsMinimumPrice</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2111.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2112.1" xmlns="http://www.w3.org/1999/xhtml">ProductsMinimumPriceRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2113.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span>
<span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2114.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2115.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2116.1" xmlns="http://www.w3.org/1999/xhtml">ProductsReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2117.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2118.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message ProductRequest {
  int32 product_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2119.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2120.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message ProductsRequest {
}
message ProductsMinimumPriceRequest {
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2121.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2122.1" xmlns="http://www.w3.org/1999/xhtml">.DecimalValue minimum_price = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2123.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2124.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message ProductReply {
  int32 product_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2125.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2126.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2127.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2128.1" xmlns="http://www.w3.org/1999/xhtml"> product_name = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2129.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.2130.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 supplier_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2131.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.2132.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 category_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2133.1" xmlns="http://www.w3.org/1999/xhtml">4</span></span><span class="koboSpan" id="kobo.2134.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2135.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2136.1" xmlns="http://www.w3.org/1999/xhtml"> quantity_per_unit = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2137.1" xmlns="http://www.w3.org/1999/xhtml">5</span></span><span class="koboSpan" id="kobo.2138.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2139.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2140.1" xmlns="http://www.w3.org/1999/xhtml">.DecimalValue unit_price = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2141.1" xmlns="http://www.w3.org/1999/xhtml">6</span></span><span class="koboSpan" id="kobo.2142.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 units_in_stock = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2143.1" xmlns="http://www.w3.org/1999/xhtml">7</span></span><span class="koboSpan" id="kobo.2144.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 units_on_order = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2145.1" xmlns="http://www.w3.org/1999/xhtml">8</span></span><span class="koboSpan" id="kobo.2146.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 reorder_level = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2147.1" xmlns="http://www.w3.org/1999/xhtml">9</span></span><span class="koboSpan" id="kobo.2148.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2149.1" xmlns="http://www.w3.org/1999/xhtml">bool</span></span><span class="koboSpan" id="kobo.2150.1" xmlns="http://www.w3.org/1999/xhtml"> discontinued = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2151.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span><span class="koboSpan" id="kobo.2152.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message ProductsReply {
  repeated ProductReply products = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2153.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2154.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2155.1" xmlns="http://www.w3.org/1999/xhtml">Add a new file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2156.1" xmlns="http://www.w3.org/1999/xhtml">employee.proto</span></code><span class="koboSpan" id="kobo.2157.1" xmlns="http://www.w3.org/1999/xhtml">, and modify it to define messages and service methods</span><a id="_idIndexMarker1468"/><span class="koboSpan" id="kobo.2158.1" xmlns="http://www.w3.org/1999/xhtml"> to get one employee or all employees, and note we</span><a id="_idIndexMarker1469"/><span class="koboSpan" id="kobo.2159.1" xmlns="http://www.w3.org/1999/xhtml"> must import the Google extension for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2160.1" xmlns="http://www.w3.org/1999/xhtml">timestamp.proto</span></code><span class="koboSpan" id="kobo.2161.1" xmlns="http://www.w3.org/1999/xhtml">, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2162.1" xmlns="http://www.w3.org/1999/xhtml">syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2163.1" xmlns="http://www.w3.org/1999/xhtml">"proto3"</span></span><span class="koboSpan" id="kobo.2164.1" xmlns="http://www.w3.org/1999/xhtml">;
option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2165.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Service"</span></span><span class="koboSpan" id="kobo.2166.1" xmlns="http://www.w3.org/1999/xhtml">;
import </span><span class="hljs-string"><span class="koboSpan" id="kobo.2167.1" xmlns="http://www.w3.org/1999/xhtml">"google/protobuf/duration.proto"</span></span><span class="koboSpan" id="kobo.2168.1" xmlns="http://www.w3.org/1999/xhtml">;
import </span><span class="hljs-string"><span class="koboSpan" id="kobo.2169.1" xmlns="http://www.w3.org/1999/xhtml">"google/protobuf/timestamp.proto"</span></span><span class="koboSpan" id="kobo.2170.1" xmlns="http://www.w3.org/1999/xhtml">;
package employee;
service Employee {
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.2171.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2172.1" xmlns="http://www.w3.org/1999/xhtml">GetEmployee</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2173.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2174.1" xmlns="http://www.w3.org/1999/xhtml">EmployeeRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2175.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2176.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2177.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2178.1" xmlns="http://www.w3.org/1999/xhtml">EmployeeReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2179.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2180.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.2181.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2182.1" xmlns="http://www.w3.org/1999/xhtml">GetEmployees</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2183.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2184.1" xmlns="http://www.w3.org/1999/xhtml">EmployeesRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2185.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2186.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2187.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2188.1" xmlns="http://www.w3.org/1999/xhtml">EmployeesReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2189.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2190.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message EmployeeRequest {
  int32 employee_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2191.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2192.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message EmployeesRequest {
}
message EmployeeReply {
  int32 employee_id = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2193.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2194.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2195.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2196.1" xmlns="http://www.w3.org/1999/xhtml"> last_name = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2197.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="koboSpan" id="kobo.2198.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2199.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2200.1" xmlns="http://www.w3.org/1999/xhtml"> first_name = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2201.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span><span class="koboSpan" id="kobo.2202.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2203.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2204.1" xmlns="http://www.w3.org/1999/xhtml"> title = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2205.1" xmlns="http://www.w3.org/1999/xhtml">4</span></span><span class="koboSpan" id="kobo.2206.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2207.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2208.1" xmlns="http://www.w3.org/1999/xhtml"> title_of_courtesy = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2209.1" xmlns="http://www.w3.org/1999/xhtml">5</span></span><span class="koboSpan" id="kobo.2210.1" xmlns="http://www.w3.org/1999/xhtml">;
  google.protobuf.Timestamp birth_date = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2211.1" xmlns="http://www.w3.org/1999/xhtml">6</span></span><span class="koboSpan" id="kobo.2212.1" xmlns="http://www.w3.org/1999/xhtml">;
  google.protobuf.Timestamp hire_date = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2213.1" xmlns="http://www.w3.org/1999/xhtml">7</span></span><span class="koboSpan" id="kobo.2214.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2215.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2216.1" xmlns="http://www.w3.org/1999/xhtml"> address = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2217.1" xmlns="http://www.w3.org/1999/xhtml">8</span></span><span class="koboSpan" id="kobo.2218.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2219.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2220.1" xmlns="http://www.w3.org/1999/xhtml"> city = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2221.1" xmlns="http://www.w3.org/1999/xhtml">9</span></span><span class="koboSpan" id="kobo.2222.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2223.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2224.1" xmlns="http://www.w3.org/1999/xhtml"> region = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2225.1" xmlns="http://www.w3.org/1999/xhtml">10</span></span><span class="koboSpan" id="kobo.2226.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2227.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2228.1" xmlns="http://www.w3.org/1999/xhtml"> postal_code = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2229.1" xmlns="http://www.w3.org/1999/xhtml">11</span></span><span class="koboSpan" id="kobo.2230.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2231.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2232.1" xmlns="http://www.w3.org/1999/xhtml"> country = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2233.1" xmlns="http://www.w3.org/1999/xhtml">12</span></span><span class="koboSpan" id="kobo.2234.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2235.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2236.1" xmlns="http://www.w3.org/1999/xhtml"> home_phone = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2237.1" xmlns="http://www.w3.org/1999/xhtml">13</span></span><span class="koboSpan" id="kobo.2238.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2239.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2240.1" xmlns="http://www.w3.org/1999/xhtml"> extension = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2241.1" xmlns="http://www.w3.org/1999/xhtml">14</span></span><span class="koboSpan" id="kobo.2242.1" xmlns="http://www.w3.org/1999/xhtml">;
  bytes photo = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2243.1" xmlns="http://www.w3.org/1999/xhtml">15</span></span><span class="koboSpan" id="kobo.2244.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2245.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2246.1" xmlns="http://www.w3.org/1999/xhtml"> notes = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2247.1" xmlns="http://www.w3.org/1999/xhtml">16</span></span><span class="koboSpan" id="kobo.2248.1" xmlns="http://www.w3.org/1999/xhtml">;
  int32 reports_to = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2249.1" xmlns="http://www.w3.org/1999/xhtml">17</span></span><span class="koboSpan" id="kobo.2250.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2251.1" xmlns="http://www.w3.org/1999/xhtml">string</span></span><span class="koboSpan" id="kobo.2252.1" xmlns="http://www.w3.org/1999/xhtml"> photo_path = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2253.1" xmlns="http://www.w3.org/1999/xhtml">18</span></span><span class="koboSpan" id="kobo.2254.1" xmlns="http://www.w3.org/1999/xhtml">;
}
message EmployeesReply {
  repeated EmployeeReply employees = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2255.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2256.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2257.1" xmlns="http://www.w3.org/1999/xhtml">In the project file, add </span><a id="_idIndexMarker1470"/><span class="koboSpan" id="kobo.2258.1" xmlns="http://www.w3.org/1999/xhtml">elements to tell the gRPC tool to process the</span><a id="_idIndexMarker1471"/><span class="koboSpan" id="kobo.2259.1" xmlns="http://www.w3.org/1999/xhtml"> new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2260.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.2261.1" xmlns="http://www.w3.org/1999/xhtml"> files, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2262.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2263.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\greet.proto"</span></span><span class="koboSpan" id="kobo.2264.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2265.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></span><span class="koboSpan" id="kobo.2266.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2267.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\shipper.proto"</span></span><span class="koboSpan" id="kobo.2268.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2269.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></span><span class="koboSpan" id="kobo.2270.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2271.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2272.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\decimal.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2273.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2274.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2275.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2276.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2277.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\product.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2278.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2279.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2280.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2281.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2282.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\employee.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2283.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2284.1" xmlns="http://www.w3.org/1999/xhtml">"Server"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2285.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.2286.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/ItemGroup&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2287.1" xmlns="http://www.w3.org/1999/xhtml">Rebuild the project to </span><a id="_idIndexMarker1472"/><span class="koboSpan" id="kobo.2288.1" xmlns="http://www.w3.org/1999/xhtml">make sure the gRPC tool has created the </span><a id="_idIndexMarker1473"/><span class="koboSpan" id="kobo.2289.1" xmlns="http://www.w3.org/1999/xhtml">C# classes in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2290.1" xmlns="http://www.w3.org/1999/xhtml">obj\Debug\net8.0\Protos</span></code><span class="koboSpan" id="kobo.2291.1" xmlns="http://www.w3.org/1999/xhtml"> folder, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2292.1" xmlns="http://www.w3.org/1999/xhtml">Figure</span></em> <em class="italic"><span class="koboSpan" id="kobo.2293.1" xmlns="http://www.w3.org/1999/xhtml">13.9</span></em><span class="koboSpan" id="kobo.2294.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2295.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2296.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.9: gRPC tool-generated classes for a custom decimal type with a Units property</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.2297.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2298.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.2299.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a new folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2300.1" xmlns="http://www.w3.org/1999/xhtml">Converters</span></code><span class="koboSpan" id="kobo.2301.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2302.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2303.1" xmlns="http://www.w3.org/1999/xhtml">Converters</span></code><span class="koboSpan" id="kobo.2304.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2305.1" xmlns="http://www.w3.org/1999/xhtml">DecimalValue.Converters.cs</span></code><span class="koboSpan" id="kobo.2306.1" xmlns="http://www.w3.org/1999/xhtml">, and modify its contents to extend the partial class created by the gRPC tools with a constructor and a pair of operators to convert between our custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.2307.1" xmlns="http://www.w3.org/1999/xhtml">DecimalValue</span></code><span class="koboSpan" id="kobo.2308.1" xmlns="http://www.w3.org/1999/xhtml"> type and the built-in .NET </span><code class="inlineCode"><span class="koboSpan" id="kobo.2309.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.2310.1" xmlns="http://www.w3.org/1999/xhtml"> type, as shown</span><a id="_idIndexMarker1474"/><span class="koboSpan" id="kobo.2311.1" xmlns="http://www.w3.org/1999/xhtml"> in the following</span><a id="_idIndexMarker1475"/><span class="koboSpan" id="kobo.2312.1" xmlns="http://www.w3.org/1999/xhtml"> code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2313.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2314.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></span><span class="koboSpan" id="kobo.2315.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2316.1" xmlns="http://www.w3.org/1999/xhtml">// This will merge with the DecimalValue type generated by the</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2317.1" xmlns="http://www.w3.org/1999/xhtml">// gRPC tools in the obj\Debug\net8.0\Protos\Decimal.cs file.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2318.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2319.1" xmlns="http://www.w3.org/1999/xhtml">partial</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2320.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2321.1" xmlns="http://www.w3.org/1999/xhtml">DecimalValue</span></span><span class="koboSpan" id="kobo.2322.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2323.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2324.1" xmlns="http://www.w3.org/1999/xhtml">const</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2325.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2326.1" xmlns="http://www.w3.org/1999/xhtml"> NanoFactor = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2327.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="koboSpan" id="kobo.2328.1" xmlns="http://www.w3.org/1999/xhtml">_000_000_000;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2329.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2330.1" xmlns="http://www.w3.org/1999/xhtml">DecimalValue</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2331.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2332.1" xmlns="http://www.w3.org/1999/xhtml">long</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2333.1" xmlns="http://www.w3.org/1999/xhtml"> units, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2334.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2335.1" xmlns="http://www.w3.org/1999/xhtml"> nanos</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2336.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2337.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    Units = units;
    Nanos = nanos;
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2338.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2339.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2340.1" xmlns="http://www.w3.org/1999/xhtml">implicit</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2341.1" xmlns="http://www.w3.org/1999/xhtml">operator</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2342.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2343.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2344.1" xmlns="http://www.w3.org/1999/xhtml">DecimalValue grpcDecimal</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2345.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2346.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2347.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.2348.1" xmlns="http://www.w3.org/1999/xhtml"> grpcDecimal.Units + (grpcDecimal.Nanos / NanoFactor);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2349.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2350.1" xmlns="http://www.w3.org/1999/xhtml">static</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2351.1" xmlns="http://www.w3.org/1999/xhtml">implicit</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2352.1" xmlns="http://www.w3.org/1999/xhtml">operator</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2353.1" xmlns="http://www.w3.org/1999/xhtml">DecimalValue</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2354.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2355.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="hljs-params"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2356.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2357.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2358.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2359.1" xmlns="http://www.w3.org/1999/xhtml">long</span></span><span class="koboSpan" id="kobo.2360.1" xmlns="http://www.w3.org/1999/xhtml"> units = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2361.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2362.1" xmlns="http://www.w3.org/1999/xhtml">.ToInt64(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2363.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="koboSpan" id="kobo.2364.1" xmlns="http://www.w3.org/1999/xhtml">);
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2365.1" xmlns="http://www.w3.org/1999/xhtml">int</span></span><span class="koboSpan" id="kobo.2366.1" xmlns="http://www.w3.org/1999/xhtml"> nanos = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2367.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="koboSpan" id="kobo.2368.1" xmlns="http://www.w3.org/1999/xhtml">.ToInt32((</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2369.1" xmlns="http://www.w3.org/1999/xhtml">value</span></span><span class="koboSpan" id="kobo.2370.1" xmlns="http://www.w3.org/1999/xhtml"> - units) * NanoFactor);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2371.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2372.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2373.1" xmlns="http://www.w3.org/1999/xhtml"> DecimalValue(units, nanos);
  }
}
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-496"><span class="koboSpan" id="kobo.2374.1" xmlns="http://www.w3.org/1999/xhtml">Implementing the product and employee gRPC services</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2375.1" xmlns="http://www.w3.org/1999/xhtml">Now we need to</span><a id="_idIndexMarker1476"/><span class="koboSpan" id="kobo.2376.1" xmlns="http://www.w3.org/1999/xhtml"> implement and register the services:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2377.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2378.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.2379.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2380.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.2381.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2382.1" xmlns="http://www.w3.org/1999/xhtml">ProductService.cs</span></code><span class="koboSpan" id="kobo.2383.1" xmlns="http://www.w3.org/1999/xhtml"> and modify its content to implement the products service. </span><span class="koboSpan" id="kobo.2383.2" xmlns="http://www.w3.org/1999/xhtml">I will leave this as an optional exercise for you, or you can copy the code from the following link: </span><a href="https://github.com/markjprice/apps-services-net8/blob/main/code/Chapter13/Northwind.Grpc.Service/Services/ProductService.cs"><span class="url"><span class="koboSpan" id="kobo.2384.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/code/Chapter13/Northwind.Grpc.Service/Services/ProductService.cs</span></span></a><span class="koboSpan" id="kobo.2385.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2386.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2387.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.2388.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2389.1" xmlns="http://www.w3.org/1999/xhtml">EmployeeService.cs</span></code><span class="koboSpan" id="kobo.2390.1" xmlns="http://www.w3.org/1999/xhtml"> and modify its content to implement the products service. </span><span class="koboSpan" id="kobo.2390.2" xmlns="http://www.w3.org/1999/xhtml">I will leave this as an optional exercise</span><a id="_idIndexMarker1477"/><span class="koboSpan" id="kobo.2391.1" xmlns="http://www.w3.org/1999/xhtml"> for you, or you can copy the code from the following link: </span><a href="https://github.com/markjprice/apps-services-net8/blob/main/code/Chapter13/Northwind.Grpc.Service/Services/EmployeeService.cs"><span class="url"><span class="koboSpan" id="kobo.2392.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/code/Chapter13/Northwind.Grpc.Service/Services/EmployeeService.cs</span></span></a><span class="koboSpan" id="kobo.2393.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2394.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2395.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2396.1" xmlns="http://www.w3.org/1999/xhtml">, register the two new services, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2397.1" xmlns="http://www.w3.org/1999/xhtml">app.MapGrpcService&lt;ProductService&gt;();
app.MapGrpcService&lt;EmployeeService&gt;();
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-497"><span class="koboSpan" id="kobo.2398.1" xmlns="http://www.w3.org/1999/xhtml">Adding product and employee gRPC clients</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2399.1" xmlns="http://www.w3.org/1999/xhtml">Next, we need to add clients to the</span><a id="_idIndexMarker1478"/><span class="koboSpan" id="kobo.2400.1" xmlns="http://www.w3.org/1999/xhtml"> MVC project to call the two new gRPC services:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2401.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2402.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.2403.1" xmlns="http://www.w3.org/1999/xhtml"> project, copy the three </span><code class="inlineCode"><span class="koboSpan" id="kobo.2404.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.2405.1" xmlns="http://www.w3.org/1999/xhtml"> files from the service project to the MVC project </span><code class="inlineCode"><span class="koboSpan" id="kobo.2406.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.2407.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2408.1" xmlns="http://www.w3.org/1999/xhtml">In the three </span><code class="inlineCode"><span class="koboSpan" id="kobo.2409.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.2410.1" xmlns="http://www.w3.org/1999/xhtml"> files, modify the namespace, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2411.1" xmlns="http://www.w3.org/1999/xhtml">option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2412.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Client.Mvc"</span></span><span class="koboSpan" id="kobo.2413.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2414.1" xmlns="http://www.w3.org/1999/xhtml">In the project file, register the three files to create client-side representations, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2415.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2416.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\greet.proto"</span></span><span class="koboSpan" id="kobo.2417.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2418.1" xmlns="http://www.w3.org/1999/xhtml">"Client"</span></span><span class="koboSpan" id="kobo.2419.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;Protobuf Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2420.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\shipper.proto"</span></span><span class="koboSpan" id="kobo.2421.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2422.1" xmlns="http://www.w3.org/1999/xhtml">"Client"</span></span><span class="koboSpan" id="kobo.2423.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2424.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2425.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\decimal.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2426.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2427.1" xmlns="http://www.w3.org/1999/xhtml">"Client"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2428.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2429.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2430.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\employee.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2431.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2432.1" xmlns="http://www.w3.org/1999/xhtml">"Client"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2433.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2434.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;Protobuf Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2435.1" xmlns="http://www.w3.org/1999/xhtml">"Protos\product.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2436.1" xmlns="http://www.w3.org/1999/xhtml"> GrpcServices=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2437.1" xmlns="http://www.w3.org/1999/xhtml">"Client"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2438.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.2439.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/ItemGroup&gt;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2440.1" xmlns="http://www.w3.org/1999/xhtml">If you are using a code editor like JetBrains Rider that adds extra configuration, I recommend that you simplify the elements as shown in the preceding markup. </span><span class="koboSpan" id="kobo.2440.2" xmlns="http://www.w3.org/1999/xhtml">If you do not, then you might get errors later in this coding task.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.2441.1" xmlns="http://www.w3.org/1999/xhtml">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2442.1" xmlns="http://www.w3.org/1999/xhtml">Converters</span></code><span class="koboSpan" id="kobo.2443.1" xmlns="http://www.w3.org/1999/xhtml"> folder</span><a id="_idIndexMarker1479"/><span class="koboSpan" id="kobo.2444.1" xmlns="http://www.w3.org/1999/xhtml"> from the gRPC project to the MVC project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2445.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2446.1" xmlns="http://www.w3.org/1999/xhtml">Converters</span></code><span class="koboSpan" id="kobo.2447.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2448.1" xmlns="http://www.w3.org/1999/xhtml">DecimalValue.Converters.cs</span></code><span class="koboSpan" id="kobo.2449.1" xmlns="http://www.w3.org/1999/xhtml">, modify the namespace to use the client, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2450.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2451.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.</span></span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2452.1" xmlns="http://www.w3.org/1999/xhtml">Client.Mvc</span></strong></span><span class="koboSpan" id="kobo.2453.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2454.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2455.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.2456.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2457.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.2458.1" xmlns="http://www.w3.org/1999/xhtml">, add statements to register clients for the two new services, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2459.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddGrpcClient&lt;Product.ProductClient&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2460.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2461.1" xmlns="http://www.w3.org/1999/xhtml">Product"</span></span><span class="koboSpan" id="kobo.2462.1" xmlns="http://www.w3.org/1999/xhtml">,
  options =&gt;
  {
    options.Address = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2463.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2464.1" xmlns="http://www.w3.org/1999/xhtml"> Uri(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2465.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5131"</span></span><span class="koboSpan" id="kobo.2466.1" xmlns="http://www.w3.org/1999/xhtml">);
  });
builder.Services.AddGrpcClient&lt;Employee.EmployeeClient&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2467.1" xmlns="http://www.w3.org/1999/xhtml">"Employee"</span></span><span class="koboSpan" id="kobo.2468.1" xmlns="http://www.w3.org/1999/xhtml">,
  options =&gt;
  {
    options.Address = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2469.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2470.1" xmlns="http://www.w3.org/1999/xhtml"> Uri(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2471.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5131"</span></span><span class="koboSpan" id="kobo.2472.1" xmlns="http://www.w3.org/1999/xhtml">);
  });
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2473.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2474.1" xmlns="http://www.w3.org/1999/xhtml">Controllers</span></code><span class="koboSpan" id="kobo.2475.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2476.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.2477.1" xmlns="http://www.w3.org/1999/xhtml">, add two fields for the two new clients and set them in the constructor. </span><span class="koboSpan" id="kobo.2477.2" xmlns="http://www.w3.org/1999/xhtml">(Hint: follow the same pattern as for greeter and shipper.)</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2478.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.2479.1" xmlns="http://www.w3.org/1999/xhtml">HomeController.cs</span></code><span class="koboSpan" id="kobo.2480.1" xmlns="http://www.w3.org/1999/xhtml">, add two action methods for products and employees, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2481.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2482.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2483.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;IActionResult&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2484.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2485.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2486.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2487.1" xmlns="http://www.w3.org/1999/xhtml"> minimumPrice = </span></span><span class="hljs-number"><span class="koboSpan" id="kobo.2488.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2489.1" xmlns="http://www.w3.org/1999/xhtml">M</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2490.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2491.1" xmlns="http://www.w3.org/1999/xhtml">
{
  ProductsReply reply = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2492.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2493.1" xmlns="http://www.w3.org/1999/xhtml"> _productClient.GetProductsMinimumPriceAsync(
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2494.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2495.1" xmlns="http://www.w3.org/1999/xhtml"> ProductsMinimumPriceRequest() { MinimumPrice = minimumPrice });
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2496.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.2497.1" xmlns="http://www.w3.org/1999/xhtml"> View(reply.Products);
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2498.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2499.1" xmlns="http://www.w3.org/1999/xhtml">async</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2500.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;IActionResult&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2501.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2502.1" xmlns="http://www.w3.org/1999/xhtml">()</span></span><span class="koboSpan" id="kobo.2503.1" xmlns="http://www.w3.org/1999/xhtml">
{
  EmployeesReply reply = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2504.1" xmlns="http://www.w3.org/1999/xhtml">await</span></span><span class="koboSpan" id="kobo.2505.1" xmlns="http://www.w3.org/1999/xhtml"> _employeeClient.GetEmployeesAsync(
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2506.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.2507.1" xmlns="http://www.w3.org/1999/xhtml"> EmployeesRequest());
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2508.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.2509.1" xmlns="http://www.w3.org/1999/xhtml"> View(reply.Employees);
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2510.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2511.1" xmlns="http://www.w3.org/1999/xhtml">Views\Shared</span></code><span class="koboSpan" id="kobo.2512.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2513.1" xmlns="http://www.w3.org/1999/xhtml">_Layout.cshtml</span></code><span class="koboSpan" id="kobo.2514.1" xmlns="http://www.w3.org/1999/xhtml">, after the menu item for navigating to the </span><a id="_idIndexMarker1480"/><span class="koboSpan" id="kobo.2515.1" xmlns="http://www.w3.org/1999/xhtml">home page, add menu items for navigating to products and employees, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2516.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2517.1" xmlns="http://www.w3.org/1999/xhtml">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2518.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2519.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2520.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2521.1" xmlns="http://www.w3.org/1999/xhtml">nav-item"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2522.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2523.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2524.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2525.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2526.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2527.1" xmlns="http://www.w3.org/1999/xhtml">"nav-link text-dark"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2528.1" xmlns="http://www.w3.org/1999/xhtml">asp-area</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2529.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2530.1" xmlns="http://www.w3.org/1999/xhtml">""</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2531.1" xmlns="http://www.w3.org/1999/xhtml">asp-controller</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2532.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2533.1" xmlns="http://www.w3.org/1999/xhtml">"Home"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2534.1" xmlns="http://www.w3.org/1999/xhtml">asp-action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2535.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2536.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2537.1" xmlns="http://www.w3.org/1999/xhtml">Index"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2538.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2539.1" xmlns="http://www.w3.org/1999/xhtml">Home</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2540.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2541.1" xmlns="http://www.w3.org/1999/xhtml">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2542.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2543.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2544.1" xmlns="http://www.w3.org/1999/xhtml">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2545.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2546.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2547.1" xmlns="http://www.w3.org/1999/xhtml">li</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2548.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2549.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2550.1" xmlns="http://www.w3.org/1999/xhtml">"nav-item"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2551.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2552.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2553.1" xmlns="http://www.w3.org/1999/xhtml">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2554.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2555.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2556.1" xmlns="http://www.w3.org/1999/xhtml">"nav-link text-dark"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2557.1" xmlns="http://www.w3.org/1999/xhtml">asp-area</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2558.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2559.1" xmlns="http://www.w3.org/1999/xhtml">""</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2560.1" xmlns="http://www.w3.org/1999/xhtml">asp-controller</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2561.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2562.1" xmlns="http://www.w3.org/1999/xhtml">"Home"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2563.1" xmlns="http://www.w3.org/1999/xhtml">asp-action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2564.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2565.1" xmlns="http://www.w3.org/1999/xhtml">"Products"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2566.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2567.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2568.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2569.1" xmlns="http://www.w3.org/1999/xhtml">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2570.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2571.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2572.1" xmlns="http://www.w3.org/1999/xhtml">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2573.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2574.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2575.1" xmlns="http://www.w3.org/1999/xhtml">li</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2576.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2577.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2578.1" xmlns="http://www.w3.org/1999/xhtml">"nav-item"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2579.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2580.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2581.1" xmlns="http://www.w3.org/1999/xhtml">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2582.1" xmlns="http://www.w3.org/1999/xhtml">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2583.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2584.1" xmlns="http://www.w3.org/1999/xhtml">"</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2585.1" xmlns="http://www.w3.org/1999/xhtml">nav-link text-dark"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2586.1" xmlns="http://www.w3.org/1999/xhtml">asp-area</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2587.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2588.1" xmlns="http://www.w3.org/1999/xhtml">""</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2589.1" xmlns="http://www.w3.org/1999/xhtml">asp-controller</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2590.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2591.1" xmlns="http://www.w3.org/1999/xhtml">"Home"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2592.1" xmlns="http://www.w3.org/1999/xhtml">asp-action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2593.1" xmlns="http://www.w3.org/1999/xhtml">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2594.1" xmlns="http://www.w3.org/1999/xhtml">"Employees"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2595.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2596.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2597.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2598.1" xmlns="http://www.w3.org/1999/xhtml">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2599.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2600.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2601.1" xmlns="http://www.w3.org/1999/xhtml">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2602.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2603.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2604.1" xmlns="http://www.w3.org/1999/xhtml">Views\Home</span></code><span class="koboSpan" id="kobo.2605.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new Razor View file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2606.1" xmlns="http://www.w3.org/1999/xhtml">Products.cshtml</span></code><span class="koboSpan" id="kobo.2607.1" xmlns="http://www.w3.org/1999/xhtml">, and modify it to show a table of products, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2608.1" xmlns="http://www.w3.org/1999/xhtml">@using Google.Protobuf.Collections
@using Northwind.Grpc.Client.Mvc
@model RepeatedField</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2609.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2610.1" xmlns="http://www.w3.org/1999/xhtml">ProductReply</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2611.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2612.1" xmlns="http://www.w3.org/1999/xhtml">
@{
  ViewData["Title"] = "Products";
  decimal price = 0;
}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2613.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2614.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2615.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2616.1" xmlns="http://www.w3.org/1999/xhtml">@ViewData["Title"]</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2617.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2618.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2619.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2620.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2621.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2622.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2623.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2624.1" xmlns="http://www.w3.org/1999/xhtml">"table table-primary table-bordered"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2625.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2626.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2627.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2628.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2629.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2630.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2631.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2632.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2633.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2634.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2635.1" xmlns="http://www.w3.org/1999/xhtml">Product ID</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2636.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2637.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2638.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2639.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2640.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2641.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2642.1" xmlns="http://www.w3.org/1999/xhtml">Product Name</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2643.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2644.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2645.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2646.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2647.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2648.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2649.1" xmlns="http://www.w3.org/1999/xhtml">Unit Price</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2650.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2651.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2652.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2653.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2654.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2655.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2656.1" xmlns="http://www.w3.org/1999/xhtml">Units In Stock</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2657.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2658.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2659.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2660.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2661.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2662.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2663.1" xmlns="http://www.w3.org/1999/xhtml">Units On Order</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2664.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2665.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2666.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2667.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2668.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2669.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2670.1" xmlns="http://www.w3.org/1999/xhtml">Reorder Level</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2671.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2672.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2673.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2674.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2675.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2676.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2677.1" xmlns="http://www.w3.org/1999/xhtml">Discontinued</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2678.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2679.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2680.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2681.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2682.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2683.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2684.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2685.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2686.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2687.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2688.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2689.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2690.1" xmlns="http://www.w3.org/1999/xhtml">
    @foreach (ProductReply p in Model)
    {
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2691.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2692.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2693.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2694.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2695.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2696.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2697.1" xmlns="http://www.w3.org/1999/xhtml">@p.ProductId</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2698.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2699.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2700.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2701.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2702.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2703.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2704.1" xmlns="http://www.w3.org/1999/xhtml">@p.ProductName</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2705.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2706.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2707.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2708.1" xmlns="http://www.w3.org/1999/xhtml">
        @{ price = p.UnitPrice; }
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2709.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2710.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2711.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2712.1" xmlns="http://www.w3.org/1999/xhtml">@price.ToString("C")</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2713.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2714.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2715.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2716.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2717.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2718.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2719.1" xmlns="http://www.w3.org/1999/xhtml">@p.UnitsInStock</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2720.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2721.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2722.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2723.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2724.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2725.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2726.1" xmlns="http://www.w3.org/1999/xhtml">@p.UnitsOnOrder</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2727.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2728.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2729.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2730.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2731.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2732.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2733.1" xmlns="http://www.w3.org/1999/xhtml">@p.ReorderLevel</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2734.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2735.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2736.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2737.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2738.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2739.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2740.1" xmlns="http://www.w3.org/1999/xhtml">@p.Discontinued</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2741.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2742.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2743.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2744.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2745.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2746.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2747.1" xmlns="http://www.w3.org/1999/xhtml">
    }
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2748.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2749.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2750.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2751.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2752.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2753.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2754.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2755.1" xmlns="http://www.w3.org/1999/xhtml">Views\Home</span></code><span class="koboSpan" id="kobo.2756.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new Razor View file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2757.1" xmlns="http://www.w3.org/1999/xhtml">Employees.cshtml</span></code><span class="koboSpan" id="kobo.2758.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><a id="_idIndexMarker1481"/><span class="koboSpan" id="kobo.2759.1" xmlns="http://www.w3.org/1999/xhtml">modify it to show a table of employees, as shown in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2760.1" xmlns="http://www.w3.org/1999/xhtml">@using Google.Protobuf.Collections
@using Northwind.Grpc.Client.Mvc
@model RepeatedField</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2761.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2762.1" xmlns="http://www.w3.org/1999/xhtml">EmployeeReply</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2763.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2764.1" xmlns="http://www.w3.org/1999/xhtml">
@{
  ViewData["Title"] = "Employees";
}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2765.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2766.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2767.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2768.1" xmlns="http://www.w3.org/1999/xhtml">@ViewData["Title"]</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2769.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2770.1" xmlns="http://www.w3.org/1999/xhtml">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2771.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2772.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2773.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2774.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2775.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2776.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2777.1" xmlns="http://www.w3.org/1999/xhtml">table table-primary table-bordered"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2778.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2779.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2780.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2781.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2782.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2783.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2784.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2785.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2786.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2787.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2788.1" xmlns="http://www.w3.org/1999/xhtml">Employee ID</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2789.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2790.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2791.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2792.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2793.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2794.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2795.1" xmlns="http://www.w3.org/1999/xhtml">Full Name</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2796.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2797.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2798.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2799.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2800.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2801.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2802.1" xmlns="http://www.w3.org/1999/xhtml">Job Title</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2803.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2804.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2805.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2806.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2807.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2808.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2809.1" xmlns="http://www.w3.org/1999/xhtml">Address</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2810.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2811.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2812.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2813.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2814.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2815.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2816.1" xmlns="http://www.w3.org/1999/xhtml">Birth Date</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2817.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2818.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2819.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2820.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2821.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2822.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2823.1" xmlns="http://www.w3.org/1999/xhtml">Photo</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2824.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2825.1" xmlns="http://www.w3.org/1999/xhtml">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2826.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2827.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2828.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2829.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2830.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2831.1" xmlns="http://www.w3.org/1999/xhtml">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2832.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2833.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2834.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2835.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2836.1" xmlns="http://www.w3.org/1999/xhtml">
    @foreach (EmployeeReply e in Model)
    {
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2837.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2838.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2839.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2840.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2841.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2842.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2843.1" xmlns="http://www.w3.org/1999/xhtml">@e.EmployeeId</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2844.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2845.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2846.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2847.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2848.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2849.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2850.1" xmlns="http://www.w3.org/1999/xhtml">@e.TitleOfCourtesy @e.FirstName @e.LastName</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2851.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2852.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2853.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2854.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2855.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2856.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2857.1" xmlns="http://www.w3.org/1999/xhtml">@e.Title</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2858.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2859.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2860.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2861.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2862.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2863.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2864.1" xmlns="http://www.w3.org/1999/xhtml">@e.Address</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2865.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2866.1" xmlns="http://www.w3.org/1999/xhtml">br</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2867.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span><span class="koboSpan" id="kobo.2868.1" xmlns="http://www.w3.org/1999/xhtml">@e.City</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2869.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2870.1" xmlns="http://www.w3.org/1999/xhtml">br</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2871.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span><span class="koboSpan" id="kobo.2872.1" xmlns="http://www.w3.org/1999/xhtml">@e.Region</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2873.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2874.1" xmlns="http://www.w3.org/1999/xhtml">br</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2875.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span><span class="koboSpan" id="kobo.2876.1" xmlns="http://www.w3.org/1999/xhtml">
            @e.PostalCode</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2877.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2878.1" xmlns="http://www.w3.org/1999/xhtml">br</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2879.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span><span class="koboSpan" id="kobo.2880.1" xmlns="http://www.w3.org/1999/xhtml">@e.Country</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2881.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2882.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2883.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2884.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2885.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2886.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2887.1" xmlns="http://www.w3.org/1999/xhtml">@e.BirthDate.ToDateTimeOffset().ToString("D")</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2888.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2889.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2890.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2891.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2892.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2893.1" xmlns="http://www.w3.org/1999/xhtml">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2894.1" xmlns="http://www.w3.org/1999/xhtml">img</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2895.1" xmlns="http://www.w3.org/1999/xhtml">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2896.1" xmlns="http://www.w3.org/1999/xhtml">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2897.1" xmlns="http://www.w3.org/1999/xhtml">"data:image/jpg;base64,</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2898.1" xmlns="http://www.w3.org/1999/xhtml">          @Convert.ToBase64String(e.Photo.ToByteArray())"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2899.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2900.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2901.1" xmlns="http://www.w3.org/1999/xhtml">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2902.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2903.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2904.1" xmlns="http://www.w3.org/1999/xhtml">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2905.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span><span class="koboSpan" id="kobo.2906.1" xmlns="http://www.w3.org/1999/xhtml">
    }
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2907.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2908.1" xmlns="http://www.w3.org/1999/xhtml">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2909.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2910.1" xmlns="http://www.w3.org/1999/xhtml">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2911.1" xmlns="http://www.w3.org/1999/xhtml">table</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2912.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></span>
</code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-498"><span class="koboSpan" id="kobo.2913.1" xmlns="http://www.w3.org/1999/xhtml">Testing decimal, date, and bytes handling</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2914.1" xmlns="http://www.w3.org/1999/xhtml">Finally, we can test the specialized type</span><a id="_idIndexMarker1482"/><span class="koboSpan" id="kobo.2915.1" xmlns="http://www.w3.org/1999/xhtml"> handling we implemented:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2916.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2917.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.2918.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2919.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2920.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.2921.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2922.1" xmlns="http://www.w3.org/1999/xhtml">On the home page, in the top navigation bar, click </span><strong class="screenText"><span class="koboSpan" id="kobo.2923.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></strong><span class="koboSpan" id="kobo.2924.1" xmlns="http://www.w3.org/1999/xhtml">, and note all products are included in the table, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2925.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.10</span></em><span class="koboSpan" id="kobo.2926.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2927.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2928.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.10: Products including unit prices that use a custom decimal implementation</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.2929.1" xmlns="http://www.w3.org/1999/xhtml">Enter a minimum </span><a id="_idIndexMarker1483"/><span class="koboSpan" id="kobo.2930.1" xmlns="http://www.w3.org/1999/xhtml">price such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2931.1" xmlns="http://www.w3.org/1999/xhtml">100</span></code><span class="koboSpan" id="kobo.2932.1" xmlns="http://www.w3.org/1999/xhtml">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.2933.1" xmlns="http://www.w3.org/1999/xhtml">Filter Products</span></strong><span class="koboSpan" id="kobo.2934.1" xmlns="http://www.w3.org/1999/xhtml">, and note that only products with a unit price of that amount or more are included in the table.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2935.1" xmlns="http://www.w3.org/1999/xhtml">In the top navigation bar, click </span><strong class="screenText"><span class="koboSpan" id="kobo.2936.1" xmlns="http://www.w3.org/1999/xhtml">Employees</span></strong><span class="koboSpan" id="kobo.2937.1" xmlns="http://www.w3.org/1999/xhtml">, and note employees and their birth dates and photos are included in the table, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2938.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.11</span></em><span class="koboSpan" id="kobo.2939.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2940.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2941.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.11: Employees including birth dates and photos using timestamp and bytes</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.2942.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser </span><a id="_idIndexMarker1484"/><span class="koboSpan" id="kobo.2943.1" xmlns="http://www.w3.org/1999/xhtml">and shut down the web servers.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2944.1" xmlns="http://www.w3.org/1999/xhtml">You’ve now seen how to use gRPC to build several services that work with data. </span><span class="koboSpan" id="kobo.2944.2" xmlns="http://www.w3.org/1999/xhtml">Now let’s see some more advanced features of gRPC.</span></p>
<h1 class="heading-1" id="_idParaDest-499"><span class="koboSpan" id="kobo.2945.1" xmlns="http://www.w3.org/1999/xhtml">Implementing interceptors and handling faults</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2946.1" xmlns="http://www.w3.org/1999/xhtml">gRPC interceptors are a way to perform additional processing during requests and responses and they can be injected at the client or service. </span><span class="koboSpan" id="kobo.2946.2" xmlns="http://www.w3.org/1999/xhtml">They are often used for logging, monitoring, and validation.</span></p>
<h2 class="heading-2" id="_idParaDest-500"><span class="koboSpan" id="kobo.2947.1" xmlns="http://www.w3.org/1999/xhtml">Adding a client-side interceptor</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2948.1" xmlns="http://www.w3.org/1999/xhtml">Let’s add a client-side gRPC interceptor</span><a id="_idIndexMarker1485"/><span class="koboSpan" id="kobo.2949.1" xmlns="http://www.w3.org/1999/xhtml"> for logging:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2950.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2951.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.2952.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a new folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2953.1" xmlns="http://www.w3.org/1999/xhtml">Interceptors</span></code><span class="koboSpan" id="kobo.2954.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2955.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2956.1" xmlns="http://www.w3.org/1999/xhtml">Interceptors</span></code><span class="koboSpan" id="kobo.2957.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a new class file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2958.1" xmlns="http://www.w3.org/1999/xhtml">ClientLoggingInterceptor.cs</span></code><span class="koboSpan" id="kobo.2959.1" xmlns="http://www.w3.org/1999/xhtml">, and then add statements to define an interceptor, as shown in</span><a id="_idIndexMarker1486"/><span class="koboSpan" id="kobo.2960.1" xmlns="http://www.w3.org/1999/xhtml"> the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2961.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2962.1" xmlns="http://www.w3.org/1999/xhtml"> Grpc.Core.Interceptors; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2963.1" xmlns="http://www.w3.org/1999/xhtml">// To use Interceptor and so on.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2964.1" xmlns="http://www.w3.org/1999/xhtml">using</span></span><span class="koboSpan" id="kobo.2965.1" xmlns="http://www.w3.org/1999/xhtml"> Grpc.Core; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2966.1" xmlns="http://www.w3.org/1999/xhtml">// To use AsyncUnaryCall&lt;T&gt;.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2967.1" xmlns="http://www.w3.org/1999/xhtml">namespace</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2968.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc.Interceptors</span></span><span class="koboSpan" id="kobo.2969.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2970.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2971.1" xmlns="http://www.w3.org/1999/xhtml">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2972.1" xmlns="http://www.w3.org/1999/xhtml">ClientLoggingInterceptor</span></span><span class="koboSpan" id="kobo.2973.1" xmlns="http://www.w3.org/1999/xhtml"> : </span><span class="hljs-title"><span class="koboSpan" id="kobo.2974.1" xmlns="http://www.w3.org/1999/xhtml">Interceptor</span></span><span class="koboSpan" id="kobo.2975.1" xmlns="http://www.w3.org/1999/xhtml">
{
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2976.1" xmlns="http://www.w3.org/1999/xhtml">private</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2977.1" xmlns="http://www.w3.org/1999/xhtml">readonly</span></span><span class="koboSpan" id="kobo.2978.1" xmlns="http://www.w3.org/1999/xhtml"> ILogger _logger;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2979.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2980.1" xmlns="http://www.w3.org/1999/xhtml">ClientLoggingInterceptor</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2981.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2982.1" xmlns="http://www.w3.org/1999/xhtml">ILoggerFactory loggerFactory</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2983.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.2984.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger = loggerFactory.CreateLogger&lt;ClientLoggingInterceptor&gt;();
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2985.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2986.1" xmlns="http://www.w3.org/1999/xhtml">override</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2987.1" xmlns="http://www.w3.org/1999/xhtml">AsyncUnaryCall</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2988.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2989.1" xmlns="http://www.w3.org/1999/xhtml">TResponse</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2990.1" xmlns="http://www.w3.org/1999/xhtml">&gt; </span></span>
<span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2991.1" xmlns="http://www.w3.org/1999/xhtml">AsyncUnaryCall</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2992.1" xmlns="http://www.w3.org/1999/xhtml">&lt;</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2993.1" xmlns="http://www.w3.org/1999/xhtml">TRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2994.1" xmlns="http://www.w3.org/1999/xhtml">, </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2995.1" xmlns="http://www.w3.org/1999/xhtml">TResponse</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2996.1" xmlns="http://www.w3.org/1999/xhtml">&gt;(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2997.1" xmlns="http://www.w3.org/1999/xhtml">TRequest request,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.2998.1" xmlns="http://www.w3.org/1999/xhtml">    ClientInterceptorContext&lt;TRequest, TResponse&gt; context,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.2999.1" xmlns="http://www.w3.org/1999/xhtml">    AsyncUnaryCallContinuation&lt;TRequest, TResponse&gt; continuation</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3000.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.3001.1" xmlns="http://www.w3.org/1999/xhtml">
  {
    _logger.LogWarning(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3002.1" xmlns="http://www.w3.org/1999/xhtml">"Starting call. </span><span class="koboSpan" id="kobo.3002.2" xmlns="http://www.w3.org/1999/xhtml">Type: {0}. </span><span class="koboSpan" id="kobo.3002.3" xmlns="http://www.w3.org/1999/xhtml">Method: {1}."</span></span><span class="koboSpan" id="kobo.3003.1" xmlns="http://www.w3.org/1999/xhtml">,
      context.Method.Type, context.Method.Name);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3004.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span><span class="koboSpan" id="kobo.3005.1" xmlns="http://www.w3.org/1999/xhtml"> continuation(request, context);
  }
}
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3006.1" xmlns="http://www.w3.org/1999/xhtml">Interceptors form a pipeline, so in your interceptor, you must call the next interceptor in the pipeline, represented by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3007.1" xmlns="http://www.w3.org/1999/xhtml">continuation</span></code><span class="koboSpan" id="kobo.3008.1" xmlns="http://www.w3.org/1999/xhtml"> delegate, and pass it the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3009.1" xmlns="http://www.w3.org/1999/xhtml">request</span></code><span class="koboSpan" id="kobo.3010.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3011.1" xmlns="http://www.w3.org/1999/xhtml">context</span></code><span class="koboSpan" id="kobo.3012.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.3013.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3014.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.3015.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.3016.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3017.1" xmlns="http://www.w3.org/1999/xhtml">, before any of the calls to add gRPC services, add a call to register the interceptor as a singleton service, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.3018.1" xmlns="http://www.w3.org/1999/xhtml">// Register the interceptor before attaching it to a gRPC client.</span></span><span class="koboSpan" id="kobo.3019.1" xmlns="http://www.w3.org/1999/xhtml">
builder.Services.AddSingleton&lt;ClientLoggingInterceptor&gt;();
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3020.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3021.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3022.1" xmlns="http://www.w3.org/1999/xhtml">, at the end of the statement to register the product client, add the interceptor, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3023.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddGrpcClient&lt;Product.ProductClient&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3024.1" xmlns="http://www.w3.org/1999/xhtml">"Product"</span></span><span class="koboSpan" id="kobo.3025.1" xmlns="http://www.w3.org/1999/xhtml">,
  options =&gt;
  {
    options.Address = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3026.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3027.1" xmlns="http://www.w3.org/1999/xhtml"> Uri(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3028.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5131"</span></span><span class="koboSpan" id="kobo.3029.1" xmlns="http://www.w3.org/1999/xhtml">);
  })
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3030.1" xmlns="http://www.w3.org/1999/xhtml">.AddInterceptor&lt;ClientLoggingInterceptor&gt;()</span></strong></span><span class="koboSpan" id="kobo.3031.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3032.1" xmlns="http://www.w3.org/1999/xhtml">You can attach the logging interceptor to as many clients as you want.</span></p>
</div>
</li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.3033.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3034.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3035.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3036.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3037.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.3038.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3039.1" xmlns="http://www.w3.org/1999/xhtml">On the home page, in the top navigation bar, click </span><strong class="screenText"><span class="koboSpan" id="kobo.3040.1" xmlns="http://www.w3.org/1999/xhtml">Products</span></strong><span class="koboSpan" id="kobo.3041.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3042.1" xmlns="http://www.w3.org/1999/xhtml">In the MVC website </span><a id="_idIndexMarker1487"/><span class="koboSpan" id="kobo.3043.1" xmlns="http://www.w3.org/1999/xhtml">project command prompt or terminal, note the warning, which will be distinct from information messages as it is yellow-on-black by default, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3044.1" xmlns="http://www.w3.org/1999/xhtml">warn: Northwind.Grpc.Client.Mvc.Interceptors.ClientLoggingInterceptor[0]
      Starting call. </span><span class="koboSpan" id="kobo.3044.2" xmlns="http://www.w3.org/1999/xhtml">Type: Unary. </span><span class="koboSpan" id="kobo.3044.3" xmlns="http://www.w3.org/1999/xhtml">Method: GetProductsMinimumPrice.
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3045.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.3046.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.3047.1" xmlns="http://www.w3.org/1999/xhtml">: You might be thinking, “Interceptors sound a lot like ASP.NET Core middleware!” </span><span class="koboSpan" id="kobo.3047.2" xmlns="http://www.w3.org/1999/xhtml">You can read a useful comparison at the following link: </span><a href="https://learn.microsoft.com/en-us/aspnet/core/grpc/interceptors#grpc-interceptors-versus-middleware"><span class="url"><span class="koboSpan" id="kobo.3048.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/grpc/interceptors#grpc-interceptors-versus-middleware</span></span></a><span class="koboSpan" id="kobo.3049.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-501"><span class="koboSpan" id="kobo.3050.1" xmlns="http://www.w3.org/1999/xhtml">Exception and transient fault handling</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3051.1" xmlns="http://www.w3.org/1999/xhtml">gRPC has built-in support to automatically retry failed calls, which is a good way to handle transient faults like </span><a id="_idIndexMarker1488"/><span class="koboSpan" id="kobo.3052.1" xmlns="http://www.w3.org/1999/xhtml">temporary network disconnects and down or busy services.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3053.1" xmlns="http://www.w3.org/1999/xhtml">In the client, an </span><code class="inlineCode"><span class="koboSpan" id="kobo.3054.1" xmlns="http://www.w3.org/1999/xhtml">RpcException</span></code><span class="koboSpan" id="kobo.3055.1" xmlns="http://www.w3.org/1999/xhtml"> could be thrown that includes details of the error.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3056.1" xmlns="http://www.w3.org/1999/xhtml">First, let’s add a transient fault to the gRPC service and see how the client handles it:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3057.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3058.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3059.1" xmlns="http://www.w3.org/1999/xhtml"> project, in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3060.1" xmlns="http://www.w3.org/1999/xhtml">Services</span></code><span class="koboSpan" id="kobo.3061.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.3062.1" xmlns="http://www.w3.org/1999/xhtml">GreeterService.cs</span></code><span class="koboSpan" id="kobo.3063.1" xmlns="http://www.w3.org/1999/xhtml">, modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3064.1" xmlns="http://www.w3.org/1999/xhtml">SayHello</span></code><span class="koboSpan" id="kobo.3065.1" xmlns="http://www.w3.org/1999/xhtml"> method to wait for one second and then, randomly, one in three times it should work but two in three times throw a service unavailable exception, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3066.1" xmlns="http://www.w3.org/1999/xhtml">public</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3067.1" xmlns="http://www.w3.org/1999/xhtml">override</span></span><span class="hljs-function"> </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3068.1" xmlns="http://www.w3.org/1999/xhtml">async</span></strong></span><span class="hljs-function"><span class="koboSpan" id="kobo.3069.1" xmlns="http://www.w3.org/1999/xhtml"> Task&lt;HelloReply&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.3070.1" xmlns="http://www.w3.org/1999/xhtml">SayHello</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3071.1" xmlns="http://www.w3.org/1999/xhtml">(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.3072.1" xmlns="http://www.w3.org/1999/xhtml">  HelloRequest request, ServerCallContext context</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3073.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.3074.1" xmlns="http://www.w3.org/1999/xhtml">
{
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3075.1" xmlns="http://www.w3.org/1999/xhtml">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3076.1" xmlns="http://www.w3.org/1999/xhtml"> Task.Delay(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3077.1" xmlns="http://www.w3.org/1999/xhtml">1000</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3078.1" xmlns="http://www.w3.org/1999/xhtml">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3079.1" xmlns="http://www.w3.org/1999/xhtml">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3080.1" xmlns="http://www.w3.org/1999/xhtml"> (Random.Shared.Next(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3081.1" xmlns="http://www.w3.org/1999/xhtml">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3082.1" xmlns="http://www.w3.org/1999/xhtml">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3083.1" xmlns="http://www.w3.org/1999/xhtml">4</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3084.1" xmlns="http://www.w3.org/1999/xhtml">) == </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3085.1" xmlns="http://www.w3.org/1999/xhtml">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3086.1" xmlns="http://www.w3.org/1999/xhtml">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3087.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3088.1" xmlns="http://www.w3.org/1999/xhtml">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3089.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3090.1" xmlns="http://www.w3.org/1999/xhtml"> HelloReply
    {
      Message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.3091.1" xmlns="http://www.w3.org/1999/xhtml">"Hello "</span></span><span class="koboSpan" id="kobo.3092.1" xmlns="http://www.w3.org/1999/xhtml"> + request.Name
    };
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3093.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3094.1" xmlns="http://www.w3.org/1999/xhtml">else</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3095.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3096.1" xmlns="http://www.w3.org/1999/xhtml">throw</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3097.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3098.1" xmlns="http://www.w3.org/1999/xhtml"> RpcException(</span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3099.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3100.1" xmlns="http://www.w3.org/1999/xhtml"> Status(StatusCode.Unavailable,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3101.1" xmlns="http://www.w3.org/1999/xhtml">"Service is temporarily unavailable. </span><span class="koboSpan" id="kobo.3101.2" xmlns="http://www.w3.org/1999/xhtml">Try again later."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3102.1" xmlns="http://www.w3.org/1999/xhtml">));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3103.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span><span class="koboSpan" id="kobo.3104.1" xmlns="http://www.w3.org/1999/xhtml">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3105.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3106.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3107.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3108.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3109.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.3110.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3111.1" xmlns="http://www.w3.org/1999/xhtml">On the home page, note the exception, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.3112.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.12</span></em><span class="koboSpan" id="kobo.3113.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3114.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3115.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.12: Service is unavailable exception</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.3116.1" xmlns="http://www.w3.org/1999/xhtml">If you don’t get an exception, refresh the page until you do.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3117.1" xmlns="http://www.w3.org/1999/xhtml">Close the browser and shut down the web servers.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.3118.1" xmlns="http://www.w3.org/1999/xhtml">Now, let’s see how to add transient fault handling to the MVC website client:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3119.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3120.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.3121.1" xmlns="http://www.w3.org/1999/xhtml"> project, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.3122.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3123.1" xmlns="http://www.w3.org/1999/xhtml">, before adding the greeter client to the services collection, add statements to define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.3124.1" xmlns="http://www.w3.org/1999/xhtml">MethodConfig</span></code><span class="koboSpan" id="kobo.3125.1" xmlns="http://www.w3.org/1999/xhtml"> with a retry</span><a id="_idIndexMarker1489"/><span class="koboSpan" id="kobo.3126.1" xmlns="http://www.w3.org/1999/xhtml"> policy that retries up to five times for status codes indicating an unavailable service, and then after configuring the greeter client address, apply the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3127.1" xmlns="http://www.w3.org/1999/xhtml">method config</span></code><span class="koboSpan" id="kobo.3128.1" xmlns="http://www.w3.org/1999/xhtml">, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3129.1" xmlns="http://www.w3.org/1999/xhtml">MethodConfig configForAllMethods = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3130.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3131.1" xmlns="http://www.w3.org/1999/xhtml">() </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3132.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3133.1" xmlns="http://www.w3.org/1999/xhtml">  Names = { MethodName.Default },</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3134.1" xmlns="http://www.w3.org/1999/xhtml">  RetryPolicy = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3135.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3136.1" xmlns="http://www.w3.org/1999/xhtml"> RetryPolicy</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3137.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3138.1" xmlns="http://www.w3.org/1999/xhtml">    MaxAttempts = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3139.1" xmlns="http://www.w3.org/1999/xhtml">5</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3140.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3141.1" xmlns="http://www.w3.org/1999/xhtml">    InitialBackoff = TimeSpan.FromSeconds(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3142.1" xmlns="http://www.w3.org/1999/xhtml">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3143.1" xmlns="http://www.w3.org/1999/xhtml">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3144.1" xmlns="http://www.w3.org/1999/xhtml">    MaxBackoff = TimeSpan.FromSeconds(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3145.1" xmlns="http://www.w3.org/1999/xhtml">5</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3146.1" xmlns="http://www.w3.org/1999/xhtml">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3147.1" xmlns="http://www.w3.org/1999/xhtml">    BackoffMultiplier = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3148.1" xmlns="http://www.w3.org/1999/xhtml">1.5</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3149.1" xmlns="http://www.w3.org/1999/xhtml">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3150.1" xmlns="http://www.w3.org/1999/xhtml">    RetryableStatusCodes = { StatusCode.Unavailable }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3151.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3152.1" xmlns="http://www.w3.org/1999/xhtml">};</span></strong></span><span class="koboSpan" id="kobo.3153.1" xmlns="http://www.w3.org/1999/xhtml">
builder.Services.AddGrpcClient&lt;Greeter.GreeterClient&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3154.1" xmlns="http://www.w3.org/1999/xhtml">"Greeter"</span></span><span class="koboSpan" id="kobo.3155.1" xmlns="http://www.w3.org/1999/xhtml">,
  options =&gt;
  {
    options.Address = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3156.1" xmlns="http://www.w3.org/1999/xhtml">new</span></span><span class="koboSpan" id="kobo.3157.1" xmlns="http://www.w3.org/1999/xhtml"> Uri(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3158.1" xmlns="http://www.w3.org/1999/xhtml">"https://localhost:5131"</span></span><span class="koboSpan" id="kobo.3159.1" xmlns="http://www.w3.org/1999/xhtml">);
  })
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3160.1" xmlns="http://www.w3.org/1999/xhtml">  .ConfigureChannel(channel =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3161.1" xmlns="http://www.w3.org/1999/xhtml">  {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3162.1" xmlns="http://www.w3.org/1999/xhtml">    channel.ServiceConfig = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3163.1" xmlns="http://www.w3.org/1999/xhtml">new</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3164.1" xmlns="http://www.w3.org/1999/xhtml"> ServiceConfig</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3165.1" xmlns="http://www.w3.org/1999/xhtml">    {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3166.1" xmlns="http://www.w3.org/1999/xhtml">      MethodConfigs = { configForAllMethods }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3167.1" xmlns="http://www.w3.org/1999/xhtml">    };</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3168.1" xmlns="http://www.w3.org/1999/xhtml">  })</span></strong></span><span class="koboSpan" id="kobo.3169.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3170.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3171.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3172.1" xmlns="http://www.w3.org/1999/xhtml"> project without debugging.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3173.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3174.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Client.Mvc</span></code><span class="koboSpan" id="kobo.3175.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3176.1" xmlns="http://www.w3.org/1999/xhtml">On the home page, note the home page might take a few seconds to appear, but eventually, it </span><a id="_idIndexMarker1490"/><span class="koboSpan" id="kobo.3177.1" xmlns="http://www.w3.org/1999/xhtml">will successfully appear with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3178.1" xmlns="http://www.w3.org/1999/xhtml">Hello Henrietta</span></code><span class="koboSpan" id="kobo.3179.1" xmlns="http://www.w3.org/1999/xhtml"> message from the gRPC service, and if you review the gRPC service output, it will include multiple attempts to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.3180.1" xmlns="http://www.w3.org/1999/xhtml">SayHello</span></code><span class="koboSpan" id="kobo.3181.1" xmlns="http://www.w3.org/1999/xhtml"> before finally working, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3182.1" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/2 POST https://localhost:5131/greet.Greeter/SayHello - application/grpc -
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'gRPC - /greet.Greeter/SayHello'
info: Grpc.AspNetCore.Server.ServerCallHandler[7]
      Error status code 'Unavailable' with detail 'Service is temporarily unavailable. </span><span class="koboSpan" id="kobo.3182.2" xmlns="http://www.w3.org/1999/xhtml">Try again later.' </span><span class="koboSpan" id="kobo.3182.3" xmlns="http://www.w3.org/1999/xhtml">raised.
</span><span class="koboSpan" id="kobo.3182.4" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'gRPC - /greet.Greeter/SayHello'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/2 POST https://localhost:5131/greet.Greeter/SayHello - 200 0 application/grpc 1039.4626ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/2 POST https://localhost:5131/greet.Greeter/SayHello - application/grpc -
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'gRPC - /greet.Greeter/SayHello'
info: Grpc.AspNetCore.Server.ServerCallHandler[7]
      Error status code 'Unavailable' with detail 'Service is temporarily unavailable. </span><span class="koboSpan" id="kobo.3182.5" xmlns="http://www.w3.org/1999/xhtml">Try again later.' </span><span class="koboSpan" id="kobo.3182.6" xmlns="http://www.w3.org/1999/xhtml">raised.
</span><span class="koboSpan" id="kobo.3182.7" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'gRPC - /greet.Greeter/SayHello'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/2 POST https://localhost:5131/greet.Greeter/SayHello - 200 0 application/grpc 1008.1375ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/2 POST https://localhost:5131/greet.Greeter/SayHello - application/grpc -
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'gRPC - /greet.Greeter/SayHello'
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'gRPC - /greet.Greeter/SayHello'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/2 POST https://localhost:5131/greet.Greeter/SayHello - 200 - application/grpc 1016.4590ms
</span></code></pre>
</li>
</ol>
<h1 class="heading-1" id="_idParaDest-502"><span class="koboSpan" id="kobo.3183.1" xmlns="http://www.w3.org/1999/xhtml">Implementing gRPC JSON transcoding</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3184.1" xmlns="http://www.w3.org/1999/xhtml">JSON is the most popular format for services that return data to a browser or mobile device. </span><span class="koboSpan" id="kobo.3184.2" xmlns="http://www.w3.org/1999/xhtml">It would be great if we</span><a id="_idIndexMarker1491"/><span class="koboSpan" id="kobo.3185.1" xmlns="http://www.w3.org/1999/xhtml"> could create a gRPC service and magically make it callable via non-HTTP/2 using JSON. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.3186.1" xmlns="http://www.w3.org/1999/xhtml">Thankfully, there is a solution.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3187.1" xmlns="http://www.w3.org/1999/xhtml">Microsoft has a technology they call </span><strong class="keyWord"><span class="koboSpan" id="kobo.3188.1" xmlns="http://www.w3.org/1999/xhtml">gRPC JSON transcoding</span></strong><span class="koboSpan" id="kobo.3189.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.3189.2" xmlns="http://www.w3.org/1999/xhtml">It is an ASP.NET Core extension that creates HTTP endpoints with JSON for gRPC services, based on Google’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.3190.1" xmlns="http://www.w3.org/1999/xhtml">HttpRule</span></code><span class="koboSpan" id="kobo.3191.1" xmlns="http://www.w3.org/1999/xhtml"> class for their gRPC transcoding.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.3192.1" xmlns="http://www.w3.org/1999/xhtml">More Information</span></strong><span class="koboSpan" id="kobo.3193.1" xmlns="http://www.w3.org/1999/xhtml">: You can read about Google’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.3194.1" xmlns="http://www.w3.org/1999/xhtml">HttpRule</span></code><span class="koboSpan" id="kobo.3195.1" xmlns="http://www.w3.org/1999/xhtml"> class at the following link: </span><a href="https://cloud.google.com/dotnet/docs/reference/Google.Api.CommonProtos/latest/Google.Api.HttpRule"><span class="url"><span class="koboSpan" id="kobo.3196.1" xmlns="http://www.w3.org/1999/xhtml">https://cloud.google.com/dotnet/docs/reference/Google.Api.CommonProtos/latest/Google.Api.HttpRule</span></span></a><span class="koboSpan" id="kobo.3197.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-503"><span class="koboSpan" id="kobo.3198.1" xmlns="http://www.w3.org/1999/xhtml">Enabling gRPC JSON transcoding</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3199.1" xmlns="http://www.w3.org/1999/xhtml">Let’s see how to enable</span><a id="_idIndexMarker1492"/><span class="koboSpan" id="kobo.3200.1" xmlns="http://www.w3.org/1999/xhtml"> gRPC JSON transcoding in our gRPC service:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3201.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3202.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3203.1" xmlns="http://www.w3.org/1999/xhtml"> project, add a package reference for gRPC JSON transcoding, as shown highlighted in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3204.1" xmlns="http://www.w3.org/1999/xhtml">&lt;ItemGroup&gt;
  &lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.3205.1" xmlns="http://www.w3.org/1999/xhtml">"Grpc.AspNetCore"</span></span><span class="koboSpan" id="kobo.3206.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.3207.1" xmlns="http://www.w3.org/1999/xhtml">"2.59.0"</span></span><span class="koboSpan" id="kobo.3208.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
  &lt;PackageReference Include=</span><span class="hljs-string"><span class="koboSpan" id="kobo.3209.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.Data.SqlClient"</span></span><span class="koboSpan" id="kobo.3210.1" xmlns="http://www.w3.org/1999/xhtml"> Version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.3211.1" xmlns="http://www.w3.org/1999/xhtml">"5.1.2"</span></span><span class="koboSpan" id="kobo.3212.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3213.1" xmlns="http://www.w3.org/1999/xhtml">  &lt;PackageReference Include=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3214.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore.Grpc.JsonTranscoding"</span></strong><strong class="hljs-slc"> </strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3215.1" xmlns="http://www.w3.org/1999/xhtml">                    Version=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3216.1" xmlns="http://www.w3.org/1999/xhtml">"8.0.0"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3217.1" xmlns="http://www.w3.org/1999/xhtml"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.3218.1" xmlns="http://www.w3.org/1999/xhtml">
&lt;/ItemGroup&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3219.1" xmlns="http://www.w3.org/1999/xhtml">Build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3220.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3221.1" xmlns="http://www.w3.org/1999/xhtml"> project to restore packages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3222.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3223.1" xmlns="http://www.w3.org/1999/xhtml">appsettings.json</span></code><span class="koboSpan" id="kobo.3224.1" xmlns="http://www.w3.org/1999/xhtml">, modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3225.1" xmlns="http://www.w3.org/1999/xhtml">Protocols</span></code><span class="koboSpan" id="kobo.3226.1" xmlns="http://www.w3.org/1999/xhtml"> option to enable HTTP/1.1 as well as HTTP/2, as shown highlighted</span><a id="_idIndexMarker1493"/><span class="koboSpan" id="kobo.3227.1" xmlns="http://www.w3.org/1999/xhtml"> in the following markup:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3228.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3229.1" xmlns="http://www.w3.org/1999/xhtml">"Logging"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3230.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.3231.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3232.1" xmlns="http://www.w3.org/1999/xhtml">"LogLevel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3233.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.3234.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3235.1" xmlns="http://www.w3.org/1999/xhtml">"Default"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3236.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3237.1" xmlns="http://www.w3.org/1999/xhtml">"Information"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3238.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3239.1" xmlns="http://www.w3.org/1999/xhtml">"Microsoft.AspNetCore"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3240.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3241.1" xmlns="http://www.w3.org/1999/xhtml">"Warning"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3242.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3243.1" xmlns="http://www.w3.org/1999/xhtml">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3244.1" xmlns="http://www.w3.org/1999/xhtml">"AllowedHosts"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3245.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3246.1" xmlns="http://www.w3.org/1999/xhtml">"*"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3247.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3248.1" xmlns="http://www.w3.org/1999/xhtml">"Kestrel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3249.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.3250.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3251.1" xmlns="http://www.w3.org/1999/xhtml">"EndpointDefaults"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3252.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.3253.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.3254.1" xmlns="http://www.w3.org/1999/xhtml">"Protocols"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.3255.1" xmlns="http://www.w3.org/1999/xhtml">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3256.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3257.1" xmlns="http://www.w3.org/1999/xhtml">Http1AndHttp2</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.3258.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3259.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3260.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.3261.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span>
</code></pre>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.3262.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.3263.1" xmlns="http://www.w3.org/1999/xhtml">: By default, a gRPC project will be configured to only allow HTTP/2 requests. </span><span class="koboSpan" id="kobo.3263.2" xmlns="http://www.w3.org/1999/xhtml">To support clients like </span><code class="inlineCode"><span class="koboSpan" id="kobo.3264.1" xmlns="http://www.w3.org/1999/xhtml">.http</span></code><span class="koboSpan" id="kobo.3265.1" xmlns="http://www.w3.org/1999/xhtml"> files in your code editor, or Unity, enable both HTTP/1.1 and HTTP/2. </span><span class="koboSpan" id="kobo.3265.2" xmlns="http://www.w3.org/1999/xhtml">Allowing HTTP/1.1 and HTTP/2 on the same port requires TLS for protocol negotiation, which is another good reason to leave HTTPS enabled in a gRPC service and therefore not use </span><code class="inlineCode"><span class="koboSpan" id="kobo.3266.1" xmlns="http://www.w3.org/1999/xhtml">CreateSlimBuilder</span></code><span class="koboSpan" id="kobo.3267.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</div></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.3268.1" xmlns="http://www.w3.org/1999/xhtml">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.3269.1" xmlns="http://www.w3.org/1999/xhtml">Program.cs</span></code><span class="koboSpan" id="kobo.3270.1" xmlns="http://www.w3.org/1999/xhtml">, add a call to add JSON transcoding after the call to add gRPC, as shown highlighted in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3271.1" xmlns="http://www.w3.org/1999/xhtml">builder.Services.AddGrpc()</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3272.1" xmlns="http://www.w3.org/1999/xhtml">.AddJsonTranscoding()</span></strong></span><span class="koboSpan" id="kobo.3273.1" xmlns="http://www.w3.org/1999/xhtml">;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3274.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3275.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3276.1" xmlns="http://www.w3.org/1999/xhtml"> project/folder, add a folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3277.1" xmlns="http://www.w3.org/1999/xhtml">google</span></code><span class="koboSpan" id="kobo.3278.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3279.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3280.1" xmlns="http://www.w3.org/1999/xhtml">google</span></code><span class="koboSpan" id="kobo.3281.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add a folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3282.1" xmlns="http://www.w3.org/1999/xhtml">api</span></code><span class="koboSpan" id="kobo.3283.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3284.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3285.1" xmlns="http://www.w3.org/1999/xhtml">api</span></code><span class="koboSpan" id="kobo.3286.1" xmlns="http://www.w3.org/1999/xhtml"> folder, add two </span><code class="inlineCode"><span class="koboSpan" id="kobo.3287.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.3288.1" xmlns="http://www.w3.org/1999/xhtml"> files named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3289.1" xmlns="http://www.w3.org/1999/xhtml">http.proto</span></code><span class="koboSpan" id="kobo.3290.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3291.1" xmlns="http://www.w3.org/1999/xhtml">annotations.proto</span></code><span class="koboSpan" id="kobo.3292.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3293.1" xmlns="http://www.w3.org/1999/xhtml">Copy and paste the raw contents for the two files from the files found at the following link: </span><a href="https://github.com/dotnet/aspnetcore/tree/main/src/Grpc/JsonTranscoding/test/testassets/Sandbox/google/api"><span class="url"><span class="koboSpan" id="kobo.3294.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/dotnet/aspnetcore/tree/main/src/Grpc/JsonTranscoding/test/testassets/Sandbox/google/api</span></span></a><span class="koboSpan" id="kobo.3295.1" xmlns="http://www.w3.org/1999/xhtml">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3296.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3297.1" xmlns="http://www.w3.org/1999/xhtml">Protos</span></code><span class="koboSpan" id="kobo.3298.1" xmlns="http://www.w3.org/1999/xhtml"> folder, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.3299.1" xmlns="http://www.w3.org/1999/xhtml">employee.proto</span></code><span class="koboSpan" id="kobo.3300.1" xmlns="http://www.w3.org/1999/xhtml">, import the annotations </span><code class="inlineCode"><span class="koboSpan" id="kobo.3301.1" xmlns="http://www.w3.org/1999/xhtml">.proto</span></code><span class="koboSpan" id="kobo.3302.1" xmlns="http://www.w3.org/1999/xhtml"> file, and use it to add an</span><a id="_idIndexMarker1494"/><span class="koboSpan" id="kobo.3303.1" xmlns="http://www.w3.org/1999/xhtml"> option to expose an endpoint to make an HTTP request to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3304.1" xmlns="http://www.w3.org/1999/xhtml">GetEmployee</span></code><span class="koboSpan" id="kobo.3305.1" xmlns="http://www.w3.org/1999/xhtml"> method, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3306.1" xmlns="http://www.w3.org/1999/xhtml">syntax = </span><span class="hljs-string"><span class="koboSpan" id="kobo.3307.1" xmlns="http://www.w3.org/1999/xhtml">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3308.1" xmlns="http://www.w3.org/1999/xhtml">proto3"</span></span><span class="koboSpan" id="kobo.3309.1" xmlns="http://www.w3.org/1999/xhtml">;
option csharp_namespace = </span><span class="hljs-string"><span class="koboSpan" id="kobo.3310.1" xmlns="http://www.w3.org/1999/xhtml">"Northwind.Grpc.Service"</span></span><span class="koboSpan" id="kobo.3311.1" xmlns="http://www.w3.org/1999/xhtml">;
import </span><span class="hljs-string"><span class="koboSpan" id="kobo.3312.1" xmlns="http://www.w3.org/1999/xhtml">"google/protobuf/duration.proto"</span></span><span class="koboSpan" id="kobo.3313.1" xmlns="http://www.w3.org/1999/xhtml">;
import </span><span class="hljs-string"><span class="koboSpan" id="kobo.3314.1" xmlns="http://www.w3.org/1999/xhtml">"google/protobuf/timestamp.proto"</span></span><span class="koboSpan" id="kobo.3315.1" xmlns="http://www.w3.org/1999/xhtml">;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3316.1" xmlns="http://www.w3.org/1999/xhtml">import </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3317.1" xmlns="http://www.w3.org/1999/xhtml">"google/api/annotations.proto"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3318.1" xmlns="http://www.w3.org/1999/xhtml">;</span></strong></span><span class="koboSpan" id="kobo.3319.1" xmlns="http://www.w3.org/1999/xhtml">
package employee;
service Employee {
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.3320.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.3321.1" xmlns="http://www.w3.org/1999/xhtml">GetEmployee</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3322.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3323.1" xmlns="http://www.w3.org/1999/xhtml">EmployeeRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3324.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.3325.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3326.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3327.1" xmlns="http://www.w3.org/1999/xhtml">EmployeeReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3328.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3329.1" xmlns="http://www.w3.org/1999/xhtml">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3330.1" xmlns="http://www.w3.org/1999/xhtml">    option (google.api.http) = {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3331.1" xmlns="http://www.w3.org/1999/xhtml">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3332.1" xmlns="http://www.w3.org/1999/xhtml">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3333.1" xmlns="http://www.w3.org/1999/xhtml">"/v1/employee/{employee_id}"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3334.1" xmlns="http://www.w3.org/1999/xhtml">    };</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3335.1" xmlns="http://www.w3.org/1999/xhtml">  }</span></strong></span><span class="koboSpan" id="kobo.3336.1" xmlns="http://www.w3.org/1999/xhtml">;
  </span><span class="hljs-function"><span class="koboSpan" id="kobo.3337.1" xmlns="http://www.w3.org/1999/xhtml">rpc </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.3338.1" xmlns="http://www.w3.org/1999/xhtml">GetEmployees</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3339.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3340.1" xmlns="http://www.w3.org/1999/xhtml">EmployeesRequest</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3341.1" xmlns="http://www.w3.org/1999/xhtml">) </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.3342.1" xmlns="http://www.w3.org/1999/xhtml">returns</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3343.1" xmlns="http://www.w3.org/1999/xhtml"> (</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3344.1" xmlns="http://www.w3.org/1999/xhtml">EmployeesReply</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3345.1" xmlns="http://www.w3.org/1999/xhtml">)</span></span><span class="koboSpan" id="kobo.3346.1" xmlns="http://www.w3.org/1999/xhtml">;
}
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-504"><span class="koboSpan" id="kobo.3347.1" xmlns="http://www.w3.org/1999/xhtml">Testing gRPC JSON transcoding</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3348.1" xmlns="http://www.w3.org/1999/xhtml">Now we can start the gRPC </span><a id="_idIndexMarker1495"/><span class="koboSpan" id="kobo.3349.1" xmlns="http://www.w3.org/1999/xhtml">service and call it directly from any browser:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3350.1" xmlns="http://www.w3.org/1999/xhtml">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3351.1" xmlns="http://www.w3.org/1999/xhtml">Northwind.Grpc.Service</span></code><span class="koboSpan" id="kobo.3352.1" xmlns="http://www.w3.org/1999/xhtml"> project.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3353.1" xmlns="http://www.w3.org/1999/xhtml">Start any browser, show the developer tools, and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.3354.1" xmlns="http://www.w3.org/1999/xhtml">Network</span></strong><span class="koboSpan" id="kobo.3355.1" xmlns="http://www.w3.org/1999/xhtml"> tab to start recording network traffic.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3356.1" xmlns="http://www.w3.org/1999/xhtml">Navigate to a URL to make a </span><code class="inlineCode"><span class="koboSpan" id="kobo.3357.1" xmlns="http://www.w3.org/1999/xhtml">GET</span></code><span class="koboSpan" id="kobo.3358.1" xmlns="http://www.w3.org/1999/xhtml"> request that will call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3359.1" xmlns="http://www.w3.org/1999/xhtml">GetEmployee</span></code><span class="koboSpan" id="kobo.3360.1" xmlns="http://www.w3.org/1999/xhtml"> method, </span><code class="inlineCode"><span class="koboSpan" id="kobo.3361.1" xmlns="http://www.w3.org/1999/xhtml">https://localhost:5131/v1/employee/1</span></code><span class="koboSpan" id="kobo.3362.1" xmlns="http://www.w3.org/1999/xhtml">, and note the JSON response returned by the gRPC service, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.3363.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.13</span></em><span class="koboSpan" id="kobo.3364.1" xmlns="http://www.w3.org/1999/xhtml">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3365.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="" src="../Images/B19587_13_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3366.1" xmlns="http://www.w3.org/1999/xhtml">Figure 13.13: Making an HTTP 1.1 GET request to a gRPC service and receiving a response in JSON</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.3367.1" xmlns="http://www.w3.org/1999/xhtml">In your code editor, in </span><a id="_idIndexMarker1496"/><span class="koboSpan" id="kobo.3368.1" xmlns="http://www.w3.org/1999/xhtml">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3369.1" xmlns="http://www.w3.org/1999/xhtml">HttpRequests</span></code><span class="koboSpan" id="kobo.3370.1" xmlns="http://www.w3.org/1999/xhtml"> folder, create a new file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.3371.1" xmlns="http://www.w3.org/1999/xhtml">grpc-json-transcoding.http</span></code><span class="koboSpan" id="kobo.3372.1" xmlns="http://www.w3.org/1999/xhtml">, and add statements to make requests for employees using HTTP/1.1, as shown in the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.3373.1" xmlns="http://www.w3.org/1999/xhtml">### Configure a variable for the gRPC service base address.</span></span><span class="koboSpan" id="kobo.3374.1" xmlns="http://www.w3.org/1999/xhtml">
@base_address = https:</span><span class="hljs-comment"><span class="koboSpan" id="kobo.3375.1" xmlns="http://www.w3.org/1999/xhtml">//localhost:5131/</span></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.3376.1" xmlns="http://www.w3.org/1999/xhtml">### Get Nancy Davolio.</span></span><span class="koboSpan" id="kobo.3377.1" xmlns="http://www.w3.org/1999/xhtml">
GET {{base_address}}v1/employee/</span><span class="hljs-number"><span class="koboSpan" id="kobo.3378.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.3379.1" xmlns="http://www.w3.org/1999/xhtml">### Get Andrew Fuller Davolio.</span></span><span class="koboSpan" id="kobo.3380.1" xmlns="http://www.w3.org/1999/xhtml">
GET {{base_address}}v1/employee/</span><span class="hljs-number"><span class="koboSpan" id="kobo.3381.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3382.1" xmlns="http://www.w3.org/1999/xhtml">Send both requests, confirm the responses are correct, and then review the gRPC service command prompt or terminal to confirm that the requests were made using HTTP/1.1, as shown in the following output:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3383.1" xmlns="http://www.w3.org/1999/xhtml">info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 GET https://localhost:5131/v1/employee/2 - - -
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'gRPC - /v1/employee/{employee_id}'
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'gRPC - /v1/employee/{employee_id}'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 GET https://localhost:5131/v1/employee/2 - 200 - application/json;+charset=utf-8 7.9328ms
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3384.1" xmlns="http://www.w3.org/1999/xhtml">Close the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3385.1" xmlns="http://www.w3.org/1999/xhtml">.http</span></code><span class="koboSpan" id="kobo.3386.1" xmlns="http://www.w3.org/1999/xhtml"> file, close </span><a id="_idIndexMarker1497"/><span class="koboSpan" id="kobo.3387.1" xmlns="http://www.w3.org/1999/xhtml">the browser, and shut down the web server.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-505"><span class="koboSpan" id="kobo.3388.1" xmlns="http://www.w3.org/1999/xhtml">Comparing with gRPC-Web</span></h2>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.3389.1" xmlns="http://www.w3.org/1999/xhtml">gRPC-Web</span></strong><span class="koboSpan" id="kobo.3390.1" xmlns="http://www.w3.org/1999/xhtml"> is an alternative to gRPC JSON transcoding to allow gRPC services to be called from a browser. </span><span class="koboSpan" id="kobo.3390.2" xmlns="http://www.w3.org/1999/xhtml">gRPC-Web achieves </span><a id="_idIndexMarker1498"/><span class="koboSpan" id="kobo.3391.1" xmlns="http://www.w3.org/1999/xhtml">this by executing a gRPC-Web client inside the browser. </span><span class="koboSpan" id="kobo.3391.2" xmlns="http://www.w3.org/1999/xhtml">This has the advantage that the communications between the browser and gRPC service use Protobuf and therefore get all the performance and scalability benefits of true gRPC communication.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3392.1" xmlns="http://www.w3.org/1999/xhtml">As you have seen, gRPC JSON transcoding allows browsers to call gRPC services as if they were HTTP APIs with JSON. </span><span class="koboSpan" id="kobo.3392.2" xmlns="http://www.w3.org/1999/xhtml">The browser needs to know nothing about gRPC. </span><span class="koboSpan" id="kobo.3392.3" xmlns="http://www.w3.org/1999/xhtml">The gRPC service is responsible for converting those HTTP API calls into calls to the actual gRPC service implementation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3393.1" xmlns="http://www.w3.org/1999/xhtml">To simplify and summarize:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3394.1" xmlns="http://www.w3.org/1999/xhtml">gRPC JSON transcoding happens on the server side.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3395.1" xmlns="http://www.w3.org/1999/xhtml">gRPC-Web happens on the client side.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.3396.1" xmlns="http://www.w3.org/1999/xhtml">Good Practice</span></strong><span class="koboSpan" id="kobo.3397.1" xmlns="http://www.w3.org/1999/xhtml">: Add gRPC JSON transcoding support to all your gRPC services hosted in ASP.NET Core. </span><span class="koboSpan" id="kobo.3397.2" xmlns="http://www.w3.org/1999/xhtml">This provides the best of both worlds. </span><span class="koboSpan" id="kobo.3397.3" xmlns="http://www.w3.org/1999/xhtml">Clients that cannot use gRPC natively can call the Web API. </span><span class="koboSpan" id="kobo.3397.4" xmlns="http://www.w3.org/1999/xhtml">Clients that can use gRPC natively can call it directly.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-506"><span class="koboSpan" id="kobo.3398.1" xmlns="http://www.w3.org/1999/xhtml">Practicing and exploring</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3399.1" xmlns="http://www.w3.org/1999/xhtml">Test your knowledge and understanding by answering some questions, getting some hands-on practice, and exploring this chapter’s topics with deeper research.</span></p>
<h2 class="heading-2" id="_idParaDest-507"><span class="koboSpan" id="kobo.3400.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 13.1 – Test your knowledge</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3401.1" xmlns="http://www.w3.org/1999/xhtml">Answer the following questions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.3402.1" xmlns="http://www.w3.org/1999/xhtml">What are three benefits of gRPC that make it a good choice for implementing services?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3403.1" xmlns="http://www.w3.org/1999/xhtml">How are contracts defined in gRPC?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3404.1" xmlns="http://www.w3.org/1999/xhtml">Which of the following .NET types require extensions to be imported: </span><code class="inlineCode"><span class="koboSpan" id="kobo.3405.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.3406.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.3407.1" xmlns="http://www.w3.org/1999/xhtml">double</span></code><span class="koboSpan" id="kobo.3408.1" xmlns="http://www.w3.org/1999/xhtml">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.3409.1" xmlns="http://www.w3.org/1999/xhtml">DateTime</span></code><span class="koboSpan" id="kobo.3410.1" xmlns="http://www.w3.org/1999/xhtml">?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3411.1" xmlns="http://www.w3.org/1999/xhtml">Why should you set a deadline when calling a gRPC method?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.3412.1" xmlns="http://www.w3.org/1999/xhtml">What are the benefits of enabling gRPC JSON transcoding to a gRPC service hosted in ASP.NET Core?</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-508"><span class="koboSpan" id="kobo.3413.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 13.2 – Compare gRPC services with HTTP APIs</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3414.1" xmlns="http://www.w3.org/1999/xhtml">Review the article found at the following link:</span></p>
<p class="normal"><a href="https://learn.microsoft.com/en-us/aspnet/core/grpc/comparison"><span class="url"><span class="koboSpan" id="kobo.3415.1" xmlns="http://www.w3.org/1999/xhtml">https://learn.microsoft.com/en-us/aspnet/core/grpc/comparison</span></span></a></p>
<h2 class="heading-2" id="_idParaDest-509"><span class="koboSpan" id="kobo.3416.1" xmlns="http://www.w3.org/1999/xhtml">Exercise 13.3 – Explore topics</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3417.1" xmlns="http://www.w3.org/1999/xhtml">Use the links on the following page to learn more details about the topics covered in this chapter:</span></p>
<p class="normal"><a href="https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-13---building-efficient-microservices-using-grpc"><span class="url"><span class="koboSpan" id="kobo.3418.1" xmlns="http://www.w3.org/1999/xhtml">https://github.com/markjprice/apps-services-net8/blob/main/docs/book-links.md#chapter-13---building-efficient-microservices-using-grpc</span></span></a></p>
<h1 class="heading-1" id="_idParaDest-510"><span class="koboSpan" id="kobo.3419.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3420.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, you:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3421.1" xmlns="http://www.w3.org/1999/xhtml">Learned about some concepts of gRPC services, how they work, and their benefits.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3422.1" xmlns="http://www.w3.org/1999/xhtml">Implemented a simple gRPC service.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3423.1" xmlns="http://www.w3.org/1999/xhtml">Implemented a gRPC service that uses an EF Core model that cannot yet use AOT publish.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3424.1" xmlns="http://www.w3.org/1999/xhtml">Implemented a gRPC service that uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.3425.1" xmlns="http://www.w3.org/1999/xhtml">SqlClient</span></code><span class="koboSpan" id="kobo.3426.1" xmlns="http://www.w3.org/1999/xhtml"> libraries that can use AOT publish and are therefore smaller and faster.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3427.1" xmlns="http://www.w3.org/1999/xhtml">Learned how to set deadlines and read metadata sent as headers and trailers.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3428.1" xmlns="http://www.w3.org/1999/xhtml">Implemented a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.3429.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.3430.1" xmlns="http://www.w3.org/1999/xhtml"> type and used extended date/time types.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3431.1" xmlns="http://www.w3.org/1999/xhtml">Implemented a client-side interceptor.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3432.1" xmlns="http://www.w3.org/1999/xhtml">Extended a gRPC service with support for being called as an HTTP service with JSON, to support clients that cannot work with gRPC natively.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.3433.1" xmlns="http://www.w3.org/1999/xhtml">In the next chapter, you will review how to build website user interfaces using ASP.NET Core MVC.</span></p>
</div>
</body>
</html>
