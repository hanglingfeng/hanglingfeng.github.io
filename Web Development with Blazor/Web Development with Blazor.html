<!DOCTYPE html><html><head>
      <title>Web Development with Blazor</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Hang\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.13\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="managing-state--part-1-管理状态---第1部分">Managing State – Part 1 管理状态 - 第1部分 </h1>
<h2 id="creating-a-data-project-创建数据项目">Creating a data project 创建数据项目 </h2>
<p>创建2个类库项目，分别命名为Data和Data.Models，目的是为了让它们的功能易于理解，并且方便查找。默认生成的Class1.cs文件可以删除。</p>
<h2 id="creating-data-classes-创建数据类">Creating data classes 创建数据类 </h2>
<ol>
<li>现在我们需要创建3个数据类。右键单击Data.Models项目，添加一个文件夹，命名为Model。</li>
<li>在Model文件夹添加3个数据类，分别命名为BlogPost.cs、Category.cs、Tag.cs。</li>
<li>Category.cs代码如下：</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Data<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Category</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">?</span></span> Id <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><p>可能有人会觉得Id属性被定义为字符串类型有些奇怪，但这主要是因为我们打算支持多种不同的数据存储类型，包括MSSQL、RavenDB以及JSON。字符串是一种能够兼容所有这些数据库系统的优秀数据类型。</p>
<ol start="4">
<li>Tag.cs代码如下：</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Data<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Tag</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">?</span></span> Id <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><ol start="5">
<li>BlogPost.cs代码如下：</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Data<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">BlogPost</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">?</span></span> Id <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Title <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Text <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">DateTime</span> PublishDate <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">Category<span class="token punctuation">?</span></span> Category <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">&gt;</span></span> Tags <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><p>在这个类中，我们定义了博客文章的内容。为了识别每篇博客文章，我们需要一个Id属性，同时包括标题、正文（文章内容）和发布日期等属性。此外，我们在该类中定义了一个Category属性，其类型为Category。这意味着一篇博客文章只能属于一个类别，而对于标签，则更加灵活，一篇博客文章可以包含零个或多个标签。因此，我们使用List<tag>类型来定义Tag属性。</tag></p>
<h2 id="creating-an-interface-创建接口">Creating an interface 创建接口 </h2>
<ol>
<li>右键单击Data.Models项目，添加一个文件夹，命名为Interfaces。</li>
<li>在Model文件夹添加1个接口，名为IBlogApi.cs。<br>
IBlogApi.cs代码如下：</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Data<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>Interfaces</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">IBlogApi</span> <span class="token punctuation">{</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetBlogPostCountAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">&gt;</span><span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetBlogPostsAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> numberofposts<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> startindex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>Category<span class="token punctuation">&gt;</span><span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCategoriesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">&gt;</span><span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetTagsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetBlogPostAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Category<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCategoryAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetTagAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">SaveBlogPostAsync</span><span class="token punctuation">(</span><span class="token class-name">BlogPost</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Category<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">SaveCategoryAsync</span><span class="token punctuation">(</span><span class="token class-name">Category</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">SaveTagAsync</span><span class="token punctuation">(</span><span class="token class-name">Tag</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">DeleteBlogPostAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">DeleteCategoryAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">DeleteTagAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">InvalidateCacheAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><h2 id="implementing-the-interface-实现接口">Implementing the interface 实现接口 </h2>
<p>这个想法是创建一个类，将我们的博客文章、标签和类别作为JSON文件存储在文件系统中。</p>
<ol>
<li>我们需要向我们的Data模型添加引用。展开Data项目，然后右键点击“Dependencies”节点。选择“添加项目引用”，并勾选“Data.Models”项目。</li>
<li>再次右键点击“Dependencies”节点，但这次选择“管理NuGet包”。搜索“Microsoft.Extensions.Options”，然后点击“安装”。</li>
<li>我们需要创建一个类。在Data项目上右键点击，选择“添加”|“类”，并将这个类命名为“BlogApiJsonDirectAccess.cs”，代码如下：</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Data</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">BlogApiJsonDirectAccess</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IBlogApi</span></span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
</code></pre><ol start="4">
<li>我们需要一个类来保存我们的设置。在Data项目上继续添加类，命名为“BlogApiJsonDirectAccessSetting.cs”，代码如下：</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Data</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">BlogApiJsonDirectAccessSetting</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> BlogPostsFolder <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> CategoriesFolder <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> TagsFolder <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> DataPath <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><ol start="5">
<li>为了能够读取配置设置，我们还会添加一种注入IOptions的方式。IOptions在程序启动时，在配置依赖关系阶段进行配置，并注入到所有请求特定类型的类中。通过这种方式获取设置，我们无需编写任何代码——它可以来自数据库、配置文件，甚至是硬编码。这是我获取设置最喜欢的方式，因为这部分代码本身并不知道如何实现这一功能——相反，我们通过依赖注入的方式来添加所有的配置设置。这样一来，代码自身与配置源解耦，提高了灵活性和可维护性。<br>
BlogApiJsonDirectAccess.cs代码如下：</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Data</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">BlogApiJsonDirectAccess</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IBlogApi</span></span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> _blogPosts<span class="token punctuation">;</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>Category<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> _categories<span class="token punctuation">;</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> _tags<span class="token punctuation">;</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name">BlogApiJsonDirectAccessSetting</span> _settings<span class="token punctuation">;</span>
        <span class="token keyword keyword-public">public</span> <span class="token function">BlogApiJsonDirectAccess</span><span class="token punctuation">(</span><span class="token class-name">IOptions<span class="token punctuation">&lt;</span>BlogApiJsonDirectAccessSetting<span class="token punctuation">&gt;</span></span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _settings <span class="token operator">=</span> option<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>_settings<span class="token punctuation">.</span>DataPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>_settings<span class="token punctuation">.</span>DataPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>BlogPostsFolder</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>BlogPostsFolder</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>CategoriesFolder</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>CategoriesFolder</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>TagsFolder</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>TagsFolder</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// Load 方法是一个通用方法，它允许我们使用相同的方法加载博客文章、标记和类别。</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeparam</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>T<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeparam</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>folder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token generic-method"><span class="token function">Load</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-ref">ref</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> list<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> folder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>list <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-var">var</span></span> fullpath <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">folder</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> f <span class="token keyword keyword-in">in</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>fullpath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> json <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllText</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> bp <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bp <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>bp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadBlogPostsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token generic-method"><span class="token function">Load</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-ref">ref</span> _blogPosts<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>BlogPostsFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadTagsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token generic-method"><span class="token function">Load</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Tag<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-ref">ref</span> _tags<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>TagsFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadCategoriesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token generic-method"><span class="token function">Load</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Category<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-ref">ref</span> _categories<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>CategoriesFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">SaveAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> list<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> folder<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> filename<span class="token punctuation">,</span> <span class="token class-name">T</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword keyword-var">var</span></span> filepath <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">folder</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">filename</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
            <span class="token keyword keyword-await">await</span> File<span class="token punctuation">.</span><span class="token function">WriteAllTextAsync</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Serialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>list <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token generic-method"><span class="token function">DeleteAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> list<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> folder<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword keyword-var">var</span></span> filepath <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_settings<span class="token punctuation">.</span>DataPath</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">folder</span><span class="token punctuation">}</span></span><span class="token string">\</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">id</span><span class="token punctuation">}</span></span><span class="token string">.json"</span></span><span class="token punctuation">;</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                File<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">&gt;</span><span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetBlogPostsAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> numberofposts<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> startindex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-await">await</span> <span class="token function">LoadBlogPostsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> _blogPosts <span class="token operator">??</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetBlogPostAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-await">await</span> <span class="token function">LoadBlogPostsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_blogPosts <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"Blog posts not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> _blogPosts<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetBlogPostCountAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-await">await</span> <span class="token function">LoadBlogPostsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_blogPosts <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                <span class="token keyword keyword-return">return</span> _blogPosts<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>Category<span class="token punctuation">&gt;</span><span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCategoriesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-await">await</span> <span class="token function">LoadCategoriesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> _categories <span class="token operator">??</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Category<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCategoryAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-await">await</span> <span class="token function">LoadCategoriesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_categories <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"Categories not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> _categories<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">&gt;</span><span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetTagsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-await">await</span> <span class="token function">LoadTagsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> _tags <span class="token operator">??</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetTagAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-await">await</span> <span class="token function">LoadTagsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_tags <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"Tags not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> _tags<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">SaveBlogPostAsync</span><span class="token punctuation">(</span><span class="token class-name">BlogPost</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>Id <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-await">await</span> <span class="token generic-method"><span class="token function">SaveAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>_blogPosts<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>BlogPostsFolder<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">item<span class="token punctuation">.</span>Id</span><span class="token punctuation">}</span></span><span class="token string">.json"</span></span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Category<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">SaveCategoryAsync</span><span class="token punctuation">(</span><span class="token class-name">Category</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>Id <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-await">await</span> <span class="token generic-method"><span class="token function">SaveAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Category<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>_categories<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>CategoriesFolder<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">item<span class="token punctuation">.</span>Id</span><span class="token punctuation">}</span></span><span class="token string">.json"</span></span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Tag<span class="token punctuation">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">SaveTagAsync</span><span class="token punctuation">(</span><span class="token class-name">Tag</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>Id <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-await">await</span> <span class="token generic-method"><span class="token function">SaveAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Tag<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>_tags<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>TagsFolder<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">item<span class="token punctuation">.</span>Id</span><span class="token punctuation">}</span></span><span class="token string">.json"</span></span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">Task</span> <span class="token function">DeleteBlogPostAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">DeleteAsync</span><span class="token punctuation">(</span>_blogPosts<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>BlogPostsFolder<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_blogPosts <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword keyword-var">var</span></span> item <span class="token operator">=</span> _blogPosts<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _blogPosts<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">Task</span> <span class="token function">DeleteCategoryAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">DeleteAsync</span><span class="token punctuation">(</span>_categories<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>CategoriesFolder<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_categories <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword keyword-var">var</span></span> item <span class="token operator">=</span> _categories<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _categories<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">Task</span> <span class="token function">DeleteTagAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">DeleteAsync</span><span class="token punctuation">(</span>_tags<span class="token punctuation">,</span> _settings<span class="token punctuation">.</span>TagsFolder<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>_tags <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword keyword-var">var</span></span> item <span class="token operator">=</span> _tags<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    _tags<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// 清除缓存</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">Task</span> <span class="token function">InvalidateCacheAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _blogPosts <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
            _tags <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
            _categories <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><p>我们的JSON存储完成了！最后，文件系统中将存储3个文件夹，一个用于blog post，一个用于categories，另一个用于tags。下一步是添加和配置Blazor项目来使用我们的新存储。</p>
<h2 id="adding-the-api-to-blazor-将api添加到blzor">Adding the API to Blazor 将API添加到Blzor </h2>
<p>现在是时候将API添加到Blazor Server项目中了：</p>
<ol>
<li>新建Blazor Server项目，并添加对Data项目的引用。</li>
<li>打开Program.cs文件，添加以下代码。</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddOptions</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BlogApiJsonDirectAccessSetting<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>DataPath <span class="token operator">=</span> <span class="token string">@"..\..\..\Data\";
        options.BlogPostsFolder = "</span>Blogposts"<span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>TagsFolder <span class="token operator">=</span> <span class="token string">"Tags"</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>CategoriesFolder <span class="token operator">=</span> <span class="token string">"Categories"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IBlogApi<span class="token punctuation">,</span> BlogApiJsonDirectAccess<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这段代码片段是我们用于指定文件存储位置的设置。您可以根据需求更改DataPath属性以指定文件存储的具体路径。无论何时我们请求IOptions<blogapijsondirectaccesssetting>，依赖注入机制都会返回一个填充了上述已提供的信息的对象。这是一个绝佳的位置，可以从.NET配置、密钥保管库或数据库加载配置信息。</blogapijsondirectaccesssetting></p>
<p>另外，这里我们也指定了当我们请求IBlogAPI接口时，依赖注入将会返回一个BlogApiJsonDirectAccess类的实例。关于依赖注入的深入探讨，我们将在第四章“理解基本Blazor组件”中进一步讲解。</p>
<p>现在我们可以使用我们的API来访问Blazor Server项目中的数据库。</p>
<h2 id="understanding-basic-blazor-components-理解基本的blozor组件">Understanding Basic Blazor Components 理解基本的Blozor组件 </h2>
<h2 id="counter-计数器">Counter 计数器 </h2>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary<span class="token punctuation">"</span></span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IncrementCount<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点击我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>这是一个带有Bootstrap样式的HTML按钮（使其看起来更美观）。@onclick将按钮的onclick事件绑定到IncrementCount()方法。如果我们不使用@而直接使用onclick，那么它将引用JavaScript事件而非Blazor中的方法，因此无法正常工作。</p>
<p>Counter组件在Blazor WebAssembly和Blazor Server中的实现方式是类似的。FetchData组件之所以有两种不同的实现方式，是因为Blazor Server项目可以直接访问服务器端的数据，而Blazor WebAssembly则需要通过Web API来访问这些数据。</p>
<p>我们使用同样的方法来使用我们的API，以便在使用Blazor Server时，我们可以了解如何利用依赖注入(DI)并直接连接到数据库。</p>
<h2 id="fetchdata-获取数据">FetchData 获取数据 </h2>
<p>FetchData组件(.net8中是Weather组件)在Pages/FetchData.razor中。</p>
<h2 id="learning-razor-syntax-学习razor语法">Learning Razor syntax 学习Razor语法 </h2>
<p>要从HTML转换到C#代码，我们使用@符号。</p>
<h3 id="razor-code-blocks-razor代码块">Razor code blocks Razor代码块 </h3>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token comment">//your code here</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>如果我们愿意，可以像这样跳过code关键字：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token block"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token comment">//your code here</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>在这些花括号中，我们可以像这样混合HTML和代码：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token block"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">RenderName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">name</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token punctuation">}</span>
        <span class="token function">RenderName</span><span class="token punctuation">(</span><span class="token string">"Steve Sanderson"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RenderName</span><span class="token punctuation">(</span><span class="token string">"Daniel Roth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>请注意，在RenderName()方法中，代码是如何在段落标签之间自如切换的，这是一种隐式转换。当Blazor遇到@符号时，它会解析并执行紧跟在其后的C#代码或表达式，并将结果输出到HTML中。</p>
<p>生成的对应html如下：</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content px-4<span class="token punctuation">"</span></span> <span class="token attr-name">b-1xn416caqo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        Welcome to your new app.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Steve Sanderson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Daniel Roth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>如果希望输出纯文本而不借助HTML标签，可以使用<text>标签代替段落标签，如下例所示：</text></p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">name</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>生成的对应html如下：</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content px-4<span class="token punctuation">"</span></span> <span class="token attr-name">b-1xn416caqo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        Welcome to your new app.
        Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Steve Sanderson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Daniel Roth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>这样渲染的结果将与之前使用段落标签的代码相同，但不会包含段落标签，而且<text>标签本身也不会被渲染到最终的HTML文档中。</text></p>
<h3 id="implicit-razor-expressions-隐式razor表达式">Implicit Razor expressions 隐式Razor表达式 </h3>
<p>隐式Razor表达式是在HTML标签中添加代码时使用的。</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">forecast<span class="token punctuation">.</span>Summary</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>我们从一个标签开始，然后使用@符号切换到C#代码，并通过结束标签切换回HTML。我们可以在方法调用时配合使用await关键字，但是除了这种方法之外，隐式Razor表达式不能包含任何空格。</p>
<p>由于&lt;&gt;在HTML中会被解析为标签符号，所以我们不能使用隐式表达式来调用泛型方法。为解决这个问题，我们可以使用显式表达式。</p>
<h3 id="explicit-razor-expressions-显式razor表达式">Explicit Razor expressions 显式Razor表达式 </h3>
<p>如果我们想在代码中使用空格，可以使用显式Razor表达式。具体做法是在@符号后面跟随一对圆括号()来编写代码。其形式如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now <span class="token operator">-</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromDays</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>使用显式表达式，我们可以轻松地使用以下语法调用泛型方法：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span><span class="token generic-method"><span class="token function">MyGenericMethod</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword keyword-string">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>Razor引擎知道我们是否在使用代码，它还确保在将字符串输出到浏览器时将其编码为HTML，这被称为表达式编码。</p>
<h3 id="expression-encoding-表达式编码">Expression encoding 表达式编码 </h3>
<p>如果我们将HTML作为字符串，则默认情况下将对其进行转义。以下面的代码为例:</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span><span class="token string">"&lt;span&gt;Hello World&lt;/span&gt;"</span><span class="token punctuation">)</span></span></span>
</code></pre><p>生成的对应html如下：</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content px-4<span class="token punctuation">"</span></span> <span class="token attr-name">b-1xn416caqo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        Welcome to your new app.
        <span class="token entity named-entity" title="<">&amp;lt;</span>span<span class="token entity named-entity" title=">">&amp;gt;</span>Hello World<span class="token entity named-entity" title="<">&amp;lt;</span>/span<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>要从字符串中输出实际的HTML(稍后我们会做)，可以使用以下语法：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span><span class="token punctuation">(</span>MarkupString<span class="token punctuation">)</span><span class="token string">"&lt;span&gt;Hello World&lt;/span&gt;"</span><span class="token punctuation">)</span></span></span>
</code></pre><p>生成的对应html如下：</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content px-4<span class="token punctuation">"</span></span> <span class="token attr-name">b-1xn416caqo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        Welcome to your new app.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>使用MarkupString时，输出将被视为HTML内容，直接显示HTML标签，例如span。在某些情况下，单行代码不足以完成任务时，我们可以使用代码块（code blocks）。</p>
<h3 id="directives-指令">Directives 指令 </h3>
<h4 id="adding-an-attribute-添加属性">Adding an attribute 添加属性 </h4>
<p>要向页面添加属性，我们可以使用属性指令：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@attribute">@attribute</span> <span class="token csharp language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Authorize</span></span><span class="token punctuation">]</span></span></span>
</code></pre><p>如果我们使用的是代码隐藏文件，那么我们会使用以下语法：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Authorize</span></span><span class="token punctuation">]</span>
</code></pre><h4 id="adding-an-interface-添加接口">Adding an interface 添加接口 </h4>
<p>要实现一个接口（例如IDisposable），我们可以使用以下代码：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@implements">@implements</span> <span class="token csharp language-csharp">IDisposable</span></span>
</code></pre><p>如果我们使用的是代码隐藏文件，那么我们会使用以下语法：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-partial">partial</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDisposable</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><h4 id="inheriting-继承">Inheriting 继承 </h4>
<p>要继承另一个类，我们应该使用以下代码：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@inherits">@inherits</span> <span class="token csharp language-csharp">FatherClass</span></span>
</code></pre><p>如果我们使用的是代码隐藏文件，那么我们会使用以下语法：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">TypeNameOfClassToInheritFrom</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><h4 id="generics-泛型">Generics 泛型 </h4>
<p>我们可以将我们的组件定义为一个泛型组件。泛型允许我们定义数据类型，因此组件可以使用任何数据类型。</p>
<p>要将组件定义为泛型组件，我们需要添加@typeparam指令；然后，我们可以在组件代码中像这样使用指定的类型：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">typeparam</span></span> TItem

    <span class="token block"><span class="token keyword keyword-@code">@code</span>
    <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>TItem<span class="token punctuation">&gt;</span></span> Data <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>泛型在创建可重用组件时非常强大，我们将在第6章中再次讨论泛型。</p>
<h4 id="changing-the-layout-改变布局">Changing the layout 改变布局 </h4>
<p>如果我们想要为某个页面指定特定的布局（非App.razor文件中默认指定的布局），可以使用@layout指令：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@layout">@layout</span> <span class="token csharp language-csharp">AnotherLayoutFile</span></span>
</code></pre><p>如此一来，该组件就会使用指定的布局文件（此方法仅适用于带有@page指令的组件）。</p>
<h4 id="setting-a-namespace-设置命名空间">Setting a namespace 设置命名空间 </h4>
<p>默认情况下，组件的命名空间将是项目的默认命名空间加上文件夹结构的名称，如果我们希望组件位于特定的命名空间中，可以使用以下命令：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@namespace">@namespace</span> <span class="token csharp language-csharp">Another<span class="token punctuation">.</span>NameSpace</span></span>
</code></pre><h4 id="setting-a-route-设置路由">Setting a route 设置路由 </h4>
<p>如果我们希望组件能通过URL直接访问，可以使用@page指令：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/theurl"</span></span></span>
</code></pre><p>URL可以包含参数、子文件夹等，我们将在本章后面再讨论。</p>
<h4 id="adding-a-using-statement-添加-using-语句">Adding a using statement 添加 using 语句 </h4>
<p>要在组件中使用一个命名空间，我们可以使用@using指令：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@using">@using</span> <span class="token csharp language-csharp">System<span class="token punctuation">.</span>IO</span></span>
</code></pre><p>如果有多个我们在不同组件中使用的命名空间，那么我们可以选择将它们添加到_Imports.razor中。这样一来，我们在创建的所有组件中都能访问到这些命名空间。</p>
<p>本节中还有一种我没有涉及的指令，那就是inject。虽然我们已经见过几次，但为了全面了解，首先需要理解什么是依赖注入（DI）及其工作原理，这将在下一节中详细介绍。</p>
<h2 id="understanding-dependency-injection-理解依赖注入">Understanding dependency injection 理解依赖注入 </h2>
<p>DI是一种软件模式和实现控制反转(Inversion of Control, IoC)的技术。IoC是一个通用术语，意味着我们可以指示类需要一个类实例，而不是让我们的类实例化一个对象。我们可以说我们的类想要一个特定的类或一个特定的接口。类的创建是在其他地方，它取决于IoC将创建什么类.</p>
<p>当涉及到DI时，它是一种IoC形式，对象(类实例)通过构造函数、参数或服务查找传递。</p>
<p>在Blazor中，我们可以通过提供对象实例化的方式来配置依赖注入(DI)。这是Blazor中一种我们应该充分利用的关键架构模式。我们已经在Startup.cs文件中看到过几个相关的示例：</p>
<pre data-role="codeBlock" data-info="csharrp" class="language-csharrp csharrp"><code>    services.AddSingleton&lt;WeatherForecastService&gt;();
</code></pre><p>在这段代码中，我们声明：如果任何类需要WeatherForecastService，应用程序应当实例化一个WeatherForecastService类型的对象。在这个例子中，我们并未使用接口，而是可以选择创建一个接口并按照如下方式配置：</p>
<pre data-role="codeBlock" data-info="csharrp" class="language-csharrp csharrp"><code>    services.AddSingleton&lt;IWeatherForecastService, WeatherForecastService&gt;();
</code></pre><p>在这种情况下，如果一个类请求IWeatherForecastService实例，应用程序将实例化一个WeatherForecastService对象并返回。我们在前一章——第3章“管理状态——第一部分”中就是这样做的。我们创建了一个IBlogApi接口，它返回一个BlogApiJsonDirectAccess实例；当我们实现WebAssembly版本时，DI将会返回另一个类的实例来替换它。</p>
<p>使用DI有很多优点。我们的依赖关系是松散耦合的，所以我们不需要在我们的类中实例化另一个类。相反，我们只需请求一个实例，这使得编写测试和根据平台更改实现变得更容易。</p>
<p>我们可以用不同的方式配置对象的创建，例如：</p>
<ul>
<li>Singleton 单例</li>
<li>Scoped 作用域</li>
<li>Transient 瞬态</li>
</ul>
<h3 id="singleton-单例">Singleton 单例 </h3>
<p>当我们使用单例时，对象对于所有站点用户都是相同的，对象只会被创建一次。要配置单例服务，请使用以下命令：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWeatherForecastService<span class="token punctuation">,</span> WeatherForecastService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>当我们想与我们网站的所有用户共享对象时，我们应该使用单例，但要注意状态是共享的，所以不要存储任何与特定用户或用户偏好相关联的数据，因为它会影响所有用户。</p>
<h3 id="scoped-作用域">Scoped 作用域 </h3>
<p>当我们使用“scoped”生命周期时，针对每个连接将会创建一个新的对象，并且由于Blazor Server需要维持连接才能正常工作，只要用户保持连接，那么这个对象就会保持一致。然而，WebAssembly并没有“scoped”的概念，因为它没有连接的概念，所有代码都在用户的网络浏览器内部运行。如果我们对Blazor WebAssembly使用“scoped”，由于只有一个用户并且所有内容都在浏览器内部运行，它实际上会像singleton（单例）一样工作。尽管如此，如果目的是将服务范围限定于当前用户，仍然建议使用“scoped”。这样做可以让代码在Blazor Server和Blazor WebAssembly之间更容易迁移，并且能够提供关于服务应该如何使用的更多上下文信息。</p>
<p>配置scoped服务时，请使用以下方式：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWeatherForecastService<span class="token punctuation">,</span> WeatherForecastService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>如果我们有属于用户的数据，我们应该使用scoped。我们可以通过使用scoped对象来保持用户的状态。更多内容请参见第11章，管理状态-第2部分。</p>
<h3 id="transient-瞬态">Transient 瞬态 </h3>
<p>当我们使用transient时，每次请求时都会创建一个新对象。要配置一个transient服务，请使用以下命令：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddTransient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWeatherForecastService<span class="token punctuation">,</span> WeatherForecastService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>如果我们不需要保存任何状态，也不介意每次请求时创建对象，那么我们应该使用transient。</p>
<p>既然我们已经知道如何配置服务，我们就需要通过注入来使用服务。</p>
<h2 id="injecting-the-service-注入服务">Injecting the service 注入服务 </h2>
<p>有三种方法可以注入服务：</p>
<ul>
<li>在Razor文件中使用@inject指令：</li>
</ul>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@inject">@inject</span> <span class="token csharp language-csharp">WeatherForecastService ForecastService</span></span>
</code></pre><p>这样就能确保在我们的组件中访问到WeatherForecastService。</p>
<ul>
<li>在使用代码后置（code-behind）时，通过添加Inject特性来创建一个属性：</li>
</ul>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Inject</span></span><span class="token punctuation">]</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">WeatherForecastService</span> ForecastService <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre><ul>
<li>如果我们想将一个服务注入到另一个服务中，那么我们需要使用构造函数来注入服务：</li>
</ul>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token function">MyService</span><span class="token punctuation">(</span><span class="token class-name">WeatherForecastService</span> weatherForecastService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><h2 id="figuring-out-where-to-put-the-code-弄清楚代码应该放在哪里">Figuring out where to put the code 弄清楚代码应该放在哪里 </h2>
<p>我们已经看到过直接在Razor文件中编写代码的例子，除非代码太复杂，否则我更喜欢这样做，我总是倾向于可读性。<br>
我们有四种方法来编写组件：</p>
<ul>
<li>In the Razor file 在Razor文件中</li>
<li>In a partial class 在局部类中</li>
<li>Inheriting a class 继承类</li>
<li>Only code 只用代码</li>
</ul>
<h3 id="in-the-razor-file-在razor文件中">In the Razor file 在Razor文件中 </h3>
<p>如果我们正在编写的文件不太复杂，那么不需在编写组件时切换文件就显得很理想了。正如本章中已介绍过的，我们可以使用@code指令直接在Razor文件中添加代码。但是许多开发人员更喜欢代码隐藏，将代码与布局分开，为此，我们可以使用部分类。</p>
<h3 id="in-a-partial-class-在局部类中">In a partial class 在局部类中 </h3>
<p>我们可以创建一个与Razor文件同名的部分类（partial class），并在文件名后附加扩展名.cs。</p>
<p>这并不是使用代码隐藏文件的唯一方法，我们还可以从代码隐藏文件继承。</p>
<h3 id="inheriting-a-class-继承类">Inheriting a class 继承类 </h3>
<p>我们也可以创建一个完全不同的类(通常的模式是把它叫做Razor文件中的东西，并在末尾添加Model)并在我们的Razor文件中继承它.为了使它工作，我们需要继承ComponentBase。在partial类的情况下，类已经继承了ComponentBase，因为Razor文件已经做了。</p>
<p>字段必须是protected或public(不是 private)，以便页面访问这些字段。如果我们不需要继承基类，我建议使用partial类。</p>
<p>下面是代码背后的类声明的片段：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">FetchDataWithInheritsModel</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">ComponentBase</span></span>
</code></pre><p>我们需要继承自ComponentBase类，或者从ComponentBase派生的类。</p>
<p>在Razor文件中，我们会使用@inherits指令：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@inherits">@inherits</span> <span class="token csharp language-csharp">FetchDataWithInheritsModel</span></span>
</code></pre><p>Razor文件现在将继承我们的代码后置类(这是创建代码后置类的第一种可用方法)。</p>
<h3 id="only-code-只用代码">Only code 只用代码 </h3>
<p>Visual Studio会使用源代码生成器将Razor代码转换为C#代码，我们会在第17章深入研究源代码生成器，Razor文件会在编译时生成代码，如果我们想的话，可以跳过Razor步骤，直接用代码写布局。</p>
<p>例如Counter组件的大致代码：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    using Microsoft.AspNetCore.Components;
    using Microsoft.AspNetCore.Components.Rendering;
    using Microsoft.AspNetCore.Components.Web;
    namespace BlazorServer.Pages {
        [Route("/CounterWithoutRazor")]
        public class CounterWithoutRazor: ComponentBase
        {
            protected override void BuildRenderTree
            (RenderTreeBuilder builder) {
                builder.AddMarkupContent(0, "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Counter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>\r\n\r\n");
                builder.OpenElement(1, "p");
                builder.AddContent(2, "Current count: ");
                builder.AddContent(3,currentCount);
                builder.CloseElement();
                builder.AddMarkupContent(4, "\r\n\r\n");
                builder.OpenElement(5, "button");
                builder.AddAttribute(6, "class","btn btn-primary");
                builder.AddAttribute(7,"onclick", EventCallback.Factory.Create<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MouseEventArgs</span><span class="token punctuation">&gt;</span></span>(this,IncrementCount));
                builder.AddContent(8, "Click me");
                builder.CloseElement();
            }
            private int currentCount = 0;
            private void IncrementCount() {
                currentCount++;
            }
        }
    }
</code></pre><p>Razor文件首先被转换成与前面代码大致相同的代码，然后编译代码，逐个添加元素，最终渲染HTML。</p>
<h2 id="lifecycle-events-生命周期事件">Lifecycle events 生命周期事件 </h2>
<p>我们可以使用一些生命周期事件来运行代码。在这一节中，我们将回顾它们，并了解何时应该使用它们。大多数生命周期事件有两个版本——同步和异步。</p>
<h3 id="oninitialized-and-oninitializedasync-oninitialized和oninitializedasync">OnInitialized and OnInitializedAsync OnInitialized和OnInitializedAsync </h3>
<p>当组件首次加载时，首先调用OnInitialized()方法，接着调用OnInitializedAsync()方法。这是一个非常适合加载任何数据的方法，因为在UI尚未渲染完成之前执行。如果我们正在进行耗时较长的任务（例如从数据库获取数据），应该将此类代码放在OnInitializedAsync()方法中执行。</p>
<p>这两个方法只会运行一次。如果我们希望在参数更改时更新UI，请参阅OnParametersSet()和OnParametersSetAsync()方法。这两个方法会在组件参数发生变化时被调用，以便相应地更新界面。</p>
<h3 id="onparametersset-and-onparameterssetasync-onparametersset和onparameterssetasync">OnParametersSet and OnParametersSetAsync OnParametersSet和OnParametersSetAsync </h3>
<p>当组件初始化时（在OnInitialized()和OnInitializedAsync()之后）以及每当参数值发生更改时，都会调用OnParametersSet()和OnParametersSetAsync()方法。</p>
<p>举例来说，如果我们在OnInitialized()方法中加载数据，且该数据加载依赖于某个参数，那么当该参数改变时，由于OnInitialized()方法只会运行一次，所以数据将不会重新加载。这时，我们需要在OnParametersSet()或OnParametersSetAsync()方法中触发数据的重新加载，或者将加载数据的操作移到这些方法中执行。</p>
<h3 id="onafterrender-and-onafterrenderasync-onafterrender和onafterrenderasync">OnAfterRender and OnAfterRenderAsync OnAfterRender和OnAfterRenderAsync </h3>
<p>在组件渲染完成后，会调用OnAfterRender()和OnAfterRenderAsync()方法。当这些方法被调用时，所有元素都已经完成了渲染。因此，如果我们需要/想要调用任何JavaScript代码，就必须在这两个方法中执行（若尝试从其他生命周期事件方法中进行JavaScript交互操作，将会导致错误）。同时，我们还可以通过一个名为firstRender的参数判断，只在首次渲染时运行我们的代码。</p>
<h3 id="shouldrender">ShouldRender </h3>
<p>当我们的组件准备重新渲染时，ShouldRender() 方法会被调用；如果该方法返回false，则组件将不会再次进行渲染。组件始终至少渲染一次；只有在准备重新渲染时，此方法才会运行。</p>
<p>需要注意的是，ShouldRender()方法没有异步选项可供使用。</p>
<p>现在我们知道了不同的生命周期事件发生的时间和顺序，组件也可以有参数，这样我们就可以用不同的数据重用它们。</p>
<h2 id="parameters-参数">Parameters 参数 </h2>
<p>参数功能使得向组件传递值成为可能。要在组件中添加参数，我们需在公共属性上使用[Parameter]属性：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> MyParameter <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>我们可以通过在@page指令中指定路由来添加参数：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/parameterdemo/{MyParameter}"</span></span></span>
</code></pre><p>在这种情况下，我们必须在花括号内指定一个与之名称相同的参数。为了在@page指令中设置参数，我们可以访问路径"/parameterdemo/THEVALUE"，其中"THEVALUE"是要传递给组件的实际参数值。</p>
<p>有时我们需要指定其他类型而不是字符串(字符串是默认值)，我们可以在参数名后面添加数据类型，如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/parameterdemo/{MyParameter:int}"</span></span></span>
</code></pre><p>这将匹配只有当数据类型为整数时才匹配的路由。我们还可以使用级联参数传递参数。</p>
<h2 id="cascading-parameters-级联参数">Cascading parameters 级联参数 </h2>
<p>用法：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CascadingParameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> MyParameter <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>为了将值传递给组件，我们可以将其包裹在一个CascadingValue组件中，如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CascadingValue</span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyProperty<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComponentWithCascadingParameter</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CascadingValue</span><span class="token punctuation">&gt;</span></span> 

    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> MyProperty <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">"Test Value"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>在此处，CascadingValue是我们传递给组件的值，而CascadingParameter则是接收这个值的属性。</p>
<p>如我们所见，我们并未直接向ComponentWithCascadingParameter组件传递任何参数值，而是通过级联值匹配具有相同数据类型的参数。如果有多个相同类型的参数，我们可以在带有CascadingParameter的组件中通过指定参数名称来区分：</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CascadingParameter</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">"MyCascadingParameter"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
</code></pre><p>同样，我们也可以为传递CascadingValue的组件指定名称：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CascadingValue</span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyProperty<span class="token punctuation">"</span></span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyCascadingParameter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComponentWithCascadingParameter</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CascadingValue</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>如果我们知道该值不会发生变化，可以通过设置IsFixed属性来指定这一点：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CascadingValue</span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyProperty<span class="token punctuation">"</span></span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyCascadingParameter<span class="token punctuation">"</span></span> <span class="token attr-name">IsFixed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>True<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComponentWithCascadingParameter</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CascadingValue</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>这样，Blzor就不会寻找变化。级联的值/参数不能向上更新，只能向下更新，这意味着要更新一个级联的值，我们需要用另一种方式实现它，从组件内部更新它不会改变任何在层次结构中的更高的组件。</p>
<p>在第5章中，我们将学习事件，这是解决级联值更新问题的一种方法。</p>
<p>这一章内容很丰富，但现在我们已经了解了Blazor组件的基本知识，是时候构建一个组件了！</p>
<h2 id="writing-our-first-component-编写第一个组件">Writing our first component 编写第一个组件 </h2>
<ol>
<li>创建Razor类库类型的新项目，命名为Components。</li>
<li>删除默认的Component1.razor和ExampleJsInterop.cs文件。</li>
<li>引用Data.Models项目。</li>
<li>删除BlazorServer项目中的Shared文件夹，再删除Pages文件夹里的所有razor文件。</li>
<li>从 BlazorWebAssembly.Client 项目中移动一些文件，这些文件可以在项目之间共享。</li>
</ol>
<h1 id="creating-advanced-blazor-components-创建高级blazor组件">Creating Advanced Blazor Components 创建高级Blazor组件 </h1>
<h2 id="exploring-binding-探索绑定">Exploring binding 探索绑定 </h2>
<p>在Blazor中，我们有两种不同的方法可以将值绑定到组件：</p>
<ul>
<li>One-way binding 单向绑定</li>
<li>Two-way binding 双向绑定</li>
</ul>
<p>通过使用绑定，我们可以在组件之间发送信息，并确保我们可以在需要时更新值。</p>
<h3 id="one-way-binding-单向绑定">One-way binding 单向绑定 </h3>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/counter"</span></span></span>
    <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">rendermode</span></span> InteractiveServer

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PageTitle</span><span class="token punctuation">&gt;</span></span>Counter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PageTitle</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Counter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>status<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Current count: <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">currentCount</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary<span class="token punctuation">"</span></span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IncrementCount<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> currentCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">IncrementCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            currentCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>该组件将会展示当前计数并包含一个按钮，点击该按钮可以递增当前计数。这是一种单向绑定的实现方式。尽管按钮的状态可以发生变化，但currentCount值的流向始终是单向的。</p>
<p>我们可以为Counter组件添加一个参数：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/counter"</span></span></span>
    <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">rendermode</span></span> InteractiveServer

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PageTitle</span><span class="token punctuation">&gt;</span></span>Counter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PageTitle</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Counter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>status<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Current count: <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">CurrentCount</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary<span class="token punctuation">"</span></span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IncrementCount<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>    
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> IncrementAmount <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> CurrentCount <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    

        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">IncrementCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            CurrentCount <span class="token operator">+=</span> IncrementAmount<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>代码示例中有两个参数，一个用于CurrentCount，另一个用于IncrementAmount。通过向组件添加参数，我们可以改变它们的行为。我们现在可以将这个组件添加到另一个组件上。这就是我们如何创建一个可重用组件，并通过更改参数的值来更改其行为。</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/"</span></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PageTitle</span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PageTitle</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    Welcome to your new app.
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Counter</span> <span class="token attr-name">IncrementAmount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">incrementAmount</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">CurrentCount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">currentCount</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Counter</span><span class="token punctuation">&gt;</span></span>

    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> incrementAmount <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> currentCount <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>在这个示例中，我们有两个变量incrementAmount和currentCount，这两个变量被我们传递给Counter组件。</p>
<h3 id="two-way-binding-双向绑定">Two-way binding 双向绑定 </h3>
<p>双向绑定会在两个方向上同步数据，这意味着我们的Counter组件能够在值发生更改时通知父组件。下一章我们将更深入地探讨双向绑定。</p>
<p>为了使Counter组件实现双向绑定，我们需要添加EventCallback。其名称必须由参数名称后跟"Changed"组成，这样一来，当值发生变化时，Blazor会自动更新该值。以我们的情况为例，我们需要将其命名为CurrentCountChanged。此时代码应如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>    
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">EventCallback<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> CurrentCountChanged  <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> IncrementAmount <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> CurrentCount <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    

        <span class="token comment">// private void IncrementCount() {</span>
        <span class="token comment">//     CurrentCount += IncrementAmount;</span>
        <span class="token comment">// }</span>

        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-async">async</span> <span class="token return-type class-name">Task</span> <span class="token function">IncrementCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            CurrentCount <span class="token operator">+=</span> IncrementAmount<span class="token punctuation">;</span>
            <span class="token keyword keyword-await">await</span> CurrentCountChanged<span class="token punctuation">.</span><span class="token function">InvokeAsync</span><span class="token punctuation">(</span>CurrentCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>通过遵循这种命名约定，Blazor就能知道当CurrentCount发生变化时，应该触发CurrentCountChanged事件。</p>
<p>另外请注意，EventCallback不能为null，所以在调用时无需进行空值检查（关于这一点，我们将在下一节进一步讨论）。</p>
<p>我们也需要更改监听变化的方式，在CurrentCount绑定前添加@bind-前缀：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/"</span></span></span>
    <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">rendermode</span></span> InteractiveServer
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PageTitle</span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PageTitle</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    Welcome to your new app.
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Counter</span> <span class="token attr-name">IncrementAmount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">incrementAmount</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">@bind-CurrentCount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>currentCount<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    
    
    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> incrementAmount <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> currentCount <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>也可以使用以下语法来设置事件的名称：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Counter</span> <span class="token attr-name">IncrementAmount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">incrementAmount</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">@bind-CurrentCount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>currentCount<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">@bind-CurrentCount:</span>event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CurrentCountChanged<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><p>通过使用:event，我们可以明确告知Blazor我们想要使用的具体事件；在这个例子中，就是 CurrentCountChanged事件。</p>
<p>在下一章，第6章，使用验证构建表单，我们将继续研究与input/form组件的绑定。</p>
<p>当然，我们也可以使用EventCallback创建事件。</p>
<h2 id="actions-and-eventcallback-动作和事件回调">Actions and EventCallback 动作和事件回调 </h2>
<p>为了实现组件间的通信和数据变化的通知，我们可以使用EventCallback，就像在双向绑定部分所展示的那样。EventCallback<t>与我们在.NET中常见的事件处理机制略有不同。EventCallback<t>是专门为Blazor设计的一个类，使得组件能够将其事件回调作为参数公开。</t></t></p>
<p>在.NET中，通常可以为一个事件添加多个监听器（多播），而使用EventCallback<t>时，只能添加一个监听器（单播）。</t></p>
<p>值得一提的是，在Blazor中，你可以沿用.NET中熟悉的事件处理方式，不过通常建议使用EventCallback<t>，因为它相比传统的.NET事件有很多优势。</t></p>
<p>.NET事件通常基于类，而EventCallback基于结构体。这意味着在Blazor中，在调用EventCallback之前无需进行空值检查，因为结构体不能为null。</p>
<p>EventCallback是异步的，可以被await。当EventCallback被调用时，Blazor会自动在消费组件上调用StateHasChanged方法，确保组件进行更新（如果需要的话）。</p>
<p>因此，如果你需要支持多个监听器，可以选择使用Action<t>。否则，最佳做法是使用EventCallback<t>。</t></t></p>
<p>有些事件类型有我们可以访问的事件参数，它们是可选的，所以在大多数情况下你不需要添加它们。</p>
<p>你可以在方法中指定它们，或者使用Lambda表达式，如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Msg <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>ClientX</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>ClientY</span><span class="token punctuation">}</span></span><span class="token string">"</span></span> <span class="token punctuation">)</span></span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>OK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> Msg <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>ClientX</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>ClientY</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span></span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>OK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre><h2 id="using-renderfragment-使用renderfragment">Using RenderFragment 使用RenderFragment </h2>
<p>为了使我们的组件更具可重用性，我们可以为它们提供一段Razor语法。在Blazor中，你可以指定RenderFragment，这是一个你可以执行和显示的Razor语法片段。</p>
<p>现在我们已经添加了动作并使用EventCallback来传递更改，我们将在下一节中看到如何执行RenderFragment。</p>
<p>有两种类型的渲染元素，RenderFragment和RenderFragment<t>。RenderFragment仅仅是一个没有任何输入参数的Razor片段，而RenderFragment<t>有一个输入参数，你可以在Razor片段代码内部通过使用context关键字来使用这个参数。现在我们不会深入探讨如何使用这个特性，但在本章后续部分，我们会讨论一个使用RenderFragment<t>的组件（Virtualize），并且在下一章，即第6章《构建带有验证功能的表单》中，我们将实现一个使用RenderFragment<t>的组件。</t></t></t></t></p>
<p>我们不仅可以将RenderFragment作为组件标签内的默认内容，还可以为其赋予一个默认值。接下来，我们将探索这一特性并利用这些功能构建一个组件。</p>
<p>如果你想深入了解渲染片段（Render Fragments）的工作原理，请查阅Blazm.Components项目，其中包含了一个大量使用RenderFragment<t>的网格组件。在我目前工作的场合，我们正是在使用这个组件，并且它是基于真实世界场景开发而成的。<br>
<a href="https://github.com/EngstromJimmy/Blazm.Components">https://github.com/EngstromJimmy/Blazm.Components</a></t></p>
<h2 id="childcontent">ChildContent </h2>
<p>通过将渲染片段命名为ChildContent，Blazor将会自动将组件标签之间的东西作为内容使用。但是，这种方式仅适用于你使用单个渲染片段的情况；如果你使用了多个渲染片段，则还需要明确指定ChildComponent标签。</p>
<h2 id="default-value-默认值">Default value 默认值 </h2>
<p>我们可以通过以下方式为RenderFragment提供一个默认值或在代码中使用@符号来设置它：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token delegate-operator operator">@</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>This is a default value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>;
</code></pre><h2 id="building-an-alert-component-构建警报组件">Building an alert component 构建警报组件 </h2>
<p>为了更好地理解如何使用渲染片段，让我们构建一个alert组件。内置模板使用Bootstrap，所以我们对这个组件也做同样的事情。Bootstrap有很多组件，很容易导入Blazor。当与多个开发人员一起工作在大型项目中时，构建组件是一种确保团队中的每个人都在以同样的方式编写代码的简单方法。</p>
<p>让我们基于Bootstrap构建一个简单的警告组件：</p>
<ol>
<li>在Components项目中新建RazorComponents文件夹。</li>
<li>创建名为Alert.razor的Razor组件，内容如下：</li>
</ol>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert alert-primary<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        A simple primary alert—check it out!
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>我们接着讨论渲染片段：</p>
<ol>
<li>在代码区域中添加一个名为ChildContent的RenderFragment属性，并将警告文本替换为新属性：</li>
</ol>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert alert-primary<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">ChildContent</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">RenderFragment</span> ChildContent <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span><span class="token html"><span class="token delegate-operator operator">@</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>This is a default value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>现在我们创建了一个RenderFragment，并为其设置了默认值，该值会在div标签之间显示。接下来，我们还希望添加一个枚举来指定警告框的不同样式。</p>
<ol start="2">
<li>在代码区域内添加一个包含所有可用样式的枚举：</li>
</ol>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    public enum AlertStyle {
        Primary,
        Secondary,
        Success,
        Danger,
        Warning,
        Info,
        Light,
        Dark
    }
</code></pre><ol start="3">
<li>然后为枚举样式添加一个参数/属性：</li>
</ol>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    [Parameter]
    public AlertStyle Style { get; set; }
</code></pre><ol start="4">
<li>最后一步是对div的class属性进行更新。将class属性修改为如下形式：</li>
</ol>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"alert alert-</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Style<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span></span><span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">ChildContent</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>整体如下：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"alert alert-</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Style<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span></span><span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">ChildContent</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-enum">enum</span> <span class="token class-name">AlertStyle</span> <span class="token punctuation">{</span>
            Primary<span class="token punctuation">,</span>
            Secondary<span class="token punctuation">,</span>
            Success<span class="token punctuation">,</span>
            Danger<span class="token punctuation">,</span>
            Warning<span class="token punctuation">,</span>
            Info<span class="token punctuation">,</span>
            Light<span class="token punctuation">,</span>
            Dark
        <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">AlertStyle</span> Style <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span>
        <span class="token keyword keyword-public">public</span> <span class="token return-type class-name">RenderFragment</span> ChildContent <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token html"><span class="token delegate-operator operator">@</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>This is a default value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><ol start="5">
<li>在Pages文件夹中新建razor组件，名为AlertTest.razor，内容如下：</li>
</ol>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/alerttest"</span></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Alert</span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css">Alert.AlertStyle.Danger</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
        This is a test
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Alert</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Alert</span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css">Alert.AlertStyle.Success</span><span class="token punctuation">"</span></span></span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildContent</span><span class="token punctuation">&gt;</span></span>
            This is another test
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ChildContent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Alert</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Alert</span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css">Alert.AlertStyle.Success</span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><p>运行效果如下：<br>
<img src="2024-03-29-13-16-54.png" alt=""></p>
<p>第1个示例使用了Danger样式，而对于"This is a test text"文本，我们并未明确指定使用哪个属性来设置其内容，但按照约定，它会使用名为ChildContent的属性。</p>
<p>第2个示例明确指定了ChildContent属性。如果你在组件中使用了多个渲染片段（RenderFragment），则必须像这样使用完整名称来设置它们。</p>
<p>第3个示例没有明确指定任何内容来赋予该属性组件中定义的默认渲染片段。</p>
<p>我们已经完成了第一个可重用组件！</p>
<p>当我们升级到最新版本的Bootstrap时，一些CSS类被弃用并被其他类所取代。 谢天谢地，我们遵循了这种方法，通过制作可重用组件，所以我们只需要改变少量的地方。在一些地方，我们仍然有一些旧的代码基(没有使用组件)，并且很明显，创建组件是值得的。</p>
<h2 id="exploring-the-new-built-in-components-探索新的内置组件">Exploring the new built-in components 探索新的内置组件 </h2>
<h3 id="setting-the-focus-of-the-ui-设置ui的焦点">Setting the focus of the UI 设置UI的焦点 </h3>
<ol>
<li>在Pages中新建一个razor组件SetFocus.razor：</li>
</ol>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token directive"><span class="token keyword keyword-@page">@page</span> <span class="token csharp language-csharp"><span class="token string">"/SetFocus"</span></span></span>
    <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">rendermode</span></span> InteractiveServer

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>textInput<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>() =&gt; textInput.FocusAsync()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Set focus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token class-name">ElementReference</span> textInput<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>通过使用@ref，我们可以为任何类型的组件或标签指定一个引用，以便于访问输入框。按钮的 onclick方法将会执行FocusAsync()方法，并将焦点设置在文本框上。</p>
<h3 id="influencing-the-html-head-影响html头部">Influencing the HTML head 影响HTML头部 </h3>
<p>有时，我们希望能够设置页面标题或更改社交网络元标签。这些标签位于_blazor.server.js（Blazor Server模式下）或index.html（Blazor WebAssembly模式下），这部分页面并不会随着应用内容的重新加载或重绘而改变（只有app组件内部的组件才会重绘）。有一个叫做HeadOutlet的组件可以解决这个问题。</p>
<h3 id="component-virtualization-组件虚拟化">Component virtualization 组件虚拟化 </h3>
<p>Virtualize是Blzor中的一个组件，它可以确保只渲染适合屏幕的组件或行，如果你有一个大的项目列表，渲染所有项目会对内存产生很大的影响。</p>
<p>虚拟化组件（Virtualize component）能够根据屏幕窗口大小及item的高度计算出屏幕上能容纳多少个items。当你滚动页面时，Blazor会在内容列表前后添加一个div标签，确保滚动条显示的是正确的位置和比例（即使此时并没有渲染出所有项目）。</p>
<p>虚拟化组件就像一个foreach循环那样工作。<br>
例如：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token block"><span class="token keyword keyword-@foreach">@foreach</span> <span class="token csharp language-csharp"><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> p <span class="token keyword keyword-in">in</span> posts<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/Post/<span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">p<span class="token punctuation">.</span>Id</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">p<span class="token punctuation">.</span>Title</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token punctuation">}</span></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>它会以一个长列表的形式显示我们数据库中的所有博客文章，虽然我们现在只有几个，但我们可能有一天会有很多文章。</p>
<p>我们可以将现有代码改为使用新的虚拟化组件，代码如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Virtualize</span> <span class="token attr-name">Items</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">Context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/Post/<span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">p<span class="token punctuation">.</span>Id</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">p<span class="token punctuation">.</span>Title</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Virtualize</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>相比于传统的foreach循环，我们现在改用虚拟化组件，并添加一个渲染片段以定义每个项目应该如何渲染。虚拟化组件使用了RenderFragment<t>，默认情况下会将类型为T的项目传递给渲染片段。对于虚拟化组件来说，由于items是一个List<t>类型的博客文章集合，所以对象将会是单个博客文章。我们通过名为context的变量来访问每个文章，不过也可以利用Virtualize组件上的Context属性指定其他名称，因此这里我们不再使用context，而是使用了p来表示每个博客文章。<br>
如上所述，也可以通过名为context的变量来访问每个文章：</t></t></p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Virtualize</span> <span class="token attr-name">Items</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/Post/<span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">context<span class="token punctuation">.</span>Id</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">context<span class="token punctuation">.</span>Title</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Virtualize</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="error-boundaries-错误边限">Error boundaries 错误边限 </h3>
<p>我们可以将组件包裹在一个ErrorBoundary组件内；如果发生错误，它将显示错误消息而不是导致整个页面失效：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComponentWithError</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>我们还可以提供一个定制的错误消息，如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildContent</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ComponentWithError</span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ChildContent</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorContent</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">red</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>Oops... something broke<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorContent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>这是一个极好的可扩展组件，可用于创建您自己的功能。您可以像处理virtualize那样，通过context参数来获取异常信息，这里演示除零错误：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span> <span class="token attr-name">Context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>ex</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildContent</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp"><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>zero<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ChildContent</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorContent</span><span class="token punctuation">&gt;</span></span>
            An error occurred <span class="token value variable"><span class="token keyword keyword-@">@</span><span class="token csharp language-csharp">ex<span class="token punctuation">.</span>Message</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorContent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">&gt;</span></span>

    <span class="token block"><span class="token keyword keyword-@code">@code</span> <span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-int">int</span></span> zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>这是在 UI 中处理错误的好方法。</p>
<h1 id="building-forms-with-validation-构建带有验证的表单">Building Forms with Validation 构建带有验证的表单 </h1>
<h2 id="exploring-form-elements-探索表单元素">Exploring form elements 探索表单元素 </h2>
<p>Blazor有可以添加功能的组件，因此我们可以而且应该尝试使用这些组件而不是HTML元素。内置组件将免费为我们提供强大的功能；我们将在本章稍后部分再讨论这一点。</p>
<p>Blazor 提供以下组件：</p>
<ul>
<li>EditForm</li>
<li>InputBase&lt;&gt;</li>
<li>InputCheckbox</li>
<li>InputDate<tvalue></tvalue></li>
<li>InputNumber<tvalue></tvalue></li>
<li>InputSelect<tvalue></tvalue></li>
<li>InputText</li>
<li>InputTextArea</li>
<li>InputRadio</li>
<li>InputRadioGroup</li>
<li>ValidationMessage</li>
<li>ValidationSummary</li>
</ul>
<h3 id="editform">EditForm </h3>
<p>EditForm呈现为form标记，但它具有更多功能。首先，我们不会有像传统form标签那样的操作或方法；Blazor将处理所有这一切。EditForm将创建一个EditContext实例作为级联值，以便您放入EditForm内的所有组件都将访问相同的EditContext。EditContext将跟踪有关编辑过程的元数据，例如已编辑的字段，并跟踪任何验证消息。</p>
<p>您需要分配一个模型（您想要编辑的类）或一个EditContext实例。</p>
<p>对于大多数用例，分配模型是可行的方法，但对于更高级的场景，您可能希望能够触发EditContext.Validate()，例如，验证连接到EditContext的所有控件。</p>
<p>EditForm具有以下可用于处理表单提交的事件：</p>
<ul>
<li>当表单中的数据正确验证时，OnValidSubmit就会被触发（我们稍后会回到验证）。</li>
<li>如果表单验证不正确，OnInvalidSubmit将被触发。</li>
<li>提交表单时会触发OnSubmit，无论表单验证是否正确。如果您想自己控制验证，请使用OnSubmit。</li>
</ul>
<p>考虑一个包含一个人的类，这个类包含这个人的姓名和年龄，如下所示：</p>
<pre data-role="codeBlock" data-info="razor" class="language-razor razor"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditForm</span> <span class="token attr-name">Model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>personModel<span class="token punctuation">"</span></span> <span class="token attr-name">OnValidSubmit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>validSubmit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sumbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EditForm</span><span class="token punctuation">&gt;</span></span>

    <span class="token block"><span class="token keyword keyword-@code">@code</span><span class="token csharp language-csharp"><span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
            <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token keyword keyword-set">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-private">private</span> <span class="token class-name">Person</span> personModel<span class="token operator">=</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-private">private</span> <span class="token return-type class-name">Task</span> <span class="token function">validSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Task</span> task <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> task<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></span></span>
</code></pre><p>EditForm指定一个模型（在本例中为personModel），我们正在侦听OnValidSubmit事件。Submit按钮是常规HTML按钮，不是特定的Blazor组件。</p>
<h3 id="inputbase">InputBase&lt;&gt; </h3>
<p>所有Blazor输入类均派生自InputBase类。它有很多我们可以用于所有input组件的东西；我们将讨论最重要的一些。</p>
<p>InputBase处理AdditionalAttributes，这意味着如果我们向标记添加任何其他属性，它们将自动传输到输出。这意味着从此类派生的组件可以利用任何HTML属性，因为它们将成为输出的一部分。</p>
<p>InputBase具有Value属性（我们可以绑定到该属性），以及当值更改时称为ValueChanged的事件回调。</p>
<p>我们还可以更改DisplayName，以便自动验证消息反映正确的名称而不是属性的名称，这是默认行为。</p>
<p>所有控件都不支持DisplayName属性。有些属性仅在组件内部使用，我们稍后将返回这些属性。</p>
<h3 id="inputcheckbox">InputCheckbox </h3>
<p>InputCheckbox组件将呈现为<input type="checkbox"> 。</p>
<h3 id="inputdatetvalue">InputDate<tvalue> </tvalue></h3>
<p>InputDate组件将呈现为<input type="date">。我们可以使用DateTime和DateTimeOffset作为InputDate组件的值。</p>
<p>没有办法格式化日期，它会使用浏览器的当前设置。这种行为是经过设计的，是HTML5规范的一部分。</p>
<h3 id="inputnumbertvalue">InputNumber<tvalue> </tvalue></h3>
<p>InputNumber组件将呈现为&lt;inputtype="number"&gt;。我们可以使用Int32、Int64、Single、Double和Decimal。</p>
<h3 id="inputselecttvalue">InputSelect<tvalue> </tvalue></h3>
<p>InputSelect组件将呈现为<select>。我们将在本章稍后创建InputSelect，因此这里不再赘述。
InputText 
InputText组件将呈现为</select><input type="text">。</p>
<h3 id="inputtextarea">InputTextArea </h3>
<p>InputTextArea组件将呈现为<textarea>。在本章中，我们将构建这个控件的我们自己的版本。&lt;/p&gt;
&lt;h3 id="inputradio"&gt;InputRadio &lt;/h3&gt;
&lt;p&gt;InputRadio组件将呈现为&lt;input type="radio"&gt; 。&lt;/p&gt;
&lt;h3 id="inputradiogroup"&gt;InputRadioGroup &lt;/h3&gt;
&lt;p&gt;InputRadioGroup组件将呈现为一组子单选按钮，&lt;Input type="radio"&gt; 。&lt;/p&gt;
&lt;h3 id="inputfile"&gt;InputFile &lt;/h3&gt;
&lt;p&gt;InputFile组件将呈现为&lt;Input type="file"&gt;。该组件将使获取文件数据变得更加容易。它将为我们提供每个文件内容的流。&lt;/p&gt;
&lt;p&gt;如我们所见，几乎所有的HTML表单控件都有一个Blazor组件，它还附带了一些验证等功能。&lt;/p&gt;
&lt;h2 id="adding-validation"&gt;Adding validation &lt;/h2&gt;
&lt;p&gt;我们已经谈到了验证；input组件和EditForm中有一些内置功能来处理验证。向表单添加验证的一种方法是使用DataAnnotations。使用数据注释，我们不必编写任何自定义逻辑来确保表单中的数据正确；相反，我们可以向数据模型添加属性，然后让DataAnnotationsValidator处理其余的事情。&lt;/p&gt;
&lt;p&gt;.NET中已经有很多我们可以使用的DataAnnotations实例；我们还可以构建自己的注释。一些内置的数据注释如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Required：使该字段成为必填字段。&lt;/li&gt;
&lt;li&gt;Email：将检查输入的值是否是电子邮件地址。&lt;/li&gt;
&lt;li&gt;MinLength：将检查字符数是否不少于指定的值。&lt;/li&gt;
&lt;li&gt;MaxLength：将检查字符数是否未超出。&lt;/li&gt;
&lt;li&gt;Range：将检查该值是否在特定范围内。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;还有更多注释可以帮助我们验证数据。为了测试这一点，让我们向数据类添加数据注释：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input @bind="msg"&gt;&lt;/input&gt;

    @code{     
        [Required,MinLength(5)]
        private string msg { get; set; } = "Sumbit";        
    }
&lt;/pre&gt;&lt;h2 id="validationmessage-验证消息"&gt;ValidationMessage 验证消息 &lt;/h2&gt;
&lt;p&gt;ValidationMessage 组件可以向我们显示特定属性的单独错误消息。我们希望使用此组件来显示表单元素下的验证错误。要添加 ValidationMessage 组件，我们必须指定 For 属性以及我们想要显示验证错误的属性名称：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;ValidationMessage For="@(() =&gt; model.Name)"/&gt;
&lt;/pre&gt;&lt;h3 id="validationsummary"&gt;ValidationSummary &lt;/h3&gt;
&lt;p&gt;ValidationSummary 组件会将所有验证错误显示为整个 EditContext 的列表。&lt;/p&gt;
&lt;p&gt;为了确保输入控件与 Bootstrap 主题(或任何我们可能使用的主题)匹配，我们可以创建自定义验证类。&lt;/p&gt;
&lt;h3 id="custom-validation-class-attributes-自定义验证类属性"&gt;Custom validation class attributes 自定义验证类属性 &lt;/h3&gt;
&lt;h2 id="looking-at-bindings-查看绑定"&gt;Looking at bindings 查看绑定 &lt;/h2&gt;
&lt;h3 id="binding-to-html-elements-绑定到-html-元素"&gt;Binding to HTML elements 绑定到 HTML 元素 &lt;/h3&gt;
&lt;p&gt;对于HTML元素，我们可以使用@bind绑定到该元素。&lt;br&gt;
如果我们要绑定到一个文本框，我们可以这样做：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input type="text" @bind="Msg"/&gt;
&lt;/pre&gt;&lt;p&gt;@bind和@bind-value都可以工作并且做同样的事情。请注意小写的v。&lt;/p&gt;
&lt;p&gt;默认情况下，当文本框失去焦点时，变量中的值将会改变。但我们可以通过添加@bind:event属性来更改该行为：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input @bind="msg" @bind:event="oninput" /&gt;
&lt;/pre&gt;&lt;p&gt;我们甚至可以通过使用@bind:get和@bind:set属性来完全控制正在发生的事情，它们与@bind执行相同的操作，因此我们不能将它们与@bind一起使用。示例如下：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input @bind:event="oninput" @bind:get="inputValue" @bind:set="OnInput" /&gt;
    &lt;p&gt;@inputValue&lt;/p&gt;

    @code {
        private string? inputValue;

        private void OnInput(string value) {
            var newValue = value ?? string.Empty;
            inputValue = newValue.Length &gt; 4 ? "Long!" : newValue;
        }
    }
&lt;/pre&gt;&lt;p&gt;@bind:set属性还有另一个不错的功能。当我们设置一个值时，我们可以运行异步方法。&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input @bind:event="oninput" @bind:get="inputValue" @bind:set="OnInput" /&gt;
    &lt;p&gt;@inputValue&lt;/p&gt;

    @code {
        private string? inputValue;

        private async void OnInput(string value) {
            await Task.Delay(100);
            var newValue = value ?? string.Empty;
            inputValue = newValue.Length &gt; 4 ? "Long!" : newValue;
        }
    }
&lt;/pre&gt;&lt;p&gt;我们还有一种方法可以在设置值后运行方法，使用@bind:after即可：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input @bind:event="oninput" @bind="inputValue" @bind:after="OnInputAfter" /&gt;
    &lt;input @bind:event="oninput" @bind="inputValue" @bind:after="OnInputAfterAsync" /&gt;
    &lt;p&gt;@inputValue&lt;/p&gt;

    @code {
        private string? inputValue;

        private void OnInputAfter() {

            inputValue = inputValue.Length &gt; 4 ? "Long!" : inputValue;
        }

        private async Task OnInputAfterAsync() {
            await Task.Delay(100);
            inputValue = inputValue.Length &gt; 4 ? "Long!" : inputValue;
        }
    }
&lt;/pre&gt;&lt;p&gt;最重要的是，我们还可以使用@bind:culture设置区域性。日期和数字字段都使用不变的区域性，并将使用适当的浏览器格式，但也可以通过@bind:culture更改，不过并不建议更改。如下所示：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input type="text" @bind="dateTime" @bind:culture="@(new CultureInfo("en-us"))" /&gt;

    @code {
        private DateTime dateTime = DateTime.Now;
    }
&lt;/pre&gt;&lt;p&gt;最后，我们可以使用@bind:format设置格式。这只对DateTime有效，其他格式表达式（如货币或数字格式）目前不可用：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;input type="text" @bind="dateTime" @bind:format="yyyy/MM/dd"/&gt;
&lt;/pre&gt;&lt;h3 id="binding-to-components-绑定到组件"&gt;Binding to components 绑定到组件 &lt;/h3&gt;
&lt;p&gt;绑定到组件时Get、Set和After也将起作用。Culture、Event和Format适用于某些组件。&lt;/p&gt;
&lt;p&gt;绑定到组件时，我们使用@bind-{ParameterName}，因此对于参数Value，它看起来像这样：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;InputText @bind-Value="msg"/&gt;

    @code {        
        private string msg { get; set; } = "The msg";
    }
&lt;/pre&gt;&lt;p&gt;在后台，@bind-Value将影响另外两个参数，ValueExpression和ValueChanged。这意味着如果您使用@bind-Value，您将无法手动设置它们。当我们改变值时，ValueChanged就会被触发，我们可以监听该事件并在它改变时让事情发生。&lt;/p&gt;
&lt;p&gt;我们还可以像这样使用Get和Set，注意必须始终提供Get和Set：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;InputText @bind-Value:get="msg" @bind-Value:set="@(value =&gt; msg = $"{value}11")"/&gt;
    &lt;InputText @bind-Value:get="msg" @bind-Value:set="OnSetAsync" /&gt;

    @code {
        private async Task OnSetAsync(string value) {
            await Task.Delay(100);
            msg = value.Length &gt; 4 ? "Long!" : value;
        }
    }
&lt;/pre&gt;&lt;p&gt;这些示例使用内置Blazor组件InputText，但此概念适用于任何组件上的任何参数。After也是如此。它可以与任何组件一起使用，如下所示：&lt;/p&gt;
&lt;pre data-role="codeBlock" data-info="razor" data-parsed-info="{"language":"razor","attributes":{"class":"razor"}}" data-normalized-info="{"language":"razor","attributes":{"class":"razor"}}" &gt;    &lt;InputText @bind-Value="msg" @bind-Value:after="() =&gt; { }" /&gt;
    &lt;InputText @bind-Value="msg" @bind-Value:after="OnInputAfterAsync" /&gt;

    @code {
        private async Task OnInputAfterAsync() {
            await Task.Delay(100);
            msg = msg.Length &gt; 4 ? "Long!" : msg;
        }
    }
&lt;/pre&gt;&lt;p&gt;我们可以使用一些不错的绑定特性，它们在绑定到组件和HTML元素时都能正常工作。&lt;/p&gt;
&lt;h3 id="building-an-admin-interface-构建管理界面"&gt;Building an admin interface 构建管理界面 &lt;/h3&gt;
</textarea></p>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>